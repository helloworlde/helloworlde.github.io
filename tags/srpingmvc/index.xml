<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>SrpingMVC on HelloWood</title><link>https://blog.hellowood.dev/tags/srpingmvc/</link><description>Recent content in SrpingMVC on HelloWood</description><generator>Hugo</generator><language>cn</language><lastBuildDate>Wed, 04 Dec 2024 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.hellowood.dev/tags/srpingmvc/index.xml" rel="self" type="application/rss+xml"/><item><title>Spring MVC简单实现国际化/多语言</title><link>https://blog.hellowood.dev/posts/spring-mvc%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0%E5%9B%BD%E9%99%85%E5%8C%96-%E5%A4%9A%E8%AF%AD%E8%A8%80/</link><pubDate>Mon, 01 Jan 2018 11:48:46 +0800</pubDate><guid>https://blog.hellowood.dev/posts/spring-mvc%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0%E5%9B%BD%E9%99%85%E5%8C%96-%E5%A4%9A%E8%AF%AD%E8%A8%80/</guid><description>&lt;blockquote&gt;
&lt;p&gt;SpringMVC 可以通过Spring框架来实现多语言&lt;/p&gt;&lt;/blockquote&gt;
&lt;h2 id="1-创建springmvc项目"&gt;1. 创建SpringMVC项目&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;配置web.xml&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;
&amp;lt;web-app xmlns=&amp;#34;http://xmlns.jcp.org/xml/ns/javaee&amp;#34;
 xmlns:xsi=&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;
 xsi:schemaLocation=&amp;#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&amp;#34;
 version=&amp;#34;3.1&amp;#34;&amp;gt;

 &amp;lt;!--Spring 配置文件--&amp;gt;
 &amp;lt;context-param&amp;gt;
 &amp;lt;param-name&amp;gt;contextConfigLocation&amp;lt;/param-name&amp;gt;
 &amp;lt;param-value&amp;gt;/WEB-INF/applicationContext.xml&amp;lt;/param-value&amp;gt;
 &amp;lt;/context-param&amp;gt;

 &amp;lt;!--监听器--&amp;gt;
 &amp;lt;listener&amp;gt;
 &amp;lt;listener-class&amp;gt;org.springframework.web.context.ContextLoaderListener&amp;lt;/listener-class&amp;gt;
 &amp;lt;/listener&amp;gt;

 &amp;lt;!--配置转发器--&amp;gt;
 &amp;lt;servlet&amp;gt;
 &amp;lt;servlet-name&amp;gt;dispatcher&amp;lt;/servlet-name&amp;gt;
 &amp;lt;servlet-class&amp;gt;org.springframework.web.servlet.DispatcherServlet&amp;lt;/servlet-class&amp;gt;
 &amp;lt;load-on-startup&amp;gt;1&amp;lt;/load-on-startup&amp;gt;
 &amp;lt;/servlet&amp;gt;
 &amp;lt;servlet-mapping&amp;gt;
 &amp;lt;servlet-name&amp;gt;dispatcher&amp;lt;/servlet-name&amp;gt;
 &amp;lt;url-pattern&amp;gt;*.action&amp;lt;/url-pattern&amp;gt;
 &amp;lt;/servlet-mapping&amp;gt;

 &amp;lt;filter&amp;gt;
 &amp;lt;filter-name&amp;gt;characterEncodingFilter&amp;lt;/filter-name&amp;gt;
 &amp;lt;filter-class&amp;gt;org.springframework.web.filter.CharacterEncodingFilter&amp;lt;/filter-class&amp;gt;
 &amp;lt;init-param&amp;gt;
 &amp;lt;param-name&amp;gt;encoding&amp;lt;/param-name&amp;gt;
 &amp;lt;param-value&amp;gt;UTF-8&amp;lt;/param-value&amp;gt;
 &amp;lt;/init-param&amp;gt;
 &amp;lt;/filter&amp;gt;
 &amp;lt;filter-mapping&amp;gt;
 &amp;lt;filter-name&amp;gt;characterEncodingFilter&amp;lt;/filter-name&amp;gt;
 &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;
 &amp;lt;/filter-mapping&amp;gt;
&amp;lt;/web-app&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;配置Spring文件(dispatcher-servlet.xml)&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;
&amp;lt;beans xmlns=&amp;#34;http://www.springframework.org/schema/beans&amp;#34;
 xmlns:xsi=&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;
 xmlns:context=&amp;#34;http://www.springframework.org/schema/context&amp;#34;
 xmlns:mvc=&amp;#34;http://www.springframework.org/schema/mvc&amp;#34;
 xsi:schemaLocation=&amp;#34;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd&amp;#34;&amp;gt;
 &amp;lt;!-- 默认使用基于注释的适配器和映射器 --&amp;gt;
 &amp;lt;mvc:annotation-driven/&amp;gt;
 &amp;lt;!-- 只把动态信息当做controller处理，忽略静态信息 --&amp;gt;
 &amp;lt;mvc:default-servlet-handler/&amp;gt;
 &amp;lt;!-- 自动扫描包中的Controlller --&amp;gt;
 &amp;lt;context:component-scan base-package=&amp;#34;controller&amp;#34;/&amp;gt;

 &amp;lt;bean class=&amp;#34;org.springframework.web.servlet.view.InternalResourceViewResolver&amp;#34;&amp;gt;
 &amp;lt;property name=&amp;#34;viewClass&amp;#34; value=&amp;#34;org.springframework.web.servlet.view.JstlView&amp;#34;/&amp;gt;
 &amp;lt;property name=&amp;#34;prefix&amp;#34; value=&amp;#34;/WEB-INF/jsp/&amp;#34;/&amp;gt;&amp;lt;!-- 前缀 --&amp;gt;
 &amp;lt;property name=&amp;#34;suffix&amp;#34; value=&amp;#34;.jsp&amp;#34;/&amp;gt;&amp;lt;!-- 后缀，自动拼接 --&amp;gt;
 &amp;lt;/bean&amp;gt;
&amp;lt;/beans&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id="2-添加多语言的配置文件"&gt;2. 添加多语言的配置文件&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;添加language_en_US.properties到src目录下&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;language.cn = \u4e2d\u6587
language.en = English
internationalisation = \u0020Internationalisation
welcome = This is the English environment
introduce= This is I18N Demo
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;添加language_zh_CN.properties到src目录下&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;language.cn = \u4e2d\u6587
language.en = English
internationalisation = \u56fd\u9645\u5316
welcome = \u8fd9\u662f\u4e2d\u6587\u73af\u5883
introduce= \u8fd9\u662f\u56fd\u9645\u5316\u7684\u4e8b\u4f8b
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id="3-加入i18n-过滤器到配置文件中"&gt;3. 加入i18n 过滤器到配置文件中&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;将配置添加到dispatcher-servelet中&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; &amp;lt;!-- 国际化资源文件 --&amp;gt;
 &amp;lt;bean id=&amp;#34;messageSource&amp;#34; class=&amp;#34;org.springframework.context.support.ReloadableResourceBundleMessageSource&amp;#34;&amp;gt;
 &amp;lt;!-- 表示多语言配置文件在根路径下，以language开头的文件--&amp;gt;
 &amp;lt;property name=&amp;#34;basename&amp;#34; value=&amp;#34;classpath:language&amp;#34;/&amp;gt;
 &amp;lt;property name=&amp;#34;useCodeAsDefaultMessage&amp;#34; value=&amp;#34;true&amp;#34;/&amp;gt;
 &amp;lt;/bean&amp;gt;

 &amp;lt;mvc:interceptors&amp;gt;
 &amp;lt;bean id=&amp;#34;localeChangeInterceptor&amp;#34; class=&amp;#34;org.springframework.web.servlet.i18n.LocaleChangeInterceptor&amp;#34;&amp;gt;
 &amp;lt;property name=&amp;#34;paramName&amp;#34; value=&amp;#34;lang&amp;#34;/&amp;gt;
 &amp;lt;/bean&amp;gt;
 &amp;lt;/mvc:interceptors&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id="4-在页面中使用多语言"&gt;4. 在页面中使用多语言&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;在Controller中添加路径&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;@Controller
public class HelloController {
 @RequestMapping(&amp;#34;/hello.action&amp;#34;)
 public String index() {
 return &amp;#34;hello&amp;#34;;
 }
}
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;在JSP页面中使用
&lt;blockquote&gt;
&lt;p&gt;通过&lt;code&gt;&amp;lt;spring:message code=&amp;quot;welcome&amp;quot;/&amp;gt;&lt;/code&gt;将配置文件中的内容读取&lt;/p&gt;</description></item><item><title>SpringMVC 生成验证码</title><link>https://blog.hellowood.dev/posts/springmvc-%E7%94%9F%E6%88%90%E9%AA%8C%E8%AF%81%E7%A0%81/</link><pubDate>Mon, 01 Jan 2018 01:04:16 +0800</pubDate><guid>https://blog.hellowood.dev/posts/springmvc-%E7%94%9F%E6%88%90%E9%AA%8C%E8%AF%81%E7%A0%81/</guid><description>&lt;blockquote&gt;
&lt;p&gt;使用 Google kaptcha 为 SpringMVC Maven 项目生成验证码&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;##1 添加依赖&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; &amp;lt;dependency&amp;gt;
 &amp;lt;groupId&amp;gt;com.github.penggle&amp;lt;/groupId&amp;gt;
 &amp;lt;artifactId&amp;gt;kaptcha&amp;lt;/artifactId&amp;gt;
 &amp;lt;version&amp;gt;2.3.2&amp;lt;/version&amp;gt;
 &amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id="2-配置文件中添加验证码生成器bean"&gt;2 配置文件中添加验证码生成器Bean&lt;/h2&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; &amp;lt;!--图片验证码--&amp;gt;
 &amp;lt;bean id=&amp;#34;captchaProducer&amp;#34; class=&amp;#34;com.google.code.kaptcha.impl.DefaultKaptcha&amp;#34;&amp;gt;
 &amp;lt;property name=&amp;#34;config&amp;#34;&amp;gt;
 &amp;lt;bean class=&amp;#34;com.google.code.kaptcha.util.Config&amp;#34;&amp;gt;
 &amp;lt;constructor-arg&amp;gt;
 &amp;lt;props&amp;gt;
 &amp;lt;prop key=&amp;#34;kaptcha.border&amp;#34;&amp;gt;no&amp;lt;/prop&amp;gt;
 &amp;lt;prop key=&amp;#34;kaptcha.image.width&amp;#34;&amp;gt;120&amp;lt;/prop&amp;gt;
 &amp;lt;prop key=&amp;#34;kaptcha.session.key&amp;#34;&amp;gt;code&amp;lt;/prop&amp;gt;
 &amp;lt;prop key=&amp;#34;kaptcha.textproducer.font.color&amp;#34;&amp;gt;blue&amp;lt;/prop&amp;gt;
 &amp;lt;prop key=&amp;#34;kaptcha.textproducer.font.size&amp;#34;&amp;gt;40&amp;lt;/prop&amp;gt;
 &amp;lt;prop key=&amp;#34;kaptcha.textproducer.char.length&amp;#34;&amp;gt;4&amp;lt;/prop&amp;gt;
 &amp;lt;/props&amp;gt;
 &amp;lt;/constructor-arg&amp;gt;
 &amp;lt;/bean&amp;gt;
 &amp;lt;/property&amp;gt;
 &amp;lt;/bean&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;配置项&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th&gt;属性&lt;/th&gt;
 &lt;th&gt;作用&lt;/th&gt;
 &lt;th&gt;说明&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.border&lt;/td&gt;
 &lt;td&gt;是否有边框&lt;/td&gt;
 &lt;td&gt;默认为true 我们可以自己设置yes，no&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.border.color&lt;/td&gt;
 &lt;td&gt;边框颜色&lt;/td&gt;
 &lt;td&gt;默认为Color.BLACK&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.border.thickness&lt;/td&gt;
 &lt;td&gt;边框粗细度&lt;/td&gt;
 &lt;td&gt;默认为1&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.producer.impl&lt;/td&gt;
 &lt;td&gt;验证码生成器&lt;/td&gt;
 &lt;td&gt;默认为DefaultKaptcha&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.textproducer.impl&lt;/td&gt;
 &lt;td&gt;验证码文本生成器&lt;/td&gt;
 &lt;td&gt;默认为DefaultTextCreator&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.textproducer.char.string&lt;/td&gt;
 &lt;td&gt;验证码文本字符内容范围&lt;/td&gt;
 &lt;td&gt;默认为abcde2345678gfynmnpwx&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.textproducer.char.length&lt;/td&gt;
 &lt;td&gt;验证码文本字符长度&lt;/td&gt;
 &lt;td&gt;默认为5&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.textproducer.font.names&lt;/td&gt;
 &lt;td&gt;验证码文本字体样式&lt;/td&gt;
 &lt;td&gt;默认为new Font(&amp;ldquo;Arial&amp;rdquo;, 1, fontSize), new Font(&amp;ldquo;Courier&amp;rdquo;, 1, fontSize)&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.textproducer.font.size&lt;/td&gt;
 &lt;td&gt;验证码文本字符大小&lt;/td&gt;
 &lt;td&gt;默认为40&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.textproducer.font.color&lt;/td&gt;
 &lt;td&gt;验证码文本字符颜色&lt;/td&gt;
 &lt;td&gt;默认为Color.BLACK&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.textproducer.char.space&lt;/td&gt;
 &lt;td&gt;验证码文本字符间距&lt;/td&gt;
 &lt;td&gt;默认为2&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.noise.impl&lt;/td&gt;
 &lt;td&gt;验证码噪点生成对象&lt;/td&gt;
 &lt;td&gt;默认为DefaultNoise&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.noise.color&lt;/td&gt;
 &lt;td&gt;验证码噪点颜色&lt;/td&gt;
 &lt;td&gt;默认为Color.BLACK&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.obscurificator.impl&lt;/td&gt;
 &lt;td&gt;验证码样式引擎&lt;/td&gt;
 &lt;td&gt;默认为WaterRipple&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.word.impl&lt;/td&gt;
 &lt;td&gt;验证码文本字符渲染&lt;/td&gt;
 &lt;td&gt;默认为DefaultWordRenderer&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.background.impl&lt;/td&gt;
 &lt;td&gt;验证码背景生成器&lt;/td&gt;
 &lt;td&gt;默认为DefaultBackground&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.background.clear.from&lt;/td&gt;
 &lt;td&gt;验证码背景颜色渐进&lt;/td&gt;
 &lt;td&gt;默认为Color.LIGHT_GRAY&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.background.clear.to&lt;/td&gt;
 &lt;td&gt;验证码背景颜色渐进&lt;/td&gt;
 &lt;td&gt;默认为Color.WHITE&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.image.width&lt;/td&gt;
 &lt;td&gt;验证码图片宽度&lt;/td&gt;
 &lt;td&gt;默认为200&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td&gt;kaptcha.image.height&lt;/td&gt;
 &lt;td&gt;验证码图片高度&lt;/td&gt;
 &lt;td&gt;默认为50&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id="3-页面添加验证码图片和输入框"&gt;3 页面添加验证码图片和输入框&lt;/h2&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; &amp;lt;div class=&amp;#34;col-md-12&amp;#34;&amp;gt;
 &amp;lt;div class=&amp;#34;col-md-7 form-control&amp;#34; style=&amp;#34;float:left; width: 60%;&amp;#34;&amp;gt;
 &amp;lt;input type=&amp;#34;text&amp;#34; id=&amp;#34;validateCode&amp;#34; name=&amp;#34;validateCode&amp;#34; placeholder=&amp;#34;验证码&amp;#34; &amp;gt;
 &amp;lt;/div&amp;gt;
 &amp;lt;div class=&amp;#34;col-md-3&amp;#34; style=&amp;#34;float: right;overflow: visible !important;&amp;#34;&amp;gt;
 &amp;lt;img src=&amp;#34;./loadValidateCode&amp;#34; id=&amp;#34;validateCodeImage&amp;#34; name=&amp;#34;validateCodeImage&amp;#34;
 style=&amp;#34;width: 100px;height: 35px;&amp;#34; onclick=&amp;#34;loadValidateCode()&amp;#34; &amp;gt;
 &amp;lt;/div&amp;gt;
 &amp;lt;/div&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id="4-页面添加刷新验证码"&gt;4 页面添加刷新验证码&lt;/h2&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; // 加载验证码
 function loadValidateCode() {
 var time = new Date().getTime();
 $(&amp;#34;#validateCodeImage&amp;#34;).attr(&amp;#39;src&amp;#39;, &amp;#39;./loadValidateCode&amp;#39;)
 }
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id="5-后台添加生成验证码"&gt;5 后台添加生成验证码&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;导入包&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; import com.google.code.kaptcha.Producer;
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;生成方法&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-Java" data-lang="Java"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;@Autowired&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;private&lt;/span&gt; Producer captchaProducer;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;private&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;final&lt;/span&gt; String VALIDATE_CODE &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;VALIDATE_CODE&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;private&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;final&lt;/span&gt; String EXPIRE_TIME &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;EXPIRE_TIME&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;@RequestMapping&lt;/span&gt;(value &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;/loadValidateCode&amp;#34;&lt;/span&gt;, method &lt;span style="color:#f92672"&gt;=&lt;/span&gt; RequestMethod.&lt;span style="color:#a6e22e"&gt;GET&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;public&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;void&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;loadValidateCode&lt;/span&gt;(HttpServletRequest request, HttpServletResponse response) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;try&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; HttpSession session &lt;span style="color:#f92672"&gt;=&lt;/span&gt; request.&lt;span style="color:#a6e22e"&gt;getSession&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;// 设置清除浏览器缓存&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; response.&lt;span style="color:#a6e22e"&gt;setDateHeader&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#34;Expires&amp;#34;&lt;/span&gt;, 0);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; response.&lt;span style="color:#a6e22e"&gt;setHeader&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#34;Cache-Control&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;no-store, no-cache, must-revalidate&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; response.&lt;span style="color:#a6e22e"&gt;addHeader&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#34;Cache-Control&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;post-check=0, pre-check=0&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; response.&lt;span style="color:#a6e22e"&gt;setHeader&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#34;Pragma&amp;#34;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#34;no-cache&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; response.&lt;span style="color:#a6e22e"&gt;setContentType&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#34;image/png&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;// 验证码一分钟内有效&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;long&lt;/span&gt; expireTime &lt;span style="color:#f92672"&gt;=&lt;/span&gt; System.&lt;span style="color:#a6e22e"&gt;currentTimeMillis&lt;/span&gt;() &lt;span style="color:#f92672"&gt;+&lt;/span&gt; 60000;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;// 将验证码放到session中&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; String validateCode &lt;span style="color:#f92672"&gt;=&lt;/span&gt; captchaProducer.&lt;span style="color:#a6e22e"&gt;createText&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; session.&lt;span style="color:#a6e22e"&gt;setAttribute&lt;/span&gt;(VALIDATE_CODE, Utils.&lt;span style="color:#a6e22e"&gt;encodeBase64&lt;/span&gt;(validateCode));&lt;span style="color:#75715e"&gt;//将加密后的验证码放到session中，确保安全&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; session.&lt;span style="color:#a6e22e"&gt;setAttribute&lt;/span&gt;(EXPIRE_TIME, expireTime);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;// 输出验证码图片&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; BufferedImage bufferedImage &lt;span style="color:#f92672"&gt;=&lt;/span&gt; captchaProducer.&lt;span style="color:#a6e22e"&gt;createImage&lt;/span&gt;(validateCode);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ServletOutputStream out &lt;span style="color:#f92672"&gt;=&lt;/span&gt; response.&lt;span style="color:#a6e22e"&gt;getOutputStream&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; ImageIO.&lt;span style="color:#a6e22e"&gt;write&lt;/span&gt;(bufferedImage, &lt;span style="color:#e6db74"&gt;&amp;#34;png&amp;#34;&lt;/span&gt;, out);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; out.&lt;span style="color:#a6e22e"&gt;flush&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; out.&lt;span style="color:#a6e22e"&gt;close&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;catch&lt;/span&gt; (IOException e) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; e.&lt;span style="color:#a6e22e"&gt;printStackTrace&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="6-登录时校验验证码"&gt;6 登录时校验验证码&lt;/h2&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; @RequestMapping(value = &amp;#34;/login&amp;#34;, method = RequestMethod.POST)
 public @ResponseBody String login(String username, String password, String validateCode) {

 // 校验验证码是否有效
 String currentValidateCode = String.valueOf(request.getSession().getAttribute(VALIDATE_CODE));
 if (System.currentTimeMillis() &amp;gt; Long.parseLong(String.valueOf(request.getSession().getAttribute(EXPIRE_TIME)))) {
 return JSON.toJSONString(&amp;#34;验证码已过期，请重试&amp;#34;);
 }

 // 校验验证码
 String currentValidateCode = String.valueOf(request.getSession().getAttribute(VALIDATE_CODE));
 if (StringUtils.isEmpty(validateCode) || validateCode.length() != 4 ||
 !Utils.encodeBase64(validateCode).equals(currentValidateCode)) {
 return JSON.toJSONString(&amp;#34;验证码错误&amp;#34;);
 }
 }
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id="7-base64加密"&gt;7 Base64加密&lt;/h2&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; public static String encodeBase64(String str) {
 sun.misc.BASE64Encoder base64Encode = new BASE64Encoder();
 return base64Encode.encode(str.getBytes());
 }
&lt;/code&gt;&lt;/pre&gt;</description></item><item><title>Spring MVC 使用 Spring Session 实现 Session 共享-Redis</title><link>https://blog.hellowood.dev/posts/spring-mvc-%E4%BD%BF%E7%94%A8-spring-session-%E5%AE%9E%E7%8E%B0-session-%E5%85%B1%E4%BA%AB-redis/</link><pubDate>Mon, 01 Jan 2018 00:07:20 +0800</pubDate><guid>https://blog.hellowood.dev/posts/spring-mvc-%E4%BD%BF%E7%94%A8-spring-session-%E5%AE%9E%E7%8E%B0-session-%E5%85%B1%E4%BA%AB-redis/</guid><description>&lt;blockquote&gt;
&lt;p&gt;使用Spring Session 通过 Redis 实现 Session 共享，用于多实例应用&lt;/p&gt;&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Spring Session 官方文档&lt;a href="https://docs.spring.io/spring-session/docs/2.0.0.M4/reference/html5/#introduction"&gt;https://docs.spring.io/spring-session/docs/2.0.0.M4/reference/html5/#introduction&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="session-共享的简单原理"&gt;Session 共享的简单原理&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;用户第一次访问应用时，应用会创建一个新的 Session，并且会将 Session 的 ID 作为 Cookie 缓存在浏览器，下一次访问时请求的头部中带着该 Cookie，应用通过获取的 Session ID 进行查找，如果该 Session 存在且有效，则继续该请求，如果 Cookie 无效或者 Session 无效，则会重新生成一个新的 Session&lt;/p&gt;
&lt;p&gt;在普通的 JavaEE 应用中，Session 信息放在内存中，当容器（如 Tomcat）关闭后，内存中的 Session 被销毁；重启后如果当前用户再去访问对应的是一个新的 Session ，在多实例中无法共享，一个用户只能访问指定的实例才能使用相同的 Session；&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Session 共享实现的原理是将原来内存中的 Session 放在一个需要共享 Session 的实例都可以访问到的位置，如数据库，Redis 中等，从而实现多实例 Session 共享&lt;/p&gt;
&lt;p&gt;实现共享后，只要浏览器的 Cookie 中的 Session ID 没有改变，多个实例中的任意一个被销毁不会影响用户访问&lt;/p&gt;&lt;/blockquote&gt;
&lt;hr&gt;
&lt;h1 id="redis-方式实现"&gt;Redis 方式实现&lt;/h1&gt;
&lt;blockquote&gt;
&lt;p&gt;将 Session 对象序列化存储到 Redis 中，多个实例访问时都会使用该 Session，Spring Session 会管理 Session 信息的管理，无需其他操作&lt;/p&gt;</description></item></channel></rss>