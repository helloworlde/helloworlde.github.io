<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Seata on HelloWood</title><link>https://blog.hellowood.dev/tags/seata/</link><description>Recent content in Seata on HelloWood</description><generator>Hugo</generator><language>cn</language><lastBuildDate>Wed, 04 Dec 2024 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.hellowood.dev/tags/seata/index.xml" rel="self" type="application/rss+xml"/><item><title>Seata 高可用部署实践</title><link>https://blog.hellowood.dev/posts/seata-%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5/</link><pubDate>Fri, 10 Apr 2020 10:51:17 +0800</pubDate><guid>https://blog.hellowood.dev/posts/seata-%E9%AB%98%E5%8F%AF%E7%94%A8%E9%83%A8%E7%BD%B2%E5%AE%9E%E8%B7%B5/</guid><description>&lt;p&gt;使用配置中心和数据库来实现 Seata 的高可用，以 Nacos 和 MySQL 为例，将&lt;a href="https://github.com/helloworlde/spring-cloud-alibaba-component/blob/master/cloud-seata-nacos/"&gt;cloud-seata-nacos&lt;/a&gt;应用部署到 Kubernetes 集群中&lt;/p&gt;
&lt;p&gt;该应用使用 Nacos 作为配置和注册中心，总共有三个服务: order-service, pay-service, storage-service, 其中 order-service 对外提供下单接口，当余额和库存充足时，下单成功，会提交事务，当不足时会抛出异常，下单失败，回滚事务&lt;/p&gt;
&lt;h2 id="准备工作"&gt;准备工作&lt;/h2&gt;
&lt;p&gt;需要准备可用的注册中心、配置中心 Nacos 和 MySQL，通常情况下，注册中心、配置中心和数据库都是已有的，不需要特别配置，在这个实践中，为了简单，只部署单机的注册中心、配置中心和数据库，假设他们是可靠的&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;部署 Nacos&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在服务器部署 Nacos，开放 8848 端口，用于 seata-server 注册，服务器地址为 &lt;code&gt;192.168.199.2&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;docker run --name nacos -p 8848:8848 -e MODE&lt;span style="color:#f92672"&gt;=&lt;/span&gt;standalone nacos/nacos-server
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;部署 MySQL&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;部署一台MySQL 数据库，用于保存事务数据，服务器地址为 &lt;code&gt;192.168.199.2&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;docker run --name mysql -p 30060:3306-e MYSQL_ROOT_PASSWORD&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;123456&lt;/span&gt; -d mysql:5.7.17
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id="部署-seata-server"&gt;部署 seata-server&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;创建seata-server需要的表&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;具体的 SQL 参考 &lt;a href="https://github.com/seata/seata/tree/develop/script/server/db"&gt;script/server/db&lt;/a&gt;，这里使用的是 MySQL 的脚本，数据库名称为 &lt;code&gt;seata&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;同时，也需要创建 undo_log 表， 可以参考 &lt;a href="https://github.com/seata/seata/blob/develop/script/client/at/db/"&gt;script/client/at/db/&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;修改seata-server配置&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;将以下配置添加到 Nacos 配置中心，具体添加方法可以参考 &lt;a href="https://github.com/seata/seata/tree/develop/script/config-center"&gt;script/config-center&lt;/a&gt;&lt;/p&gt;</description></item></channel></rss>