<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Nginx on HelloWood</title><link>https://blog.hellowood.dev/tags/nginx/</link><description>Recent content in Nginx on HelloWood</description><generator>Hugo</generator><language>cn</language><lastBuildDate>Sat, 06 Sep 2025 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.hellowood.dev/tags/nginx/index.xml" rel="self" type="application/rss+xml"/><item><title>Docker 配置 Nginx 访问宿主机目录下的应用</title><link>https://blog.hellowood.dev/posts/docker-%E9%85%8D%E7%BD%AE-nginx-%E8%AE%BF%E9%97%AE%E5%AE%BF%E4%B8%BB%E6%9C%BA%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84%E5%BA%94%E7%94%A8/</link><pubDate>Tue, 10 Apr 2018 11:39:09 +0800</pubDate><guid>https://blog.hellowood.dev/posts/docker-%E9%85%8D%E7%BD%AE-nginx-%E8%AE%BF%E9%97%AE%E5%AE%BF%E4%B8%BB%E6%9C%BA%E7%9B%AE%E5%BD%95%E4%B8%8B%E7%9A%84%E5%BA%94%E7%94%A8/</guid><description>&lt;blockquote&gt;
&lt;p&gt;使用 Nginx 将请求转发到宿主机的 Tomcat 应用&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="配置并启动-tomcat"&gt;配置并启动 Tomcat&lt;/h2&gt;
&lt;h2 id="安装-docker"&gt;安装 Docker&lt;/h2&gt;
&lt;h2 id="配置-nginx"&gt;配置 Nginx&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;创建配置和日志文件夹&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;mkdir /home/nginx/conf
mkdir /home/nginx/logs
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;查询宿主机 IP&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;docker inspect --format &amp;#39;{{ .NetworkSettings.IPAddress }}&amp;#39; &amp;lt;container-ID&amp;gt;

# 或
docker inspect &amp;lt;container id&amp;gt;

# 或
docker inspect -f &amp;#39;{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&amp;#39; container_name_or_id
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;添加配置文件 &lt;code&gt;nginx.conf&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;将 &lt;code&gt;8084&lt;/code&gt;端口转发到&lt;code&gt;8080&lt;/code&gt;端口，使用 &lt;code&gt;log_format&lt;/code&gt;目的是为了使用阿里云监控切分日志，可以没有&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;log_format proxyformat &amp;#34;$remote_addr $request_time $http_x_readtime [$time_local] \&amp;#34;$request_method http://$host$request_uri\&amp;#34; $status $body_bytes_sent \&amp;#34;$http_referer\&amp;#34; \&amp;#34;$upstream_addr\&amp;#34; \&amp;#34;$http_user_agent\&amp;#34; \&amp;#34;$upstream_response_time\&amp;#34; \&amp;#34;$request_time\&amp;#34;&amp;#34;;


 server {
 listen 80;
 server_name ali.hellowood.com.cn;
 location / {
 proxy_pass http://172.17.0.1:8080;
 proxy_set_header Host $http_host;
 proxy_set_header X-Real-IP $remote_addr;
 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
 }
 }
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;需要注意的是，Docker 会默认使用桥接路由，所以其 IP 和宿主机的 IP 位于同一 IP 段，并且默认宿主机的 IP 为第一个，即如果 Docker 的 IP 为 &lt;code&gt;10.1.0.2&lt;/code&gt;, 则可以通过 访问 &lt;code&gt;10.1.0.1&lt;/code&gt; 访问到宿主机&lt;/p&gt;</description></item><item><title>Docker 配置Ubuntu 下 Tomcat 和 Nginx 使用 HTTPS 访问</title><link>https://blog.hellowood.dev/posts/docker-%E9%85%8D%E7%BD%AEubuntu-%E4%B8%8B-tomcat-%E5%92%8C-nginx-%E4%BD%BF%E7%94%A8-https-%E8%AE%BF%E9%97%AE/</link><pubDate>Sun, 08 Apr 2018 15:38:01 +0800</pubDate><guid>https://blog.hellowood.dev/posts/docker-%E9%85%8D%E7%BD%AEubuntu-%E4%B8%8B-tomcat-%E5%92%8C-nginx-%E4%BD%BF%E7%94%A8-https-%E8%AE%BF%E9%97%AE/</guid><description>&lt;h2 id="安装-docker"&gt;安装 Docker&lt;/h2&gt;
&lt;h3 id="使用脚本自动安装"&gt;使用脚本自动安装&lt;/h3&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;curl -fsSL get.docker.com -o get-docker.sh
sudo sh get-docker.sh --mirror Aliyun
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="更改镜像地址"&gt;更改镜像地址&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;修改或新建 &lt;code&gt;/etc/docker/daemon.json&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;{
 &amp;#34;registry-mirrors&amp;#34;: [
 &amp;#34;https://registry.docker-cn.com&amp;#34;
 ]
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="启动-docker"&gt;启动 Docker&lt;/h3&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;sudo systemctl daemon-reload
sudo systemctl enable docker
sudo systemctl start docker
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id="配置-tomcat"&gt;配置 Tomcat&lt;/h2&gt;
&lt;h3 id="启动-tomcat-容器"&gt;启动 Tomcat 容器&lt;/h3&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;docker pull tomcat
docker run --name tomcat -d -p 8080:8080 tomcat
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="修改-tomcat-manager-应用"&gt;修改 Tomcat Manager 应用&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;修改 &lt;code&gt;webapps/manager/META-INF/content.xml&lt;/code&gt;，允许需要的IP访问，这里运行所有的IP访问&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;Context antiResourceLocking=&amp;#34;false&amp;#34; privileged=&amp;#34;true&amp;#34; &amp;gt;
 &amp;lt;Valve className=&amp;#34;org.apache.catalina.valves.RemoteAddrValve&amp;#34;
 allow=&amp;#34;^.*$&amp;#34; /&amp;gt;
 &amp;lt;Manager sessionAttributeValueClassNameFilter=&amp;#34;java\.lang\.(?:Boolean|Integer|Long|Number|String)|org\.apache\.catalina\.filters\.CsrfPreventionFilter\$LruCache(?:\$1)?|java\.util\.(?:Linked)?HashMap&amp;#34;/&amp;gt;
&amp;lt;/Context&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="配置-tomcat-用户"&gt;配置 Tomcat 用户&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;修改 &lt;code&gt;conf/tomcat-user.xml&lt;/code&gt;，添加用户&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;role rolename=&amp;#34;admin-gui&amp;#34;/&amp;gt;
&amp;lt;role rolename=&amp;#34;manager-gui&amp;#34;/&amp;gt;
&amp;lt;user username=&amp;#34;tomcat&amp;#34; password=&amp;#34;tomcat&amp;#34; roles=&amp;#34;manager-gui,admin-gui&amp;#34;/&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h2 id="配置-nginx"&gt;配置 Nginx&lt;/h2&gt;
&lt;h3 id="配置目录"&gt;配置目录&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;新建目录 &lt;code&gt;/home/ubuntu/hellowood/dev/nginx/conf&lt;/code&gt;, &lt;code&gt;/home/ubuntu/hellowood/dev/nginx/log&lt;/code&gt;, &lt;code&gt;/home/ubuntu/hellowood/dev/nginx/certs&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;下载并解压相应的Nginx证书文件到 &lt;code&gt;/home/ubuntu/hellowood/dev/nginx/conf&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="添加-nginx-配置"&gt;添加 Nginx 配置&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;nginx.conf&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;server {
 listen 80;
 listen 443 ssl;
 server_name hellowood.com.cn;
 ssl_certificate /etc/nginx/certs/hellowood.com.cn_bundle.crt;
 ssl_certificate_key /etc/nginx/certs/hellowood.com.cn.key;
 location / {
 proxy_pass http://tomcat:8080;
 }
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;http://tomcat:8080&lt;/code&gt;: 将所有请求都转发到 &lt;code&gt;tomcat&lt;/code&gt; 容器的 &lt;code&gt;8080&lt;/code&gt;端口(不是映射端口)&lt;/p&gt;</description></item><item><title>Ubuntu安装 Nginx</title><link>https://blog.hellowood.dev/posts/ubuntu%E5%AE%89%E8%A3%85-nginx/</link><pubDate>Mon, 01 Jan 2018 12:10:38 +0800</pubDate><guid>https://blog.hellowood.dev/posts/ubuntu%E5%AE%89%E8%A3%85-nginx/</guid><description>&lt;blockquote&gt;
&lt;p&gt;在 Ubuntu 上安装 Nginx&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="安装"&gt;安装&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;安装&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; sudo apt-get install nginx
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;目录结构
&lt;ul&gt;
&lt;li&gt;所有文件都在 &lt;code&gt;/etc/nginx/&lt;/code&gt;目录下&lt;/li&gt;
&lt;li&gt;程序文件在&lt;code&gt;/user/local/nginx/sbin/&lt;/code&gt;目录下&lt;/li&gt;
&lt;li&gt;日志在&lt;code&gt;/var/log/nginx/&lt;/code&gt;目录下&lt;/li&gt;
&lt;li&gt;启动脚本为&lt;code&gt;/etc/init.d/nginx&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="启动"&gt;启动&lt;/h2&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; sudo /etc/init.d/nginx start
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h1 id="nginx-源代码安装"&gt;Nginx 源代码安装&lt;/h1&gt;
&lt;h2 id="安装-1"&gt;安装&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;下载&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; cd /usr/local
 //下载源码
 wget http://nginx.org/download/nginx-1.2.8.tar.gz

 // 解压
 tar -zxcf nginx-1.2.8.tar.gz
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;安装依赖&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; sudo apt-get install libpcre3
 sudo apt-get install libpcre3-dev
 sudo apt-get install zlib1g-dev
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;编译安装&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; cd nginx-1.2.8
 // 检查环境
 ./configure

 // 编译
 make

 // 安装
 make install
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id="配置"&gt;配置&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;默认启动&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; cd /usr/local/nginx

 // 启动
 sbin/nginx
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;配置快捷启动方式&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; // 创建启动脚本
 sudo vi /etc/init.d/nginx

 // 增加执行权限
 sudo chmod a+x /etc/init.d/nginx

 // 启动
 sudo /etc/init.d/nginx start
 // 停止
 sudo /etc/init.d/nginx stop
 // 重启
 sudo /etc/init.d/nginx restart
&lt;/code&gt;&lt;/pre&gt;</description></item><item><title>Nginx 配置</title><link>https://blog.hellowood.dev/posts/nginx-%E9%85%8D%E7%BD%AE/</link><pubDate>Mon, 01 Jan 2018 12:03:12 +0800</pubDate><guid>https://blog.hellowood.dev/posts/nginx-%E9%85%8D%E7%BD%AE/</guid><description>&lt;h2 id="1-基础配置"&gt;1. 基础配置&lt;/h2&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;worker_processes 1;

events {
 worker_connections 1024;
}

http {
 include mime.types;
 default_type application/octet-stream;

 sendfile on;

 keepalive_timeout 65;

 server {
 listen 80;
 server_name project.hellowood.com;

 access_log logs/project.access.log;

 location / {
 proxy_pass http://127.0.0.1:8080;
 proxy_set_header Host $host;
 proxy_set_header X-Real-IP $remote_addr;
 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
 }

 error_page 500 502 503 504 /50x.html;
 location = /50x.html {
 root html;
 }
 }
}
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;访问&lt;code&gt;project.hellowood.com&lt;/code&gt; 实际会访问该 IP 下的8080端口&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="2-不同的-url-访问不同的服务器"&gt;2. 不同的 URL 访问不同的服务器&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;配置 Server 节点&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; server {
 listen 80;
 server_name project.hellowood.com;

 access_log logs/project.access.log;

 location / {
 proxy_pass http://127.0.0.1:8080;
 proxy_set_header Host $host;
 proxy_set_header X-Real-IP $remote_addr;
 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
 }

 error_page 500 502 503 504 /50x.html;
 location = /50x.html {
 root html;
 }
 }

 server {
 listen 80;
 server_name introduce.hellowood.com;

 access_log logs/introduce.access.log;

 location / {
 proxy_pass http://127.0.0.1:8081;
 proxy_set_header Host $host;
 proxy_set_header X-Real-IP $remote_addr;
 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
 }

 error_page 500 502 503 504 /50x.html;
 location = /50x.html {
 root html;
 }
 }

 server {
 listen 80;
 server_name helloworld.com;

 access_log logs/helloworld.access.log;

 location / {
 proxy_pass http://127.0.0.1:8082;
 proxy_set_header Host $host;
 proxy_set_header X-Real-IP $remote_addr;
 proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
 }

 error_page 500 502 503 504 /50x.html;
 location = /50x.html {
 root html;
 }
 }
&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;
&lt;p&gt;访问&lt;code&gt;project.hellowood.com&lt;/code&gt; 实际会访问该 IP 下的8080端口
访问&lt;code&gt;introduce.hellowood.com&lt;/code&gt; 实际会访问该 IP 下的8081端口
访问&lt;code&gt;helloworld.com&lt;/code&gt; 实际会访问该 IP 下的8082端口&lt;/p&gt;</description></item></channel></rss>