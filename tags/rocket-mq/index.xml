<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Rocket MQ on HelloWood</title><link>https://blog.hellowood.dev/tags/rocket-mq/</link><description>Recent content in Rocket MQ on HelloWood</description><generator>Hugo</generator><language>cn</language><lastBuildDate>Sat, 06 Sep 2025 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.hellowood.dev/tags/rocket-mq/index.xml" rel="self" type="application/rss+xml"/><item><title>Rocket MQ 相关知识</title><link>https://blog.hellowood.dev/posts/rocket-mq-%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/</link><pubDate>Mon, 01 Jan 2018 12:54:02 +0800</pubDate><guid>https://blog.hellowood.dev/posts/rocket-mq-%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/</guid><description>&lt;p&gt;@(消息队列)[RocketMQ, 消息]&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Rocket MQ消息队列（Message Queue，简称 MQ）是阿里巴巴集团中间件技术部自主研发的专业消息中间件。产品基于高可用分布式集群技术，提供消息发布订阅、消息轨迹查询、定时（延时）消息、资源统计、监控报警等一系列消息云服务，是企业级互联网架构的核心产品。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="rocket-mq相关名词"&gt;Rocket MQ相关名词&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Producer 消息生产者，负责生产消息&lt;/li&gt;
&lt;li&gt;Consumer 消息消费者，负责消费消息&lt;/li&gt;
&lt;li&gt;NameServer 无状态节点，用来保存活跃的broker列表和topic列表&lt;/li&gt;
&lt;li&gt;Broker 消息中转角色，负责存储消息，转发消息&lt;/li&gt;
&lt;li&gt;Topic 消息的逻辑管理单位&lt;/li&gt;
&lt;li&gt;Message 消息
&lt;ul&gt;
&lt;li&gt;body 消息体，用于携带消息具体内容&lt;/li&gt;
&lt;li&gt;key 消息的key，用于区别不同的消息&lt;/li&gt;
&lt;li&gt;tags 消息的Tag，用于不同的订阅者过滤消息&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="消息发送方式"&gt;消息发送方式&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;同步方式
&lt;blockquote&gt;
&lt;p&gt;发送消息，接收到结果之后再发送下一条消息，速度最慢，耗时最长&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;异步方式
&lt;blockquote&gt;
&lt;p&gt;发送消息，不论是否收到结果，直接发送下一条消息，发送速度介于同步和单向方式之间&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;单向方式
&lt;blockquote&gt;
&lt;p&gt;发送消息，直接发送消息，不返回发送结果，发送速度最快&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="消息类型"&gt;消息类型&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;定时消息
&lt;blockquote&gt;
&lt;p&gt;在指定的发送时间发送消息&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;延时消息
&lt;blockquote&gt;
&lt;p&gt;从当前时间开始，经过延时时间后再发送消息&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;顺序消息
&lt;blockquote&gt;
&lt;p&gt;立即发送消息&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;事务消息
&lt;blockquote&gt;
&lt;p&gt;MQ 提供类似 X/Open XA 的分布事务功能，通过 MQ 事务消息能达到分布式事务的最终一致&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="实例代码"&gt;实例代码&lt;/h1&gt;
&lt;h2 id="producer"&gt;Producer&lt;/h2&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class ProducerDelayTest {
 public static void main(String[] args) {
 Properties properties = new Properties();
 //您在 MQ 控制台创建的Producer ID
 properties.put(PropertyKeyConst.ProducerId, &amp;#34;XXX&amp;#34;);
 // 阿里云身份验证，在阿里云服务器管理控制台创建
 properties.put(PropertyKeyConst.AccessKey, &amp;#34;XXX&amp;#34;);
 // 阿里云身份验证，在阿里云服务器管理控制台创建
 properties.put(PropertyKeyConst.SecretKey, &amp;#34;XXX&amp;#34;);
 // 设置 TCP 接入域名（此处以公共云生产环境为例）
 properties.put(PropertyKeyConst.ONSAddr,
 &amp;#34;http://onsaddr-internal.aliyun.com:8080/rocketmq/nsaddr4client-internal&amp;#34;);
 Producer producer = ONSFactory.createProducer(properties);
 // 在发送消息前，必须调用start方法来启动Producer，只需调用一次即可。
 producer.start();

 /**
 * 消息类型代码，参考下面消息类型代码
 */
 /**
 * 消息发送方式代码，参考下面发送方式代码
 */
 System.out.println(&amp;#34;Message Id:&amp;#34; + sendResult.getMessageId());
 // 在应用退出前，销毁 Producer 对象
 // 注意：如果不销毁也没有问题，如果发送消息较多不应该销毁
 producer.shutdown();
 }
}
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="消息类型代码"&gt;消息类型代码&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;定时消息&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; Message msg = new Message();
 msg.setTag(&amp;#34;TAG&amp;#34;);
 msg.setKey(&amp;#34;KEY&amp;#34;);
 msg.setTopic(&amp;#34;TOPIC&amp;#34;);
 msg.setBody(&amp;#34;BODY&amp;#34;.getBytes());
 long timeStamp =new SimpleDateFormat(&amp;#34;yyyy-MM-dd HH:mm:ss&amp;#34;).parse(&amp;#34;2017-09-03 16:21:00&amp;#34;).getTime();
 msg.setStartDeliverTime(timeStamp);
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;延时消息&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; Message msg = new Message();
 msg.setTag(&amp;#34;TAG&amp;#34;);
 msg.setKey(&amp;#34;KEY&amp;#34;);
 msg.setTopic(&amp;#34;TOPIC&amp;#34;);
 msg.setBody(&amp;#34;BODY&amp;#34;.getBytes());
 long delayTime = 3000;//30秒后再发送
 msg.setStartDeliverTime(System.currentTimes() + delayTime);
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;顺序消息&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; Message msg = new Message();
 msg.setTag(&amp;#34;TAG&amp;#34;);
 msg.setKey(&amp;#34;KEY&amp;#34;);
 msg.setTopic(&amp;#34;TOPIC&amp;#34;.getBytes());
 msg.setBody(&amp;#34;BODY&amp;#34;);
&lt;/code&gt;&lt;/pre&gt;&lt;h3 id="消息发送方式代码"&gt;消息发送方式代码&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;同步方式发送&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; SendResult sendResult = producer.send(msg);
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;异步方式发送&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; producer.sendAsync(message, new SendCallback() {
 @Override
 public void onSuccess(final SendResult sendResult) {
 logger.info(&amp;#34;MQ send ASYNCHRONOUS message successed，response is &amp;#34; + JSON.toJSONString(sendResult));
 }

 @Override
 public void onException(OnExceptionContext onExceptionContext) {
 logger.info(&amp;#34;MQ send ASYNCHRONOUS message failed, error is &amp;#34; + onExceptionContext.getException().getMessage());
 }
 });
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;单向方式发送&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt; producer.sendOneway(message);
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id="consumer"&gt;Consumer&lt;/h2&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;public class ConsumerTest {
 public static void main(String[] args) {
 Properties properties = new Properties();
 // 您在控制台创建的 Consumer ID
 properties.put(PropertyKeyConst.ConsumerId, &amp;#34;XXX&amp;#34;);
 // AccessKey 阿里云身份验证，在阿里云服务器管理控制台创建
 properties.put(PropertyKeyConst.AccessKey, &amp;#34;XXX&amp;#34;);
 // SecretKey 阿里云身份验证，在阿里云服务器管理控制台创建
 properties.put(PropertyKeyConst.SecretKey, &amp;#34;XXX&amp;#34;);
 // 设置 TCP 接入域名（此处以公共云生产环境为例）
 properties.put(PropertyKeyConst.ONSAddr,
 &amp;#34;http://onsaddr-internal.aliyun.com:8080/rocketmq/nsaddr4client-internal&amp;#34;);
 // 集群订阅方式 (默认)
 // properties.put(PropertyKeyConst.MessageModel, PropertyValueConst.CLUSTERING);
 // 广播订阅方式
 // properties.put(PropertyKeyConst.MessageModel, PropertyValueConst.BROADCASTING);
 Consumer consumer = ONSFactory.createConsumer(properties);
 consumer.subscribe(&amp;#34;TopicTestMQ&amp;#34;, &amp;#34;TagA||TagB&amp;#34;, new MessageListener() { //订阅多个Tag
 public Action consume(Message message, ConsumeContext context) {
 System.out.println(&amp;#34;Receive: &amp;#34; + message);
 return Action.CommitMessage;
 }
 });
 //订阅另外一个Topic
 consumer.subscribe(&amp;#34;TopicTestMQ-Other&amp;#34;, &amp;#34;*&amp;#34;, new MessageListener() { //订阅全部Tag
 public Action consume(Message message, ConsumeContext context) {
 System.out.println(&amp;#34;Receive: &amp;#34; + message);
 return Action.CommitMessage;
 }
 });
 consumer.start();
 System.out.println(&amp;#34;Consumer Started&amp;#34;);
 }
}
&lt;/code&gt;&lt;/pre&gt;</description></item><item><title>Rocket MQ 发送消息</title><link>https://blog.hellowood.dev/posts/rocket-mq-%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF/</link><pubDate>Mon, 01 Jan 2018 12:52:39 +0800</pubDate><guid>https://blog.hellowood.dev/posts/rocket-mq-%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF/</guid><description>&lt;h2 id="rocket-mq-发送消息"&gt;Rocket MQ 发送消息&lt;/h2&gt;
&lt;p&gt;@(消息队列)[RocketMQ, 消息]&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;使用阿里巴巴的Rocket MQ发送消息的SpringBoo项目&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;使用之前请现在&lt;a href="https://ons.console.aliyun.com/?spm=5176.2020520001.1002.d10ons.61d991b3GbNJPR#/home/topic"&gt;阿里云&lt;/a&gt;申请消息队列并创建消息TOPIC、Producer和Consumer&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="启动"&gt;启动&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;下载： &lt;code&gt;https://github.com/helloworlde/SpringBoot-RocketMQ.git&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;修改配置文件：修改&lt;code&gt;application.properties&lt;/code&gt; ，填入相应的信息&lt;/li&gt;
&lt;/ul&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;spring.rocketmq.ONSAddresses=消息队列地址
spring.rocketmq.accessKey=AccessKey
spring.rocketmq.secretKey=SercetKey
spring.rocketmq.topic=TOPIC
spring.rocketmq.producerId生产者
spring.rocketmq.consumerId=订阅者
&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;
&lt;li&gt;编译：&lt;code&gt;gradle build&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;启动：&lt;code&gt;gradle bootrun&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;hr&gt;
&lt;h2 id="api"&gt;API&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;请求URL：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;http://localhost:8080/sendMessage&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;请求方式：&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;POST &lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;参数：&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
 &lt;thead&gt;
 &lt;tr&gt;
 &lt;th style="text-align: left"&gt;参数名&lt;/th&gt;
 &lt;th style="text-align: left"&gt;必选&lt;/th&gt;
 &lt;th style="text-align: left"&gt;类型&lt;/th&gt;
 &lt;th&gt;说明&lt;/th&gt;
 &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;body&lt;/td&gt;
 &lt;td style="text-align: left"&gt;是&lt;/td&gt;
 &lt;td style="text-align: left"&gt;String&lt;/td&gt;
 &lt;td&gt;消息所携带的数据，可以是对象的JSON串&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;key&lt;/td&gt;
 &lt;td style="text-align: left"&gt;是&lt;/td&gt;
 &lt;td style="text-align: left"&gt;String&lt;/td&gt;
 &lt;td&gt;32位key&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;tags&lt;/td&gt;
 &lt;td style="text-align: left"&gt;否&lt;/td&gt;
 &lt;td style="text-align: left"&gt;String&lt;/td&gt;
 &lt;td&gt;Message Tag，用于过滤订阅者过滤消息&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;method&lt;/td&gt;
 &lt;td style="text-align: left"&gt;否&lt;/td&gt;
 &lt;td style="text-align: left"&gt;String&lt;/td&gt;
 &lt;td&gt;消息发送方式，共有三种：同步发送：&lt;code&gt;SYNCHRONOUS&lt;/code&gt;，异步发送：&lt;code&gt;ASYNCHRONOUS&lt;/code&gt;, 单向发送：&lt;code&gt;ONE_WAY&lt;/code&gt; ,默认使用同步发送方式发送消息&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;type&lt;/td&gt;
 &lt;td style="text-align: left"&gt;否&lt;/td&gt;
 &lt;td style="text-align: left"&gt;String&lt;/td&gt;
 &lt;td&gt;消息类型，共有三种：顺序消息：&lt;code&gt;ORDER&lt;/code&gt;，延时消息：&lt;code&gt;DELAY&lt;/code&gt;，定时消息：&lt;code&gt;TIMING&lt;/code&gt;，默认发送顺序消息&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;delayTime&lt;/td&gt;
 &lt;td style="text-align: left"&gt;否&lt;/td&gt;
 &lt;td style="text-align: left"&gt;long&lt;/td&gt;
 &lt;td&gt;消息发送延时时间，单位是毫秒&lt;/td&gt;
 &lt;/tr&gt;
 &lt;tr&gt;
 &lt;td style="text-align: left"&gt;startDeliveryTime&lt;/td&gt;
 &lt;td style="text-align: left"&gt;否&lt;/td&gt;
 &lt;td style="text-align: left"&gt;String&lt;/td&gt;
 &lt;td&gt;定时消息发送时间，必须是&lt;code&gt;yyyy-MM-dd HH:mm:ss&lt;/code&gt;格式&lt;/td&gt;
 &lt;/tr&gt;
 &lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;顺序消息 Body&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;{
 &amp;#34;body&amp;#34;:&amp;#34;{\&amp;#34;name\&amp;#34;:\&amp;#34;MQ\&amp;#34;,\&amp;#34;type\&amp;#34;:\&amp;#34;Rocket\&amp;#34;}&amp;#34;,
 &amp;#34;delayTime&amp;#34;:30000,
 &amp;#34;key&amp;#34;:&amp;#34;key&amp;#34;,
 &amp;#34;method&amp;#34;:&amp;#34;SYNCHRONOUS&amp;#34;,
 &amp;#34;tags&amp;#34;:&amp;#34;TAG1,TAG2&amp;#34;,
 &amp;#34;topic&amp;#34;:&amp;#34;TOPIC&amp;#34;,
 &amp;#34;type&amp;#34;:&amp;#34;ORDER&amp;#34;
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;延时消息 Body&lt;/strong&gt;&lt;/p&gt;</description></item></channel></rss>