<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>树莓派 4B 容器方式安装 OpenWrt 作为软路由</title>
<meta charset=utf-8><meta name=description content="Ladder@树莓派 4B 容器方式安装 OpenWrt 作为软路由 在树莓派 4B，基于 Ubuntu 22.04，使用 Docker 容器的方式运行 Openwrt 作为软路由，基于 SuLingGG/OpenWrt-Docker 的方案
什么是软路由 硬路由以特有的硬设备，包括处理器、电源供应、嵌入式软件，提供设定的路由器功能，如常用的路由器；软路由则是指利用台式机或服务器配合软件形成路由解决方案，主要靠软件的设置，达成路由器的功能；
普通路由器因为硬件性能限制，无法支持长时间处理大量流量，当家中有 NAS 等设备时，通常无法跑满带宽；通过软路由，可以让路由器只处理流量的转发，其他的功能由软路由实现
通常我们使用软路由用于多线负载、宽带叠加、为局域网内的其他设备过滤广告、自定义 DNS 等扩展功能
安装依赖 安装 linux-modules-extra-raspi 需要保证安装了linux-modules-extra-raspi，否则会导致在运行容器后出现Error response from daemon: failed to create the macvlan port: operation not supported错误
linux-modules-extra-raspi 是树莓派 Ubuntu Arm 的不常用扩展，Ubuntu 最新的包管理中默认不包含扩展；因此需要单独安装
sudo apt install linux-modules-extra-raspi 安装之后需要重启树莓派
sudo reboot 配置网络 开启网卡混杂模式 默认情况下网卡只会将发送给本机的包传递到上层服务，其他的包一律丢弃；开启混杂模式后机器的网卡能够接收所有流经过它的数据流，而无论其目的地址是否是它，一般用于网络分析和路由节点；
树莓派只有一个有线接口，地址为 eth0，所以在 eth0 接口开启混杂模式
sudo ip link set eth0 promisc on 执行以下命令检查结果
ifconfig eth0 网卡 flag 信息有 PROMISC 表示开启成功"><meta name=author content="HelloWood"><link rel=canonical href=https://blog.hellowood.dev/posts/%E6%A0%91%E8%8E%93%E6%B4%BE-4b-%E5%AE%B9%E5%99%A8%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85-openwrt-%E4%BD%9C%E4%B8%BA%E8%BD%AF%E8%B7%AF%E7%94%B1/><meta name=google-site-verification content="G-3MSGPYTHPZ"><link rel=alternate type=application/rss+xml href=https://blog.hellowood.dev//index.xml title=HelloWood><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ")}</script><script async defer data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301 src=https://umami.hellowood.dev/script.js></script><script defer data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}' src=https://static.cloudflareinsights.com/beacon.min.js></script><meta property="og:url" content="https://blog.hellowood.dev/posts/%E6%A0%91%E8%8E%93%E6%B4%BE-4b-%E5%AE%B9%E5%99%A8%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85-openwrt-%E4%BD%9C%E4%B8%BA%E8%BD%AF%E8%B7%AF%E7%94%B1/"><meta property="og:site_name" content="HelloWood"><meta property="og:title" content="树莓派 4B 容器方式安装 OpenWrt 作为软路由"><meta property="og:description" content="树莓派 4B 容器方式安装 OpenWrt 作为软路由 在树莓派 4B，基于 Ubuntu 22.04，使用 Docker 容器的方式运行 Openwrt 作为软路由，基于 SuLingGG/OpenWrt-Docker 的方案
什么是软路由 硬路由以特有的硬设备，包括处理器、电源供应、嵌入式软件，提供设定的路由器功能，如常用的路由器；软路由则是指利用台式机或服务器配合软件形成路由解决方案，主要靠软件的设置，达成路由器的功能；
普通路由器因为硬件性能限制，无法支持长时间处理大量流量，当家中有 NAS 等设备时，通常无法跑满带宽；通过软路由，可以让路由器只处理流量的转发，其他的功能由软路由实现
通常我们使用软路由用于多线负载、宽带叠加、为局域网内的其他设备过滤广告、自定义 DNS 等扩展功能
安装依赖 安装 linux-modules-extra-raspi 需要保证安装了linux-modules-extra-raspi，否则会导致在运行容器后出现Error response from daemon: failed to create the macvlan port: operation not supported错误
linux-modules-extra-raspi 是树莓派 Ubuntu Arm 的不常用扩展，Ubuntu 最新的包管理中默认不包含扩展；因此需要单独安装
sudo apt install linux-modules-extra-raspi 安装之后需要重启树莓派
sudo reboot 配置网络 开启网卡混杂模式 默认情况下网卡只会将发送给本机的包传递到上层服务，其他的包一律丢弃；开启混杂模式后机器的网卡能够接收所有流经过它的数据流，而无论其目的地址是否是它，一般用于网络分析和路由节点；
树莓派只有一个有线接口，地址为 eth0，所以在 eth0 接口开启混杂模式
sudo ip link set eth0 promisc on 执行以下命令检查结果
ifconfig eth0 网卡 flag 信息有 PROMISC 表示开启成功"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-20T11:32:08+00:00"><meta property="article:modified_time" content="2022-07-20T11:32:08+00:00"><meta property="article:tag" content="OpenWrt"><meta property="article:tag" content="RaspberryPi"><meta property="article:tag" content="HomeLab"><meta name=twitter:card content="summary"><meta name=twitter:title content="树莓派 4B 容器方式安装 OpenWrt 作为软路由"><meta name=twitter:description content="树莓派 4B 容器方式安装 OpenWrt 作为软路由 在树莓派 4B，基于 Ubuntu 22.04，使用 Docker 容器的方式运行 Openwrt 作为软路由，基于 SuLingGG/OpenWrt-Docker 的方案
什么是软路由 硬路由以特有的硬设备，包括处理器、电源供应、嵌入式软件，提供设定的路由器功能，如常用的路由器；软路由则是指利用台式机或服务器配合软件形成路由解决方案，主要靠软件的设置，达成路由器的功能；
普通路由器因为硬件性能限制，无法支持长时间处理大量流量，当家中有 NAS 等设备时，通常无法跑满带宽；通过软路由，可以让路由器只处理流量的转发，其他的功能由软路由实现
通常我们使用软路由用于多线负载、宽带叠加、为局域网内的其他设备过滤广告、自定义 DNS 等扩展功能
安装依赖 安装 linux-modules-extra-raspi 需要保证安装了linux-modules-extra-raspi，否则会导致在运行容器后出现Error response from daemon: failed to create the macvlan port: operation not supported错误
linux-modules-extra-raspi 是树莓派 Ubuntu Arm 的不常用扩展，Ubuntu 最新的包管理中默认不包含扩展；因此需要单独安装
sudo apt install linux-modules-extra-raspi 安装之后需要重启树莓派
sudo reboot 配置网络 开启网卡混杂模式 默认情况下网卡只会将发送给本机的包传递到上层服务，其他的包一律丢弃；开启混杂模式后机器的网卡能够接收所有流经过它的数据流，而无论其目的地址是否是它，一般用于网络分析和路由节点；
树莓派只有一个有线接口，地址为 eth0，所以在 eth0 接口开启混杂模式
sudo ip link set eth0 promisc on 执行以下命令检查结果
ifconfig eth0 网卡 flag 信息有 PROMISC 表示开启成功"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.hellowood.dev/posts/"},{"@type":"ListItem","position":2,"name":"树莓派 4B 容器方式安装 OpenWrt 作为软路由","item":"https://blog.hellowood.dev/posts/%E6%A0%91%E8%8E%93%E6%B4%BE-4b-%E5%AE%B9%E5%99%A8%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85-openwrt-%E4%BD%9C%E4%B8%BA%E8%BD%AF%E8%B7%AF%E7%94%B1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"树莓派 4B 容器方式安装 OpenWrt 作为软路由","name":"树莓派 4B 容器方式安装 OpenWrt 作为软路由","description":"树莓派 4B 容器方式安装 OpenWrt 作为软路由 在树莓派 4B，基于 Ubuntu 22.04，使用 Docker 容器的方式运行 Openwrt 作为软路由，基于 SuLingGG/OpenWrt-Docker 的方案\n什么是软路由 硬路由以特有的硬设备，包括处理器、电源供应、嵌入式软件，提供设定的路由器功能，如常用的路由器；软路由则是指利用台式机或服务器配合软件形成路由解决方案，主要靠软件的设置，达成路由器的功能；\n普通路由器因为硬件性能限制，无法支持长时间处理大量流量，当家中有 NAS 等设备时，通常无法跑满带宽；通过软路由，可以让路由器只处理流量的转发，其他的功能由软路由实现\n通常我们使用软路由用于多线负载、宽带叠加、为局域网内的其他设备过滤广告、自定义 DNS 等扩展功能\n安装依赖 安装 linux-modules-extra-raspi 需要保证安装了linux-modules-extra-raspi，否则会导致在运行容器后出现Error response from daemon: failed to create the macvlan port: operation not supported错误\nlinux-modules-extra-raspi 是树莓派 Ubuntu Arm 的不常用扩展，Ubuntu 最新的包管理中默认不包含扩展；因此需要单独安装\nsudo apt install linux-modules-extra-raspi 安装之后需要重启树莓派\nsudo reboot 配置网络 开启网卡混杂模式 默认情况下网卡只会将发送给本机的包传递到上层服务，其他的包一律丢弃；开启混杂模式后机器的网卡能够接收所有流经过它的数据流，而无论其目的地址是否是它，一般用于网络分析和路由节点；\n树莓派只有一个有线接口，地址为 eth0，所以在 eth0 接口开启混杂模式\nsudo ip link set eth0 promisc on 执行以下命令检查结果\nifconfig eth0 网卡 flag 信息有 PROMISC 表示开启成功","keywords":["OpenWrt","RaspberryPi","HomeLab"],"articleBody":"树莓派 4B 容器方式安装 OpenWrt 作为软路由 在树莓派 4B，基于 Ubuntu 22.04，使用 Docker 容器的方式运行 Openwrt 作为软路由，基于 SuLingGG/OpenWrt-Docker 的方案\n什么是软路由 硬路由以特有的硬设备，包括处理器、电源供应、嵌入式软件，提供设定的路由器功能，如常用的路由器；软路由则是指利用台式机或服务器配合软件形成路由解决方案，主要靠软件的设置，达成路由器的功能；\n普通路由器因为硬件性能限制，无法支持长时间处理大量流量，当家中有 NAS 等设备时，通常无法跑满带宽；通过软路由，可以让路由器只处理流量的转发，其他的功能由软路由实现\n通常我们使用软路由用于多线负载、宽带叠加、为局域网内的其他设备过滤广告、自定义 DNS 等扩展功能\n安装依赖 安装 linux-modules-extra-raspi 需要保证安装了linux-modules-extra-raspi，否则会导致在运行容器后出现Error response from daemon: failed to create the macvlan port: operation not supported错误\nlinux-modules-extra-raspi 是树莓派 Ubuntu Arm 的不常用扩展，Ubuntu 最新的包管理中默认不包含扩展；因此需要单独安装\nsudo apt install linux-modules-extra-raspi 安装之后需要重启树莓派\nsudo reboot 配置网络 开启网卡混杂模式 默认情况下网卡只会将发送给本机的包传递到上层服务，其他的包一律丢弃；开启混杂模式后机器的网卡能够接收所有流经过它的数据流，而无论其目的地址是否是它，一般用于网络分析和路由节点；\n树莓派只有一个有线接口，地址为 eth0，所以在 eth0 接口开启混杂模式\nsudo ip link set eth0 promisc on 执行以下命令检查结果\nifconfig eth0 网卡 flag 信息有 PROMISC 表示开启成功\neth0: flags=4419 mtu 1500 inet 192.168.31.2 netmask 255.255.255.0 broadcast 192.168.31.255 inet6 2408:8207:24ac:6fc0::50c prefixlen 128 scopeid 0x0 inet6 fe80::dea6:32ff:fe5f:b43e prefixlen 64 scopeid 0x20 inet6 2408:8207:24ac:6fc0:dea6:32ff:fe5f:b43e prefixlen 64 scopeid 0x0 ether dc:a6:32:5f:b4:3e txqueuelen 1000 (Ethernet) RX packets 2705601 bytes 1502740361 (1.5 GB) RX errors 0 dropped 55 overruns 0 frame 0 TX packets 2314782 bytes 826118897 (826.1 MB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 ``` ## 配置 OpenWrt 容器 1. 创建 `macvlan` `macvlan` 是一种网卡虚拟化技术，允许在同一个物理网卡上配置多个 MAC 地址，即多个 `interface`，每个 `interface` 可以配置自己的 IP；`macvlan`直接通过以太网的 `interface` 连接到物理网络，因此性能极好 因此，软路由需要使用 `macvlan` 配合混杂模式在容器中实现路由功能 Docker 创建 `macvlan` 时要确定所在的网段，可以在路由器后台进行确认；如小米路由器常用的是 `192.168.31.0/24`网段；在创建网络时需要保证子网网段`subnet`和网关地址`gateway`参数与当前网络一致 ```bash docker network create -d macvlan --subnet=192.168.31.0/24 --gateway=192.168.31.1 -o parent=eth0 macnet 创建容器 创建容器时需要指定网络为刚才创建的 macnet\ndocker run --restart always --name openwrt -d --network macnet --privileged sulinggg/openwrt:rpi4 /sbin/init 修改容器网络配置 容器成功运行后还无法直接使用，需要进入到容器中修改 OpenWrt 的网络配置\ndocker exec -it openwrt bash 修改网络\nvi /etc/config/network ipaddr 为 OpenWrt 分配 IP 地址，因为 OpenWrt 使用了独立的 Mac 地址，所以这个 IP 地址不能和树莓派的相同，否则会无法访问；如树莓派的 IP 地址为 192.168.31.2，可以将 OpenWrt 的 IP 改为 192.168.31.4 gateway 为当前局域网的网关地址，即 192.168.31.1 dns 需要指定 DNS，否则无法将域名解析为 IP，建议使用路由器的地址，或者使用 114.114.114.114等常用 DNS 服务器 需要注意的是，使用到的 IP 都应该是固定的，可以在路由器中配置 DHCP 进行 Mac 地址绑定\nconfig interface 'lan' option type 'bridge' option ifname 'eth0' option proto 'static' option netmask '255.255.255.0' option ip6assign '60' option ipaddr '192.168.31.4' option gateway '192.168.31.1' option dns '114.114.114.114' 修改完成后重启容器的网络\n/etc/init.d/network restart 重启完成后访问 http://192.168.31.4，使用账户 root 和密码 password 即可进入管理页面\nOpenWrt 配置 登录后在 网络-接口中修改 LAN 接口，在底层基本设置中选择忽略此接口，使用默认路由器做 DHCP 服务器 使用 OpenWrt 有两种使用方式：\n一种是将 OpenWrt 作为路由器的网关，这样所有使用路由器的设备的流量都会被 OpenWrt 处理，这种方式要求路由器支持指定网关(辣鸡小米路由器没有 root 不支持指定，且官方已不支持 root)，并且 OpenWrt 足够稳定，否则会影响使用；\n另一种方式是通过在设备端指定 OpenWrt 作为网关，只有这些设备的流量会被软路由处理，这种方式需要设备端支持（大部分 IoT 设备无法配置） 配置重启后网卡默认使用混杂模式 网卡的混杂模式会在系统重启后失效，需要在系统启动后自定配置混杂模式，参考 How to enable Promiscuous Mode permanently on a NIC managed by NetworkManager?，通过注册一个单独的服务启用网卡混杂模式\n添加 oneshot服务，在网络启动之后执行，配置 eth0 网卡为混杂模式 sudo bash -c 'cat \u003e /etc/systemd/system/eth0-promisc.service' \u003c\u003c'EOS' [Unit] Description=Makes interfaces run in promiscuous mode at boot After=network-online.target [Service] Type=oneshot ExecStart=/usr/sbin/ip link set dev eth0 promisc on TimeoutStartSec=0 RemainAfterExit=yes [Install] WantedBy=default.target EOS 启用注册的服务 sudo systemctl enable eth0-promisc 这样，在系统重启后依然可以正常使用 OpenWrt\n修复宿主机与 OpenWrt 无法通信问题 Docker 的 macvlan 为了安全禁止宿主机与容器通信，因此宿主机和 OpenWrt 无法互相访问，导致宿主机上的一些监控无法从 OpenWrt 拉取数据；可以通过在宿主机上再创建一个 macvlan 接口，修改路由规则解决该问题\n配置 macvlan 接口 宿主机创建 macvlan 接口 在宿主机上添加了一个新的 macvlan 桥接 eth0 的接口，名称为 openwrt-bridge\nip link add openwrt-bridge link eth0 type macvlan mode bridge 为 openwrt-bridge 接口配置 IP 并启用 为 openwrt-bridge 接口配置不冲突的 IP地址 192.168.31.6，并启用该接口\nip addr add 192.168.31.6 dev openwrt-bridge ip link set openwrt-bridge up 配置路由规则，添加 OpenWrt 将 OpenWrt 的 IP 地址添加到 openwrt-bridge 接口的路由规则中，即可实现宿主机与 OpenWrt 容器的互相通信\nip route add 192.168.31.4 dev openwrt-bridge 配置重启后自动使用 macvlan 接口 同样通过添加一个 oneshot服务的方式配置\n添加 oneshot服务，在网络启动之后执行，添加 macvlan 网卡 sudo bash -c 'cat \u003e /etc/systemd/system/openwrt-bridge.service' \u003c\u003c'EOS' [Unit] Description=Add network interface for openwrt at boot After=network-online.target [Service] Type=oneshot ExecStart=/usr/sbin/ip link add openwrt-bridge link eth0 type macvlan mode bridge ExecStart=/usr/sbin/ip addr add 192.168.31.6 dev openwrt-bridge ExecStart=/usr/sbin/ip link set openwrt-bridge up ExecStart=/usr/sbin/ip route add 192.168.31.4 dev openwrt-bridge ExecStop=/usr/sbin/ip link delete openwrt-bridge TimeoutStartSec=0 RemainAfterExit=yes [Install] WantedBy=default.target EOS 启用注册的服务 sudo systemctl enable openwrt-bridge 参考文档 https://switch-router.gitee.io/blog/macvlan/ 在Docker 中运行 OpenWrt 旁路网关 USING DOCKER MACVLAN NETWORKS What is the difference between systemd’s ‘oneshot’ and ‘simple’ service types? Simple vs Oneshot - Choosing a systemd Service Type ","wordCount":"531","inLanguage":"en","datePublished":"2022-07-20T11:32:08Z","dateModified":"2022-07-20T11:32:08Z","author":{"@type":"Person","name":"HelloWood"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.hellowood.dev/posts/%E6%A0%91%E8%8E%93%E6%B4%BE-4b-%E5%AE%B9%E5%99%A8%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85-openwrt-%E4%BD%9C%E4%B8%BA%E8%BD%AF%E8%B7%AF%E7%94%B1/"},"publisher":{"@type":"Organization","name":"HelloWood","logo":{"@type":"ImageObject","url":"https://blog.hellowood.dev/favicon.ico"}}}</script><link rel=icon href=/images/avatar.png sizes=16x16><link rel=apple-touch-icon href=/images/avatar.png><link rel=manifest href=/images/avatar.png><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.7f82854fa0e999ec07c4835d3029de9f484030e254b80d470b3ca48eb934720e.css integrity="sha256-f4KFT6DpmewHxINdMCnen0hAMOJUuA1HCzykjrk0cg4=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><meta name=google-adsense-account content="ca-pub-3401351766168985"><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jtbhx98g62")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3401351766168985" crossorigin=anonymous></script><script defer src=https://analytics.us.umami.is/script.js data-website-id=73ff1c8c-9938-43cf-81af-e77e26b0cca3></script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand data-umami-event=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Blog href=/posts>Blog</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Tags href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Archive href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Dashboard href=https://umami.hellowood.dev/share/lab/Blog>Dashboard</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link data-umami-event=navigation-social href=https://github.com/helloworlde><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button data-umami-event=toggle-theme aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
<span class=toggle-light><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>树莓派 4B 容器方式安装 OpenWrt 作为软路由</h1></header><p><small>July 20, 2022&nbsp;· 531 words&nbsp;· 3 min</small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#安装依赖>安装依赖</a></li><li><a href=#配置网络>配置网络</a></li><li><a href=#使用-openwrt>使用 OpenWrt</a></li><li><a href=#配置重启后网卡默认使用混杂模式>配置重启后网卡默认使用混杂模式</a></li><li><a href=#修复宿主机与-openwrt-无法通信问题>修复宿主机与 OpenWrt 无法通信问题</a><ul><li><a href=#配置-macvlan-接口>配置 macvlan 接口</a></li><li><a href=#配置重启后自动使用-macvlan-接口>配置重启后自动使用 macvlan 接口</a></li></ul></li><li><a href=#参考文档>参考文档</a></li></ul></nav></div><section class=blog-content><h1 id=树莓派-4b-容器方式安装-openwrt-作为软路由>树莓派 4B 容器方式安装 OpenWrt 作为软路由</h1><blockquote><p>在树莓派 4B，基于 Ubuntu 22.04，使用 Docker 容器的方式运行 Openwrt 作为软路由，基于 <a href=https://github.com/SuLingGG/OpenWrt-Docker>SuLingGG/OpenWrt-Docker</a> 的方案</p></blockquote><ul><li>什么是软路由</li></ul><p>硬路由以特有的硬设备，包括处理器、电源供应、嵌入式软件，提供设定的路由器功能，如常用的路由器；软路由则是指利用台式机或服务器配合软件形成路由解决方案，主要靠软件的设置，达成路由器的功能；</p><p>普通路由器因为硬件性能限制，无法支持长时间处理大量流量，当家中有 NAS 等设备时，通常无法跑满带宽；通过软路由，可以让路由器只处理流量的转发，其他的功能由软路由实现</p><p>通常我们使用软路由用于多线负载、宽带叠加、为局域网内的其他设备过滤广告、自定义 DNS 等扩展功能</p><h2 id=安装依赖>安装依赖</h2><ul><li>安装 <a href=https://ubuntu.pkgs.org/21.10/ubuntu-main-arm64/linux-modules-extra-raspi_5.13.0.1008.14_arm64.deb.html>linux-modules-extra-raspi</a></li></ul><p>需要保证安装了<code>linux-modules-extra-raspi</code>，否则会导致在运行容器后出现<code>Error response from daemon: failed to create the macvlan port: operation not supported</code>错误</p><p><code>linux-modules-extra-raspi</code> 是树莓派 Ubuntu Arm 的不常用扩展，Ubuntu 最新的包管理中默认不包含扩展；因此需要单独安装</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install linux-modules-extra-raspi
</span></span></code></pre></div><p>安装之后需要重启树莓派</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo reboot
</span></span></code></pre></div><h2 id=配置网络>配置网络</h2><ul><li>开启网卡混杂模式</li></ul><p>默认情况下网卡只会将发送给本机的包传递到上层服务，其他的包一律丢弃；开启混杂模式后机器的网卡能够接收所有流经过它的数据流，而无论其目的地址是否是它，一般用于网络分析和路由节点；</p><p>树莓派只有一个有线接口，地址为 <code>eth0</code>，所以在 <code>eth0</code> 接口开启混杂模式</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ip link set eth0 promisc on
</span></span></code></pre></div><p>执行以下命令检查结果</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ifconfig eth0
</span></span></code></pre></div><p>网卡 flag 信息有 <code>PROMISC</code> 表示开启成功</p><pre tabindex=0><code>eth0: flags=4419&lt;UP,BROADCAST,RUNNING,PROMISC,MULTICAST&gt;  mtu 1500
inet 192.168.31.2  netmask 255.255.255.0  broadcast 192.168.31.255
inet6 2408:8207:24ac:6fc0::50c  prefixlen 128  scopeid 0x0&lt;global&gt;
    inet6 fe80::dea6:32ff:fe5f:b43e  prefixlen 64  scopeid 0x20&lt;link&gt;
    inet6 2408:8207:24ac:6fc0:dea6:32ff:fe5f:b43e  prefixlen 64  scopeid 0x0&lt;global&gt;
        ether dc:a6:32:5f:b4:3e  txqueuelen 1000  (Ethernet)
        RX packets 2705601  bytes 1502740361 (1.5 GB)
        RX errors 0  dropped 55  overruns 0  frame 0
        TX packets 2314782  bytes 826118897 (826.1 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
        ```


## 配置 OpenWrt 容器

1. 创建 `macvlan`

`macvlan` 是一种网卡虚拟化技术，允许在同一个物理网卡上配置多个 MAC 地址，即多个 `interface`，每个 `interface` 可以配置自己的 IP；`macvlan`直接通过以太网的 `interface` 连接到物理网络，因此性能极好

因此，软路由需要使用 `macvlan` 配合混杂模式在容器中实现路由功能

Docker 创建 `macvlan` 时要确定所在的网段，可以在路由器后台进行确认；如小米路由器常用的是 `192.168.31.0/24`网段；在创建网络时需要保证子网网段`subnet`和网关地址`gateway`参数与当前网络一致

```bash
docker network create -d macvlan --subnet=192.168.31.0/24 --gateway=192.168.31.1 -o parent=eth0 macnet
</code></pre><ol start=2><li>创建容器</li></ol><p>创建容器时需要指定网络为刚才创建的 <code>macnet</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --restart always --name openwrt -d --network macnet --privileged   sulinggg/openwrt:rpi4 /sbin/init
</span></span></code></pre></div><ol start=3><li>修改容器网络配置</li></ol><p>容器成功运行后还无法直接使用，需要进入到容器中修改 OpenWrt 的网络配置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec -it openwrt bash
</span></span></code></pre></div><p>修改网络</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vi /etc/config/network
</span></span></code></pre></div><ul><li><code>ipaddr</code> 为 OpenWrt 分配 IP 地址，因为 OpenWrt 使用了独立的 Mac 地址，所以这个 IP 地址不能和树莓派的相同，否则会无法访问；如树莓派的 IP 地址为 <code>192.168.31.2</code>，可以将 OpenWrt 的 IP 改为 <code>192.168.31.4</code></li><li><code>gateway</code> 为当前局域网的网关地址，即 <code>192.168.31.1</code></li><li><code>dns</code> 需要指定 DNS，否则无法将域名解析为 IP，建议使用路由器的地址，或者使用 <code>114.114.114.114</code>等常用 DNS 服务器</li></ul><p>需要注意的是，使用到的 IP 都应该是固定的，可以在路由器中配置 DHCP 进行 Mac 地址绑定</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>config interface <span style=color:#e6db74>&#39;lan&#39;</span>
</span></span><span style=display:flex><span>option type <span style=color:#e6db74>&#39;bridge&#39;</span>
</span></span><span style=display:flex><span>option ifname <span style=color:#e6db74>&#39;eth0&#39;</span>
</span></span><span style=display:flex><span>option proto <span style=color:#e6db74>&#39;static&#39;</span>
</span></span><span style=display:flex><span>option netmask <span style=color:#e6db74>&#39;255.255.255.0&#39;</span>
</span></span><span style=display:flex><span>option ip6assign <span style=color:#e6db74>&#39;60&#39;</span>
</span></span><span style=display:flex><span>option ipaddr <span style=color:#e6db74>&#39;192.168.31.4&#39;</span>
</span></span><span style=display:flex><span>option gateway <span style=color:#e6db74>&#39;192.168.31.1&#39;</span>
</span></span><span style=display:flex><span>option dns <span style=color:#e6db74>&#39;114.114.114.114&#39;</span>
</span></span></code></pre></div><p>修改完成后重启容器的网络</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/etc/init.d/network restart
</span></span></code></pre></div><p>重启完成后访问 <a href=http://192.168.31.4>http://192.168.31.4</a>，使用账户 <code>root</code> 和密码 <code>password</code> 即可进入管理页面</p><ol start=4><li>OpenWrt 配置</li></ol><p>登录后在 <code>网络-接口</code>中修改 <code>LAN</code> 接口，在底层基本设置中选择<code>忽略此接口</code>，使用默认路由器做 DHCP 服务器
<img alt=openwrt-config-dhcp.png src=https://img.hellowood.dev/picture/openwrt-config-dhcp.png></p><h2 id=使用-openwrt>使用 OpenWrt</h2><p>有两种使用方式：</p><p>一种是将 OpenWrt 作为路由器的网关，这样所有使用路由器的设备的流量都会被 OpenWrt 处理，这种方式要求路由器支持指定网关(辣鸡小米路由器没有 root 不支持指定，且官方已不支持 root)，并且 OpenWrt 足够稳定，否则会影响使用；</p><p>另一种方式是通过在设备端指定 OpenWrt 作为网关，只有这些设备的流量会被软路由处理，这种方式需要设备端支持（大部分 IoT 设备无法配置）
<img alt=openwrt-usage-mac.png src=https://img.hellowood.dev/picture/openwrt-usage-mac.png></p><h2 id=配置重启后网卡默认使用混杂模式>配置重启后网卡默认使用混杂模式</h2><p>网卡的混杂模式会在系统重启后失效，需要在系统启动后自定配置混杂模式，参考 <a href=https://askubuntu.com/questions/1355974/how-to-enable-promiscuous-mode-permanently-on-a-nic-managed-by-networkmanager>How to enable Promiscuous Mode permanently on a NIC managed by NetworkManager?</a>，通过注册一个单独的服务启用网卡混杂模式</p><ol><li>添加 <code>oneshot</code>服务，在网络启动之后执行，配置 <code>eth0</code> 网卡为混杂模式</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo bash -c <span style=color:#e6db74>&#39;cat &gt; /etc/systemd/system/eth0-promisc.service&#39;</span> <span style=color:#e6db74>&lt;&lt;&#39;EOS&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Unit]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Description=Makes interfaces run in promiscuous mode at boot
</span></span></span><span style=display:flex><span><span style=color:#e6db74>After=network-online.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Service]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Type=oneshot
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ExecStart=/usr/sbin/ip link set dev eth0 promisc on
</span></span></span><span style=display:flex><span><span style=color:#e6db74>TimeoutStartSec=0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>RemainAfterExit=yes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Install]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>WantedBy=default.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOS</span>
</span></span></code></pre></div><ol start=2><li>启用注册的服务</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl enable eth0-promisc
</span></span></code></pre></div><p>这样，在系统重启后依然可以正常使用 OpenWrt</p><h2 id=修复宿主机与-openwrt-无法通信问题>修复宿主机与 OpenWrt 无法通信问题</h2><p>Docker 的 <code>macvlan</code> 为了安全禁止宿主机与容器通信，因此宿主机和 OpenWrt 无法互相访问，导致宿主机上的一些监控无法从 OpenWrt 拉取数据；可以通过在宿主机上再创建一个 <code>macvlan</code> 接口，修改路由规则解决该问题</p><h3 id=配置-macvlan-接口>配置 macvlan 接口</h3><ul><li>宿主机创建 <code>macvlan</code> 接口</li></ul><p>在宿主机上添加了一个新的 <code>macvlan</code> 桥接 <code>eth0</code> 的接口，名称为 <code>openwrt-bridge</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ip link add openwrt-bridge link eth0 type macvlan mode bridge
</span></span></code></pre></div><ul><li>为 <code>openwrt-bridge</code> 接口配置 IP 并启用</li></ul><p>为 <code>openwrt-bridge</code> 接口配置不冲突的 IP地址 <code>192.168.31.6</code>，并启用该接口</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ip addr add 192.168.31.6 dev openwrt-bridge
</span></span><span style=display:flex><span>ip link set openwrt-bridge up
</span></span></code></pre></div><ul><li>配置路由规则，添加 OpenWrt</li></ul><p>将 OpenWrt 的 IP 地址添加到 <code>openwrt-bridge</code> 接口的路由规则中，即可实现宿主机与 OpenWrt 容器的互相通信</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ip route add 192.168.31.4 dev openwrt-bridge
</span></span></code></pre></div><h3 id=配置重启后自动使用-macvlan-接口>配置重启后自动使用 macvlan 接口</h3><p>同样通过添加一个 <code>oneshot</code>服务的方式配置</p><ol><li>添加 <code>oneshot</code>服务，在网络启动之后执行，添加 <code>macvlan</code> 网卡</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo bash -c <span style=color:#e6db74>&#39;cat &gt; /etc/systemd/system/openwrt-bridge.service&#39;</span> <span style=color:#e6db74>&lt;&lt;&#39;EOS&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Unit]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Description=Add network interface for openwrt at boot
</span></span></span><span style=display:flex><span><span style=color:#e6db74>After=network-online.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Service]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Type=oneshot
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ExecStart=/usr/sbin/ip link add openwrt-bridge link eth0 type macvlan mode bridge
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ExecStart=/usr/sbin/ip addr add 192.168.31.6 dev openwrt-bridge
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ExecStart=/usr/sbin/ip link set openwrt-bridge up
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ExecStart=/usr/sbin/ip route add 192.168.31.4 dev openwrt-bridge
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ExecStop=/usr/sbin/ip link delete openwrt-bridge
</span></span></span><span style=display:flex><span><span style=color:#e6db74>TimeoutStartSec=0
</span></span></span><span style=display:flex><span><span style=color:#e6db74>RemainAfterExit=yes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[Install]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>WantedBy=default.target
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOS</span>
</span></span></code></pre></div><ol start=2><li>启用注册的服务</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl enable openwrt-bridge
</span></span></code></pre></div><h2 id=参考文档>参考文档</h2><ul><li><a href=%E7%90%86%E8%A7%A3%20macvlan>https://switch-router.gitee.io/blog/macvlan/</a></li><li><a href=https://mlapp.cn/376.html>在Docker 中运行 OpenWrt 旁路网关</a></li><li><a href=https://blog.oddbit.com/post/2018-03-12-using-docker-macvlan-networks/>USING DOCKER MACVLAN NETWORKS</a></li><li><a href=https://stackoverflow.com/questions/39032100/what-is-the-difference-between-systemds-oneshot-and-simple-service-types>What is the difference between systemd&rsquo;s &lsquo;oneshot&rsquo; and &lsquo;simple&rsquo; service types?</a></li><li><a href=https://trstringer.com/simple-vs-oneshot-systemd-service/>Simple vs Oneshot - Choosing a systemd Service Type</a></li></ul></section><div class=paginator><a class=prev href=https://blog.hellowood.dev/posts/openwrt-%E5%9C%A8-esxi-%E4%B8%AD%E4%BB%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85/><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg>
<span>Openwrt 在 Esxi 中以虚拟机方式安装</span></a>
<a class=next href=https://blog.hellowood.dev/posts/macos-monterey-%E5%88%B6%E4%BD%9C-windows-%E5%90%AF%E5%8A%A8%E7%9B%98/><span>MacOS Monterey 制作 Windows 启动盘</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div></article></div><footer class=footer><p>&copy; 2024 <a href=https://blog.hellowood.dev/>HelloWood</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank data-umami-event=to-hugo>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank data-umami-event=to-ladder>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g data-umami-event=top-link><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>