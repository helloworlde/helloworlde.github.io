<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:1.1rem}</style><title>ä½¿ç”¨ Step CA ä½œä¸ºå†…ç½‘çš„ ACME Server ä¸º Caddy é¢å‘å¯ä¿¡çš„ HTTPS è¯ä¹¦</title><meta name=description content="æœ‰ä¸€äº›æœåŠ¡å¦‚ç”¨äºç™»å½•çš„ PocketId ç­‰éœ€è¦ä½¿ç”¨ HTTPS è¿›è¡Œè®¿é—®ï¼Œä½†æ˜¯ Caddy ç”Ÿæˆçš„è¯ä¹¦æ˜¯è‡ªç­¾åçš„ï¼Œè®¿é—®æ—¶ä¼šæç¤ºä¸å—ä¿¡ä»»ï¼›å› æ­¤éœ€è¦ä½¿ç”¨ä¸€ä¸ªå¯ä¿¡çš„ CA æ¥é¢å‘è¯ä¹¦ï¼›è¿™é‡Œä½¿ç”¨ Step CA ä½œä¸º ACME Serverï¼Œä¸º Caddy é¢å‘å¯ä¿¡çš„ HTTPS è¯ä¹¦
éƒ¨ç½² Step CA â€¦"><meta name=keywords content='blog,hugo,HomeLab,Caddy,Cert'><meta property="og:url" content="https://blog.hellowood.dev/posts/%E4%BD%BF%E7%94%A8-step-ca-%E4%BD%9C%E4%B8%BA%E5%86%85%E7%BD%91%E7%9A%84-acme-server-%E4%B8%BA-caddy-%E9%A2%81%E5%8F%91%E5%8F%AF%E4%BF%A1%E7%9A%84-https-%E8%AF%81%E4%B9%A6/"><meta property="og:type" content="website"><meta property="og:title" content="ä½¿ç”¨ Step CA ä½œä¸ºå†…ç½‘çš„ ACME Server ä¸º Caddy é¢å‘å¯ä¿¡çš„ HTTPS è¯ä¹¦"><meta property="og:description" content="æœ‰ä¸€äº›æœåŠ¡å¦‚ç”¨äºç™»å½•çš„ PocketId ç­‰éœ€è¦ä½¿ç”¨ HTTPS è¿›è¡Œè®¿é—®ï¼Œä½†æ˜¯ Caddy ç”Ÿæˆçš„è¯ä¹¦æ˜¯è‡ªç­¾åçš„ï¼Œè®¿é—®æ—¶ä¼šæç¤ºä¸å—ä¿¡ä»»ï¼›å› æ­¤éœ€è¦ä½¿ç”¨ä¸€ä¸ªå¯ä¿¡çš„ CA æ¥é¢å‘è¯ä¹¦ï¼›è¿™é‡Œä½¿ç”¨ Step CA ä½œä¸º ACME Serverï¼Œä¸º Caddy é¢å‘å¯ä¿¡çš„ HTTPS è¯ä¹¦
éƒ¨ç½² Step CA â€¦"><meta property="og:image" content="https://blog.hellowood.dev/images/avatar.webp"><meta property="og:image:secure_url" content="https://blog.hellowood.dev/images/avatar.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="ä½¿ç”¨ Step CA ä½œä¸ºå†…ç½‘çš„ ACME Server ä¸º Caddy é¢å‘å¯ä¿¡çš„ HTTPS è¯ä¹¦"><meta name=twitter:description content="æœ‰ä¸€äº›æœåŠ¡å¦‚ç”¨äºç™»å½•çš„ PocketId ç­‰éœ€è¦ä½¿ç”¨ HTTPS è¿›è¡Œè®¿é—®ï¼Œä½†æ˜¯ Caddy ç”Ÿæˆçš„è¯ä¹¦æ˜¯è‡ªç­¾åçš„ï¼Œè®¿é—®æ—¶ä¼šæç¤ºä¸å—ä¿¡ä»»ï¼›å› æ­¤éœ€è¦ä½¿ç”¨ä¸€ä¸ªå¯ä¿¡çš„ CA æ¥é¢å‘è¯ä¹¦ï¼›è¿™é‡Œä½¿ç”¨ Step CA ä½œä¸º ACME Serverï¼Œä¸º Caddy é¢å‘å¯ä¿¡çš„ HTTPS è¯ä¹¦
éƒ¨ç½² Step CA â€¦"><meta property="twitter:domain" content="https://blog.hellowood.dev/posts/%E4%BD%BF%E7%94%A8-step-ca-%E4%BD%9C%E4%B8%BA%E5%86%85%E7%BD%91%E7%9A%84-acme-server-%E4%B8%BA-caddy-%E9%A2%81%E5%8F%91%E5%8F%AF%E4%BF%A1%E7%9A%84-https-%E8%AF%81%E4%B9%A6/"><meta property="twitter:url" content="https://blog.hellowood.dev/posts/%E4%BD%BF%E7%94%A8-step-ca-%E4%BD%9C%E4%B8%BA%E5%86%85%E7%BD%91%E7%9A%84-acme-server-%E4%B8%BA-caddy-%E9%A2%81%E5%8F%91%E5%8F%AF%E4%BF%A1%E7%9A%84-https-%E8%AF%81%E4%B9%A6/"><meta name=twitter:image content="https://blog.hellowood.dev/images/avatar.webp"><link rel=canonical href=https://blog.hellowood.dev/posts/%E4%BD%BF%E7%94%A8-step-ca-%E4%BD%9C%E4%B8%BA%E5%86%85%E7%BD%91%E7%9A%84-acme-server-%E4%B8%BA-caddy-%E9%A2%81%E5%8F%91%E5%8F%AF%E4%BF%A1%E7%9A%84-https-%E8%AF%81%E4%B9%A6/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.70293498aa96b2dbb767ec11a622eb2266d8fc37a0fff88233a82952e3c72b15.js integrity="sha256-cCk0mKqWstu3Z+wRpiLrImbY/Deg//iCM6gpUuPHKxU="></script><link rel=stylesheet type=text/css href=/css/custom.css><script defer src=https://umami.hellowood.dev/script.js data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301></script><script defer src=https://cloud.umami.is/script.js data-website-id=73ff1c8c-9938-43cf-81af-e77e26b0cca3></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}'></script><meta name=google-adsense-account content="ca-pub-5709431067036925"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5709431067036925" crossorigin=anonymous></script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jtbhx98g62")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ")</script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://blog.hellowood.dev/><img src=/images/avatar.webp alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://blog.hellowood.dev/>HelloWood</a></div><div class=nav-links><div class=nav-link><a href=https://blog.hellowood.dev/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://blog.hellowood.dev/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://blog.hellowood.dev/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://github.com/helloworlde aria-label=github><span data-feather=github></span></a></div><div class=nav-link><a href=https://umami.hellowood.dev/share/lab/Blog aria-label=dashboard><span data-feather=pie-chart></span></a></div><div class=nav-link><a href=https://blog.hellowood.dev/index.xml aria-label=rss><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://blog.hellowood.dev/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://blog.hellowood.dev/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://blog.hellowood.dev/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://github.com/helloworlde><span data-feather=github></span></a></li><li class=nav-item><a href=https://umami.hellowood.dev/share/lab/Blog><span data-feather=pie-chart></span></a></li><li class=nav-item><a href=https://blog.hellowood.dev/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>ä½¿ç”¨ Step CA ä½œä¸ºå†…ç½‘çš„ ACME Server ä¸º Caddy é¢å‘å¯ä¿¡çš„ HTTPS è¯ä¹¦</h1><small role=doc-subtitle></small><p class=post-date>2025-08-16</p><ul class=post-tags><li class=post-tag><a href=https://blog.hellowood.dev/tags/homelab>HomeLab</a></li><li class=post-tag><a href=https://blog.hellowood.dev/tags/caddy>Caddy</a></li><li class=post-tag><a href=https://blog.hellowood.dev/tags/cert>Cert</a></li></ul></div><div class=post-content><p>æœ‰ä¸€äº›æœåŠ¡å¦‚ç”¨äºç™»å½•çš„ PocketId ç­‰éœ€è¦ä½¿ç”¨ HTTPS è¿›è¡Œè®¿é—®ï¼Œä½†æ˜¯ Caddy ç”Ÿæˆçš„è¯ä¹¦æ˜¯è‡ªç­¾åçš„ï¼Œè®¿é—®æ—¶ä¼šæç¤ºä¸å—ä¿¡ä»»ï¼›å› æ­¤éœ€è¦ä½¿ç”¨ä¸€ä¸ªå¯ä¿¡çš„ CA æ¥é¢å‘è¯ä¹¦ï¼›è¿™é‡Œä½¿ç”¨ <a href=https://smallstep.com/docs/platform/>Step CA</a> ä½œä¸º ACME Serverï¼Œä¸º Caddy é¢å‘å¯ä¿¡çš„ HTTPS è¯ä¹¦</p><h2 id=éƒ¨ç½²-step-ca>éƒ¨ç½² Step CA</h2><h3 id=ä½¿ç”¨-docker-éƒ¨ç½²-step-ca>ä½¿ç”¨ Docker éƒ¨ç½² Step CA</h3><ul><li>åˆ›å»ºæŒ‚è½½ç›®å½•</li></ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCA è¯ä¹¦çš„æ ¹è¯ä¹¦å’Œä¸­é—´è¯ä¹¦ä¸€æ—¦ç”Ÿæˆå°±ä¸èƒ½æ›´æ”¹ï¼Œå¦åˆ™ä¼šå½±å“åˆ°æ‰€æœ‰ä½¿ç”¨è¯¥ CA é¢å‘çš„è¯ä¹¦ï¼Œå› æ­¤ä¸€å®šè¦æŒ‚è½½åˆ°ä¸€ä¸ªæŒä¹…åŒ–çš„ç›®å½•ä¸‹å®‰å…¨ä¿å­˜</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p data/config data/certs data/secrets data/db
</span></span></code></pre></div><ul><li>ä¿®æ”¹ç›®å½•æƒé™</li></ul><p>Step CA é»˜è®¤ä½¿ç”¨ UID 1000 çš„ç”¨æˆ·è¿è¡Œï¼Œå› æ­¤éœ€è¦å°†æŒ‚è½½ç›®å½•çš„æƒé™ä¿®æ”¹ä¸º 1000:1000ï¼Œé¿å… Step CA å› æƒé™é—®é¢˜æ— æ³•å†™å…¥è¯ä¹¦å’Œé…ç½®æ–‡ä»¶</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo chown -R 1000:1000 data/config data/certs data/secrets data/db
</span></span></code></pre></div><ul><li>docker-compose.yml</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>step-ca</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>smallstep/step-ca:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>step-ca</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>user</span>: <span style=color:#ae81ff>1000</span>:<span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;9000:9000&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./data/config:/home/step/config:rw</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./data/certs:/home/step/certs:rw</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./data/secrets:/home/step/secrets:rw</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./data/db:/home/step/db:rw</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DOCKER_STEPCA_INIT_NAME=Homelab Internal CA</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DOCKER_STEPCA_INIT_DNS_NAMES=ca.svc.homelab,*.svc.homelab,localhost</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DOCKER_STEPCA_INIT_REMOTE_MANAGEMENT=true</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DOCKER_STEPCA_INIT_ADMIN_SUBJECT=hellowood</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DOCKER_STEPCA_INIT_PASSWORD=123456</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DOCKER_STEPCA_INIT_ACME=true</span>
</span></span></code></pre></div><p>ç›®å½•è¯´æ˜ï¼š</p><table><thead><tr><th>å®¹å™¨è·¯å¾„</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>/home/step/config</code></td><td>å­˜æ”¾ CA é…ç½®æ–‡ä»¶ï¼ˆ<code>ca.json</code> ç­‰ï¼‰ï¼Œæ§åˆ¶ CA çš„è¡Œä¸ºå’Œ provisioner é…ç½®</td></tr><tr><td><code>/home/step/certs</code></td><td>å­˜æ”¾ CA æ ¹è¯ä¹¦ã€é¢å‘çš„è¯ä¹¦ä»¥åŠä¸­é—´è¯ä¹¦ç­‰</td></tr><tr><td><code>/home/step/secrets</code></td><td>å­˜æ”¾ CA ç§é’¥ã€ç®¡ç†å‘˜ JWK ç§é’¥ç­‰æ•æ„Ÿä¿¡æ¯</td></tr><tr><td><code>/home/step/db</code></td><td>å­˜æ”¾æ•°æ®åº“æ–‡ä»¶ï¼Œç”¨äºæŒä¹…åŒ–è¯ä¹¦ã€è´¦æˆ·ã€provisioner ç­‰çŠ¶æ€ä¿¡æ¯</td></tr></tbody></table><p>ç¯å¢ƒå˜é‡å¦‚ä¸‹ï¼š</p><table><thead><tr><th>å˜é‡</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>DOCKER_STEPCA_INIT_NAME</code></td><td>CA åç§°ï¼Œå†™å…¥æ ¹è¯ä¹¦çš„ Organization å­—æ®µ</td></tr><tr><td><code>DOCKER_STEPCA_INIT_DNS_NAMES</code></td><td>CA æ ¹è¯ä¹¦çš„æœ‰æ•ˆåŸŸååˆ—è¡¨</td></tr><tr><td><code>DOCKER_STEPCA_INIT_REMOTE_MANAGEMENT</code></td><td>æ˜¯å¦å¯ç”¨è¿œç¨‹ç®¡ç†ï¼Œå…è®¸ step-cli åœ¨å®¹å™¨å¤–é€šè¿‡ admin JWK å¯¹ CA è¿›è¡Œç®¡ç†æ“ä½œï¼Œå¦‚æ·»åŠ  provisionerã€ç®¡ç†è¯ä¹¦ç­‰</td></tr><tr><td><code>DOCKER_STEPCA_INIT_ADMIN_SUBJECT</code></td><td>è¶…çº§ç®¡ç†å‘˜è´¦å·åï¼Œç”¨äºæ‰§è¡Œç®¡ç†å‘½ä»¤çš„ç”¨æˆ·</td></tr><tr><td><code>DOCKER_STEPCA_INIT_PASSWORD</code></td><td>è¶…çº§ç®¡ç†å‘˜å¯†ç ï¼Œç”¨äºè§£é” admin JWK</td></tr><tr><td><code>DOCKER_STEPCA_INIT_ACME</code></td><td>æ˜¯å¦åˆå§‹åŒ– ACME provisionerï¼Œå…è®¸ ACME å®¢æˆ·ç«¯ï¼ˆå¦‚ Caddyã€Traefikï¼‰ç”³è¯·è¯ä¹¦</td></tr></tbody></table><ul><li>å¯åŠ¨ Step CA</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker compose up -d
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°è‡ªåŠ¨ç”Ÿæˆäº†æ ¹è¯ä¹¦å’Œä¸­é—´è¯ä¹¦ï¼Œç›¸å…³æ—¥å¿—å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>step-ca  |
</span></span><span style=display:flex><span>step-ca  | Generating root certificate... <span style=color:#66d9ef>done</span>!
</span></span><span style=display:flex><span>step-ca  | Generating intermediate certificate... <span style=color:#66d9ef>done</span>!
</span></span><span style=display:flex><span>step-ca  |
</span></span><span style=display:flex><span>step-ca  | âœ” Root certificate: /home/step/certs/root_ca.crt
</span></span><span style=display:flex><span>step-ca  | âœ” Root private key: /home/step/secrets/root_ca_key
</span></span><span style=display:flex><span>step-ca  | âœ” Root fingerprint: b201194735cb48db79eaf2f7aa2135e2a5ced7d3dd316d7613bcfaf9eac6d6f8
</span></span><span style=display:flex><span>step-ca  | âœ” Intermediate certificate: /home/step/certs/intermediate_ca.crt
</span></span><span style=display:flex><span>step-ca  | âœ” Intermediate private key: /home/step/secrets/intermediate_ca_key
</span></span><span style=display:flex><span>step-ca  | badger 2025/08/16 10:11:32 INFO: All <span style=color:#ae81ff>0</span> tables opened in 0s
</span></span><span style=display:flex><span>step-ca  | badger 2025/08/16 10:11:32 INFO: Storing value log head: <span style=color:#f92672>{</span>Fid:0 Len:30 Offset:3311<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>step-ca  | badger 2025/08/16 10:11:32 INFO: <span style=color:#f92672>[</span>Compactor: 173<span style=color:#f92672>]</span> Running compaction: <span style=color:#f92672>{</span>level:0 score:1.73 dropPrefixes:<span style=color:#f92672>[]}</span> <span style=color:#66d9ef>for</span> level: <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>step-ca  | badger 2025/08/16 10:11:32 INFO: LOG Compact 0-&gt;1, del <span style=color:#ae81ff>1</span> tables, add <span style=color:#ae81ff>1</span> tables, took 1.522094ms
</span></span><span style=display:flex><span>step-ca  | badger 2025/08/16 10:11:32 INFO: <span style=color:#f92672>[</span>Compactor: 173<span style=color:#f92672>]</span> Compaction <span style=color:#66d9ef>for</span> level: <span style=color:#ae81ff>0</span> DONE
</span></span><span style=display:flex><span>step-ca  | badger 2025/08/16 10:11:32 INFO: Force compaction on level <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>step-ca  | âœ” Database folder: /home/step/db
</span></span><span style=display:flex><span>step-ca  | âœ” Default configuration: /home/step/config/defaults.json
</span></span><span style=display:flex><span>step-ca  | âœ” Certificate Authority configuration: /home/step/config/ca.json
</span></span><span style=display:flex><span>step-ca  | âœ” Admin provisioner: admin <span style=color:#f92672>(</span>JWK<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>step-ca  | âœ” Super admin subject: hellowood
</span></span><span style=display:flex><span>step-ca  |
</span></span><span style=display:flex><span>step-ca  | Your PKI is ready to go. To generate certificates <span style=color:#66d9ef>for</span> individual services see <span style=color:#e6db74>&#39;step help ca&#39;</span>.
</span></span><span style=display:flex><span>step-ca  |
</span></span><span style=display:flex><span>step-ca  | FEEDBACK ğŸ˜ ğŸ»
</span></span><span style=display:flex><span>step-ca  |   The step utility is not instrumented <span style=color:#66d9ef>for</span> usage statistics. It does not phone
</span></span><span style=display:flex><span>step-ca  |   home. But your feedback is extremely valuable. Any information you can provide
</span></span><span style=display:flex><span>step-ca  |   regarding how youâ€™re using <span style=color:#e6db74>`</span>step<span style=color:#e6db74>`</span> helps. Please send us a sentence or two,
</span></span><span style=display:flex><span>step-ca  |   good or bad at feedback@smallstep.com or join GitHub Discussions
</span></span><span style=display:flex><span>step-ca  |   https://github.com/smallstep/certificates/discussions and our Discord
</span></span><span style=display:flex><span>step-ca  |   https://u.step.sm/discord.
</span></span><span style=display:flex><span>step-ca  |
</span></span><span style=display:flex><span>step-ca  | ğŸ‘‰ Your CA administrative username is: hellowood
</span></span><span style=display:flex><span>step-ca  | ğŸ‘‰ Your CA administrative password is: Ihaveapen1!
</span></span><span style=display:flex><span>step-ca  | ğŸ¤« This will only be displayed once.
</span></span><span style=display:flex><span>step-ca  | badger 2025/08/16 10:11:32 INFO: All <span style=color:#ae81ff>1</span> tables opened in 0s
</span></span><span style=display:flex><span>step-ca  | badger 2025/08/16 10:11:32 INFO: Replaying file id: <span style=color:#ae81ff>0</span> at offset: <span style=color:#ae81ff>3341</span>
</span></span><span style=display:flex><span>step-ca  | badger 2025/08/16 10:11:32 INFO: Replay took: 3.326Âµs
</span></span><span style=display:flex><span>step-ca  | 2025/08/16 10:11:32 Building new tls configuration using step-ca x509 Signer Interface
</span></span><span style=display:flex><span>step-ca  | 2025/08/16 10:11:32 Starting Smallstep CA/0.28.4 <span style=color:#f92672>(</span>linux/amd64<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>step-ca  | 2025/08/16 10:11:32 Documentation: https://u.step.sm/docs/ca
</span></span><span style=display:flex><span>step-ca  | 2025/08/16 10:11:32 Community Discord: https://u.step.sm/discord
</span></span><span style=display:flex><span>step-ca  | 2025/08/16 10:11:32 Config file: /home/step/config/ca.json
</span></span><span style=display:flex><span>step-ca  | 2025/08/16 10:11:32 The primary server URL is https://ca.svc.homelab:9000
</span></span><span style=display:flex><span>step-ca  | 2025/08/16 10:11:32 Root certificates are available at https://ca.svc.homelab:9000/roots.pem
</span></span><span style=display:flex><span>step-ca  | 2025/08/16 10:11:32 Additional configured hostnames: *.svc.homelab, localhost
</span></span><span style=display:flex><span>step-ca  | 2025/08/16 10:11:32 X.509 Root Fingerprint: b201194735cb48db79eaf2f7aa2135e2a5ced7d3dd316d7613bcfaf9eac6d6f8
</span></span><span style=display:flex><span>step-ca  | 2025/08/16 10:11:32 Serving HTTPS on :9000 ...
</span></span></code></pre></div><p>å¯åŠ¨å®Œæˆåè®¿é—® <code>https://100.0.0.2:9000/health</code>ï¼Œè¿”å› OK è¡¨ç¤º Step CA æ­£ç¡®å¯åŠ¨</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -k https://100.0.0.2:9000/health
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;status&#34;</span>:<span style=color:#e6db74>&#34;ok&#34;</span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>è®¿é—® <code>https://100.0.0.2:9000/acme/acme/directory</code> æŸ¥çœ‹ ACME ç›®å½•ä¿¡æ¯</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -k https://100.0.0.2:9000/acme/acme/directory
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;newNonce&#34;</span>:<span style=color:#e6db74>&#34;https://100.0.0.2:9000/acme/acme/new-nonce&#34;</span>,<span style=color:#e6db74>&#34;newAccount&#34;</span>:<span style=color:#e6db74>&#34;https://100.0.0.2:9000/acme/acme/new-account&#34;</span>,<span style=color:#e6db74>&#34;newOrder&#34;</span>:<span style=color:#e6db74>&#34;https://100.0.0.2:9000/acme/acme/new-order&#34;</span>,<span style=color:#e6db74>&#34;revokeCert&#34;</span>:<span style=color:#e6db74>&#34;https://100.0.0.2:9000/acme/acme/revoke-cert&#34;</span>,<span style=color:#e6db74>&#34;keyChange&#34;</span>:<span style=color:#e6db74>&#34;https://100.0.0.2:9000/acme/acme/key-change&#34;</span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=æ·»åŠ åŸŸåè§£æ>æ·»åŠ åŸŸåè§£æ</h3><p>å°† <code>ca.svc.homelab</code> åŸŸåè§£æåˆ° Step CA çš„ IP åœ°å€ï¼Œæ–¹ä¾¿ Caddy ä½œä¸º ACME Server ä½¿ç”¨ï¼Œå¯ä»¥é€šè¿‡ DNS æœåŠ¡å™¨æˆ–è€… <code>/etc/hosts</code> æ–‡ä»¶æ·»åŠ è§£æ</p><pre tabindex=0><code>100.0.0.2 ca.svc.homelab
</code></pre><h2 id=ä¿¡ä»»-step-ca-çš„æ ¹è¯ä¹¦>ä¿¡ä»» Step CA çš„æ ¹è¯ä¹¦</h2><p>æƒ³è¦å…¶ä»–æœåŠ¡ä½¿ç”¨ Step CA é¢å‘çš„è¯ä¹¦èƒ½æ­£ç¡®è®¿é—®ï¼Œéœ€è¦å°† Root CA è¯ä¹¦æ·»åŠ åˆ°è®¾å¤‡çš„å—ä¿¡ä»»çš„æ ¹è¯ä¹¦ä¸­</p><ul><li>è·å– CA è¯ä¹¦</li></ul><p>Step CA æ­£ç¡®å¯åŠ¨åä¼šåœ¨ <code>data/certs/</code> ç›®å½•ä¸‹ç”Ÿæˆ <code>root_ca.crt</code> å’Œ <code>intermediate_ca.crt</code> ä¸¤ä¸ªè¯ä¹¦æ–‡ä»¶ï¼›å…¶ä¸­ <code>root_ca.crt</code> æ˜¯æ ¹è¯ä¹¦ï¼Œ<code>intermediate_ca.crt</code> æ˜¯ä¸­é—´è¯ä¹¦ï¼›éœ€è¦å°† <code>root_ca.crt</code> æ·»åŠ åˆ°è®¾å¤‡çš„å—ä¿¡ä»»çš„æ ¹è¯ä¹¦ä¸­ï¼›æ–‡ä»¶ç›®å½•ç»“æ„å¦‚ä¸‹ï¼Œ<code>data/certs/root_ca.crt</code> å°±æ˜¯æ ¹è¯ä¹¦</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>.
</span></span><span style=display:flex><span>â”œâ”€â”€ data
</span></span><span style=display:flex><span>â”‚Â Â  â”œâ”€â”€ certs
</span></span><span style=display:flex><span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ intermediate_ca.crt
</span></span><span style=display:flex><span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ root_ca.crt
</span></span><span style=display:flex><span>â”‚Â Â  â”œâ”€â”€ config
</span></span><span style=display:flex><span>â”‚Â Â  â”‚Â Â  â”œâ”€â”€ ca.json
</span></span><span style=display:flex><span>â”‚Â Â  â”‚Â Â  â””â”€â”€ defaults.json
</span></span><span style=display:flex><span>â”‚Â Â  â””â”€â”€ secrets
</span></span><span style=display:flex><span>â”‚Â Â      â”œâ”€â”€ intermediate_ca_key
</span></span><span style=display:flex><span>â”‚Â Â      â”œâ”€â”€ password
</span></span><span style=display:flex><span>â”‚Â Â      â””â”€â”€ root_ca_key
</span></span><span style=display:flex><span>â””â”€â”€ docker-compose.yaml
</span></span></code></pre></div><ul><li>å°†æ ¹è¯ä¹¦æ·»åŠ åˆ° Ubuntu</li></ul><p>éœ€è¦å°†æ ¹è¯ä¹¦æ–‡ä»¶å¤åˆ¶åˆ° <code>/usr/local/share/ca-certificates/</code> ç›®å½•ä¸‹ï¼Œç„¶åè¿è¡Œ <code>update-ca-certificates</code> å‘½ä»¤æ›´æ–°è¯ä¹¦åˆ—è¡¨ï¼Œä½¿è¯ä¹¦ç”Ÿæ•ˆï¼Œè¿™æ ·è®¿é—® Step CA é¢å‘çš„è¯ä¹¦æ—¶å°±ä¸ä¼šå†æç¤ºä¸å—ä¿¡ä»»</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo cp data/certs/root_ca.crt /usr/local/share/ca-certificates/
</span></span><span style=display:flex><span>sudo update-ca-certificates
</span></span></code></pre></div><ul><li>å°†æ ¹è¯ä¹¦æ·»åŠ åˆ° macOS</li></ul><p>å°† root_ca.crt æ–‡ä»¶ä¸‹è½½åˆ° macOS ä¸Šï¼Œä½¿ç”¨é’¥åŒ™ä¸²è®¿é—®æ‰“å¼€ï¼Œç„¶ååœ¨ç™»å½•-è¯ä¹¦ä¸­é€‰æ‹©ä¿¡ä»»è¯¥è¯ä¹¦</p><p><img src=https://img.hellowood.dev/picture/homelab-caddy-step-ca-cert-trust-root-ca-01.png alt=homelab-caddy-step-ca-cert-trust-root-ca-01.png loading=lazy></p><p><img src=https://img.hellowood.dev/picture/homelab-caddy-step-ca-cert-trust-root-ca-02.png alt=homelab-caddy-step-ca-cert-trust-root-ca-02.png loading=lazy></p><p>å…¶ä»–æ“ä½œç³»ç»Ÿæˆ–è€…è½¯ä»¶å¯ä»¥å‚è€ƒ <a href=https://smallstep.com/docs/step-cli/reference/certificate/install/>step certificate install</a> ä¸­çš„ç›¸å…³å†…å®¹è¿›è¡Œå®‰è£…</p><h2 id=caddy-ä½¿ç”¨-step-ca-ä½œä¸º-acme-server>Caddy ä½¿ç”¨ Step CA ä½œä¸º ACME Server</h2><p>Caddy æ”¯æŒè‡ªå®šä¹‰ ACME Serverï¼Œå› æ­¤å¯ä»¥ç›´æ¥ä½¿ç”¨ Step CA ä½œä¸º ACME Server æ¥é¢å‘è¯ä¹¦</p><p>å…³äº Caddy çš„å®‰è£…å’Œé…ç½®å¯ä»¥å‚è€ƒ <a href=https://blog.hellowood.dev/posts/%E4%BD%BF%E7%94%A8-caddy-%E4%BD%9C%E4%B8%BA-homelab-%E5%86%85%E7%BD%91%E6%9C%8D%E5%8A%A1%E7%9A%84%E4%BB%A3%E7%90%86/>ä½¿ç”¨ Caddy ä½œä¸º HomeLab å†…ç½‘æœåŠ¡çš„ä»£ç†</a></p><h3 id=å¯åŠ¨-caddy>å¯åŠ¨ Caddy</h3><p>ä½¿ç”¨ docker compose å¯åŠ¨ Caddyï¼›åŒæ—¶å¯åŠ¨ä¸€ä¸ª whoami æœåŠ¡ç”¨äºæµ‹è¯•</p><ul><li>docker-compose.yml</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>caddy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>caddy</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>caddy</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hostname</span>: <span style=color:#ae81ff>caddy</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;80:80&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;443:443&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;2019:2019&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./Caddyfile:/etc/caddy/Caddyfile</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./certs:/certs</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./data:/data/caddy</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./config:/config/caddy</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>whoami</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>traefik/whoami</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>whoami</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>hostname</span>: <span style=color:#ae81ff>whoami</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>8081</span>:<span style=color:#ae81ff>80</span>
</span></span></code></pre></div><h3 id=é…ç½®-acme-server>é…ç½® ACME Server</h3><ul><li>å°† Step CA çš„æ ¹è¯ä¹¦æŒ‚è½½åˆ° Caddy å®¹å™¨ä¸­</li></ul><p>éœ€è¦å°† Step CA çš„æ ¹è¯ä¹¦æŒ‚è½½åˆ° Caddy å®¹å™¨ä¸­ï¼Œç”¨äº Caddy éªŒè¯ Step CA é¢å‘çš„è¯ä¹¦ï¼›å°† Step CA çš„ <code>data/certs/root_ca.crt</code> å¤åˆ¶åˆ° <code>certs/</code> ç›®å½•ä¸‹</p><ul><li>Caddyfile é…ç½® ACME Server</li></ul><pre tabindex=0><code class=language-conf data-lang=conf>{
    log {
        output stdout
        format console
        level info
    }
    admin 0.0.0.0:2019

    # ACME Server é…ç½®
    email admin@mail.svc.homelab
    acme_ca https://ca.svc.homelab:9000/acme/acme/directory
    acme_ca_root /certs/root_ca.crt
}

whoami.svc.homelab {
  reverse_proxy 100.0.0.2:8080
}
</code></pre><h3 id=å¯åŠ¨-caddy-1>å¯åŠ¨ Caddy</h3><p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>.
</span></span><span style=display:flex><span>â”œâ”€â”€ Caddyfile
</span></span><span style=display:flex><span>â”œâ”€â”€ config
</span></span><span style=display:flex><span>â”œâ”€â”€ certs
</span></span><span style=display:flex><span>â”‚Â Â  â”œâ”€â”€ root_ca.crt
</span></span><span style=display:flex><span>â”œâ”€â”€ data
</span></span><span style=display:flex><span>â””â”€â”€ docker-compose.yaml
</span></span></code></pre></div><p>ä½¿ç”¨ <code>docker compose up -d</code> å¯åŠ¨ Caddy æœåŠ¡ï¼ŒCaddy ä¼šè‡ªåŠ¨å‘ Step CA è¯·æ±‚è¯ä¹¦ï¼Œç›¸å…³æ—¥å¿—å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>caddy  | 2025/08/16 13:44:18.098	INFO	tls.issuance.acme	<span style=color:#66d9ef>done</span> waiting on internal rate limiter	<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;identifiers&#34;</span>: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;whoami.svc.homelab&#34;</span><span style=color:#f92672>]</span>, <span style=color:#e6db74>&#34;ca&#34;</span>: <span style=color:#e6db74>&#34;https://ca.svc.homelab:9000/acme/acme/directory&#34;</span>, <span style=color:#e6db74>&#34;account&#34;</span>: <span style=color:#e6db74>&#34;admin@mail.svc.homelab&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>caddy  | 2025/08/16 13:44:18.098	INFO	tls.issuance.acme	using ACME account	<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;account_id&#34;</span>: <span style=color:#e6db74>&#34;https://ca.svc.homelab:9000/acme/acme/account/hlJdKH3lry6PQukHyahRQWQ06wwdBM5J&#34;</span>, <span style=color:#e6db74>&#34;account_contact&#34;</span>: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;mailto:admin@mail.svc.homelab&#34;</span><span style=color:#f92672>]}</span>
</span></span><span style=display:flex><span>caddy  | 2025/08/16 13:44:18.105	INFO	trying to solve challenge	<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;identifier&#34;</span>: <span style=color:#e6db74>&#34;whoami.svc.homelab&#34;</span>, <span style=color:#e6db74>&#34;challenge_type&#34;</span>: <span style=color:#e6db74>&#34;tls-alpn-01&#34;</span>, <span style=color:#e6db74>&#34;ca&#34;</span>: <span style=color:#e6db74>&#34;https://ca.svc.homelab:9000/acme/acme/directory&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>caddy  | 2025/08/16 13:44:18.108	INFO	tls	served key authentication certificate	<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;server_name&#34;</span>: <span style=color:#e6db74>&#34;whoami.svc.homelab&#34;</span>, <span style=color:#e6db74>&#34;challenge&#34;</span>: <span style=color:#e6db74>&#34;tls-alpn-01&#34;</span>, <span style=color:#e6db74>&#34;remote&#34;</span>: <span style=color:#e6db74>&#34;172.18.0.1:51640&#34;</span>, <span style=color:#e6db74>&#34;distributed&#34;</span>: false<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>caddy  | 2025/08/16 13:44:18.364	INFO	authorization finalized	<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;identifier&#34;</span>: <span style=color:#e6db74>&#34;whoami.svc.homelab&#34;</span>, <span style=color:#e6db74>&#34;authz_status&#34;</span>: <span style=color:#e6db74>&#34;valid&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>caddy  | 2025/08/16 13:44:18.364	INFO	validations succeeded; finalizing order	<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;order&#34;</span>: <span style=color:#e6db74>&#34;https://ca.svc.homelab:9000/acme/acme/order/WmFkMDixawSZl1bw6gq0xX9CnyOEnLQc&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>caddy  | 2025/08/16 13:44:18.372	INFO	successfully downloaded available certificate chains	<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;count&#34;</span>: 1, <span style=color:#e6db74>&#34;first_url&#34;</span>: <span style=color:#e6db74>&#34;https://ca.svc.homelab:9000/acme/acme/certificate/04rWrksSgX9IHiyBCgHajOeXs2xjUu6K&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>caddy  | 2025/08/16 13:44:18.374	INFO	tls.obtain	certificate obtained successfully	<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;identifier&#34;</span>: <span style=color:#e6db74>&#34;whoami.svc.homelab&#34;</span>, <span style=color:#e6db74>&#34;issuer&#34;</span>: <span style=color:#e6db74>&#34;ca.svc.homelab:9000-acme-acme-directory&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>caddy  | 2025/08/16 13:44:18.374	INFO	tls.obtain	releasing lock	<span style=color:#f92672>{</span><span style=color:#e6db74>&#34;identifier&#34;</span>: <span style=color:#e6db74>&#34;whoami.svc.homelab&#34;</span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=éªŒè¯-https-è¯ä¹¦>éªŒè¯ HTTPS è¯ä¹¦</h3><p>è®¿é—® <code>https://whoami.svc.homelab</code>ï¼Œå¯ä»¥æ­£å¸¸è®¿é—®ï¼Œå¹¶ä¸”è¯ä¹¦æ˜¯æœ‰æ•ˆçš„ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -I https://whoami.svc.homelab
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>HTTP/2 <span style=color:#ae81ff>200</span>
</span></span><span style=display:flex><span>alt-svc: h3<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;:443&#34;</span>; ma<span style=color:#f92672>=</span><span style=color:#ae81ff>2592000</span>
</span></span><span style=display:flex><span>content-type: text/plain; charset<span style=color:#f92672>=</span>utf-8
</span></span><span style=display:flex><span>date: Sat, <span style=color:#ae81ff>16</span> Aug <span style=color:#ae81ff>2025</span> 13:49:41 GMT
</span></span><span style=display:flex><span>via: 1.1 Caddy
</span></span><span style=display:flex><span>content-length: <span style=color:#ae81ff>273</span>
</span></span></code></pre></div><ul><li>æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯</li></ul><p>é€šè¿‡ openssl å‘½ä»¤æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯ï¼Œç”± <code>Homelab Internal CA</code> é¢å‘ï¼Œæœ‰æ•ˆæœŸä¸º1å¤©ï¼ŒCaddy ä¼šè‡ªåŠ¨ç»­æœŸ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo | openssl s_client -connect whoami.svc.homelab:443 2&gt;/dev/null | openssl x509 -noout -dates -subject -issuer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>notBefore<span style=color:#f92672>=</span>Aug <span style=color:#ae81ff>16</span> 13:43:18 <span style=color:#ae81ff>2025</span> GMT
</span></span><span style=display:flex><span>notAfter<span style=color:#f92672>=</span>Aug <span style=color:#ae81ff>17</span> 13:44:18 <span style=color:#ae81ff>2025</span> GMT
</span></span><span style=display:flex><span>subject<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>issuer<span style=color:#f92672>=</span>O<span style=color:#f92672>=</span>Homelab Internal CA, CN<span style=color:#f92672>=</span>Homelab Internal CA Intermediate CA
</span></span></code></pre></div><h3 id=æ³›åŸŸåç”³è¯·è¯ä¹¦>æ³›åŸŸåç”³è¯·è¯ä¹¦</h3><p>Caddy æ³›åŸŸåç”³è¯·è¯ä¹¦æ¯”è¾ƒéº»çƒ¦ï¼Œéœ€è¦æ”¯æŒ dns-01 challenge çš„ DNS æœåŠ¡å™¨ï¼Œå¹¶ä¸”éœ€è¦å¼€å¯<code>rfc2136</code> æ’ä»¶ï¼›åœ¨ HomeLab åœºæ™¯ä¸‹ï¼Œæ›´æ¨èä½¿ç”¨ Step CA ç›´æ¥ç”Ÿæˆæ³›åŸŸåè¯ä¹¦ï¼Œç„¶åæŒ‚è½½åˆ° Caddy ä¸­ä½¿ç”¨</p><h4 id=åˆ›å»ºæ³›åŸŸåè¯ä¹¦>åˆ›å»ºæ³›åŸŸåè¯ä¹¦</h4><p>å¯ä»¥è¿›å…¥åˆ° Step CA å®¹å™¨ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºè¯ä¹¦ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker exec -it step-ca bash
</span></span></code></pre></div><p>è¿›å…¥åˆ° <code>/home/step/certs</code> ç›®å½•åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºæ³›åŸŸåè¯ä¹¦ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>step certificate create <span style=color:#e6db74>&#34;*.svc.homelab&#34;</span> _wildcard.svc.homelab.crt _wildcard.svc.homelab.key <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --profile leaf <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --ca /home/step/certs/root_ca.crt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --ca-key /home/step/secrets/root_ca_key <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --no-password --insecure <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --not-after 87600h
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Please enter the password to decrypt /home/step/secrets/root_ca_key:
</span></span><span style=display:flex><span>âœ” Would you like to overwrite _wildcard.svc.homelab.crt <span style=color:#f92672>[</span>y/n<span style=color:#f92672>]</span>: yâ–ˆ
</span></span><span style=display:flex><span>âœ” Would you like to overwrite _wildcard.svc.homelab.crt <span style=color:#f92672>[</span>y/n<span style=color:#f92672>]</span>: y
</span></span><span style=display:flex><span>Your certificate has been saved in _wildcard.svc.homelab.crt.
</span></span><span style=display:flex><span>Your private key has been saved in _wildcard.svc.homelab.key.
</span></span></code></pre></div><h4 id=æŒ‚è½½åˆ°-caddy>æŒ‚è½½åˆ° Caddy</h4><ul><li>Caddyfile</li></ul><pre tabindex=0><code class=language-conf data-lang=conf>*.svc.homelab {
  tls /certs/_wildcard.svc.homelab.crt /certs/_wildcard.svc.homelab.key
  reverse_proxy 100.0.0.2:8080
}
</code></pre><p>å¯åŠ¨åæŸ¥çœ‹è¯ä¹¦ä¿¡æ¯ï¼Œæ­¤æ—¶è¯ä¹¦å˜æˆäº†æ³›åŸŸåè¯ä¹¦ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>echo | openssl s_client -connect whoami.svc.homelab:443 2&gt;/dev/null | openssl x509 -noout -dates -subject -issuer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>notBefore<span style=color:#f92672>=</span>Aug <span style=color:#ae81ff>16</span> 08:43:55 <span style=color:#ae81ff>2025</span> GMT
</span></span><span style=display:flex><span>notAfter<span style=color:#f92672>=</span>Aug <span style=color:#ae81ff>14</span> 08:43:51 <span style=color:#ae81ff>2035</span> GMT
</span></span><span style=display:flex><span>subject<span style=color:#f92672>=</span>CN<span style=color:#f92672>=</span>*.svc.homelab
</span></span><span style=display:flex><span>issuer<span style=color:#f92672>=</span>O<span style=color:#f92672>=</span>Homelab Internal CA, CN<span style=color:#f92672>=</span>Homelab Internal CA Root CA
</span></span></code></pre></div><p>ä½¿ç”¨ä¹‹åè¿˜æ˜¯å¤ªå¤æ‚ï¼Œä¸é€‚åˆ HomeLab åœºæ™¯ï¼Œè¿˜æ˜¯ä½¿ç”¨ mkcert ç”Ÿæˆè¯ä¹¦ç›´æ¥ä½¿ç”¨æ›´ç®€å•ï¼Œå°†æ ¹è¯ä¹¦æ·»åŠ åˆ°è®¾å¤‡çš„å—ä¿¡ä»»çš„æ ¹è¯ä¹¦ä¸­å³å¯</p></div><div class=prev-next></div><svg id="btt-button" class="arrow-logo" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script><div id=comments><script src=https://utteranc.es/client.js repo=helloworlde/helloworlde.github.io issue-term=title theme=github-light crossorigin=anonymous async></script></div></div></main><footer class=footer><span>&copy; 2025 hellowood.dev</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>