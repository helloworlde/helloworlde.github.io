<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>OpenWrt å®‰è£…ä½¿ç”¨ Dae ä½œä¸ºä»£ç†</title><meta name=description content="Dae æ˜¯ä¸€ç§é«˜æ€§èƒ½é€æ˜ä»£ç†è§£å†³æ–¹æ¡ˆï¼Œåœ¨ Linux å†…æ ¸ä¸­ä½¿ç”¨ eBPF å®ç°äº†ä»£ç†èƒ½åŠ›ï¼›æ”¯æŒä»¥åŸŸåã€æº IPã€ç›®çš„ IPã€æºç«¯å£ã€ç›®çš„ç«¯å£ã€TCP/UDPã€IPv4/IPv6ã€è¿›ç¨‹åã€MAC åœ°å€ç­‰å¯¹æµé‡è¿›è¡Œåˆ†æµï¼›ç›¸å¯¹äºå…¶ä»–ä»£ç†æ–¹æ¡ˆï¼Œå¦‚ Clash ç­‰ï¼ŒDae çš„ä»£ç†è§„åˆ™ç›¸å¯¹çµæ´»ï¼Œç›´è¿çš„æ€§èƒ½æ›´å¥½(æœ¬æœºè¿›ç¨‹ï¼Œä½œä¸ºç½‘å…³ â€¦"><meta name=keywords content='blog,hugo,Proxy,Dae,HomeLab,OpenWrt'><meta property="og:url" content="https://blog.hellowood.dev/posts/openwrt-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8-dae-%E4%BD%9C%E4%B8%BA%E4%BB%A3%E7%90%86/"><meta property="og:type" content="website"><meta property="og:title" content="OpenWrt å®‰è£…ä½¿ç”¨ Dae ä½œä¸ºä»£ç†"><meta property="og:description" content="Dae æ˜¯ä¸€ç§é«˜æ€§èƒ½é€æ˜ä»£ç†è§£å†³æ–¹æ¡ˆï¼Œåœ¨ Linux å†…æ ¸ä¸­ä½¿ç”¨ eBPF å®ç°äº†ä»£ç†èƒ½åŠ›ï¼›æ”¯æŒä»¥åŸŸåã€æº IPã€ç›®çš„ IPã€æºç«¯å£ã€ç›®çš„ç«¯å£ã€TCP/UDPã€IPv4/IPv6ã€è¿›ç¨‹åã€MAC åœ°å€ç­‰å¯¹æµé‡è¿›è¡Œåˆ†æµï¼›ç›¸å¯¹äºå…¶ä»–ä»£ç†æ–¹æ¡ˆï¼Œå¦‚ Clash ç­‰ï¼ŒDae çš„ä»£ç†è§„åˆ™ç›¸å¯¹çµæ´»ï¼Œç›´è¿çš„æ€§èƒ½æ›´å¥½(æœ¬æœºè¿›ç¨‹ï¼Œä½œä¸ºç½‘å…³ â€¦"><meta property="og:image" content="https://blog.hellowood.dev/images/avatar.webp"><meta property="og:image:secure_url" content="https://blog.hellowood.dev/images/avatar.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="OpenWrt å®‰è£…ä½¿ç”¨ Dae ä½œä¸ºä»£ç†"><meta name=twitter:description content="Dae æ˜¯ä¸€ç§é«˜æ€§èƒ½é€æ˜ä»£ç†è§£å†³æ–¹æ¡ˆï¼Œåœ¨ Linux å†…æ ¸ä¸­ä½¿ç”¨ eBPF å®ç°äº†ä»£ç†èƒ½åŠ›ï¼›æ”¯æŒä»¥åŸŸåã€æº IPã€ç›®çš„ IPã€æºç«¯å£ã€ç›®çš„ç«¯å£ã€TCP/UDPã€IPv4/IPv6ã€è¿›ç¨‹åã€MAC åœ°å€ç­‰å¯¹æµé‡è¿›è¡Œåˆ†æµï¼›ç›¸å¯¹äºå…¶ä»–ä»£ç†æ–¹æ¡ˆï¼Œå¦‚ Clash ç­‰ï¼ŒDae çš„ä»£ç†è§„åˆ™ç›¸å¯¹çµæ´»ï¼Œç›´è¿çš„æ€§èƒ½æ›´å¥½(æœ¬æœºè¿›ç¨‹ï¼Œä½œä¸ºç½‘å…³ â€¦"><meta property="twitter:domain" content="https://blog.hellowood.dev/posts/openwrt-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8-dae-%E4%BD%9C%E4%B8%BA%E4%BB%A3%E7%90%86/"><meta property="twitter:url" content="https://blog.hellowood.dev/posts/openwrt-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8-dae-%E4%BD%9C%E4%B8%BA%E4%BB%A3%E7%90%86/"><meta name=twitter:image content="https://blog.hellowood.dev/images/avatar.webp"><link rel=canonical href=https://blog.hellowood.dev/posts/openwrt-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8-dae-%E4%BD%9C%E4%B8%BA%E4%BB%A3%E7%90%86/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.70293498aa96b2dbb767ec11a622eb2266d8fc37a0fff88233a82952e3c72b15.js integrity="sha256-cCk0mKqWstu3Z+wRpiLrImbY/Deg//iCM6gpUuPHKxU="></script><link rel=stylesheet type=text/css href=/css/custom.css><script defer src=https://umami.hellowood.dev/script.js data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301></script><script defer src=https://cloud.umami.is/script.js data-website-id=73ff1c8c-9938-43cf-81af-e77e26b0cca3></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}'></script><meta name=google-adsense-account content="ca-pub-3401351766168985"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3401351766168985" crossorigin=anonymous></script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jtbhx98g62")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ")</script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://blog.hellowood.dev/><img src=/images/avatar.webp alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://blog.hellowood.dev/>HelloWood</a></div><div class=nav-links><div class=nav-link><a href=https://blog.hellowood.dev/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://blog.hellowood.dev/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://blog.hellowood.dev/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://github.com/helloworlde aria-label=github><span data-feather=github></span></a></div><div class=nav-link><a href=https://umami.hellowood.dev/share/lab/Blog aria-label=dashboard><span data-feather=pie-chart></span></a></div><div class=nav-link><a href=https://blog.hellowood.dev/index.xml aria-label=rss><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://blog.hellowood.dev/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://blog.hellowood.dev/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://blog.hellowood.dev/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://github.com/helloworlde><span data-feather=github></span></a></li><li class=nav-item><a href=https://umami.hellowood.dev/share/lab/Blog><span data-feather=pie-chart></span></a></li><li class=nav-item><a href=https://blog.hellowood.dev/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>OpenWrt å®‰è£…ä½¿ç”¨ Dae ä½œä¸ºä»£ç†</h1><small role=doc-subtitle></small><p class=post-date>2025-04-28</p><ul class=post-tags><li class=post-tag><a href=https://blog.hellowood.dev/tags/proxy>Proxy</a></li><li class=post-tag><a href=https://blog.hellowood.dev/tags/dae>Dae</a></li><li class=post-tag><a href=https://blog.hellowood.dev/tags/homelab>HomeLab</a></li><li class=post-tag><a href=https://blog.hellowood.dev/tags/openwrt>OpenWrt</a></li></ul></div><div class=post-content><p><a href=https://github.com/daeuniverse/dae>Dae</a> æ˜¯ä¸€ç§é«˜æ€§èƒ½é€æ˜ä»£ç†è§£å†³æ–¹æ¡ˆï¼Œåœ¨ Linux å†…æ ¸ä¸­ä½¿ç”¨ eBPF å®ç°äº†ä»£ç†èƒ½åŠ›ï¼›æ”¯æŒä»¥åŸŸåã€æº IPã€ç›®çš„ IPã€æºç«¯å£ã€ç›®çš„ç«¯å£ã€TCP/UDPã€IPv4/IPv6ã€è¿›ç¨‹åã€MAC åœ°å€ç­‰å¯¹æµé‡è¿›è¡Œåˆ†æµï¼›ç›¸å¯¹äºå…¶ä»–ä»£ç†æ–¹æ¡ˆï¼Œå¦‚ Clash ç­‰ï¼ŒDae çš„ä»£ç†è§„åˆ™ç›¸å¯¹çµæ´»ï¼Œç›´è¿çš„æ€§èƒ½æ›´å¥½(æœ¬æœºè¿›ç¨‹ï¼Œä½œä¸ºç½‘å…³å®é™…æ•ˆæœå·®è·ä¸å¤§)</p><p>Dae çš„å‡ºæ ˆåè®®æ”¯æŒ HTTPS/VMess/VLESS/Shadowsocks/Trojan/Tuic/Juicity/Hysteria2 ç­‰</p><p>Dae å’Œå…¶ä»–çš„ä»£ç†è½¯ä»¶å¦‚ Clash ç­‰ç›¸æ¯”ï¼Œåœ¨å¯é æ€§ã€ç¨³å®šæ€§ã€é€Ÿåº¦ã€å®¹ç¾ç­‰æ–¹é¢å¹¶æ²¡æœ‰æ˜æ˜¾çš„ä¼˜åŠ¿ï¼Œå¹¶ä¸”å¯¹è®¾å¤‡çš„è¦æ±‚è¾ƒé«˜ï¼Œå› æ­¤å¹¶ä¸è§å¾—æ˜¯æœ€ä½³é€‰æ‹©</p><h2 id=å®‰è£…-openwrt>å®‰è£… OpenWrt</h2><p>å› ä¸º dae æ˜¯åŸºäº eBPF å®ç°çš„ï¼Œæ‰€ä»¥éœ€è¦ OpenWrt å†…æ ¸æ”¯æŒ eBPFï¼Œå†…æ ¸ç‰ˆæœ¬éœ€è¦å¤§äº 5.17ï¼Œå¹¶ä¸”éœ€è¦å¼€å¯ eBPFï¼›OpenWrt å®˜æ–¹æä¾›çš„é•œåƒæœªå¼€å¯ eBPF æ”¯æŒï¼Œéœ€è¦è‡ªè¡Œç¼–è¯‘ï¼Œæˆ–è€…ä½¿ç”¨ ImmortalWRT æ„å»ºçš„é•œåƒ</p><h3 id=ä½¿ç”¨-immortalwrt-æ„å»ºé•œåƒ>ä½¿ç”¨ ImmortalWRT æ„å»ºé•œåƒ</h3><p>è®¿é—® <a href=https://firmware-selector.immortalwrt.org/>https://firmware-selector.immortalwrt.org/</a>ï¼Œæˆ‘æ˜¯åœ¨ x86 æœºå™¨çš„ PVE ä¸­ä½¿ç”¨è™šæ‹Ÿæœºçš„æ–¹å¼è¿è¡Œ OpenWrtï¼Œå› æ­¤é€‰æ‹© <code>Generic x86/64</code>ï¼Œå…¶ä»–å¹³å°å¦‚ arm ç­‰é€‰æ‹©å¯¹åº”çš„å¹³å°å³å¯</p><p>åœ¨ Installed Packages åé¢è¿½åŠ  eBPF å’Œ Dae ç›¸å…³çš„åŒ…ï¼š</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>kmod-xdp-sockets-diag kmod-veth kmod-sched-core kmod-sched-bpf kmod-nft-bridge dae-geosite dae-geoip dae
</span></span></code></pre></div><p>è½¯ä»¶åŒ…çš„ä½œç”¨å¦‚ä¸‹ï¼š</p><table><thead><tr><th>è½¯ä»¶å</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>kmod-xdp-sockets-diag</code></td><td>æä¾› XDP å¥—æ¥å­—è¯Šæ–­ï¼Œç”¨äºç›‘æ§ä¸æ’æŸ¥åŸºäº XDP çš„é«˜æ€§èƒ½ç½‘ç»œç¨‹åº</td></tr><tr><td><code>kmod-veth</code></td><td>æ”¯æŒæˆå¯¹è™šæ‹Ÿä»¥å¤ªç½‘è®¾å¤‡ï¼ˆvethï¼‰ï¼Œå¸¸ç”¨äºå®¹å™¨ç½‘ç»œéš”ç¦»</td></tr><tr><td><code>kmod-sched-core</code></td><td>æä¾› Linux å†…æ ¸çš„æµé‡è°ƒåº¦æ ¸å¿ƒæ¡†æ¶ï¼Œæ”¯æ’‘ QoS ç­–ç•¥</td></tr><tr><td><code>kmod-sched-bpf</code></td><td>åŸºäº BPF çš„æµé‡è°ƒåº¦æ‰©å±•ï¼Œæ”¯æŒè‡ªå®šä¹‰æ•°æ®åŒ…å¤„ç†ç­–ç•¥</td></tr><tr><td><code>kmod-nft-bridge</code></td><td>åœ¨æ¡¥æ¥æ¥å£ä¸Šé›†æˆ nftables é˜²ç«å¢™è§„åˆ™</td></tr><tr><td><code>dae-geosite</code></td><td>ä¸º dae å®ˆæŠ¤è¿›ç¨‹æä¾› GeoSite æ”¯æŒï¼Œå¯æŒ‰åŸŸåæˆ–ç½‘ç«™åˆ†ç±»è¿‡æ»¤æµé‡</td></tr><tr><td><code>dae-geoip</code></td><td>ä¸º dae å®ˆæŠ¤è¿›ç¨‹æä¾› GeoIP æ”¯æŒï¼Œå¯æŒ‰ IP åœ°ç†ä½ç½®è¿‡æ»¤æˆ–è·¯ç”±æµé‡</td></tr><tr><td><code>dae</code></td><td>æ ¸å¿ƒ dae å®ˆæŠ¤è¿›ç¨‹ï¼Œå®ç°åå°æµé‡è¿‡æ»¤ä¸è½¬å‘ç­‰ç½‘ç»œæœåŠ¡</td></tr></tbody></table><p>å®Œæ•´çš„åŒ…åˆ—è¡¨å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>autocore automount base-files block-mount ca-bundle default-settings-chn dnsmasq-full dropbear fdisk firewall4 fstools grub2-bios-setup i915-firmware-dmc kmod-8139cp kmod-8139too kmod-button-hotplug kmod-e1000e kmod-fs-f2fs kmod-i40e kmod-igb kmod-igbvf kmod-igc kmod-ixgbe kmod-ixgbevf kmod-nf-nathelper kmod-nf-nathelper-extra kmod-nft-offload kmod-pcnet32 kmod-r8101 kmod-r8125 kmod-r8126 kmod-r8168 kmod-tulip kmod-usb-hid kmod-usb-net kmod-usb-net-asix kmod-usb-net-asix-ax88179 kmod-usb-net-rtl8150 kmod-usb-net-rtl8152-vendor kmod-vmxnet3 libc libgcc libustream-openssl logd luci-app-package-manager luci-compat luci-lib-base luci-lib-ipkg luci-light mkf2fs mtd netifd nftables odhcp6c odhcpd-ipv6only opkg partx-utils ppp ppp-mod-pppoe procd-ujail uci uclient-fetch urandom-seed urngd kmod-amazon-ena kmod-amd-xgbe kmod-bnx2 kmod-e1000 kmod-dwmac-intel kmod-forcedeth kmod-fs-vfat kmod-tg3 kmod-drm-i915 kmod-xdp-sockets-diag kmod-veth kmod-sched-core kmod-sched-bpf kmod-nft-bridge dae-geosite dae-geoip dae
</span></span></code></pre></div><p><img src=https://img.hellowood.dev/picture/homelab-openwrt-dae-build-openwrt-firmware.png alt=homelab-openwrt-dae-build-openwrt-firmware.png loading=lazy></p><p>ç„¶åé€‰æ‹© <code>REQUEST BUILD</code> æ„å»ºé•œåƒï¼›ç­‰å¾…æ„å»ºå®Œæˆåé€‰æ‹© <code>COMBINED-EFI (EXT4)</code> ä¸‹è½½åˆ°æœ¬åœ°</p><h3 id=åœ¨-pve-ä¸­è¿è¡Œ-openwrt>åœ¨ PVE ä¸­è¿è¡Œ OpenWrt</h3><p>ä½¿ç”¨åˆšæ‰ä¸‹è½½çš„é•œåƒåœ¨ PVE ä¸­åˆ›å»º OpenWrt çš„è™šæ‹Ÿæœºå¹¶è¿è¡Œï¼Œè¯¦ç»†å‚è€ƒ <a href=https://blog.hellowood.dev/posts/openwrt-%E5%9C%A8-pve-%E4%B8%AD%E4%BB%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85/>OpenWrt åœ¨ PVE ä¸­ä»¥è™šæ‹Ÿæœºæ–¹å¼å®‰è£…</a></p><h2 id=é…ç½®-dae>é…ç½® Dae</h2><h3 id=ä¿®æ”¹é…ç½®æ–‡ä»¶>ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><p>ç™»å½• OpenWrt çš„å‘½ä»¤è¡Œè¿›è¡Œä¿®æ”¹ï¼Œå…³äº Dae é…ç½®çš„è¯¦ç»†è§£é‡Šå¯ä»¥å‚è€ƒ: <a href=https://blog.hellowood.dev/posts/dae-%E4%BB%A3%E7%90%86%E8%BD%AF%E4%BB%B6%E7%9A%84%E9%85%8D%E7%BD%AE/>dae-ä»£ç†è½¯ä»¶çš„é…ç½®</a></p><p>é…ç½®æ–‡ä»¶ä½ç½®åœ¨ <code>/etc/dae/</code> è·¯å¾„ä¸‹ï¼Œåˆ›å»º <code>/etc/dae/config.dae</code> æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><ul><li><code>/etc/dae/config.dae</code></li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># å®Œæ•´é…ç½®å‚è€ƒ https://github.com/daeuniverse/dae/blob/main/example.dae
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#c678dd>global</span> {
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># ä¿®æ”¹æ—¥å¿—çº§åˆ«ä¸º debugï¼Œæ–¹ä¾¿è°ƒè¯•
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#c678dd>log_level:</span> <span style=color:#98c379>debug</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># lan å£ç»‘å®š eth0
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#98c379>lan_interface:</span> <span style=color:#98c379>eth0</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># ç”¨å¼ºåˆ¶ SNI å—…æ¢è¿›è¡Œåˆ†æµ
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#98c379>dial_mode:</span> <span style=color:#98c379>domain++</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># DNS é…ç½®
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#98c379>dns</span> {
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic># ä½¿ç”¨ IPv4 çš„ DNSï¼Œé¿å…éƒ¨åˆ† node ä¸æ”¯æŒ IPv6 å¯¼è‡´è¯·æ±‚å¤±è´¥
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#c678dd>ipversion_prefer:</span> <span style=color:#d19a66>4</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic># ä¸Šæ¸¸ DNS
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#98c379>upstream</span> {
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># é˜¿é‡Œäº‘ DNSï¼Œç”¨äºå›½å†…åŸŸåæŸ¥è¯¢
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#c678dd>alidns:</span> <span style=color:#98c379>&#39;udp://223.5.5.5:53&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># æœ¬åœ° DNSï¼Œç”¨äºå†…ç½‘è‡ªå®šä¹‰çš„  DNS æŸ¥è¯¢
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#98c379>adguard:</span> <span style=color:#98c379>&#39;udp://10.0.0.1:53&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># Cloudflare DNSï¼Œç”¨äºéå›½å†…çš„ DNS æŸ¥è¯¢
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#98c379>cfdns:</span> <span style=color:#98c379>&#39;tcp+udp://1.1.1.1:53&#39;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic># DNS æŸ¥è¯¢è§„åˆ™
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>  <span style=color:#98c379>routing</span> {
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># æ ¹æ® DNS æŸ¥è¯¢ï¼Œå†³å®šä½¿ç”¨å“ªä¸ª DNS ä¸Šæ¸¸ï¼ŒæŒ‰ç”±ä¸Šåˆ°ä¸‹çš„é¡ºåºåŒ¹é…
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#c678dd>request</span> {
</span></span><span style=display:flex><span>      <span style=color:#8a93a5;font-style:italic># svc.local ç»“å°¾çš„åŸŸåï¼Œç”¨æœ¬åœ°çš„ DNS æŸ¥è¯¢
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>      <span style=color:#c678dd>qname(suffix:</span> <span style=color:#98c379>svc.local)</span> <span style=color:#98c379>-&gt;</span> <span style=color:#98c379>adguard</span>
</span></span><span style=display:flex><span>      <span style=color:#8a93a5;font-style:italic># å¯¹äºä¸­å›½å¤§é™†åŸŸåä½¿ç”¨ alidnsï¼Œå…¶ä»–ä½¿ç”¨ cfdns æŸ¥è¯¢ã€‚
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>      <span style=color:#98c379>qname(geosite:cn)</span> <span style=color:#98c379>-&gt;</span> <span style=color:#98c379>alidns</span>
</span></span><span style=display:flex><span>      <span style=color:#8a93a5;font-style:italic># fallback å³é»˜è®¤å…œåº• DNS
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>      <span style=color:#98c379>fallback:</span> <span style=color:#98c379>cfdns</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># å¦‚æœä½¿ç”¨è®¢é˜…åœ°å€ï¼Œå¿…é¡»æ˜¯ç¬¦åˆ SIP008 æ ¼å¼æˆ–è€… base64/urlencode ç¼–ç æˆ–è€… txt æ ¼å¼çš„èŠ‚ç‚¹åˆ—è¡¨ï¼Œè¯¦ç»†å‚è€ƒ: https://blog.hellowood.dev/posts/dae-%E4%BB%A3%E7%90%86%E8%BD%AF%E4%BB%B6%E7%9A%84%E9%85%8D%E7%BD%AE/
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># subscription çš„èŠ‚ç‚¹è§£æè¿‡æ»¤åä½œä¸º nodeï¼Œtag æ˜¯
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#98c379>subscription</span> {
</span></span><span style=display:flex><span>  <span style=color:#c678dd>sub_airport_1:</span> <span style=color:#98c379>&#39;https://è®¢é˜…åœ°å€&#39;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># è‡ªå·±æ­å»ºçš„èŠ‚ç‚¹ï¼Œç›´æ¥é…ç½®åˆ° node æ–¹ä¾¿è°ƒè¯•
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#98c379>node</span> {
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># HTTPS/VMess/VLESS/Shadowsocks/Trojan/Tuic/Juicity/Hysteria2 ç­‰æ ¼å¼
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#c678dd>hy2:</span> <span style=color:#98c379>&#34;hysteria2://user:password@host:443/?insecure=false&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># èŠ‚ç‚¹åˆ†ç»„
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#98c379>group</span> {
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># åˆ†ç»„ä¸€ï¼Œåç§°æ˜¯ proxyï¼Œç”¨äº routing é€‰æ‹©
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#8a93a5;font-style:italic># æ²¡æœ‰è¿‡æ»¤æ¡ä»¶ï¼Œä½¿ç”¨æ‰€æœ‰èŠ‚ç‚¹
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#c678dd>proxy</span> {
</span></span><span style=display:flex><span>        <span style=color:#8a93a5;font-style:italic># èŠ‚ç‚¹é€‰æ‹©ç­–ç•¥ä½¿ç”¨ æœ€å°ç§»åŠ¨å¹³å‡å»¶è¿ŸèŠ‚ç‚¹
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>        <span style=color:#c678dd>policy:</span> <span style=color:#98c379>min_moving_avg</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># AI åˆ†ç»„ï¼Œç”¨äº claude ç­‰å¯¹åœ°åŒºæœ‰é™åˆ¶çš„æœåŠ¡å•†
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#98c379>ai</span> {
</span></span><span style=display:flex><span>        <span style=color:#8a93a5;font-style:italic># ä» subscription çš„ sub_airport_1 ä¸­è¿‡æ»¤åç§°åŒ…å«æ–°åŠ å¡çš„ä½œä¸ºè¿™ä¸ªåˆ†ç»„çš„å¯ç”¨èŠ‚ç‚¹
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>        <span style=color:#c678dd>filter:</span> <span style=color:#98c379>subtag(sub_airport_1)</span> <span style=color:#98c379>&amp;&amp;</span> <span style=color:#98c379>name(keyword:</span> <span style=color:#98c379>&#39;æ–°åŠ å¡&#39;)</span>
</span></span><span style=display:flex><span>        <span style=color:#8a93a5;font-style:italic># èŠ‚ç‚¹é€‰æ‹©ç­–ç•¥ä½¿ç”¨ æœ€å°ç§»åŠ¨å¹³å‡å»¶è¿ŸèŠ‚ç‚¹
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>        <span style=color:#98c379>policy:</span> <span style=color:#98c379>min_moving_avg</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># è·¯ç”±é…ç½®
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span><span style=color:#98c379>routing</span> {
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># DNS/SSH ç­‰ç›¸å…³è¿›ç¨‹å¼ºåˆ¶ç›´è¿
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#c678dd>pname(dnsmasq,</span> <span style=color:#98c379>dropbear)</span> <span style=color:#98c379>-&gt;</span> <span style=color:#98c379>must_direct</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># DNS åœ°å€æˆ–åŸŸåï¼Œå¼ºåˆ¶ç›´è¿
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#98c379>dip(8.8.8.8)</span> <span style=color:#98c379>-&gt;</span> <span style=color:#98c379>must_direct</span>
</span></span><span style=display:flex><span>    <span style=color:#98c379>dip(1.1.1.1)</span> <span style=color:#98c379>-&gt;</span> <span style=color:#98c379>must_direct</span>
</span></span><span style=display:flex><span>    <span style=color:#98c379>domain(dns.alidns.com)</span> <span style=color:#98c379>-&gt;</span> <span style=color:#98c379>must_direct</span>
</span></span><span style=display:flex><span>    <span style=color:#98c379>domain(dns.google)</span> <span style=color:#98c379>-&gt;</span> <span style=color:#98c379>must_direct</span>
</span></span><span style=display:flex><span>    <span style=color:#98c379>domain(cloudflare-dns.com)</span> <span style=color:#98c379>-&gt;</span> <span style=color:#98c379>must_direct</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># ç›®æ ‡ IP å¤šæ’­ã€å¹¿æ’­åœ°å€ï¼Œç›´è¿
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#98c379>dip(224.0.0.0/3,</span> <span style=color:#98c379>&#39;ff00::/8&#39;)</span> <span style=color:#98c379>-&gt;</span> <span style=color:#98c379>direct</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># ç›®æ ‡ IP geoip ä¸­çš„å†…ç½‘åœ°å€ï¼Œç›´è¿
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#98c379>dip(geoip:private)</span> <span style=color:#98c379>-&gt;</span> <span style=color:#98c379>direct</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># ç›®æ ‡ IP ä¸­å›½ IPï¼Œç›´è¿
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#98c379>dip(geoip:cn)</span> <span style=color:#98c379>-&gt;</span> <span style=color:#98c379>direct</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># ä¸­å›½åŸŸåï¼Œç›´è¿
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#98c379>domain(geosite:cn)</span> <span style=color:#98c379>-&gt;</span> <span style=color:#98c379>direct</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># å¹¿å‘ŠåŸŸåï¼Œæ‹’ç»
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#98c379>domain(geosite:category-ads)</span> <span style=color:#98c379>-&gt;</span> <span style=color:#98c379>block</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># AI åŸŸåï¼ŒAI åˆ†ç»„ä»£ç†
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#98c379>domain(suffix:</span> <span style=color:#98c379>claude.ai)</span> <span style=color:#98c379>-&gt;</span> <span style=color:#98c379>ai</span>
</span></span><span style=display:flex><span>    <span style=color:#98c379>domain(suffix:</span> <span style=color:#98c379>openai.com)</span> <span style=color:#98c379>-&gt;</span> <span style=color:#98c379>ai</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># æœªå‘½ä¸­ä¸Šé¢çš„è§„åˆ™çš„èµ° proxy ä»£ç†
</span></span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic></span>    <span style=color:#98c379>fallback:</span> <span style=color:#98c379>proxy</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>éœ€è¦æ³¨æ„ï¼Œdae è¦æ±‚é…ç½®æ–‡ä»¶çš„æƒé™æ˜¯ 640 ä»¥ä¸‹çš„æƒé™ï¼Œå¦åˆ™ä¼šæç¤º <code>permissions 0644 for '/etc/dae/config.dae' are too open</code>ï¼›é€šè¿‡ä»¥ä¸‹å‘½ä»¤ä¿®æ”¹:</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod <span style=color:#d19a66>600</span> /etc/dae/config.dae
</span></span></code></pre></div><ul><li>æ£€æŸ¥é…ç½®æ–‡ä»¶</li></ul><p>é€šè¿‡ <code>dae</code> æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœæ²¡æœ‰è¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œè¡¨ç¤ºé…ç½®æ²¡æœ‰é—®é¢˜</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/usr/bin/dae validate -c /etc/dae/config.dae
</span></span></code></pre></div><h3 id=å¯åŠ¨-dae>å¯åŠ¨ dae</h3><ul><li>é€šè¿‡ <code>/etc/init.d/dae</code> è„šæœ¬å¯åŠ¨ dae</li></ul><p>å…è®¸ dae è‡ªåŠ¨å¯åŠ¨</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/etc/init.d/dae <span style=color:#ef8383>enable</span>
</span></span></code></pre></div><p>ç„¶åå¯åŠ¨ dae</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>/etc/init.d/dae start
</span></span></code></pre></div><ul><li>æ£€æŸ¥ dae çŠ¶æ€</li></ul><p>å¯ä»¥é€šè¿‡ <code>ps</code> æŸ¥çœ‹ dae çš„è¿›ç¨‹</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ps w |grep dae
</span></span><span style=display:flex><span><span style=color:#d19a66>13609</span> root     1359m S    /usr/bin/dae run --disable-timestamp -c /etc/dae/config.dae
</span></span><span style=display:flex><span><span style=color:#d19a66>14819</span> root      <span style=color:#d19a66>1184</span> S    grep dae
</span></span></code></pre></div><ul><li>æŸ¥çœ‹ dae çš„æ—¥å¿—</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tail -f /var/log/dae.log
</span></span></code></pre></div><p>å¯ä»¥ä»æ—¥å¿—ä¸­çœ‹åˆ° dae å¯åŠ¨ã€æ›´æ–° Node çš„ä¿¡æ¯</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span><span style=color:#c1abea>level</span>=<span style=color:#c1abea>info</span> <span style=color:#c1abea>msg</span>=<span style=color:#98c379>&#34;Include config files: [/etc/dae/config.dae]&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c1abea>level</span>=<span style=color:#c1abea>info</span> <span style=color:#c1abea>msg</span>=<span style=color:#98c379>&#34;Waiting for network...&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c1abea>level</span>=<span style=color:#c1abea>debug</span> <span style=color:#c1abea>msg</span>=<span style=color:#98c379>&#34;CheckNetwork: Get &#34;</span><span style=color:#c1abea>http</span>:<span style=color:#8a93a5;font-style:italic>//www.gstatic.com/generate_204&#34;: context deadline exceeded (Client.Timeout exceeded while awaiting headers)&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c1abea>level</span>=<span style=color:#c1abea>info</span> <span style=color:#c1abea>msg</span>=<span style=color:#98c379>&#34;Network online.&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c1abea>level</span>=<span style=color:#c1abea>info</span> <span style=color:#c1abea>msg</span>=<span style=color:#98c379>&#34;Fetching subscriptions...&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c1abea>level</span>=<span style=color:#c1abea>debug</span> <span style=color:#c1abea>msg</span>=<span style=color:#98c379>&#34;ResolveSubscription: https://è®¢é˜…åœ°å€&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c1abea>level</span>=<span style=color:#c1abea>debug</span> <span style=color:#c1abea>msg</span>=<span style=color:#98c379>&#34;Try to resolve as sip008&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c1abea>level</span>=<span style=color:#c1abea>debug</span> <span style=color:#c1abea>msg</span>=<span style=color:#98c379>&#34;failed to unmarshal json to sip008&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c1abea>level</span>=<span style=color:#c1abea>debug</span> <span style=color:#c1abea>msg</span>=<span style=color:#98c379>&#34;Try to resolve as base64&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c1abea>level</span>=<span style=color:#c1abea>info</span> <span style=color:#c1abea>msg</span>=<span style=color:#98c379>&#34;Loading eBPF programs and maps into the kernel...&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c1abea>level</span>=<span style=color:#c1abea>info</span> <span style=color:#c1abea>msg</span>=<span style=color:#98c379>&#34;The loading process takes about 120MB free memory, which will be released after loading. Insufficient memory will cause loading failure.&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c1abea>level</span>=<span style=color:#c1abea>info</span> <span style=color:#c1abea>msg</span>=<span style=color:#98c379>&#34;Loaded eBPF programs and maps&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c1abea>level</span>=<span style=color:#c1abea>info</span> <span style=color:#c1abea>msg</span>=<span style=color:#98c379>&#34;Bind to LAN: eth0&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c1abea>level</span>=<span style=color:#c1abea>info</span> <span style=color:#c1abea>msg</span>=<span style=color:#98c379>&#34;Group &#34;</span><span style=color:#c1abea>proxy</span><span style=color:#98c379>&#34; node list:&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c1abea>level</span>=<span style=color:#c1abea>info</span> <span style=color:#c1abea>msg</span>=<span style=color:#98c379>&#34;	hy2&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c1abea>level</span>=<span style=color:#c1abea>info</span> <span style=color:#c1abea>msg</span>=<span style=color:#98c379>&#34;	å‰©ä½™æµé‡ï¼š322.88 GB&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c1abea>level</span>=<span style=color:#c1abea>info</span> <span style=color:#c1abea>msg</span>=<span style=color:#98c379>&#34;	å¥—é¤åˆ°æœŸï¼šé•¿æœŸæœ‰æ•ˆ&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c1abea>level</span>=<span style=color:#c1abea>info</span> <span style=color:#c1abea>msg</span>=<span style=color:#98c379>&#34;	æ–°åŠ å¡01aws&#34;</span>
</span></span><span style=display:flex><span># <span style=color:#c7bf54>...</span>
</span></span></code></pre></div><h2 id=ä½¿ç”¨>ä½¿ç”¨</h2><p>å¦‚æœ OpenWrt ä½œä¸ºä¸»è·¯ç”±ï¼Œåˆ™ä¸éœ€è¦ä»»ä½•è®¾ç½®ï¼›å¦‚æœæ˜¯ä½œä¸ºæ—è·¯ç½‘å…³ï¼Œåˆ™éœ€è¦å°†è®¾å¤‡çš„ç½‘å…³æŒ‡å‘ OpenWrt</p><ul><li>ä¿®æ”¹ç½‘ç»œé…ç½®</li></ul><p>ç½‘å…³åœ°å€æ”¹ä¸º OpenWrt çš„åœ°å€ï¼Œå¦‚ 10.0.0.254</p><p><img src=https://img.hellowood.dev/picture/homelab-openwrt-dae-modify-device-gateway.png alt=homelab-openwrt-dae-modify-device-gateway.png loading=lazy></p><ul><li>ä¿®æ”¹ DNS åœ°å€</li></ul><p>DNS åœ°å€ä¹Ÿå¯ä»¥ä¿®æ”¹ä¸ºæŒ‡å‘ OpenWrtï¼Œè¿™æ ·èƒ½å¤Ÿä¿è¯ dae æ­£ç¡®åˆ†æµï¼Œé…ç½® DNS ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯é…ç½®ä¹‹åæ•ˆæœä¼šæ›´å¥½ï¼›å¦‚æœä¸é…ç½® DNSï¼Œä¹Ÿå¯ä»¥å°† <code>dial_mode</code> è®¾ç½®ä¸º <code>domain++</code> è¿›è¡Œå¼ºåˆ¶ SNI å—…æ¢åˆ†æµ</p><p><img src=https://img.hellowood.dev/picture/homelab-openwrt-dae-modify-device-dns.png alt=homelab-openwrt-dae-modify-device-dns.png loading=lazy></p><ul><li>æŸ¥çœ‹è®¿é—®æ—¥å¿—</li></ul><p>ä»¥ claude.ai ä¸ºä¾‹ï¼Œé…ç½®å®Œæˆåï¼Œè®¿é—® claude.ai åœ°å€ï¼Œæ£€æŸ¥ OpenWrt çš„æ—¥å¿—ï¼Œå‘ç°ä½¿ç”¨ DNS æŸ¥è¯¢ä½¿ç”¨äº† cloudflareï¼ŒèŠ‚ç‚¹ä½¿ç”¨äº†æ–°åŠ å¡çš„èŠ‚ç‚¹ï¼Œoutbound çš„åˆ†ç»„ä¸º aiï¼Œå—…æ¢åˆ°çš„åŸŸåæ˜¯ claude.aiï¼Œç¬¦åˆé¢„æœŸ</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tail -f /var/log/dae.log |grep claude
</span></span><span style=display:flex><span><span style=color:#dcaeea>level</span><span style=color:#c7bf54>=</span>info <span style=color:#dcaeea>msg</span><span style=color:#c7bf54>=</span><span style=color:#63c381>&#34;10.0.0.1:61301 &lt;-&gt; 1.1.1.1:53&#34;</span> <span style=color:#dcaeea>_qname</span><span style=color:#c7bf54>=</span>claude.ai. <span style=color:#dcaeea>dialer</span><span style=color:#c7bf54>=</span>direct <span style=color:#dcaeea>dscp</span><span style=color:#c7bf54>=</span><span style=color:#d19a66>0</span> <span style=color:#dcaeea>mac</span><span style=color:#c7bf54>=</span><span style=color:#63c381>&#34;00:11:22:33:44:55&#34;</span> <span style=color:#dcaeea>network</span><span style=color:#c7bf54>=</span><span style=color:#63c381>&#34;udp4(DNS)&#34;</span> <span style=color:#dcaeea>outbound</span><span style=color:#c7bf54>=</span>direct <span style=color:#dcaeea>pid</span><span style=color:#c7bf54>=</span><span style=color:#d19a66>0</span> <span style=color:#dcaeea>pname</span><span style=color:#c7bf54>=</span> <span style=color:#dcaeea>policy</span><span style=color:#c7bf54>=</span>fixed <span style=color:#dcaeea>qtype</span><span style=color:#c7bf54>=</span>HTTPS
</span></span><span style=display:flex><span><span style=color:#dcaeea>level</span><span style=color:#c7bf54>=</span>info <span style=color:#dcaeea>msg</span><span style=color:#c7bf54>=</span><span style=color:#63c381>&#34;10.0.0.1:27818 &lt;-&gt; 1.1.1.1:53&#34;</span> <span style=color:#dcaeea>_qname</span><span style=color:#c7bf54>=</span>claude.ai. <span style=color:#dcaeea>dialer</span><span style=color:#c7bf54>=</span>direct <span style=color:#dcaeea>dscp</span><span style=color:#c7bf54>=</span><span style=color:#d19a66>0</span> <span style=color:#dcaeea>mac</span><span style=color:#c7bf54>=</span><span style=color:#63c381>&#34;00:11:22:33:44:55&#34;</span> <span style=color:#dcaeea>network</span><span style=color:#c7bf54>=</span><span style=color:#63c381>&#34;udp4(DNS)&#34;</span> <span style=color:#dcaeea>outbound</span><span style=color:#c7bf54>=</span>direct <span style=color:#dcaeea>pid</span><span style=color:#c7bf54>=</span><span style=color:#d19a66>0</span> <span style=color:#dcaeea>pname</span><span style=color:#c7bf54>=</span> <span style=color:#dcaeea>policy</span><span style=color:#c7bf54>=</span>fixed <span style=color:#dcaeea>qtype</span><span style=color:#c7bf54>=</span>A
</span></span><span style=display:flex><span><span style=color:#dcaeea>level</span><span style=color:#c7bf54>=</span>info <span style=color:#dcaeea>msg</span><span style=color:#c7bf54>=</span><span style=color:#63c381>&#34;10.0.0.1:27818 &lt;-&gt; 1.1.1.1:53&#34;</span> <span style=color:#dcaeea>_qname</span><span style=color:#c7bf54>=</span>claude.ai. <span style=color:#dcaeea>dialer</span><span style=color:#c7bf54>=</span>direct <span style=color:#dcaeea>dscp</span><span style=color:#c7bf54>=</span><span style=color:#d19a66>0</span> <span style=color:#dcaeea>mac</span><span style=color:#c7bf54>=</span><span style=color:#63c381>&#34;00:11:22:33:44:55&#34;</span> <span style=color:#dcaeea>network</span><span style=color:#c7bf54>=</span><span style=color:#63c381>&#34;udp4(DNS)&#34;</span> <span style=color:#dcaeea>outbound</span><span style=color:#c7bf54>=</span>direct <span style=color:#dcaeea>pid</span><span style=color:#c7bf54>=</span><span style=color:#d19a66>0</span> <span style=color:#dcaeea>pname</span><span style=color:#c7bf54>=</span> <span style=color:#dcaeea>policy</span><span style=color:#c7bf54>=</span>fixed <span style=color:#dcaeea>qtype</span><span style=color:#c7bf54>=</span>AAAA
</span></span><span style=display:flex><span><span style=color:#dcaeea>level</span><span style=color:#c7bf54>=</span>info <span style=color:#dcaeea>msg</span><span style=color:#c7bf54>=</span><span style=color:#63c381>&#34;10.0.0.1:64316 &lt;-&gt; claude.ai:443&#34;</span> <span style=color:#dcaeea>dialer</span><span style=color:#c7bf54>=</span><span style=color:#63c381>&#34;æ–°åŠ å¡09aws&#34;</span> <span style=color:#dcaeea>dscp</span><span style=color:#c7bf54>=</span><span style=color:#d19a66>0</span> <span style=color:#dcaeea>ip</span><span style=color:#c7bf54>=</span><span style=color:#63c381>&#34;10.0.0.2:443&#34;</span> <span style=color:#dcaeea>mac</span><span style=color:#c7bf54>=</span><span style=color:#63c381>&#34;00:11:22:33:44:55&#34;</span> <span style=color:#dcaeea>network</span><span style=color:#c7bf54>=</span>tcp4 <span style=color:#dcaeea>outbound</span><span style=color:#c7bf54>=</span>ai <span style=color:#dcaeea>pid</span><span style=color:#c7bf54>=</span><span style=color:#d19a66>0</span> <span style=color:#dcaeea>pname</span><span style=color:#c7bf54>=</span> <span style=color:#dcaeea>policy</span><span style=color:#c7bf54>=</span>min_moving_avg <span style=color:#dcaeea>sniffed</span><span style=color:#c7bf54>=</span>claude.ai
</span></span><span style=display:flex><span><span style=color:#dcaeea>level</span><span style=color:#c7bf54>=</span>info <span style=color:#dcaeea>msg</span><span style=color:#c7bf54>=</span><span style=color:#63c381>&#34;10.0.0.1:64376 &lt;-&gt; claude.ai:443&#34;</span> <span style=color:#dcaeea>dialer</span><span style=color:#c7bf54>=</span><span style=color:#63c381>&#34;æ–°åŠ å¡07aws&#34;</span> <span style=color:#dcaeea>dscp</span><span style=color:#c7bf54>=</span><span style=color:#d19a66>0</span> <span style=color:#dcaeea>ip</span><span style=color:#c7bf54>=</span><span style=color:#63c381>&#34;10.0.0.2:443&#34;</span> <span style=color:#dcaeea>mac</span><span style=color:#c7bf54>=</span><span style=color:#63c381>&#34;00:11:22:33:44:55&#34;</span> <span style=color:#dcaeea>network</span><span style=color:#c7bf54>=</span>tcp4 <span style=color:#dcaeea>outbound</span><span style=color:#c7bf54>=</span>ai <span style=color:#dcaeea>pid</span><span style=color:#c7bf54>=</span><span style=color:#d19a66>0</span> <span style=color:#dcaeea>pname</span><span style=color:#c7bf54>=</span> <span style=color:#dcaeea>policy</span><span style=color:#c7bf54>=</span>min_moving_avg <span style=color:#dcaeea>sniffed</span><span style=color:#c7bf54>=</span>claude.ai
</span></span></code></pre></div><h2 id=å‚è€ƒæ–‡æ¡£>å‚è€ƒæ–‡æ¡£</h2><ul><li><a href=https://blog.hellowood.dev/posts/dae-%E4%BB%A3%E7%90%86%E8%BD%AF%E4%BB%B6%E7%9A%84%E9%85%8D%E7%BD%AE/>Dae ä»£ç†è½¯ä»¶çš„é…ç½®</a></li><li><a href=https://blog.hellowood.dev/posts/openwrt-%E5%9C%A8-pve-%E4%B8%AD%E4%BB%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85/>OpenWrt åœ¨ PVE ä¸­ä»¥è™šæ‹Ÿæœºæ–¹å¼å®‰è£…</a></li><li><a href=https://deeprouter.org/article/dae-installation-configuration-guide#1ac975710fee8089983de9e660c0e0eb>ğŸ¦¢Daeå®‰è£…åŠé…ç½®æŒ‡å—</a></li><li><a href=https://github.com/daeuniverse/dae/blob/main/example.dae>https://github.com/daeuniverse/dae/blob/main/example.dae</a></li><li><a href=https://github.com/daeuniverse/dae/blob/main/docs/zh/README.md>åƒé¹…ç›´é€šæ‰‹å†Œ</a></li><li><a href=https://firmware-selector.immortalwrt.org/>Download ImmortalWrt Firmware for your Device</a></li></ul></div><div class=prev-next></div><svg id="btt-button" class="arrow-logo" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script><div id=comments><script src=https://utteranc.es/client.js repo=helloworlde/helloworlde.github.io issue-term=title theme=github-light crossorigin=anonymous async></script></div></div></main><footer class=footer><span>&copy; 2025 hellowood.dev</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>