<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>Go 开发命令行工具-OSS文件上传</title>
<meta charset=utf-8><meta name=description content="Ladder@使用 Go 开发命令行工具-OSS 文件上 使用 Go 语言开发一个命令行工具，用于向 OSS 文件上传文件 命令行工具有很多框架，选择使用 Cobra
准备 安装 Cobra go get -u github.com/spf13/cobra/cobra 初始化项目 创建项目 cd $GOPATH/src mkdir oss cd oss cobra init --pkg-name oss 此时，已经创建了一个 oss 的目录，里面已经包含一个 root 命令
. ├── LICENSE ├── cmd │ └── root.go └── main.go 1 directory, 3 files 运行 go run main.go查看root 命令
go run main.go A longer description that spans multiple lines and likely contains examples and usage of using your application."><meta name=author content="HelloWood"><link rel=canonical href=https://blog.hellowood.dev/posts/go-%E5%BC%80%E5%8F%91%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7-oss%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/><meta name=google-site-verification content="G-3MSGPYTHPZ"><link rel=alternate type=application/rss+xml href=https://blog.hellowood.dev//index.xml title=HelloWood><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ")}</script><script async defer data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301 src=https://umami.hellowood.dev/script.js></script><script defer data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}' src=https://static.cloudflareinsights.com/beacon.min.js></script><meta property="og:url" content="https://blog.hellowood.dev/posts/go-%E5%BC%80%E5%8F%91%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7-oss%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"><meta property="og:site_name" content="HelloWood"><meta property="og:title" content="Go 开发命令行工具-OSS文件上传"><meta property="og:description" content="使用 Go 开发命令行工具-OSS 文件上 使用 Go 语言开发一个命令行工具，用于向 OSS 文件上传文件 命令行工具有很多框架，选择使用 Cobra
准备 安装 Cobra go get -u github.com/spf13/cobra/cobra 初始化项目 创建项目 cd $GOPATH/src mkdir oss cd oss cobra init --pkg-name oss 此时，已经创建了一个 oss 的目录，里面已经包含一个 root 命令
. ├── LICENSE ├── cmd │ └── root.go └── main.go 1 directory, 3 files 运行 go run main.go查看root 命令
go run main.go A longer description that spans multiple lines and likely contains examples and usage of using your application."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-09-08T18:53:25+00:00"><meta property="article:modified_time" content="2019-09-08T18:53:25+00:00"><meta property="article:tag" content="Go"><meta property="article:tag" content="Cobra"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go 开发命令行工具-OSS文件上传"><meta name=twitter:description content="使用 Go 开发命令行工具-OSS 文件上 使用 Go 语言开发一个命令行工具，用于向 OSS 文件上传文件 命令行工具有很多框架，选择使用 Cobra
准备 安装 Cobra go get -u github.com/spf13/cobra/cobra 初始化项目 创建项目 cd $GOPATH/src mkdir oss cd oss cobra init --pkg-name oss 此时，已经创建了一个 oss 的目录，里面已经包含一个 root 命令
. ├── LICENSE ├── cmd │ └── root.go └── main.go 1 directory, 3 files 运行 go run main.go查看root 命令
go run main.go A longer description that spans multiple lines and likely contains examples and usage of using your application."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.hellowood.dev/posts/"},{"@type":"ListItem","position":2,"name":"Go 开发命令行工具-OSS文件上传","item":"https://blog.hellowood.dev/posts/go-%E5%BC%80%E5%8F%91%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7-oss%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Go 开发命令行工具-OSS文件上传","name":"Go 开发命令行工具-OSS文件上传","description":"使用 Go 开发命令行工具-OSS 文件上 使用 Go 语言开发一个命令行工具，用于向 OSS 文件上传文件 命令行工具有很多框架，选择使用 Cobra\n准备 安装 Cobra go get -u github.com/spf13/cobra/cobra 初始化项目 创建项目 cd $GOPATH/src mkdir oss cd oss cobra init --pkg-name oss 此时，已经创建了一个 oss 的目录，里面已经包含一个 root 命令\n. ├── LICENSE ├── cmd │ └── root.go └── main.go 1 directory, 3 files 运行 go run main.go查看root 命令\ngo run main.go A longer description that spans multiple lines and likely contains examples and usage of using your application.","keywords":["Go","Cobra"],"articleBody":"使用 Go 开发命令行工具-OSS 文件上 使用 Go 语言开发一个命令行工具，用于向 OSS 文件上传文件 命令行工具有很多框架，选择使用 Cobra\n准备 安装 Cobra go get -u github.com/spf13/cobra/cobra 初始化项目 创建项目 cd $GOPATH/src mkdir oss cd oss cobra init --pkg-name oss 此时，已经创建了一个 oss 的目录，里面已经包含一个 root 命令\n. ├── LICENSE ├── cmd │ └── root.go └── main.go 1 directory, 3 files 运行 go run main.go查看root 命令\ngo run main.go A longer description that spans multiple lines and likely contains examples and usage of using your application. For example: Cobra is a CLI library for Go that empowers applications. This application is a tool to generate the needed files to quickly create a Cobra application. 添加 mod 添加mod 是为了更方便的管理依赖，module 设置 GitHub 是为了安装方便\nexport GO111MODULE=on go mod init github.com/helloworlde/oss 同时需要改下 mian.go中的包名，由oss/cmd改为 github.com/helloworlde/oss/cmd，如果是在GoLand 这样的 IDE 中，还需要启用Enable Go Modules (vgo) integration\n添加命令 添加一个 Upload 命令 cobra add upload 此时，会在 cmd/下新建一个upload.go的文件，包含基本的运行 upload 命令的代码\ngo run main.go upload upload called 在upload.go中添加相应的逻辑，具体可以参考 getting-started\nvar uploadCmd = \u0026cobra.Command{ Use: \"upload [file]\", Short: \"Upload file to OSS\", Long: ``, Args: func(cmd *cobra.Command, args []string) error { if len(args) \u003c 1 { return errors.New(\"requires at least one file path\") } return nil }, Run: func(cmd *cobra.Command, args []string) { dir := cmd.Flag(\"directory\").Value.String() picture := cmd.Flag(\"picture\").Value.String() markdown := cmd.Flag(\"markdown\").Value.String() if !util.ValidateConfig(ossConfig) { os.Exit(1) } bucket := util.InitBucket(ossConfig) util.UploadFile(ossDir, path, ossConfig, *bucket) }, } func init() { rootCmd.AddCommand(uploadCmd) uploadCmd.Flags().StringP(\"directory\", \"d\", \"\", \"Dictionary of upload file\") uploadCmd.Flags().BoolP(\"picture\", \"p\", true, \"Upload to Picture folder\") uploadCmd.Flags().BoolP(\"markdown\", \"m\", false, \"Print link as Markdown\") } 发布 先将代码上传到 GitHub，然后可以通过 goreleaser 这个工具来发布；需要注意的是，Repo 的名字要和 Module 一致，否则会在安装时提示 Module 不匹配\n安装配置 goreleaser 安装 brew install goreleaser 配置 goreleaser 发布时需要使用 GitHub 的 Token，然后需要将 GitHub Token 添加到环境变量中\nexport GITHUB_TOKEN=`YOUR_GITHUB_TOKEN` 发布 项目中添加 goreleaser 配置 goreleaser init 添加Tag git tag -a v0.0.1 -m \"First release\" git push origin v0.1.0 发布 goreleaser --rm-dist 待上传完成后就可以在 GitHub Release 页面看到刚才发布的版本\n使用 安装 go get -u github.com/helloworlde/oss 使用 上传文件 oss upload oss-tool.png 上传到指定文件夹 oss upload oss-tool.png -d images/png 上传文件夹 oss upload ./cmd -d cmd 上传图片到指定文件夹 oss upload oss-tool.png -p 上传图片后输出 Markdown 格式 oss upload oss-tool.png -p -m GitHub https://github.com/helloworlde/oss\n","wordCount":"326","inLanguage":"en","datePublished":"2019-09-08T18:53:25Z","dateModified":"2019-09-08T18:53:25Z","author":{"@type":"Person","name":"HelloWood"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.hellowood.dev/posts/go-%E5%BC%80%E5%8F%91%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7-oss%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"},"publisher":{"@type":"Organization","name":"HelloWood","logo":{"@type":"ImageObject","url":"https://blog.hellowood.dev/favicon.ico"}}}</script><link rel=icon href=/images/avatar.png sizes=16x16><link rel=apple-touch-icon href=/images/avatar.png><link rel=manifest href=/images/avatar.png><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.7f82854fa0e999ec07c4835d3029de9f484030e254b80d470b3ca48eb934720e.css integrity="sha256-f4KFT6DpmewHxINdMCnen0hAMOJUuA1HCzykjrk0cg4=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><meta name=google-adsense-account content="ca-pub-3401351766168985"><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jtbhx98g62")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3401351766168985" crossorigin=anonymous></script><script defer src=https://analytics.us.umami.is/script.js data-website-id=73ff1c8c-9938-43cf-81af-e77e26b0cca3></script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand data-umami-event=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Blog href=/posts>Blog</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Tags href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Archive href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Dashboard href=https://umami.hellowood.dev/share/lab/Blog>Dashboard</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link data-umami-event=navigation-social href=https://github.com/helloworlde><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button data-umami-event=toggle-theme aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
<span class=toggle-light><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>Go 开发命令行工具-OSS文件上传</h1></header><p><small>September 8, 2019&nbsp;· 326 words&nbsp;· 2 min</small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#准备>准备</a></li><li><a href=#初始化项目>初始化项目</a></li><li><a href=#添加命令>添加命令</a></li><li><a href=#发布>发布</a><ul><li><a href=#安装配置-goreleaser>安装配置 goreleaser</a></li><li><a href=#发布-1>发布</a></li></ul></li><li><a href=#使用>使用</a><ul><li><a href=#安装>安装</a></li><li><a href=#使用-1>使用</a></li><li><a href=#github>GitHub</a></li></ul></li></ul></nav></div><section class=blog-content><h1 id=使用-go-开发命令行工具-oss-文件上>使用 Go 开发命令行工具-OSS 文件上</h1><blockquote><p>使用 Go 语言开发一个命令行工具，用于向 OSS 文件上传文件
命令行工具有很多框架，选择使用 <a href=https://github.com/spf13/cobra>Cobra</a></p></blockquote><h2 id=准备>准备</h2><ul><li>安装 Cobra</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go get -u github.com/spf13/cobra/cobra
</span></span></code></pre></div><h2 id=初始化项目>初始化项目</h2><ul><li>创建项目</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd $GOPATH/src
</span></span><span style=display:flex><span>mkdir oss
</span></span><span style=display:flex><span>cd oss
</span></span><span style=display:flex><span>cobra init --pkg-name oss
</span></span></code></pre></div><p>此时，已经创建了一个 oss 的目录，里面已经包含一个 root 命令</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>.
</span></span><span style=display:flex><span>├── LICENSE
</span></span><span style=display:flex><span>├── cmd
</span></span><span style=display:flex><span>│   └── root.go
</span></span><span style=display:flex><span>└── main.go
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> directory, <span style=color:#ae81ff>3</span> files
</span></span></code></pre></div><p>运行 <code>go run main.go</code>查看root 命令</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go run main.go
</span></span><span style=display:flex><span>A longer description that spans multiple lines and likely contains
</span></span><span style=display:flex><span>examples and usage of using your application. For example:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Cobra is a CLI library <span style=color:#66d9ef>for</span> Go that empowers applications.
</span></span><span style=display:flex><span>This application is a tool to generate the needed files
</span></span><span style=display:flex><span>to quickly create a Cobra application.
</span></span></code></pre></div><ul><li>添加 mod</li></ul><p>添加mod 是为了更方便的管理依赖，module 设置 GitHub 是为了安装方便</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export GO111MODULE<span style=color:#f92672>=</span>on
</span></span><span style=display:flex><span>go mod init github.com/helloworlde/oss
</span></span></code></pre></div><p>同时需要改下 <code>mian.go</code>中的包名，由<code>oss/cmd</code>改为 <code>github.com/helloworlde/oss/cmd</code>，如果是在GoLand 这样的 IDE 中，还需要启用<code>Enable Go Modules (vgo) integration</code></p><h2 id=添加命令>添加命令</h2><ul><li>添加一个 Upload 命令</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cobra add upload
</span></span></code></pre></div><p>此时，会在 <code>cmd/</code>下新建一个<code>upload.go</code>的文件，包含基本的运行 upload 命令的代码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go run main.go upload
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>upload called
</span></span></code></pre></div><p>在<code>upload.go</code>中添加相应的逻辑，具体可以参考 <a href=https://github.com/spf13/cobra#getting-started>getting-started</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>uploadCmd</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>cobra</span>.<span style=color:#a6e22e>Command</span>{
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Use</span>:   <span style=color:#e6db74>&#34;upload [file]&#34;</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Short</span>: <span style=color:#e6db74>&#34;Upload file to OSS&#34;</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Long</span>:  <span style=color:#e6db74>``</span>,
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Args</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>cmd</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>cobra</span>.<span style=color:#a6e22e>Command</span>, <span style=color:#a6e22e>args</span> []<span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>args</span>) &lt; <span style=color:#ae81ff>1</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;requires at least one file path&#34;</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>	},
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>Run</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>cmd</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>cobra</span>.<span style=color:#a6e22e>Command</span>, <span style=color:#a6e22e>args</span> []<span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>dir</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Flag</span>(<span style=color:#e6db74>&#34;directory&#34;</span>).<span style=color:#a6e22e>Value</span>.<span style=color:#a6e22e>String</span>()
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>picture</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Flag</span>(<span style=color:#e6db74>&#34;picture&#34;</span>).<span style=color:#a6e22e>Value</span>.<span style=color:#a6e22e>String</span>()
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>markdown</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>Flag</span>(<span style=color:#e6db74>&#34;markdown&#34;</span>).<span style=color:#a6e22e>Value</span>.<span style=color:#a6e22e>String</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>util</span>.<span style=color:#a6e22e>ValidateConfig</span>(<span style=color:#a6e22e>ossConfig</span>) {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Exit</span>(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>bucket</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>util</span>.<span style=color:#a6e22e>InitBucket</span>(<span style=color:#a6e22e>ossConfig</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>util</span>.<span style=color:#a6e22e>UploadFile</span>(<span style=color:#a6e22e>ossDir</span>, <span style=color:#a6e22e>path</span>, <span style=color:#a6e22e>ossConfig</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>bucket</span>)
</span></span><span style=display:flex><span>	},
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>init</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>rootCmd</span>.<span style=color:#a6e22e>AddCommand</span>(<span style=color:#a6e22e>uploadCmd</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>uploadCmd</span>.<span style=color:#a6e22e>Flags</span>().<span style=color:#a6e22e>StringP</span>(<span style=color:#e6db74>&#34;directory&#34;</span>, <span style=color:#e6db74>&#34;d&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#e6db74>&#34;Dictionary of upload file&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>uploadCmd</span>.<span style=color:#a6e22e>Flags</span>().<span style=color:#a6e22e>BoolP</span>(<span style=color:#e6db74>&#34;picture&#34;</span>, <span style=color:#e6db74>&#34;p&#34;</span>, <span style=color:#66d9ef>true</span>, <span style=color:#e6db74>&#34;Upload to Picture folder&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>uploadCmd</span>.<span style=color:#a6e22e>Flags</span>().<span style=color:#a6e22e>BoolP</span>(<span style=color:#e6db74>&#34;markdown&#34;</span>, <span style=color:#e6db74>&#34;m&#34;</span>, <span style=color:#66d9ef>false</span>, <span style=color:#e6db74>&#34;Print link as Markdown&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=发布>发布</h2><p>先将代码上传到 GitHub，然后可以通过 <a href=https://goreleaser.com/>goreleaser</a> 这个工具来发布；需要注意的是，Repo 的名字要和 Module 一致，否则会在安装时提示 Module 不匹配</p><h3 id=安装配置-goreleaser>安装配置 goreleaser</h3><ul><li>安装</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install goreleaser
</span></span></code></pre></div><ul><li>配置</li></ul><p>goreleaser 发布时需要使用 GitHub 的 Token，然后需要将 GitHub Token 添加到环境变量中</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export GITHUB_TOKEN<span style=color:#f92672>=</span><span style=color:#e6db74>`</span>YOUR_GITHUB_TOKEN<span style=color:#e6db74>`</span>
</span></span></code></pre></div><h3 id=发布-1>发布</h3><ul><li>项目中添加 goreleaser 配置</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>goreleaser init
</span></span></code></pre></div><ul><li>添加Tag</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git tag -a v0.0.1 -m <span style=color:#e6db74>&#34;First release&#34;</span>
</span></span><span style=display:flex><span>git push origin v0.1.0
</span></span></code></pre></div><ul><li>发布</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>goreleaser --rm-dist
</span></span></code></pre></div><p>待上传完成后就可以在 GitHub Release 页面看到刚才发布的版本</p><p><img alt=oss-tool.png src=https://img.hellowood.dev/images/oss-tool.png></p><h2 id=使用>使用</h2><h3 id=安装>安装</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go get -u github.com/helloworlde/oss
</span></span></code></pre></div><h3 id=使用-1>使用</h3><ul><li>上传文件</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>oss upload oss-tool.png
</span></span></code></pre></div><ul><li>上传到指定文件夹</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>oss upload oss-tool.png -d images/png
</span></span></code></pre></div><ul><li>上传文件夹</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>oss upload ./cmd -d cmd
</span></span></code></pre></div><ul><li>上传图片到指定文件夹</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>oss upload oss-tool.png -p
</span></span></code></pre></div><ul><li>上传图片后输出 Markdown 格式</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>oss upload oss-tool.png -p -m
</span></span></code></pre></div><h3 id=github>GitHub</h3><p><a href=https://github.com/helloworlde/oss>https://github.com/helloworlde/oss</a></p></section><div class=paginator><a class=prev href=https://blog.hellowood.dev/posts/kubernetes-%E4%B8%AD%E5%AE%89%E8%A3%85-helm/><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg>
<span>Kubernetes 中安装 Helm</span></a>
<a class=next href=https://blog.hellowood.dev/posts/spring-boot-%E4%B8%AD%E4%BD%BF%E7%94%A8spring-cloud-stream/><span>Spring Boot 中使用Spring Cloud Stream</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div></article></div><footer class=footer><p>&copy; 2024 <a href=https://blog.hellowood.dev/>HelloWood</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank data-umami-event=to-hugo>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank data-umami-event=to-ladder>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g data-umami-event=top-link><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>