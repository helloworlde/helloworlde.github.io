<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>SpringMVC 生成验证码</title>
<meta charset=utf-8><meta name=description content='Ladder@使用 Google kaptcha 为 SpringMVC Maven 项目生成验证码
##1 添加依赖
<dependency> <groupId>com.github.penggle</groupId> <artifactId>kaptcha</artifactId> <version>2.3.2</version> </dependency> 2 配置文件中添加验证码生成器Bean <!--图片验证码--> <bean id="captchaProducer" class="com.google.code.kaptcha.impl.DefaultKaptcha"> <property name="config"> <bean class="com.google.code.kaptcha.util.Config"> <constructor-arg> <props> <prop key="kaptcha.border">no</prop> <prop key="kaptcha.image.width">120</prop> <prop key="kaptcha.session.key">code</prop> <prop key="kaptcha.textproducer.font.color">blue</prop> <prop key="kaptcha.textproducer.font.size">40</prop> <prop key="kaptcha.textproducer.char.length">4</prop> </props> </constructor-arg> </bean> </property> </bean> 配置项 属性 作用 说明 kaptcha.border 是否有边框 默认为true 我们可以自己设置yes，no kaptcha.border.color 边框颜色 默认为Color.BLACK kaptcha.border.thickness 边框粗细度 默认为1 kaptcha.producer.impl 验证码生成器 默认为DefaultKaptcha kaptcha.textproducer.impl 验证码文本生成器 默认为DefaultTextCreator kaptcha.textproducer.char.string 验证码文本字符内容范围 默认为abcde2345678gfynmnpwx kaptcha.textproducer.char.length 验证码文本字符长度 默认为5 kaptcha.'><meta name=author content="HelloWood"><link rel=canonical href=https://blog.hellowood.dev/posts/springmvc-%E7%94%9F%E6%88%90%E9%AA%8C%E8%AF%81%E7%A0%81/><meta name=google-site-verification content="G-3MSGPYTHPZ"><link rel=alternate type=application/rss+xml href=https://blog.hellowood.dev//index.xml title=HelloWood><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ")}</script><script async defer data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301 src=https://umami.hellowood.dev/script.js></script><script defer data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}' src=https://static.cloudflareinsights.com/beacon.min.js></script><meta property="og:url" content="https://blog.hellowood.dev/posts/springmvc-%E7%94%9F%E6%88%90%E9%AA%8C%E8%AF%81%E7%A0%81/"><meta property="og:site_name" content="HelloWood"><meta property="og:title" content="SpringMVC 生成验证码"><meta property="og:description" content='使用 Google kaptcha 为 SpringMVC Maven 项目生成验证码
##1 添加依赖
<dependency> <groupId>com.github.penggle</groupId> <artifactId>kaptcha</artifactId> <version>2.3.2</version> </dependency> 2 配置文件中添加验证码生成器Bean <!--图片验证码--> <bean id="captchaProducer" class="com.google.code.kaptcha.impl.DefaultKaptcha"> <property name="config"> <bean class="com.google.code.kaptcha.util.Config"> <constructor-arg> <props> <prop key="kaptcha.border">no</prop> <prop key="kaptcha.image.width">120</prop> <prop key="kaptcha.session.key">code</prop> <prop key="kaptcha.textproducer.font.color">blue</prop> <prop key="kaptcha.textproducer.font.size">40</prop> <prop key="kaptcha.textproducer.char.length">4</prop> </props> </constructor-arg> </bean> </property> </bean> 配置项 属性 作用 说明 kaptcha.border 是否有边框 默认为true 我们可以自己设置yes，no kaptcha.border.color 边框颜色 默认为Color.BLACK kaptcha.border.thickness 边框粗细度 默认为1 kaptcha.producer.impl 验证码生成器 默认为DefaultKaptcha kaptcha.textproducer.impl 验证码文本生成器 默认为DefaultTextCreator kaptcha.textproducer.char.string 验证码文本字符内容范围 默认为abcde2345678gfynmnpwx kaptcha.textproducer.char.length 验证码文本字符长度 默认为5 kaptcha.'><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-01-01T01:04:16+00:00"><meta property="article:modified_time" content="2018-01-01T01:04:16+00:00"><meta property="article:tag" content="Java"><meta property="article:tag" content="SrpingMVC"><meta name=twitter:card content="summary"><meta name=twitter:title content="SpringMVC 生成验证码"><meta name=twitter:description content='使用 Google kaptcha 为 SpringMVC Maven 项目生成验证码
##1 添加依赖
<dependency> <groupId>com.github.penggle</groupId> <artifactId>kaptcha</artifactId> <version>2.3.2</version> </dependency> 2 配置文件中添加验证码生成器Bean <!--图片验证码--> <bean id="captchaProducer" class="com.google.code.kaptcha.impl.DefaultKaptcha"> <property name="config"> <bean class="com.google.code.kaptcha.util.Config"> <constructor-arg> <props> <prop key="kaptcha.border">no</prop> <prop key="kaptcha.image.width">120</prop> <prop key="kaptcha.session.key">code</prop> <prop key="kaptcha.textproducer.font.color">blue</prop> <prop key="kaptcha.textproducer.font.size">40</prop> <prop key="kaptcha.textproducer.char.length">4</prop> </props> </constructor-arg> </bean> </property> </bean> 配置项 属性 作用 说明 kaptcha.border 是否有边框 默认为true 我们可以自己设置yes，no kaptcha.border.color 边框颜色 默认为Color.BLACK kaptcha.border.thickness 边框粗细度 默认为1 kaptcha.producer.impl 验证码生成器 默认为DefaultKaptcha kaptcha.textproducer.impl 验证码文本生成器 默认为DefaultTextCreator kaptcha.textproducer.char.string 验证码文本字符内容范围 默认为abcde2345678gfynmnpwx kaptcha.textproducer.char.length 验证码文本字符长度 默认为5 kaptcha.'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.hellowood.dev/posts/"},{"@type":"ListItem","position":2,"name":"SpringMVC 生成验证码","item":"https://blog.hellowood.dev/posts/springmvc-%E7%94%9F%E6%88%90%E9%AA%8C%E8%AF%81%E7%A0%81/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SpringMVC 生成验证码","name":"SpringMVC 生成验证码","description":"使用 Google kaptcha 为 SpringMVC Maven 项目生成验证码\n##1 添加依赖\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.github.penggle\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;kaptcha\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;2.3.2\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; 2 配置文件中添加验证码生成器Bean \u0026lt;!--图片验证码--\u0026gt; \u0026lt;bean id=\u0026#34;captchaProducer\u0026#34; class=\u0026#34;com.google.code.kaptcha.impl.DefaultKaptcha\u0026#34;\u0026gt; \u0026lt;property name=\u0026#34;config\u0026#34;\u0026gt; \u0026lt;bean class=\u0026#34;com.google.code.kaptcha.util.Config\u0026#34;\u0026gt; \u0026lt;constructor-arg\u0026gt; \u0026lt;props\u0026gt; \u0026lt;prop key=\u0026#34;kaptcha.border\u0026#34;\u0026gt;no\u0026lt;/prop\u0026gt; \u0026lt;prop key=\u0026#34;kaptcha.image.width\u0026#34;\u0026gt;120\u0026lt;/prop\u0026gt; \u0026lt;prop key=\u0026#34;kaptcha.session.key\u0026#34;\u0026gt;code\u0026lt;/prop\u0026gt; \u0026lt;prop key=\u0026#34;kaptcha.textproducer.font.color\u0026#34;\u0026gt;blue\u0026lt;/prop\u0026gt; \u0026lt;prop key=\u0026#34;kaptcha.textproducer.font.size\u0026#34;\u0026gt;40\u0026lt;/prop\u0026gt; \u0026lt;prop key=\u0026#34;kaptcha.textproducer.char.length\u0026#34;\u0026gt;4\u0026lt;/prop\u0026gt; \u0026lt;/props\u0026gt; \u0026lt;/constructor-arg\u0026gt; \u0026lt;/bean\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;/bean\u0026gt; 配置项 属性 作用 说明 kaptcha.border 是否有边框 默认为true 我们可以自己设置yes，no kaptcha.border.color 边框颜色 默认为Color.BLACK kaptcha.border.thickness 边框粗细度 默认为1 kaptcha.producer.impl 验证码生成器 默认为DefaultKaptcha kaptcha.textproducer.impl 验证码文本生成器 默认为DefaultTextCreator kaptcha.textproducer.char.string 验证码文本字符内容范围 默认为abcde2345678gfynmnpwx kaptcha.textproducer.char.length 验证码文本字符长度 默认为5 kaptcha.","keywords":["Java","SrpingMVC"],"articleBody":" 使用 Google kaptcha 为 SpringMVC Maven 项目生成验证码\n##1 添加依赖\ncom.github.penggle kaptcha 2.3.2 2 配置文件中添加验证码生成器Bean no 120 code blue 40 4 配置项 属性 作用 说明 kaptcha.border 是否有边框 默认为true 我们可以自己设置yes，no kaptcha.border.color 边框颜色 默认为Color.BLACK kaptcha.border.thickness 边框粗细度 默认为1 kaptcha.producer.impl 验证码生成器 默认为DefaultKaptcha kaptcha.textproducer.impl 验证码文本生成器 默认为DefaultTextCreator kaptcha.textproducer.char.string 验证码文本字符内容范围 默认为abcde2345678gfynmnpwx kaptcha.textproducer.char.length 验证码文本字符长度 默认为5 kaptcha.textproducer.font.names 验证码文本字体样式 默认为new Font(“Arial”, 1, fontSize), new Font(“Courier”, 1, fontSize) kaptcha.textproducer.font.size 验证码文本字符大小 默认为40 kaptcha.textproducer.font.color 验证码文本字符颜色 默认为Color.BLACK kaptcha.textproducer.char.space 验证码文本字符间距 默认为2 kaptcha.noise.impl 验证码噪点生成对象 默认为DefaultNoise kaptcha.noise.color 验证码噪点颜色 默认为Color.BLACK kaptcha.obscurificator.impl 验证码样式引擎 默认为WaterRipple kaptcha.word.impl 验证码文本字符渲染 默认为DefaultWordRenderer kaptcha.background.impl 验证码背景生成器 默认为DefaultBackground kaptcha.background.clear.from 验证码背景颜色渐进 默认为Color.LIGHT_GRAY kaptcha.background.clear.to 验证码背景颜色渐进 默认为Color.WHITE kaptcha.image.width 验证码图片宽度 默认为200 kaptcha.image.height 验证码图片高度 默认为50 3 页面添加验证码图片和输入框 4 页面添加刷新验证码 // 加载验证码 function loadValidateCode() { var time = new Date().getTime(); $(\"#validateCodeImage\").attr('src', './loadValidateCode') } 5 后台添加生成验证码 导入包 import com.google.code.kaptcha.Producer; 生成方法 @Autowired private Producer captchaProducer; private final String VALIDATE_CODE = \"VALIDATE_CODE\"; private final String EXPIRE_TIME = \"EXPIRE_TIME\"; @RequestMapping(value = \"/loadValidateCode\", method = RequestMethod.GET) public void loadValidateCode(HttpServletRequest request, HttpServletResponse response) { try { HttpSession session = request.getSession(); // 设置清除浏览器缓存 response.setDateHeader(\"Expires\", 0); response.setHeader(\"Cache-Control\", \"no-store, no-cache, must-revalidate\"); response.addHeader(\"Cache-Control\", \"post-check=0, pre-check=0\"); response.setHeader(\"Pragma\", \"no-cache\"); response.setContentType(\"image/png\"); // 验证码一分钟内有效 long expireTime = System.currentTimeMillis() + 60000; // 将验证码放到session中 String validateCode = captchaProducer.createText(); session.setAttribute(VALIDATE_CODE, Utils.encodeBase64(validateCode));//将加密后的验证码放到session中，确保安全 session.setAttribute(EXPIRE_TIME, expireTime); // 输出验证码图片 BufferedImage bufferedImage = captchaProducer.createImage(validateCode); ServletOutputStream out = response.getOutputStream(); ImageIO.write(bufferedImage, \"png\", out); out.flush(); out.close(); } catch (IOException e) { e.printStackTrace(); } } 6 登录时校验验证码 @RequestMapping(value = \"/login\", method = RequestMethod.POST) public @ResponseBody String login(String username, String password, String validateCode) { // 校验验证码是否有效 String currentValidateCode = String.valueOf(request.getSession().getAttribute(VALIDATE_CODE)); if (System.currentTimeMillis() \u003e Long.parseLong(String.valueOf(request.getSession().getAttribute(EXPIRE_TIME)))) { return JSON.toJSONString(\"验证码已过期，请重试\"); } // 校验验证码 String currentValidateCode = String.valueOf(request.getSession().getAttribute(VALIDATE_CODE)); if (StringUtils.isEmpty(validateCode) || validateCode.length() != 4 || !Utils.encodeBase64(validateCode).equals(currentValidateCode)) { return JSON.toJSONString(\"验证码错误\"); } } 7 Base64加密 public static String encodeBase64(String str) { sun.misc.BASE64Encoder base64Encode = new BASE64Encoder(); return base64Encode.encode(str.getBytes()); } ","wordCount":"327","inLanguage":"en","datePublished":"2018-01-01T01:04:16Z","dateModified":"2018-01-01T01:04:16Z","author":{"@type":"Person","name":"HelloWood"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.hellowood.dev/posts/springmvc-%E7%94%9F%E6%88%90%E9%AA%8C%E8%AF%81%E7%A0%81/"},"publisher":{"@type":"Organization","name":"HelloWood","logo":{"@type":"ImageObject","url":"https://blog.hellowood.dev/favicon.ico"}}}</script><link rel=icon href=/images/avatar.png sizes=16x16><link rel=apple-touch-icon href=/images/avatar.png><link rel=manifest href=/images/avatar.png><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.ff1bc260fafbfb440e10194d7d06d57eb5e85eed11d12d06255581262664204e.css integrity="sha256-/xvCYPr7+0QOEBlNfQbVfrXoXu0R0S0GJVWBJiZkIE4=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><meta name=google-adsense-account content="ca-pub-3401351766168985"><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jtbhx98g62")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3401351766168985" crossorigin=anonymous></script><script defer src=https://analytics.us.umami.is/script.js data-website-id=73ff1c8c-9938-43cf-81af-e77e26b0cca3></script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand data-umami-event=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Blog href=/posts>Blog</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Tags href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Archive href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Dashboard href=https://umami.hellowood.dev/share/lab/Blog>Dashboard</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link data-umami-event=navigation-social href=https://github.com/helloworlde><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button data-umami-event=toggle-theme aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
<span class=toggle-light><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>SpringMVC 生成验证码</h1></header><p><small>January 1, 2018&nbsp;· 327 words&nbsp;· 2 min</small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#2-配置文件中添加验证码生成器bean>2 配置文件中添加验证码生成器Bean</a></li><li><a href=#3-页面添加验证码图片和输入框>3 页面添加验证码图片和输入框</a></li><li><a href=#4-页面添加刷新验证码>4 页面添加刷新验证码</a></li><li><a href=#5-后台添加生成验证码>5 后台添加生成验证码</a></li><li><a href=#6-登录时校验验证码>6 登录时校验验证码</a></li><li><a href=#7-base64加密>7 Base64加密</a></li></ul></nav></div><section class=blog-content><blockquote><p>使用 Google kaptcha 为 SpringMVC Maven 项目生成验证码</p></blockquote><p>##1 添加依赖</p><pre tabindex=0><code>        &lt;dependency&gt;
            &lt;groupId&gt;com.github.penggle&lt;/groupId&gt;
            &lt;artifactId&gt;kaptcha&lt;/artifactId&gt;
            &lt;version&gt;2.3.2&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre><h2 id=2-配置文件中添加验证码生成器bean>2 配置文件中添加验证码生成器Bean</h2><pre tabindex=0><code>    &lt;!--图片验证码--&gt;
    &lt;bean id=&#34;captchaProducer&#34; class=&#34;com.google.code.kaptcha.impl.DefaultKaptcha&#34;&gt;
        &lt;property name=&#34;config&#34;&gt;
            &lt;bean class=&#34;com.google.code.kaptcha.util.Config&#34;&gt;
                &lt;constructor-arg&gt;
                    &lt;props&gt;
                        &lt;prop key=&#34;kaptcha.border&#34;&gt;no&lt;/prop&gt;
                        &lt;prop key=&#34;kaptcha.image.width&#34;&gt;120&lt;/prop&gt;
                        &lt;prop key=&#34;kaptcha.session.key&#34;&gt;code&lt;/prop&gt;
                        &lt;prop key=&#34;kaptcha.textproducer.font.color&#34;&gt;blue&lt;/prop&gt;
                        &lt;prop key=&#34;kaptcha.textproducer.font.size&#34;&gt;40&lt;/prop&gt;
                        &lt;prop key=&#34;kaptcha.textproducer.char.length&#34;&gt;4&lt;/prop&gt;
                    &lt;/props&gt;
                &lt;/constructor-arg&gt;
            &lt;/bean&gt;
        &lt;/property&gt;
    &lt;/bean&gt;
</code></pre><ul><li>配置项</li></ul><table><thead><tr><th>属性</th><th>作用</th><th>说明</th></tr></thead><tbody><tr><td>kaptcha.border</td><td>是否有边框</td><td>默认为true 我们可以自己设置yes，no</td></tr><tr><td>kaptcha.border.color</td><td>边框颜色</td><td>默认为Color.BLACK</td></tr><tr><td>kaptcha.border.thickness</td><td>边框粗细度</td><td>默认为1</td></tr><tr><td>kaptcha.producer.impl</td><td>验证码生成器</td><td>默认为DefaultKaptcha</td></tr><tr><td>kaptcha.textproducer.impl</td><td>验证码文本生成器</td><td>默认为DefaultTextCreator</td></tr><tr><td>kaptcha.textproducer.char.string</td><td>验证码文本字符内容范围</td><td>默认为abcde2345678gfynmnpwx</td></tr><tr><td>kaptcha.textproducer.char.length</td><td>验证码文本字符长度</td><td>默认为5</td></tr><tr><td>kaptcha.textproducer.font.names</td><td>验证码文本字体样式</td><td>默认为new Font(&ldquo;Arial&rdquo;, 1, fontSize), new Font(&ldquo;Courier&rdquo;, 1, fontSize)</td></tr><tr><td>kaptcha.textproducer.font.size</td><td>验证码文本字符大小</td><td>默认为40</td></tr><tr><td>kaptcha.textproducer.font.color</td><td>验证码文本字符颜色</td><td>默认为Color.BLACK</td></tr><tr><td>kaptcha.textproducer.char.space</td><td>验证码文本字符间距</td><td>默认为2</td></tr><tr><td>kaptcha.noise.impl</td><td>验证码噪点生成对象</td><td>默认为DefaultNoise</td></tr><tr><td>kaptcha.noise.color</td><td>验证码噪点颜色</td><td>默认为Color.BLACK</td></tr><tr><td>kaptcha.obscurificator.impl</td><td>验证码样式引擎</td><td>默认为WaterRipple</td></tr><tr><td>kaptcha.word.impl</td><td>验证码文本字符渲染</td><td>默认为DefaultWordRenderer</td></tr><tr><td>kaptcha.background.impl</td><td>验证码背景生成器</td><td>默认为DefaultBackground</td></tr><tr><td>kaptcha.background.clear.from</td><td>验证码背景颜色渐进</td><td>默认为Color.LIGHT_GRAY</td></tr><tr><td>kaptcha.background.clear.to</td><td>验证码背景颜色渐进</td><td>默认为Color.WHITE</td></tr><tr><td>kaptcha.image.width</td><td>验证码图片宽度</td><td>默认为200</td></tr><tr><td>kaptcha.image.height</td><td>验证码图片高度</td><td>默认为50</td></tr></tbody></table><h2 id=3-页面添加验证码图片和输入框>3 页面添加验证码图片和输入框</h2><pre tabindex=0><code>            &lt;div class=&#34;col-md-12&#34;&gt;
                &lt;div class=&#34;col-md-7 form-control&#34;  style=&#34;float:left; width: 60%;&#34;&gt;
                    &lt;input type=&#34;text&#34; id=&#34;validateCode&#34; name=&#34;validateCode&#34; placeholder=&#34;验证码&#34; &gt;
                &lt;/div&gt;
                &lt;div class=&#34;col-md-3&#34; style=&#34;float: right;overflow: visible !important;&#34;&gt;
                    &lt;img src=&#34;./loadValidateCode&#34; id=&#34;validateCodeImage&#34; name=&#34;validateCodeImage&#34;
                         style=&#34;width: 100px;height: 35px;&#34;  onclick=&#34;loadValidateCode()&#34; &gt;
                &lt;/div&gt;
            &lt;/div&gt;
</code></pre><h2 id=4-页面添加刷新验证码>4 页面添加刷新验证码</h2><pre tabindex=0><code>    // 加载验证码
    function loadValidateCode() {
        var time = new Date().getTime();
        $(&#34;#validateCodeImage&#34;).attr(&#39;src&#39;, &#39;./loadValidateCode&#39;)
    }
</code></pre><h2 id=5-后台添加生成验证码>5 后台添加生成验证码</h2><ul><li>导入包</li></ul><pre tabindex=0><code>    import com.google.code.kaptcha.Producer;
</code></pre><ul><li>生成方法</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Java data-lang=Java><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Producer captchaProducer;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> String VALIDATE_CODE <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;VALIDATE_CODE&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> String EXPIRE_TIME <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;EXPIRE_TIME&#34;</span>;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@RequestMapping</span>(value <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/loadValidateCode&#34;</span>, method <span style=color:#f92672>=</span> RequestMethod.<span style=color:#a6e22e>GET</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>loadValidateCode</span>(HttpServletRequest request, HttpServletResponse response) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            HttpSession session <span style=color:#f92672>=</span> request.<span style=color:#a6e22e>getSession</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 设置清除浏览器缓存</span>
</span></span><span style=display:flex><span>            response.<span style=color:#a6e22e>setDateHeader</span>(<span style=color:#e6db74>&#34;Expires&#34;</span>, 0);
</span></span><span style=display:flex><span>            response.<span style=color:#a6e22e>setHeader</span>(<span style=color:#e6db74>&#34;Cache-Control&#34;</span>, <span style=color:#e6db74>&#34;no-store, no-cache, must-revalidate&#34;</span>);
</span></span><span style=display:flex><span>            response.<span style=color:#a6e22e>addHeader</span>(<span style=color:#e6db74>&#34;Cache-Control&#34;</span>, <span style=color:#e6db74>&#34;post-check=0, pre-check=0&#34;</span>);
</span></span><span style=display:flex><span>            response.<span style=color:#a6e22e>setHeader</span>(<span style=color:#e6db74>&#34;Pragma&#34;</span>, <span style=color:#e6db74>&#34;no-cache&#34;</span>);
</span></span><span style=display:flex><span>            response.<span style=color:#a6e22e>setContentType</span>(<span style=color:#e6db74>&#34;image/png&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 验证码一分钟内有效</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>long</span> expireTime <span style=color:#f92672>=</span> System.<span style=color:#a6e22e>currentTimeMillis</span>() <span style=color:#f92672>+</span> 60000;
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 将验证码放到session中</span>
</span></span><span style=display:flex><span>            String validateCode <span style=color:#f92672>=</span> captchaProducer.<span style=color:#a6e22e>createText</span>();
</span></span><span style=display:flex><span>            session.<span style=color:#a6e22e>setAttribute</span>(VALIDATE_CODE, Utils.<span style=color:#a6e22e>encodeBase64</span>(validateCode));<span style=color:#75715e>//将加密后的验证码放到session中，确保安全</span>
</span></span><span style=display:flex><span>            session.<span style=color:#a6e22e>setAttribute</span>(EXPIRE_TIME, expireTime);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 输出验证码图片</span>
</span></span><span style=display:flex><span>            BufferedImage bufferedImage <span style=color:#f92672>=</span> captchaProducer.<span style=color:#a6e22e>createImage</span>(validateCode);
</span></span><span style=display:flex><span>            ServletOutputStream out <span style=color:#f92672>=</span> response.<span style=color:#a6e22e>getOutputStream</span>();
</span></span><span style=display:flex><span>            ImageIO.<span style=color:#a6e22e>write</span>(bufferedImage, <span style=color:#e6db74>&#34;png&#34;</span>, out);
</span></span><span style=display:flex><span>            out.<span style=color:#a6e22e>flush</span>();
</span></span><span style=display:flex><span>            out.<span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (IOException e) {
</span></span><span style=display:flex><span>            e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><h2 id=6-登录时校验验证码>6 登录时校验验证码</h2><pre tabindex=0><code>    @RequestMapping(value = &#34;/login&#34;, method = RequestMethod.POST)
    public @ResponseBody String login(String username, String password, String validateCode) {
        
        // 校验验证码是否有效
        String currentValidateCode = String.valueOf(request.getSession().getAttribute(VALIDATE_CODE));
        if (System.currentTimeMillis() &gt; Long.parseLong(String.valueOf(request.getSession().getAttribute(EXPIRE_TIME)))) {
            return JSON.toJSONString(&#34;验证码已过期，请重试&#34;);
        }

        // 校验验证码
        String currentValidateCode = String.valueOf(request.getSession().getAttribute(VALIDATE_CODE));
        if (StringUtils.isEmpty(validateCode) || validateCode.length() != 4 ||
                !Utils.encodeBase64(validateCode).equals(currentValidateCode)) {
            return JSON.toJSONString(&#34;验证码错误&#34;);
        }
 }       
</code></pre><h2 id=7-base64加密>7 Base64加密</h2><pre tabindex=0><code>    public static String encodeBase64(String str) {
        sun.misc.BASE64Encoder base64Encode = new BASE64Encoder();
        return base64Encode.encode(str.getBytes());
    }
</code></pre></section><div class=paginator><a class=prev href=https://blog.hellowood.dev/posts/tomcat%E5%90%AF%E5%8A%A8%E6%97%B6%E4%B8%80%E7%9B%B4%E5%81%9C%E7%95%99%E5%9C%A8%E4%B8%80%E4%B8%AA%E5%BA%94%E7%94%A8%E7%9A%84%E5%8F%91%E5%B8%83%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg>
<span>Tomcat启动时一直停留在一个应用的发布的解决办法</span></a>
<a class=next href=https://blog.hellowood.dev/posts/idea%E5%90%AF%E5%8A%A8spring-boot%E9%A1%B9%E7%9B%AE%E6%8F%90%E7%A4%BAunable-to-start-embeddedwebapplicationcontext-due-to-missing-embeddedservlet/><span>IDEA启动Spring Boot项目提示Unable to start EmbeddedWebApplicationContext due to missing EmbeddedServlet...</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div></article></div><footer class=footer><p>&copy; 2024 <a href=https://blog.hellowood.dev/>HelloWood</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank data-umami-event=to-hugo>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank data-umami-event=to-ladder>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g data-umami-event=top-link><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>