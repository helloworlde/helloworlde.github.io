<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>Spring Boot MyBatis 动态数据源常见问题和解决方法</title>
<meta charset=utf-8><meta name=description content='Ladder@在使用 Spring Boot 和 MyBatis 动态切换数据源时遇到的问题以及解决方法 相关项目地址:https://github.com/helloworlde/SpringBoot-DynamicDataSource
1. org.apache.ibatis.binding.BindingException: Invalid bound statement (not found) 在使用了动态数据源后遇到了该问题，从错误信息来看是因为没有找到 *.xml 文件而导致的，但是在配置文件中 确实添加了相关的配置，这种错误的原因是因为设置数据源后没有设置SqlSessionFactoryBean的 typeAliasesPackage 和mapperLocations属性或属性无效导致的；
解决方法： 如果在应用的入口类中添加了 @SpringBootApplication(exclude = DataSourceAutoConfiguration.class), 在DataSourceConfigure类的中设置相关属性：
@Bean @ConfigurationProperties(prefix = "mybatis") public SqlSessionFactoryBean sqlSessionFactoryBean() { SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean(); sqlSessionFactoryBean.setDataSource(dynamicDataSource()); return sqlSessionFactoryBean; } 或者直接配置(不推荐该方式)：
@Bean public SqlSessionFactoryBean sqlSessionFactoryBean() { SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean(); sqlSessionFactoryBean.setTypeAliasesPackage("typeAliasesPackage"); sqlSessionFactoryBean.setMapperLocations(new PathMatchingResourcePatternResolver().getResources("mapperLocations")); sqlSessionFactoryBean.setDataSource(dynamicDataSource()); return sqlSessionFactoryBean; } 2. Consider marking one of the beans as @Primary, updating the consumer to accept multiple beans, or using @Qualifier to identify the bean that should be consumed 该异常在错误信息中已经说的很清楚了，是因为有多个 DataSource 的实例，所以无法确定该引用那个实例'><meta name=author content="HelloWood"><link rel=canonical href=https://blog.hellowood.dev/posts/spring-boot-mybatis-%E5%8A%A8%E6%80%81%E6%95%B0%E6%8D%AE%E6%BA%90%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/><meta name=google-site-verification content="G-3MSGPYTHPZ"><link rel=alternate type=application/rss+xml href=https://blog.hellowood.dev//index.xml title=HelloWood><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ",{anonymize_ip:!1})}</script><script async defer data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301 src=https://umami.hellowood.dev/script.js></script><script defer data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}' src=https://static.cloudflareinsights.com/beacon.min.js></script><meta property="og:title" content="Spring Boot MyBatis 动态数据源常见问题和解决方法"><meta property="og:description" content='在使用 Spring Boot 和 MyBatis 动态切换数据源时遇到的问题以及解决方法 相关项目地址:https://github.com/helloworlde/SpringBoot-DynamicDataSource
1. org.apache.ibatis.binding.BindingException: Invalid bound statement (not found) 在使用了动态数据源后遇到了该问题，从错误信息来看是因为没有找到 *.xml 文件而导致的，但是在配置文件中 确实添加了相关的配置，这种错误的原因是因为设置数据源后没有设置SqlSessionFactoryBean的 typeAliasesPackage 和mapperLocations属性或属性无效导致的；
解决方法： 如果在应用的入口类中添加了 @SpringBootApplication(exclude = DataSourceAutoConfiguration.class), 在DataSourceConfigure类的中设置相关属性：
@Bean @ConfigurationProperties(prefix = "mybatis") public SqlSessionFactoryBean sqlSessionFactoryBean() { SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean(); sqlSessionFactoryBean.setDataSource(dynamicDataSource()); return sqlSessionFactoryBean; } 或者直接配置(不推荐该方式)：
@Bean public SqlSessionFactoryBean sqlSessionFactoryBean() { SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean(); sqlSessionFactoryBean.setTypeAliasesPackage("typeAliasesPackage"); sqlSessionFactoryBean.setMapperLocations(new PathMatchingResourcePatternResolver().getResources("mapperLocations")); sqlSessionFactoryBean.setDataSource(dynamicDataSource()); return sqlSessionFactoryBean; } 2. Consider marking one of the beans as @Primary, updating the consumer to accept multiple beans, or using @Qualifier to identify the bean that should be consumed 该异常在错误信息中已经说的很清楚了，是因为有多个 DataSource 的实例，所以无法确定该引用那个实例'><meta property="og:type" content="article"><meta property="og:url" content="https://blog.hellowood.dev/posts/spring-boot-mybatis-%E5%8A%A8%E6%80%81%E6%95%B0%E6%8D%AE%E6%BA%90%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-12-31T23:45:52+00:00"><meta property="article:modified_time" content="2017-12-31T23:45:52+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Spring Boot MyBatis 动态数据源常见问题和解决方法"><meta name=twitter:description content='在使用 Spring Boot 和 MyBatis 动态切换数据源时遇到的问题以及解决方法 相关项目地址:https://github.com/helloworlde/SpringBoot-DynamicDataSource
1. org.apache.ibatis.binding.BindingException: Invalid bound statement (not found) 在使用了动态数据源后遇到了该问题，从错误信息来看是因为没有找到 *.xml 文件而导致的，但是在配置文件中 确实添加了相关的配置，这种错误的原因是因为设置数据源后没有设置SqlSessionFactoryBean的 typeAliasesPackage 和mapperLocations属性或属性无效导致的；
解决方法： 如果在应用的入口类中添加了 @SpringBootApplication(exclude = DataSourceAutoConfiguration.class), 在DataSourceConfigure类的中设置相关属性：
@Bean @ConfigurationProperties(prefix = "mybatis") public SqlSessionFactoryBean sqlSessionFactoryBean() { SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean(); sqlSessionFactoryBean.setDataSource(dynamicDataSource()); return sqlSessionFactoryBean; } 或者直接配置(不推荐该方式)：
@Bean public SqlSessionFactoryBean sqlSessionFactoryBean() { SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean(); sqlSessionFactoryBean.setTypeAliasesPackage("typeAliasesPackage"); sqlSessionFactoryBean.setMapperLocations(new PathMatchingResourcePatternResolver().getResources("mapperLocations")); sqlSessionFactoryBean.setDataSource(dynamicDataSource()); return sqlSessionFactoryBean; } 2. Consider marking one of the beans as @Primary, updating the consumer to accept multiple beans, or using @Qualifier to identify the bean that should be consumed 该异常在错误信息中已经说的很清楚了，是因为有多个 DataSource 的实例，所以无法确定该引用那个实例'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.hellowood.dev/posts/"},{"@type":"ListItem","position":2,"name":"Spring Boot MyBatis 动态数据源常见问题和解决方法","item":"https://blog.hellowood.dev/posts/spring-boot-mybatis-%E5%8A%A8%E6%80%81%E6%95%B0%E6%8D%AE%E6%BA%90%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Spring Boot MyBatis 动态数据源常见问题和解决方法","name":"Spring Boot MyBatis 动态数据源常见问题和解决方法","description":"在使用 Spring Boot 和 MyBatis 动态切换数据源时遇到的问题以及解决方法 相关项目地址:https://github.com/helloworlde/SpringBoot-DynamicDataSource\n1. org.apache.ibatis.binding.BindingException: Invalid bound statement (not found) 在使用了动态数据源后遇到了该问题，从错误信息来看是因为没有找到 *.xml 文件而导致的，但是在配置文件中 确实添加了相关的配置，这种错误的原因是因为设置数据源后没有设置SqlSessionFactoryBean的 typeAliasesPackage 和mapperLocations属性或属性无效导致的；\n解决方法： 如果在应用的入口类中添加了 @SpringBootApplication(exclude = DataSourceAutoConfiguration.class), 在DataSourceConfigure类的中设置相关属性：\n@Bean @ConfigurationProperties(prefix = \u0026#34;mybatis\u0026#34;) public SqlSessionFactoryBean sqlSessionFactoryBean() { SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean(); sqlSessionFactoryBean.setDataSource(dynamicDataSource()); return sqlSessionFactoryBean; } 或者直接配置(不推荐该方式)：\n@Bean public SqlSessionFactoryBean sqlSessionFactoryBean() { SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean(); sqlSessionFactoryBean.setTypeAliasesPackage(\u0026#34;typeAliasesPackage\u0026#34;); sqlSessionFactoryBean.setMapperLocations(new PathMatchingResourcePatternResolver().getResources(\u0026#34;mapperLocations\u0026#34;)); sqlSessionFactoryBean.setDataSource(dynamicDataSource()); return sqlSessionFactoryBean; } 2. Consider marking one of the beans as @Primary, updating the consumer to accept multiple beans, or using @Qualifier to identify the bean that should be consumed 该异常在错误信息中已经说的很清楚了，是因为有多个 DataSource 的实例，所以无法确定该引用那个实例","keywords":["Java","SpringBoot","MyBatis","DynamicDataSource","MultipleDataSource","Druid","Issue"],"articleBody":"在使用 Spring Boot 和 MyBatis 动态切换数据源时遇到的问题以及解决方法 相关项目地址:https://github.com/helloworlde/SpringBoot-DynamicDataSource\n1. org.apache.ibatis.binding.BindingException: Invalid bound statement (not found) 在使用了动态数据源后遇到了该问题，从错误信息来看是因为没有找到 *.xml 文件而导致的，但是在配置文件中 确实添加了相关的配置，这种错误的原因是因为设置数据源后没有设置SqlSessionFactoryBean的 typeAliasesPackage 和mapperLocations属性或属性无效导致的；\n解决方法： 如果在应用的入口类中添加了 @SpringBootApplication(exclude = DataSourceAutoConfiguration.class), 在DataSourceConfigure类的中设置相关属性：\n@Bean @ConfigurationProperties(prefix = \"mybatis\") public SqlSessionFactoryBean sqlSessionFactoryBean() { SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean(); sqlSessionFactoryBean.setDataSource(dynamicDataSource()); return sqlSessionFactoryBean; } 或者直接配置(不推荐该方式)：\n@Bean public SqlSessionFactoryBean sqlSessionFactoryBean() { SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean(); sqlSessionFactoryBean.setTypeAliasesPackage(\"typeAliasesPackage\"); sqlSessionFactoryBean.setMapperLocations(new PathMatchingResourcePatternResolver().getResources(\"mapperLocations\")); sqlSessionFactoryBean.setDataSource(dynamicDataSource()); return sqlSessionFactoryBean; } 2. Consider marking one of the beans as @Primary, updating the consumer to accept multiple beans, or using @Qualifier to identify the bean that should be consumed 该异常在错误信息中已经说的很清楚了，是因为有多个 DataSource 的实例，所以无法确定该引用那个实例\n解决方法： 为数据源的某个 Bean 添加 @Primary 注解，该 Bean 应当是通过 DataSourceBuilder.create().build() 得到的 Bean，而不是通过 new AbstractRoutingDataSource 的子类实现的 Bean，在本项目中可以是 master() 或 slave() 得到的 DataSource，不能是 dynamicDataSource() 得到的 DataSource\n3. 通过注解方式动态切换数据源无效 请确认注解没有放到 DAO 层方法上, 因为会在 Service 层开启事务，所以当注解在 DAO 层时不会生效 请确认以下 Bean 正确配置： @Bean(\"dynamicDataSource\") public DataSource dynamicDataSource() { DynamicRoutingDataSource dynamicRoutingDataSource = new DynamicRoutingDataSource(); Map\u003cObject, Object\u003e dataSourceMap = new HashMap\u003c\u003e(2); dataSourceMap.put(\"master\", master()); dataSourceMap.put(\"slave\", slave()); // Set master datasource as default dynamicRoutingDataSource.setDefaultTargetDataSource(master()); // Set master and slave datasource as target datasource dynamicRoutingDataSource.setTargetDataSources(dataSourceMap); // To put datasource keys into DataSourceContextHolder to judge if the datasource is exist DynamicDataSourceContextHolder.dataSourceKeys.addAll(dataSourceMap.keySet()); return dynamicRoutingDataSource; } @Bean @ConfigurationProperties(prefix = \"mybatis\") public SqlSessionFactoryBean sqlSessionFactoryBean() { SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean(); // Here is very important, if don't config this, will can't switch datasource // put all datasource into SqlSessionFactoryBean, then will autoconfig SqlSessionFactory sqlSessionFactoryBean.setDataSource(dynamicDataSource()); return sqlSessionFactoryBean; } 4. @Transactional 注解无效，发生异常不回滚 请确认该 Bean 得到正确配置，并且@Transactional 的 rollbackFor 配置正确 @Bean public PlatformTransactionManager transactionManager() { return new DataSourceTransactionManager(dynamicDataSource()); } 5. 通过 AOP 判断 DAO 层方法名时切换数据源无效 当切面指向了 DAO 层后无论如何设置切面的顺序，都无法在执行查询之前切换数据源，但是切面改为 Service 层后可以正常工作\n解决方法: 请确认 @Transactional 注解是加在方法上而不是 Service 类上，添加了 @Transactional 的方法因为在 Service 层开启了事务， 会在事务结束之后才会切换数据源\n检出 DataSourceTransactionManager Bean 注入正确\n@Bean public PlatformTransactionManager transactionManager() { return new DataSourceTransactionManager(dynamicDataSource()); } 6. The dependencies of some of the beans in the application context form a cycle 错误信息： The dependencies of some of the beans in the application context form a cycle: produceController (field private cn.com.hellowood.dynamicdatasource.service.ProductService cn.com.hellowood.dynamicdatasource.controller.ProduceController.productService) ↓ productService (field private cn.com.hellowood.dynamicdatasource.mapper.ProductDao cn.com.hellowood.dynamicdatasource.service.ProductService.productDao) ↓ productDao defined in file [/Users/hehuimin/Downloads/Dev/SpringBoot/DynamicDataSource/out/production/classes/cn/com/hellowood/dynamicdatasource/mapper/ProductDao.class] ↓ sqlSessionFactoryBean defined in class path resource [cn/com/hellowood/dynamicdatasource/configuration/DataSourceConfigurer.class] ┌─────┐ | dynamicDataSource defined in class path resource [cn/com/hellowood/dynamicdatasource/configuration/DataSourceConfigurer.class] ↑ ↓ | master defined in class path resource [cn/com/hellowood/dynamicdatasource/configuration/DataSourceConfigurer.class] ↑ ↓ | dataSourceInitializer └─────┘ 这是因为在注入 DataSource 的实例的时候产生了循环调用，第一个注入的 Bean 依赖于其他的 Bean， 而被依赖的 Bean 产生依赖传递，依赖第一个 注入的 Bean, 陷入了循环，无法启动项目\n解决方法：将 @Primary 注解指向没有依赖的 Bean，如： /** * master DataSource * @Primary 注解用于标识默认使用的 DataSource Bean，因为有三个 DataSource Bean，该注解可用于 master * 或 slave DataSource Bean, 但不能用于 dynamicDataSource Bean, 否则会产生循环调用 * * @ConfigurationProperties 注解用于从 application.properties 文件中读取配置，为 Bean 设置属性 * @return data source */ @Bean(\"master\") @Primary @ConfigurationProperties(prefix = \"application.server.db.master\") public DataSource master() { return DataSourceBuilder.create().build(); } @Bean(\"slave\") @ConfigurationProperties(prefix = \"application.server.db.slave\") public DataSource slave() { return DataSourceBuilder.create().build(); } @Bean(\"dynamicDataSource\") public DataSource dynamicDataSource() { DynamicRoutingDataSource dynamicRoutingDataSource = new DynamicRoutingDataSource(); Map\u003cObject, Object\u003e dataSourceMap = new HashMap\u003c\u003e(2); dataSourceMap.put(\"master\", master()); dataSourceMap.put(\"slave\", slave()); // Set master datasource as default dynamicRoutingDataSource.setDefaultTargetDataSource(master()); // Set master and slave datasource as target datasource dynamicRoutingDataSource.setTargetDataSources(dataSourceMap); // To put datasource keys into DataSourceContextHolder to judge if the datasource is exist DynamicDataSourceContextHolder.dataSourceKeys.addAll(dataSourceMap.keySet()); return dynamicRoutingDataSource; } ","wordCount":"482","inLanguage":"en","datePublished":"2017-12-31T23:45:52Z","dateModified":"2017-12-31T23:45:52Z","author":{"@type":"Person","name":"HelloWood"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.hellowood.dev/posts/spring-boot-mybatis-%E5%8A%A8%E6%80%81%E6%95%B0%E6%8D%AE%E6%BA%90%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E5%92%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"},"publisher":{"@type":"Organization","name":"HelloWood","logo":{"@type":"ImageObject","url":"https://blog.hellowood.dev/favicon.ico"}}}</script><link rel=icon href=/images/avatar.png sizes=16x16><link rel=apple-touch-icon href=/images/avatar.png><link rel=manifest href=/images/avatar.png><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.ff1bc260fafbfb440e10194d7d06d57eb5e85eed11d12d06255581262664204e.css integrity="sha256-/xvCYPr7+0QOEBlNfQbVfrXoXu0R0S0GJVWBJiZkIE4=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jtbhx98g62")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3401351766168985" crossorigin=anonymous></script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand data-umami-event=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Blog href=/posts>Blog</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Tags href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Archive href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Dashboard href=https://umami.hellowood.dev/share/lab/Blog>Dashboard</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link data-umami-event=navigation-social href=https://github.com/helloworlde><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button data-umami-event=toggle-theme aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
<span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>Spring Boot MyBatis 动态数据源常见问题和解决方法</h1></header><p><small>December 31, 2017&nbsp;· 482 words&nbsp;· 3 min</small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#1-orgapacheibatisbindingbindingexception-invalid-bound-statement-not-found>1. org.apache.ibatis.binding.BindingException: Invalid bound statement (not found)</a></li><li><a href=#2-consider-marking-one-of-the-beans-as-primary-updating-the-consumer-to-accept-multiple-beans-or-using-qualifier-to-identify-the-bean-that-should-be-consumed>2. Consider marking one of the beans as @Primary, updating the consumer to accept multiple beans, or using @Qualifier to identify the bean that should be consumed</a></li><li><a href=#3-通过注解方式动态切换数据源无效>3. 通过注解方式动态切换数据源无效</a></li><li><a href=#4-transactional-注解无效发生异常不回滚>4. <code>@Transactional</code> 注解无效，发生异常不回滚</a></li><li><a href=#5-通过-aop-判断-dao-层方法名时切换数据源无效>5. 通过 AOP 判断 DAO 层方法名时切换数据源无效</a></li><li><a href=#6-the-dependencies-of-some-of-the-beans-in-the-application-context-form-a-cycle>6. The dependencies of some of the beans in the application context form a cycle</a></li></ul></nav></div><section class=blog-content><h1 id=在使用-spring-boot-和-mybatis-动态切换数据源时遇到的问题以及解决方法>在使用 Spring Boot 和 MyBatis 动态切换数据源时遇到的问题以及解决方法</h1><blockquote><p>相关项目地址:<a href=https://github.com/helloworlde/SpringBoot-DynamicDataSource>https://github.com/helloworlde/SpringBoot-DynamicDataSource</a></p></blockquote><h2 id=1-orgapacheibatisbindingbindingexception-invalid-bound-statement-not-found>1. org.apache.ibatis.binding.BindingException: Invalid bound statement (not found)</h2><blockquote><p>在使用了动态数据源后遇到了该问题，从错误信息来看是因为没有找到 <code>*.xml</code> 文件而导致的，但是在配置文件中
确实添加了相关的配置，这种错误的原因是因为设置数据源后没有设置<code>SqlSessionFactoryBean</code>的 <code>typeAliasesPackage</code>
和<code>mapperLocations</code>属性或属性无效导致的；</p></blockquote><ul><li>解决方法：</li></ul><blockquote><p>如果在应用的入口类中添加了 <code>@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</code>,
在<code>DataSourceConfigure</code>类的中设置相关属性：</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ConfigurationProperties</span>(prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;mybatis&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> SqlSessionFactoryBean <span style=color:#a6e22e>sqlSessionFactoryBean</span>() {
</span></span><span style=display:flex><span>        SqlSessionFactoryBean sqlSessionFactoryBean <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SqlSessionFactoryBean();
</span></span><span style=display:flex><span>        sqlSessionFactoryBean.<span style=color:#a6e22e>setDataSource</span>(dynamicDataSource());
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> sqlSessionFactoryBean;
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>或者直接配置(不推荐该方式)：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> SqlSessionFactoryBean <span style=color:#a6e22e>sqlSessionFactoryBean</span>() {
</span></span><span style=display:flex><span>        SqlSessionFactoryBean sqlSessionFactoryBean <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SqlSessionFactoryBean();
</span></span><span style=display:flex><span>        sqlSessionFactoryBean.<span style=color:#a6e22e>setTypeAliasesPackage</span>(<span style=color:#e6db74>&#34;typeAliasesPackage&#34;</span>);
</span></span><span style=display:flex><span>        sqlSessionFactoryBean.<span style=color:#a6e22e>setMapperLocations</span>(<span style=color:#66d9ef>new</span> PathMatchingResourcePatternResolver().<span style=color:#a6e22e>getResources</span>(<span style=color:#e6db74>&#34;mapperLocations&#34;</span>));
</span></span><span style=display:flex><span>        sqlSessionFactoryBean.<span style=color:#a6e22e>setDataSource</span>(dynamicDataSource());
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> sqlSessionFactoryBean;
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><h2 id=2-consider-marking-one-of-the-beans-as-primary-updating-the-consumer-to-accept-multiple-beans-or-using-qualifier-to-identify-the-bean-that-should-be-consumed>2. Consider marking one of the beans as @Primary, updating the consumer to accept multiple beans, or using @Qualifier to identify the bean that should be consumed</h2><blockquote><p>该异常在错误信息中已经说的很清楚了，是因为有多个 <code>DataSource</code> 的实例，所以无法确定该引用那个实例</p></blockquote><ul><li>解决方法：</li></ul><blockquote><p>为数据源的某个 <code>Bean</code> 添加 <code>@Primary</code> 注解，该 <code>Bean</code> 应当是通过 <code>DataSourceBuilder.create().build()</code>
得到的 <code>Bean</code>，而不是通过 <code>new AbstractRoutingDataSource</code> 的子类实现的 <code>Bean</code>，在本项目中可以是 <code>master()</code>
或 <code>slave()</code> 得到的 <code>DataSource</code>，不能是 <code>dynamicDataSource()</code> 得到的 <code>DataSource</code></p></blockquote><h2 id=3-通过注解方式动态切换数据源无效>3. 通过注解方式动态切换数据源无效</h2><ul><li>请确认注解没有放到 DAO 层方法上, 因为会在 Service 层开启事务，所以当注解在 DAO 层时不会生效</li><li>请确认以下 <code>Bean</code> 正确配置：</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>(<span style=color:#e6db74>&#34;dynamicDataSource&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> DataSource <span style=color:#a6e22e>dynamicDataSource</span>() {
</span></span><span style=display:flex><span>        DynamicRoutingDataSource dynamicRoutingDataSource <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> DynamicRoutingDataSource();
</span></span><span style=display:flex><span>        Map<span style=color:#f92672>&lt;</span>Object, Object<span style=color:#f92672>&gt;</span> dataSourceMap <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;</span>(2);
</span></span><span style=display:flex><span>        dataSourceMap.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;master&#34;</span>, master());
</span></span><span style=display:flex><span>        dataSourceMap.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;slave&#34;</span>, slave());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Set master datasource as default</span>
</span></span><span style=display:flex><span>        dynamicRoutingDataSource.<span style=color:#a6e22e>setDefaultTargetDataSource</span>(master());
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Set master and slave datasource as target datasource</span>
</span></span><span style=display:flex><span>        dynamicRoutingDataSource.<span style=color:#a6e22e>setTargetDataSources</span>(dataSourceMap);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// To put datasource keys into DataSourceContextHolder to judge if the datasource is exist</span>
</span></span><span style=display:flex><span>        DynamicDataSourceContextHolder.<span style=color:#a6e22e>dataSourceKeys</span>.<span style=color:#a6e22e>addAll</span>(dataSourceMap.<span style=color:#a6e22e>keySet</span>());
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> dynamicRoutingDataSource;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ConfigurationProperties</span>(prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;mybatis&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> SqlSessionFactoryBean <span style=color:#a6e22e>sqlSessionFactoryBean</span>() {
</span></span><span style=display:flex><span>        SqlSessionFactoryBean sqlSessionFactoryBean <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> SqlSessionFactoryBean();
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Here is very important, if don&#39;t config this, will can&#39;t switch datasource</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// put all datasource into SqlSessionFactoryBean, then will autoconfig SqlSessionFactory</span>
</span></span><span style=display:flex><span>        sqlSessionFactoryBean.<span style=color:#a6e22e>setDataSource</span>(dynamicDataSource());
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> sqlSessionFactoryBean;
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><h2 id=4-transactional-注解无效发生异常不回滚>4. <code>@Transactional</code> 注解无效，发生异常不回滚</h2><ul><li>请确认该 <code>Bean</code> 得到正确配置，并且<code>@Transactional</code> 的 <code>rollbackFor</code> 配置正确</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> PlatformTransactionManager <span style=color:#a6e22e>transactionManager</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> DataSourceTransactionManager(dynamicDataSource());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span></code></pre></div><h2 id=5-通过-aop-判断-dao-层方法名时切换数据源无效>5. 通过 AOP 判断 DAO 层方法名时切换数据源无效</h2><blockquote><p>当切面指向了 DAO 层后无论如何设置切面的顺序，都无法在执行查询之前切换数据源，但是切面改为 Service 层后可以正常工作</p></blockquote><ul><li><p>解决方法: 请确认 <code>@Transactional</code> 注解是加在方法上而不是 Service 类上，添加了 <code>@Transactional</code> 的方法因为在 Service 层开启了事务，
会在事务结束之后才会切换数据源</p></li><li><p>检出 <code>DataSourceTransactionManager</code> Bean 注入正确</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span> 
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> PlatformTransactionManager <span style=color:#a6e22e>transactionManager</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> DataSourceTransactionManager(dynamicDataSource());
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><h2 id=6-the-dependencies-of-some-of-the-beans-in-the-application-context-form-a-cycle>6. The dependencies of some of the beans in the application context form a cycle</h2><ul><li>错误信息：</li></ul><pre tabindex=0><code>The dependencies of some of the beans in the application context form a cycle:

   produceController (field private cn.com.hellowood.dynamicdatasource.service.ProductService cn.com.hellowood.dynamicdatasource.controller.ProduceController.productService)
      ↓
   productService (field private cn.com.hellowood.dynamicdatasource.mapper.ProductDao cn.com.hellowood.dynamicdatasource.service.ProductService.productDao)
      ↓
   productDao defined in file [/Users/hehuimin/Downloads/Dev/SpringBoot/DynamicDataSource/out/production/classes/cn/com/hellowood/dynamicdatasource/mapper/ProductDao.class]
      ↓
   sqlSessionFactoryBean defined in class path resource [cn/com/hellowood/dynamicdatasource/configuration/DataSourceConfigurer.class]
┌─────┐
|  dynamicDataSource defined in class path resource [cn/com/hellowood/dynamicdatasource/configuration/DataSourceConfigurer.class]
↑     ↓
|  master defined in class path resource [cn/com/hellowood/dynamicdatasource/configuration/DataSourceConfigurer.class]
↑     ↓
|  dataSourceInitializer
└─────┘
</code></pre><blockquote><p>这是因为在注入 <code>DataSource</code> 的实例的时候产生了循环调用，第一个注入的 Bean 依赖于其他的 Bean， 而被依赖的 Bean 产生依赖传递，依赖第一个
注入的 Bean, 陷入了循环，无法启动项目</p></blockquote><ul><li>解决方法：将 <code>@Primary</code> 注解指向没有依赖的 Bean，如：</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * master DataSource
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @Primary 注解用于标识默认使用的 DataSource Bean，因为有三个 DataSource Bean，该注解可用于 master
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 或 slave DataSource Bean, 但不能用于 dynamicDataSource Bean, 否则会产生循环调用 
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @ConfigurationProperties 注解用于从 application.properties 文件中读取配置，为 Bean 设置属性 
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return data source
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>(<span style=color:#e6db74>&#34;master&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Primary</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ConfigurationProperties</span>(prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;application.server.db.master&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> DataSource <span style=color:#a6e22e>master</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> DataSourceBuilder.<span style=color:#a6e22e>create</span>().<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>(<span style=color:#e6db74>&#34;slave&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@ConfigurationProperties</span>(prefix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;application.server.db.slave&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> DataSource <span style=color:#a6e22e>slave</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> DataSourceBuilder.<span style=color:#a6e22e>create</span>().<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>(<span style=color:#e6db74>&#34;dynamicDataSource&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> DataSource <span style=color:#a6e22e>dynamicDataSource</span>() {
</span></span><span style=display:flex><span>        DynamicRoutingDataSource dynamicRoutingDataSource <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> DynamicRoutingDataSource();
</span></span><span style=display:flex><span>        Map<span style=color:#f92672>&lt;</span>Object, Object<span style=color:#f92672>&gt;</span> dataSourceMap <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;</span>(2);
</span></span><span style=display:flex><span>        dataSourceMap.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;master&#34;</span>, master());
</span></span><span style=display:flex><span>        dataSourceMap.<span style=color:#a6e22e>put</span>(<span style=color:#e6db74>&#34;slave&#34;</span>, slave());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Set master datasource as default</span>
</span></span><span style=display:flex><span>        dynamicRoutingDataSource.<span style=color:#a6e22e>setDefaultTargetDataSource</span>(master());
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Set master and slave datasource as target datasource</span>
</span></span><span style=display:flex><span>        dynamicRoutingDataSource.<span style=color:#a6e22e>setTargetDataSources</span>(dataSourceMap);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// To put datasource keys into DataSourceContextHolder to judge if the datasource is exist</span>
</span></span><span style=display:flex><span>        DynamicDataSourceContextHolder.<span style=color:#a6e22e>dataSourceKeys</span>.<span style=color:#a6e22e>addAll</span>(dataSourceMap.<span style=color:#a6e22e>keySet</span>());
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> dynamicRoutingDataSource;
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div></section><div class=paginator><a class=prev href=https://blog.hellowood.dev/posts/spring-boot-%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6/><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg>
<span>Spring Boot 发送邮件</span></a>
<a class=next href=https://blog.hellowood.dev/posts/spring-boot-mybatis%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E5%8A%A8%E6%80%81%E6%95%B0%E6%8D%AE%E6%BA%90%E5%88%87%E6%8D%A2/><span>Spring Boot MyBatis Druid 多数据源、动态数据源切换</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div></article></div><footer class=footer><p>&copy; 2024 <a href=https://blog.hellowood.dev/>HelloWood</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank data-umami-event=to-hugo>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank data-umami-event=to-ladder>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g data-umami-event=top-link><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>