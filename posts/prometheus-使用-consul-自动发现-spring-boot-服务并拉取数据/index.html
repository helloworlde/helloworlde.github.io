<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>Prometheus 使用 Consul 自动发现 Spring Boot 服务并拉取数据</title>
<meta charset=utf-8><meta name=description content="Ladder@Prometheus 使用 Consul 自动发现 Spring Boot 服务并拉取数据
使用 Prometheus监控 SpringBoot 应用，当应用很多，且上下线频繁时，需要不断的更改 Prometheus 的配置文件，不能灵活的使用，可以通过为 Prometheus配置注册中心，从注册中心拉取应用数据获取监控数据
启动 Prometheus

添加配置文件 prometheus.yaml

mkdir -p ~/docker/prometheus/config
vi ~/docker/prometheus/config/prometheus.yml
global:
  scrape_interval: 15s
  scrape_timeout: 10s
  evaluation_interval: 15s
alerting:
  alertmanagers:
  - static_configs:
    - targets: []
    scheme: http
    timeout: 10s
    api_version: v1
scrape_configs:
- job_name: prometheus
  honor_timestamps: true
  scrape_interval: 15s
  scrape_timeout: 10s
  metrics_path: /metrics
  scheme: http
  static_configs:
  - targets:
    - localhost:9090

启动容器

docker run \
    -d \
    --name prometheus \
    -p 9090:9090 \
    -v ~/docker/prometheus/config/prometheus.yml:/etc/prometheus/prometheus.yml \
    prom/prometheus    
启动 Consul
docker run \
       -d \
       --name consul \
       -p 8500:8500 \
       consul
启动 Spring Boot 应用
添加监控

添加依赖 build.gradle

    compile 'org.springframework.cloud:spring-cloud-starter-consul-discovery'
    compile 'org.springframework.boot:spring-boot-starter-actuator'
    compile 'io.micrometer:micrometer-core:1.5.1'
    compile 'io.micrometer:micrometer-registry-prometheus:1.5.1' 

修改应用配置 applicaiton.properties

spring.cloud.consul.host=localhost
spring.cloud.consul.port=8500
spring.cloud.consul.discovery.service-name=${spring.application.name}
spring.cloud.consul.discovery.prefer-ip-address=true
spring.cloud.consul.discovery.health-check-url=http://host.docker.internal:${server.port}/actuator/health
spring.cloud.consul.discovery.tags=metrics=true

management.endpoints.web.exposure.include=*
# prometheus
management.metrics.tags.application=${spring.application.name}
上面配置中指定健康检查是为了 Consul 从容器访问宿主机的应用，指定tag是为了Prometheus 从Consul列表中拉取需要监控的指定应用"><meta name=author content="HelloWood"><link rel=canonical href=https://blog.hellowood.dev/posts/prometheus-%E4%BD%BF%E7%94%A8-consul-%E8%87%AA%E5%8A%A8%E5%8F%91%E7%8E%B0-spring-boot-%E6%9C%8D%E5%8A%A1%E5%B9%B6%E6%8B%89%E5%8F%96%E6%95%B0%E6%8D%AE/><meta name=google-site-verification content="G-3MSGPYTHPZ"><link rel=alternate type=application/rss+xml href=https://blog.hellowood.dev//index.xml title=HelloWood><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ")}</script><script async defer data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301 src=https://umami.hellowood.dev/script.js></script><script defer data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}' src=https://static.cloudflareinsights.com/beacon.min.js></script><meta property="og:url" content="https://blog.hellowood.dev/posts/prometheus-%E4%BD%BF%E7%94%A8-consul-%E8%87%AA%E5%8A%A8%E5%8F%91%E7%8E%B0-spring-boot-%E6%9C%8D%E5%8A%A1%E5%B9%B6%E6%8B%89%E5%8F%96%E6%95%B0%E6%8D%AE/"><meta property="og:site_name" content="HelloWood"><meta property="og:title" content="Prometheus 使用 Consul 自动发现 Spring Boot 服务并拉取数据"><meta property="og:description" content="Prometheus 使用 Consul 自动发现 Spring Boot 服务并拉取数据 使用 Prometheus监控 SpringBoot 应用，当应用很多，且上下线频繁时，需要不断的更改 Prometheus 的配置文件，不能灵活的使用，可以通过为 Prometheus配置注册中心，从注册中心拉取应用数据获取监控数据
启动 Prometheus 添加配置文件 prometheus.yaml mkdir -p ~/docker/prometheus/config vi ~/docker/prometheus/config/prometheus.yml global: scrape_interval: 15s scrape_timeout: 10s evaluation_interval: 15s alerting: alertmanagers: - static_configs: - targets: [] scheme: http timeout: 10s api_version: v1 scrape_configs: - job_name: prometheus honor_timestamps: true scrape_interval: 15s scrape_timeout: 10s metrics_path: /metrics scheme: http static_configs: - targets: - localhost:9090 启动容器 docker run \ -d \ --name prometheus \ -p 9090:9090 \ -v ~/docker/prometheus/config/prometheus.yml:/etc/prometheus/prometheus.yml \ prom/prometheus 启动 Consul docker run \ -d \ --name consul \ -p 8500:8500 \ consul 启动 Spring Boot 应用 添加监控 添加依赖 build.gradle compile 'org.springframework.cloud:spring-cloud-starter-consul-discovery' compile 'org.springframework.boot:spring-boot-starter-actuator' compile 'io.micrometer:micrometer-core:1.5.1' compile 'io.micrometer:micrometer-registry-prometheus:1.5.1' 修改应用配置 applicaiton.properties spring.cloud.consul.host=localhost spring.cloud.consul.port=8500 spring.cloud.consul.discovery.service-name=${spring.application.name} spring.cloud.consul.discovery.prefer-ip-address=true spring.cloud.consul.discovery.health-check-url=http://host.docker.internal:${server.port}/actuator/health spring.cloud.consul.discovery.tags=metrics=true management.endpoints.web.exposure.include=* # prometheus management.metrics.tags.application=${spring.application.name} 上面配置中指定健康检查是为了 Consul 从容器访问宿主机的应用，指定tag是为了Prometheus 从Consul列表中拉取需要监控的指定应用"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-05-16T14:49:38+00:00"><meta property="article:modified_time" content="2020-05-16T14:49:38+00:00"><meta property="article:tag" content="Prometheus"><meta property="article:tag" content="Grafana"><meta property="article:tag" content="Consul"><meta property="article:tag" content="SpringBoot"><meta name=twitter:card content="summary"><meta name=twitter:title content="Prometheus 使用 Consul 自动发现 Spring Boot 服务并拉取数据"><meta name=twitter:description content="Prometheus 使用 Consul 自动发现 Spring Boot 服务并拉取数据 使用 Prometheus监控 SpringBoot 应用，当应用很多，且上下线频繁时，需要不断的更改 Prometheus 的配置文件，不能灵活的使用，可以通过为 Prometheus配置注册中心，从注册中心拉取应用数据获取监控数据
启动 Prometheus 添加配置文件 prometheus.yaml mkdir -p ~/docker/prometheus/config vi ~/docker/prometheus/config/prometheus.yml global: scrape_interval: 15s scrape_timeout: 10s evaluation_interval: 15s alerting: alertmanagers: - static_configs: - targets: [] scheme: http timeout: 10s api_version: v1 scrape_configs: - job_name: prometheus honor_timestamps: true scrape_interval: 15s scrape_timeout: 10s metrics_path: /metrics scheme: http static_configs: - targets: - localhost:9090 启动容器 docker run \ -d \ --name prometheus \ -p 9090:9090 \ -v ~/docker/prometheus/config/prometheus.yml:/etc/prometheus/prometheus.yml \ prom/prometheus 启动 Consul docker run \ -d \ --name consul \ -p 8500:8500 \ consul 启动 Spring Boot 应用 添加监控 添加依赖 build.gradle compile 'org.springframework.cloud:spring-cloud-starter-consul-discovery' compile 'org.springframework.boot:spring-boot-starter-actuator' compile 'io.micrometer:micrometer-core:1.5.1' compile 'io.micrometer:micrometer-registry-prometheus:1.5.1' 修改应用配置 applicaiton.properties spring.cloud.consul.host=localhost spring.cloud.consul.port=8500 spring.cloud.consul.discovery.service-name=${spring.application.name} spring.cloud.consul.discovery.prefer-ip-address=true spring.cloud.consul.discovery.health-check-url=http://host.docker.internal:${server.port}/actuator/health spring.cloud.consul.discovery.tags=metrics=true management.endpoints.web.exposure.include=* # prometheus management.metrics.tags.application=${spring.application.name} 上面配置中指定健康检查是为了 Consul 从容器访问宿主机的应用，指定tag是为了Prometheus 从Consul列表中拉取需要监控的指定应用"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.hellowood.dev/posts/"},{"@type":"ListItem","position":2,"name":"Prometheus 使用 Consul 自动发现 Spring Boot 服务并拉取数据","item":"https://blog.hellowood.dev/posts/prometheus-%E4%BD%BF%E7%94%A8-consul-%E8%87%AA%E5%8A%A8%E5%8F%91%E7%8E%B0-spring-boot-%E6%9C%8D%E5%8A%A1%E5%B9%B6%E6%8B%89%E5%8F%96%E6%95%B0%E6%8D%AE/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Prometheus 使用 Consul 自动发现 Spring Boot 服务并拉取数据","name":"Prometheus 使用 Consul 自动发现 Spring Boot 服务并拉取数据","description":"Prometheus 使用 Consul 自动发现 Spring Boot 服务并拉取数据 使用 Prometheus监控 SpringBoot 应用，当应用很多，且上下线频繁时，需要不断的更改 Prometheus 的配置文件，不能灵活的使用，可以通过为 Prometheus配置注册中心，从注册中心拉取应用数据获取监控数据\n启动 Prometheus 添加配置文件 prometheus.yaml mkdir -p ~/docker/prometheus/config vi ~/docker/prometheus/config/prometheus.yml global: scrape_interval: 15s scrape_timeout: 10s evaluation_interval: 15s alerting: alertmanagers: - static_configs: - targets: [] scheme: http timeout: 10s api_version: v1 scrape_configs: - job_name: prometheus honor_timestamps: true scrape_interval: 15s scrape_timeout: 10s metrics_path: /metrics scheme: http static_configs: - targets: - localhost:9090 启动容器 docker run \\ -d \\ --name prometheus \\ -p 9090:9090 \\ -v ~/docker/prometheus/config/prometheus.yml:/etc/prometheus/prometheus.yml \\ prom/prometheus 启动 Consul docker run \\ -d \\ --name consul \\ -p 8500:8500 \\ consul 启动 Spring Boot 应用 添加监控 添加依赖 build.gradle compile \u0026#39;org.springframework.cloud:spring-cloud-starter-consul-discovery\u0026#39; compile \u0026#39;org.springframework.boot:spring-boot-starter-actuator\u0026#39; compile \u0026#39;io.micrometer:micrometer-core:1.5.1\u0026#39; compile \u0026#39;io.micrometer:micrometer-registry-prometheus:1.5.1\u0026#39; 修改应用配置 applicaiton.properties spring.cloud.consul.host=localhost spring.cloud.consul.port=8500 spring.cloud.consul.discovery.service-name=${spring.application.name} spring.cloud.consul.discovery.prefer-ip-address=true spring.cloud.consul.discovery.health-check-url=http://host.docker.internal:${server.port}/actuator/health spring.cloud.consul.discovery.tags=metrics=true management.endpoints.web.exposure.include=* # prometheus management.metrics.tags.application=${spring.application.name} 上面配置中指定健康检查是为了 Consul 从容器访问宿主机的应用，指定tag是为了Prometheus 从Consul列表中拉取需要监控的指定应用\n","keywords":["Prometheus","Grafana","Consul","SpringBoot"],"articleBody":"Prometheus 使用 Consul 自动发现 Spring Boot 服务并拉取数据 使用 Prometheus监控 SpringBoot 应用，当应用很多，且上下线频繁时，需要不断的更改 Prometheus 的配置文件，不能灵活的使用，可以通过为 Prometheus配置注册中心，从注册中心拉取应用数据获取监控数据\n启动 Prometheus 添加配置文件 prometheus.yaml mkdir -p ~/docker/prometheus/config vi ~/docker/prometheus/config/prometheus.yml global: scrape_interval: 15s scrape_timeout: 10s evaluation_interval: 15s alerting: alertmanagers: - static_configs: - targets: [] scheme: http timeout: 10s api_version: v1 scrape_configs: - job_name: prometheus honor_timestamps: true scrape_interval: 15s scrape_timeout: 10s metrics_path: /metrics scheme: http static_configs: - targets: - localhost:9090 启动容器 docker run \\ -d \\ --name prometheus \\ -p 9090:9090 \\ -v ~/docker/prometheus/config/prometheus.yml:/etc/prometheus/prometheus.yml \\ prom/prometheus 启动 Consul docker run \\ -d \\ --name consul \\ -p 8500:8500 \\ consul 启动 Spring Boot 应用 添加监控 添加依赖 build.gradle compile 'org.springframework.cloud:spring-cloud-starter-consul-discovery' compile 'org.springframework.boot:spring-boot-starter-actuator' compile 'io.micrometer:micrometer-core:1.5.1' compile 'io.micrometer:micrometer-registry-prometheus:1.5.1' 修改应用配置 applicaiton.properties spring.cloud.consul.host=localhost spring.cloud.consul.port=8500 spring.cloud.consul.discovery.service-name=${spring.application.name} spring.cloud.consul.discovery.prefer-ip-address=true spring.cloud.consul.discovery.health-check-url=http://host.docker.internal:${server.port}/actuator/health spring.cloud.consul.discovery.tags=metrics=true management.endpoints.web.exposure.include=* # prometheus management.metrics.tags.application=${spring.application.name} 上面配置中指定健康检查是为了 Consul 从容器访问宿主机的应用，指定tag是为了Prometheus 从Consul列表中拉取需要监控的指定应用\n使用 Consul 发现服务 修改 Prometheus 配置 prometheus.yaml global: scrape_interval: 15s scrape_timeout: 10s evaluation_interval: 15s alerting: alertmanagers: - static_configs: - targets: [] scheme: http timeout: 10s api_version: v1 scrape_configs: - job_name: \"prometheus\" static_configs: - targets: [\"localhost:9090\"] - job_name: \"consul\" consul_sd_configs: - server: \"host.docker.internal:8500\" relabel_configs: - source_labels: [\"__meta_consul_dc\"] target_label: \"dc\" - source_labels: [__meta_consul_service] separator: ; regex: (.*) target_label: application replacement: $1 action: replace - source_labels: [__address__] separator: \":\" regex: (127.0.0.1):(.*) target_label: __address__ replacement: host.docker.internal:${2} action: replace - source_labels: [__metrics_path__] separator: ; regex: /metrics target_label: __metrics_path__ replacement: /actuator/prometheus action: replace - source_labels: ['__meta_consul_tags'] regex: '^.*,metrics=true,.*$' action: keep 其中 :\nconsul_sd_configs指定 Consul 的地址 relabel_configs 指定配置标签覆盖规则 __meta_consul_service - source_labels: [__meta_consul_service] separator: ; regex: (.*) target_label: application replacement: $1 action: replace 这个配置是将 __meta_consul_service 重新映射为 application字段，方便 Prometheus 查询\n__address__ - source_labels: [__address__] separator: \":\" regex: (127.0.0.1):(.*) target_label: __address__ replacement: host.docker.internal:${2} action: replace 这个配置是为了将 127.0.0.1的地址改为host.docker.internal，方便 Prometheus 从容器中访问宿主机的应用\n__metrics_path__ - source_labels: [__metrics_path__] separator: ; regex: /metrics target_label: __metrics_path__ replacement: /actuator/prometheus action: replace 这个配置是为了将 Prometheus 默认的拉取数据 /metrics改成 /actuator/prometheus，方便从 Spring拉取，如果有多种不同的应用，数据路径不一样，建议设置多个job，以使用不同的规则\n__meta_consul_tags - source_labels: ['__meta_consul_tags'] regex: '^.*,metrics=true,.*$' action: keep 这个配置是为了筛选指定tag的应用，只有有这个tag的应用才会拉取监控数据，这里是 metrics=true，是在 Spring Boot的配置文件中配置的，这样就可以避免拉取不相关的数据的应用(如 Consul自己的数据，替换路径为/actuator/prometheus后无法获取到监控数据)\n配置完成后重启 Prometheus\n获取应用 Consul 中注册的应用 Prometheus 的 Service Discovery 可以看到，consul这个服务下发现了三个服务，但是只有一个在拉取数据，另外两个被丢弃了，这是因为限制了只拉取 tag 为 metrics=true\nPrometheus 的 Target 可以看到 Target 也只拉取了这一个应用\n查询监控数据 在 Prometheus 的 Graph中查询应用信息，也只能看到一个\nprocess_uptime_seconds 修改另一个 Spring Boot 应用，添加监控tag 再次查询 Prometheus 数据，可以看到另一个应用也开始拉取数据\n相关项目可以参考 grpc ","wordCount":"329","inLanguage":"en","datePublished":"2020-05-16T14:49:38Z","dateModified":"2020-05-16T14:49:38Z","author":{"@type":"Person","name":"HelloWood"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.hellowood.dev/posts/prometheus-%E4%BD%BF%E7%94%A8-consul-%E8%87%AA%E5%8A%A8%E5%8F%91%E7%8E%B0-spring-boot-%E6%9C%8D%E5%8A%A1%E5%B9%B6%E6%8B%89%E5%8F%96%E6%95%B0%E6%8D%AE/"},"publisher":{"@type":"Organization","name":"HelloWood","logo":{"@type":"ImageObject","url":"https://blog.hellowood.dev/favicon.ico"}}}</script><link rel=icon href=/images/avatar.png sizes=16x16><link rel=apple-touch-icon href=/images/avatar.png><link rel=manifest href=/images/avatar.png><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.7f82854fa0e999ec07c4835d3029de9f484030e254b80d470b3ca48eb934720e.css integrity="sha256-f4KFT6DpmewHxINdMCnen0hAMOJUuA1HCzykjrk0cg4=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><meta name=google-adsense-account content="ca-pub-3401351766168985"><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jtbhx98g62")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3401351766168985" crossorigin=anonymous></script><script defer src=https://analytics.us.umami.is/script.js data-website-id=73ff1c8c-9938-43cf-81af-e77e26b0cca3></script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand data-umami-event=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Blog href=/posts>Blog</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Tags href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Archive href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Dashboard href=https://umami.hellowood.dev/share/lab/Blog>Dashboard</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link data-umami-event=navigation-social href=https://github.com/helloworlde><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button data-umami-event=toggle-theme aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
<span class=toggle-light><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>Prometheus 使用 Consul 自动发现 Spring Boot 服务并拉取数据</h1></header><p><small>May 16, 2020&nbsp;· 329 words&nbsp;· 2 min</small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#启动-prometheus>启动 Prometheus</a></li><li><a href=#启动-consul>启动 Consul</a></li><li><a href=#启动-spring-boot-应用>启动 Spring Boot 应用</a><ul><li><a href=#添加监控>添加监控</a></li></ul></li><li><a href=#使用-consul-发现服务>使用 Consul 发现服务</a><ul><li><a href=#修改-prometheus-配置>修改 Prometheus 配置</a></li><li><a href=#获取应用>获取应用</a></li></ul></li></ul></nav></div><section class=blog-content><h1 id=prometheus-使用-consul-自动发现-spring-boot-服务并拉取数据>Prometheus 使用 Consul 自动发现 Spring Boot 服务并拉取数据</h1><p>使用 Prometheus监控 SpringBoot 应用，当应用很多，且上下线频繁时，需要不断的更改 Prometheus 的配置文件，不能灵活的使用，可以通过为 Prometheus配置注册中心，从注册中心拉取应用数据获取监控数据</p><h2 id=启动-prometheus>启动 Prometheus</h2><ul><li>添加配置文件 prometheus.yaml</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p ~/docker/prometheus/config
</span></span><span style=display:flex><span>vi ~/docker/prometheus/config/prometheus.yml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>global</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>scrape_interval</span>: <span style=color:#ae81ff>15s</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>scrape_timeout</span>: <span style=color:#ae81ff>10s</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>evaluation_interval</span>: <span style=color:#ae81ff>15s</span>
</span></span><span style=display:flex><span><span style=color:#f92672>alerting</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>alertmanagers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>static_configs</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>targets</span>: []
</span></span><span style=display:flex><span>    <span style=color:#f92672>scheme</span>: <span style=color:#ae81ff>http</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>timeout</span>: <span style=color:#ae81ff>10s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>api_version</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>scrape_configs</span>:
</span></span><span style=display:flex><span>- <span style=color:#f92672>job_name</span>: <span style=color:#ae81ff>prometheus</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>honor_timestamps</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>scrape_interval</span>: <span style=color:#ae81ff>15s</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>scrape_timeout</span>: <span style=color:#ae81ff>10s</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>metrics_path</span>: <span style=color:#ae81ff>/metrics</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>scheme</span>: <span style=color:#ae81ff>http</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>static_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>targets</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>localhost:9090</span>
</span></span></code></pre></div><ul><li>启动容器</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --name prometheus <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -p 9090:9090 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -v ~/docker/prometheus/config/prometheus.yml:/etc/prometheus/prometheus.yml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    prom/prometheus    
</span></span></code></pre></div><h2 id=启动-consul>启动 Consul</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       -d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       --name consul <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       -p 8500:8500 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       consul
</span></span></code></pre></div><h2 id=启动-spring-boot-应用>启动 Spring Boot 应用</h2><h3 id=添加监控>添加监控</h3><ul><li>添加依赖 build.gradle</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>    compile <span style=color:#e6db74>&#39;org.springframework.cloud:spring-cloud-starter-consul-discovery&#39;</span>
</span></span><span style=display:flex><span>    compile <span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-actuator&#39;</span>
</span></span><span style=display:flex><span>    compile <span style=color:#e6db74>&#39;io.micrometer:micrometer-core:1.5.1&#39;</span>
</span></span><span style=display:flex><span>    compile <span style=color:#e6db74>&#39;io.micrometer:micrometer-registry-prometheus:1.5.1&#39;</span> 
</span></span></code></pre></div><ul><li>修改应用配置 applicaiton.properties</li></ul><pre tabindex=0><code>spring.cloud.consul.host=localhost
spring.cloud.consul.port=8500
spring.cloud.consul.discovery.service-name=${spring.application.name}
spring.cloud.consul.discovery.prefer-ip-address=true
spring.cloud.consul.discovery.health-check-url=http://host.docker.internal:${server.port}/actuator/health
spring.cloud.consul.discovery.tags=metrics=true

management.endpoints.web.exposure.include=*
# prometheus
management.metrics.tags.application=${spring.application.name}
</code></pre><p>上面配置中指定健康检查是为了 Consul 从容器访问宿主机的应用，指定tag是为了Prometheus 从Consul列表中拉取需要监控的指定应用</p><h2 id=使用-consul-发现服务>使用 Consul 发现服务</h2><h3 id=修改-prometheus-配置>修改 Prometheus 配置</h3><ul><li>prometheus.yaml</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>global</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>scrape_interval</span>: <span style=color:#ae81ff>15s</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>scrape_timeout</span>: <span style=color:#ae81ff>10s</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>evaluation_interval</span>: <span style=color:#ae81ff>15s</span>
</span></span><span style=display:flex><span><span style=color:#f92672>alerting</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>alertmanagers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>static_configs</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>targets</span>: []
</span></span><span style=display:flex><span>      <span style=color:#f92672>scheme</span>: <span style=color:#ae81ff>http</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>timeout</span>: <span style=color:#ae81ff>10s</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>api_version</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>scrape_configs</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#34;prometheus&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>static_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>targets</span>: [<span style=color:#e6db74>&#34;localhost:9090&#34;</span>]
</span></span><span style=display:flex><span>  - <span style=color:#f92672>job_name</span>: <span style=color:#e6db74>&#34;consul&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>consul_sd_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>server</span>: <span style=color:#e6db74>&#34;host.docker.internal:8500&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>relabel_configs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>source_labels</span>: [<span style=color:#e6db74>&#34;__meta_consul_dc&#34;</span>]
</span></span><span style=display:flex><span>        <span style=color:#f92672>target_label</span>: <span style=color:#e6db74>&#34;dc&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>source_labels</span>: [<span style=color:#ae81ff>__meta_consul_service]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>separator</span>: <span style=color:#ae81ff>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>regex</span>: <span style=color:#ae81ff>(.*)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>target_label</span>: <span style=color:#ae81ff>application</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>replacement</span>: <span style=color:#ae81ff>$1</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>action</span>: <span style=color:#ae81ff>replace</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>source_labels</span>: [<span style=color:#ae81ff>__address__]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>separator</span>: <span style=color:#e6db74>&#34;:&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>regex</span>: <span style=color:#ae81ff>(127.0.0.1):(.*)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>target_label</span>: <span style=color:#ae81ff>__address__</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>replacement</span>: <span style=color:#ae81ff>host.docker.internal:${2}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>action</span>: <span style=color:#ae81ff>replace</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>source_labels</span>: [<span style=color:#ae81ff>__metrics_path__]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>separator</span>: <span style=color:#ae81ff>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>regex</span>: <span style=color:#ae81ff>/metrics</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>target_label</span>: <span style=color:#ae81ff>__metrics_path__</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>replacement</span>: <span style=color:#ae81ff>/actuator/prometheus</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>action</span>: <span style=color:#ae81ff>replace</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>source_labels</span>: [<span style=color:#e6db74>&#39;__meta_consul_tags&#39;</span>]
</span></span><span style=display:flex><span>        <span style=color:#f92672>regex</span>: <span style=color:#e6db74>&#39;^.*,metrics=true,.*$&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>action</span>: <span style=color:#ae81ff>keep</span>
</span></span></code></pre></div><p>其中 :</p><ul><li><code>consul_sd_configs</code>指定 Consul 的地址</li><li><code>relabel_configs</code> 指定配置标签覆盖规则</li><li><code>__meta_consul_service</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>      - <span style=color:#f92672>source_labels</span>: [<span style=color:#ae81ff>__meta_consul_service]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>separator</span>: <span style=color:#ae81ff>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>regex</span>: <span style=color:#ae81ff>(.*)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>target_label</span>: <span style=color:#ae81ff>application</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>replacement</span>: <span style=color:#ae81ff>$1</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>action</span>: <span style=color:#ae81ff>replace</span>
</span></span></code></pre></div><p>这个配置是将 <code>__meta_consul_service</code> 重新映射为 <code>application</code>字段，方便 Prometheus 查询</p><ul><li><code>__address__</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>      - <span style=color:#f92672>source_labels</span>: [<span style=color:#ae81ff>__address__]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>separator</span>: <span style=color:#e6db74>&#34;:&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>regex</span>: <span style=color:#ae81ff>(127.0.0.1):(.*)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>target_label</span>: <span style=color:#ae81ff>__address__</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>replacement</span>: <span style=color:#ae81ff>host.docker.internal:${2}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>action</span>: <span style=color:#ae81ff>replace</span>
</span></span></code></pre></div><p>这个配置是为了将 <code>127.0.0.1</code>的地址改为<code>host.docker.internal</code>，方便 Prometheus 从容器中访问宿主机的应用</p><ul><li><code>__metrics_path__</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>      - <span style=color:#f92672>source_labels</span>: [<span style=color:#ae81ff>__metrics_path__]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>separator</span>: <span style=color:#ae81ff>;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>regex</span>: <span style=color:#ae81ff>/metrics</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>target_label</span>: <span style=color:#ae81ff>__metrics_path__</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>replacement</span>: <span style=color:#ae81ff>/actuator/prometheus</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>action</span>: <span style=color:#ae81ff>replace</span>
</span></span></code></pre></div><p>这个配置是为了将 Prometheus 默认的拉取数据 <code>/metrics</code>改成 <code>/actuator/prometheus</code>，方便从 Spring拉取，如果有多种不同的应用，数据路径不一样，建议设置多个job，以使用不同的规则</p><ul><li><code>__meta_consul_tags</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>      - <span style=color:#f92672>source_labels</span>: [<span style=color:#e6db74>&#39;__meta_consul_tags&#39;</span>]
</span></span><span style=display:flex><span>        <span style=color:#f92672>regex</span>: <span style=color:#e6db74>&#39;^.*,metrics=true,.*$&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>action</span>: <span style=color:#ae81ff>keep</span>
</span></span></code></pre></div><p>这个配置是为了筛选指定tag的应用，只有有这个tag的应用才会拉取监控数据，这里是 <code>metrics=true</code>，是在 Spring Boot的配置文件中配置的，这样就可以避免拉取不相关的数据的应用(如 Consul自己的数据，替换路径为<code>/actuator/prometheus</code>后无法获取到监控数据)</p><p>配置完成后重启 Prometheus</p><h3 id=获取应用>获取应用</h3><ul><li>Consul 中注册的应用</li></ul><p><img alt=prometheus-consul-consul-service-list.png src=https://img.hellowood.dev/picture/prometheus-consul-consul-service-list.png></p><ul><li>Prometheus 的 Service Discovery</li></ul><p>可以看到，consul这个服务下发现了三个服务，但是只有一个在拉取数据，另外两个被丢弃了，这是因为限制了只拉取 tag 为 <code>metrics=true</code></p><p><img alt=prometheus-consul-prometheus-discovery-list.png src=https://img.hellowood.dev/picture/prometheus-consul-prometheus-discovery-list.png></p><ul><li>Prometheus 的 Target</li></ul><p>可以看到 Target 也只拉取了这一个应用</p><p><img alt=prometheus-consul-prometheus-target-list.png src=https://img.hellowood.dev/picture/prometheus-consul-prometheus-target-list.png></p><ul><li>查询监控数据</li></ul><p>在 Prometheus 的 Graph中查询应用信息，也只能看到一个</p><pre tabindex=0><code>process_uptime_seconds
</code></pre><p><img alt=prometheus-consul-prometheus-query-result1.png src=https://img.hellowood.dev/picture/prometheus-consul-prometheus-query-result1.png></p><ul><li>修改另一个 Spring Boot 应用，添加监控tag</li></ul><p>再次查询 Prometheus 数据，可以看到另一个应用也开始拉取数据</p><p><img alt=prometheus-consul-prometheus-query-result2.png src=https://img.hellowood.dev/picture/prometheus-consul-prometheus-query-result2.png></p><hr><ul><li>相关项目可以参考 <a href=https://github.com/helloworlde/SpringBootCollection/tree/master/grpc>grpc</a></li></ul></section><div class=paginator><a class=prev href=https://blog.hellowood.dev/posts/spring-cloud-gateway-%E4%BD%BF%E7%94%A8-kubernetes-%E5%AE%9E%E7%8E%B0%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg>
<span>Spring Cloud Gateway 使用 Kubernetes 实现负载均衡</span></a>
<a class=next href=https://blog.hellowood.dev/posts/%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89-grafana-%E9%9D%A2%E6%9D%BF%E7%9B%91%E6%8E%A7-consul/><span>使用自定义 Grafana 面板监控 Consul</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div></article></div><footer class=footer><p>&copy; 2024 <a href=https://blog.hellowood.dev/>HelloWood</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank data-umami-event=to-hugo>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank data-umami-event=to-ladder>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g data-umami-event=top-link><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>