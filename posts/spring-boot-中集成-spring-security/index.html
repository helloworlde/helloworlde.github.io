<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Spring Boot 中集成 Spring Security</title>
<meta name=description content="Copy Paste Worker"><meta name=keywords content='blog,hugo,Java,SpringBoot,Spring Security'><meta property="og:url" content="https://blog.hellowood.dev/posts/spring-boot-%E4%B8%AD%E9%9B%86%E6%88%90-spring-security/"><meta property="og:type" content="website"><meta property="og:title" content="Spring Boot 中集成 Spring Security"><meta property="og:description" content="Copy Paste Worker"><meta property="og:image" content="https://blog.hellowood.dev/images/avatar.webp"><meta property="og:image:secure_url" content="https://blog.hellowood.dev/images/avatar.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Spring Boot 中集成 Spring Security"><meta name=twitter:description content="Copy Paste Worker"><meta property="twitter:domain" content="https://blog.hellowood.dev/posts/spring-boot-%E4%B8%AD%E9%9B%86%E6%88%90-spring-security/"><meta property="twitter:url" content="https://blog.hellowood.dev/posts/spring-boot-%E4%B8%AD%E9%9B%86%E6%88%90-spring-security/"><meta name=twitter:image content="https://blog.hellowood.dev/images/avatar.webp"><link rel=canonical href=https://blog.hellowood.dev/posts/spring-boot-%E4%B8%AD%E9%9B%86%E6%88%90-spring-security/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.9a920d7dabdbad8363b6a0a94e29a9dfebdb7ee64cfcb193a0145e512ef2bdab.js integrity="sha256-mpINfavbrYNjtqCpTimp3+vbfuZM/LGToBReUS7yvas="></script><script defer src=https://umami.hellowood.dev/script.js data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301></script><script defer src=https://cloud.umami.is/script.js data-website-id=73ff1c8c-9938-43cf-81af-e77e26b0cca3></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}'></script><meta name=google-adsense-account content="ca-pub-3401351766168985"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3401351766168985" crossorigin=anonymous></script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jtbhx98g62")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ")</script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://blog.hellowood.dev/><img src=/images/avatar.webp alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://blog.hellowood.dev/>HelloWood</a></div><div class=nav-links><div class=nav-link><a href=https://blog.hellowood.dev/><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://blog.hellowood.dev/posts/><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://blog.hellowood.dev/tags/><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://github.com/helloworlde><span data-feather=github></span></a></div><div class=nav-link><a href=https://umami.hellowood.dev/share/lab/Blog><span data-feather=pie-chart></span></a></div><div class=nav-link><a href=https://blog.hellowood.dev/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target"></span>
<a><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://blog.hellowood.dev/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://blog.hellowood.dev/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://blog.hellowood.dev/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://github.com/helloworlde><span data-feather=github></span></a></li><li class=nav-item><a href=https://umami.hellowood.dev/share/lab/Blog><span data-feather=pie-chart></span></a></li><li class=nav-item><a href=https://blog.hellowood.dev/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Spring Boot 中集成 Spring Security</h1><small role=doc-subtitle></small><p class=post-date>2018-01-01</p><ul class=post-tags><li class=post-tag><a href=https://blog.hellowood.dev/tags/java>Java</a></li><li class=post-tag><a href=https://blog.hellowood.dev/tags/springboot>SpringBoot</a></li><li class=post-tag><a href=https://blog.hellowood.dev/tags/spring-security>Spring Security</a></li></ul></div><div class=post-content><blockquote><p>Spring Boot 集成 Spring Security的简单应用，从数据库读取数据校验用户，页面使用Thymeleaf模板</p></blockquote><hr><h3 id=项目地址-httpsgithubcomhelloworldespringsecurityhttpsgithubcomhelloworldespringsecurity>项目地址 <a href=https://github.com/helloworlde/SpringSecurity>https://github.com/helloworlde/SpringSecurity</a></h3><h3 id=演示-httpprojecthellowoodcomcnsecurityhttpprojecthellowoodcomcnsecurity>演示 <a href=http://project.hellowood.com.cn/Security/>http://project.hellowood.com.cn/Security/</a></h3><h2 id=创建-spring-boot-应用>创建 Spring Boot 应用</h2><h2 id=添加依赖>添加依赖</h2><pre tabindex=0><code>    compile(&#39;org.springframework.boot:spring-boot-starter-security&#39;)
    compile(&#39;org.springframework.boot:spring-boot-starter-web&#39;)
    compile(&#39;org.mybatis.spring.boot:mybatis-spring-boot-starter:1.3.0&#39;)
    compile(&#39;org.springframework.boot:spring-boot-starter-thymeleaf&#39;)
    runtime(&#39;mysql:mysql-connector-java&#39;)
    runtime(&#39;org.springframework.boot:spring-boot-starter-tomcat&#39;)
    testCompile(&#39;org.springframework.boot:spring-boot-starter-test&#39;)
    testCompile(&#39;org.springframework.security:spring-security-test&#39;)    
</code></pre><h2 id=创建用户表并插入数据>创建用户表并插入数据</h2><pre tabindex=0><code>    CREATE TABLE user (
      id       INT                  AUTO_INCREMENT PRIMARY KEY,
      username VARCHAR(45) NOT NULL,
      password VARCHAR(45) NOT NULL,
      enabled  INT         NOT NULL DEFAULT 1
    );
    
   
    INSERT INTO user (username, password, enabled) VALUES (&#39;username&#39;, &#39;password&#39;, TRUE);
</code></pre><h2 id=添加配置信息>添加配置信息</h2><pre tabindex=0><code>    spring.datasource.url=jdbc:mysql://localhost:3306/security?useSSL=false
    spring.datasource.username=security
    spring.datasource.password=security
    spring.datasource.driver-class-name=com.mysql.jdbc.Driver
    mybatis.type-aliases-package=cn.com.hellowood.springsecurity.mapper
    mybatis.mapper-locations=mappers/**Mapper.xml
</code></pre><h2 id=添加-security-配置文件>添加 Security 配置文件</h2><pre tabindex=0><code>    
    import cn.com.hellowood.springsecurity.security.CustomAuthenticationProvider;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
    import org.springframework.security.config.annotation.web.builders.HttpSecurity;
    import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
    import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
    
    @EnableWebSecurity
    public class SecurityConfig extends WebSecurityConfigurerAdapter {
    
        @Autowired
        private CustomAuthenticationProvider customAuthenticationProvider;
    
        @Override
        protected void configure(HttpSecurity http) throws Exception {
            // 所有请求均可访问
            http.authorizeRequests()
                    .antMatchers(&#34;/&#34;, &#34;/login&#34;, &#34;/login-error&#34;, &#34;/css/**&#34;, &#34;/index&#34;)
                    .permitAll();
            
            // 其余所有请求均需要权限
            http.authorizeRequests()
                    .anyRequest()
                    .authenticated();
    
            // 配置登录页面的表单 action 必须是 &#39;/login&#39;, 用户名和密码的参数名必须是 &#39;username&#39; 和 &#39;password&#39;，
            // 登录失败的 url 是 &#39;/login-error&#39;
            http.formLogin()
                    .loginPage(&#34;/login&#34;)
                    .loginProcessingUrl(&#34;/login&#34;)
                    .usernameParameter(&#34;username&#34;)
                    .passwordParameter(&#34;password&#34;)
                    .failureUrl(&#34;/login-error&#34;);
        }
    
        /**
         * Configure global.
         *
         * @param auth the auth
         * @throws Exception the exception
         */
        @Autowired
        public void configureGlobal(AuthenticationManagerBuilder auth) {
            // 使用自定义的 Authentication Provider
            auth.authenticationProvider(customAuthenticationProvider);
        }
    }
</code></pre><h2 id=添加自定义的-authentication-provider-类>添加自定义的 Authentication Provider 类</h2><pre tabindex=0><code>    import cn.com.hellowood.springsecurity.model.UserModel;
    import cn.com.hellowood.springsecurity.service.UserService;
    import org.slf4j.Logger;
    import org.slf4j.LoggerFactory;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.security.authentication.AccountExpiredException;
    import org.springframework.security.authentication.AuthenticationProvider;
    import org.springframework.security.authentication.BadCredentialsException;
    import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
    import org.springframework.security.core.Authentication;
    import org.springframework.security.core.AuthenticationException;
    import org.springframework.security.core.GrantedAuthority;
    import org.springframework.stereotype.Component;
    
    import javax.servlet.http.HttpSession;
    import java.util.ArrayList;
    import java.util.List;
    
    @Component
    public class CustomAuthenticationProvider implements AuthenticationProvider {
    
        private final Logger logger = LoggerFactory.getLogger(getClass());
    
        @Autowired
        private HttpSession session;
    
        @Autowired
        private UserService userService;
    
        /**
         * Validate user info is correct form database
         *
         * @param authentication
         * @return
         * @throws AuthenticationException
         */
        @Override
        public Authentication authenticate(Authentication authentication) throws AuthenticationException {
            String username = authentication.getName();
            String password = authentication.getCredentials().toString();
            List&lt;GrantedAuthority&gt; grantedAuthorities = new ArrayList&lt;&gt;();
    
            // 检查用户名密码是否正确
            UserModel user = userService.loadUserByUsernameAndPassword(username, password);
            if (user == null) {
                logger.error(&#34;{} login failed, username or password is wrong&#34;, username);
                throw new BadCredentialsException(&#34;Username or password is not correct&#34;);
            } else if (!user.getEnabled()) {
                throw new AccountExpiredException(&#34;Account had expired&#34;);
            }
    
            // 用户信息有效时将其放入 session 中
            session.setAttribute(&#34;user&#34;, user);
            Authentication auth = new UsernamePasswordAuthenticationToken(username, password, grantedAuthorities);
            return auth;
        }
    
    
        @Override
        public boolean supports(Class&lt;?&gt; authentication) {
            return authentication.equals(UsernamePasswordAuthenticationToken.class);
        }
    
    }
</code></pre><h2 id=添加校验用户信息所需要的类>添加校验用户信息所需要的类</h2><ul><li>添加 UserModel.java</li></ul><pre tabindex=0><code>
    public class UserModel {
    
        private Integer id;
    
        private String username;
    
        private String password;
    
        private Boolean enabled;
    
        /**
         * Instantiates a new User model.
         */
        public UserModel() {
        }
    
        /**
         * Instantiates a new User model.
         *
         * @param id       the id
         * @param username the username
         * @param password the password
         * @param enabled  the enabled
         */
        public UserModel(Integer id, String username, String password, Boolean enabled) {
            this.id = id;
            this.username = username;
            this.password = password;
            this.enabled = enabled;
        }
    
        /**
         * Gets id.
         *
         * @return the id
         */
        public Integer getId() {
            return id;
        }
    
        /**
         * Sets id.
         *
         * @param id the id
         */
        public void setId(Integer id) {
            this.id = id;
        }
    
        /**
         * Gets username.
         *
         * @return the username
         */
        public String getUsername() {
            return username;
        }
    
        /**
         * Sets username.
         *
         * @param username the username
         */
        public void setUsername(String username) {
            this.username = username;
        }
    
        /**
         * Gets password.
         *
         * @return the password
         */
        public String getPassword() {
            return password;
        }
    
        /**
         * Sets password.
         *
         * @param password the password
         */
        public void setPassword(String password) {
            this.password = password;
        }
    
        /**
         * Gets enabled.
         *
         * @return the enabled
         */
        public Boolean getEnabled() {
            return enabled;
        }
    
        /**
         * Sets enabled.
         *
         * @param enabled the enabled
         */
        public void setEnabled(Boolean enabled) {
            this.enabled = enabled;
        }
    
        @Override
        public String toString() {
            return &#34;UserModel{&#34; +
                    &#34;id=&#34; + id +
                    &#34;, username=&#39;&#34; + username + &#39;\&#39;&#39; +
                    &#34;, password=&#39;&#34; + password + &#39;\&#39;&#39; +
                    &#34;, enabled=&#34; + enabled +
                    &#39;}&#39;;
        }
    }
</code></pre><ul><li>添加 UserService.java</li></ul><pre tabindex=0><code>
    import cn.com.hellowood.springsecurity.mapper.UserMapper;
    import cn.com.hellowood.springsecurity.model.UserModel;
    import org.springframework.beans.factory.annotation.Autowired;
    import org.springframework.stereotype.Service;
    
    @Service(&#34;userService&#34;)
    public class UserService {
    
        @Autowired
        private UserMapper userMapper;
    
        /**
         * Load user by username and password user model.
         *
         * @param username the username
         * @param password the password
         * @return the user model
         */
        public UserModel loadUserByUsernameAndPassword(String username, String password) {
            return userMapper.getUserByUsernameAndPassword(username, password);
        }
    }
</code></pre><ul><li>添加 UserMapper.java</li></ul><pre tabindex=0><code>    import cn.com.hellowood.springsecurity.model.UserModel;
    import org.apache.ibatis.annotations.Mapper;
    import org.apache.ibatis.annotations.Param;
    
    @Mapper
    public interface UserMapper {
    
        /**
         * Gets user by username and password.
         *
         * @param username the username
         * @param password the password
         * @return the user by username and password
         */
        UserModel getUserByUsernameAndPassword(@Param(&#34;username&#34;) String username,
                                               @Param(&#34;password&#34;) String password);
    }
</code></pre><ul><li>添加 UserMapper.xml</li></ul><pre tabindex=0><code>    &lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;
    &lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34; &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34; &gt;
    &lt;mapper namespace=&#34;cn.com.hellowood.springsecurity.mapper.UserMapper&#34;&gt;
    
        &lt;resultMap id=&#34;baseResultMap&#34; type=&#34;cn.com.hellowood.springsecurity.model.UserModel&#34;&gt;
            &lt;id column=&#34;id&#34; property=&#34;id&#34; javaType=&#34;java.lang.Integer&#34; jdbcType=&#34;INTEGER&#34;&gt;&lt;/id&gt;
            &lt;result column=&#34;username&#34; property=&#34;username&#34; javaType=&#34;java.lang.String&#34; jdbcType=&#34;VARCHAR&#34;&gt;&lt;/result&gt;
            &lt;result column=&#34;password&#34; property=&#34;password&#34; javaType=&#34;java.lang.String&#34; jdbcType=&#34;VARCHAR&#34;&gt;&lt;/result&gt;
            &lt;result column=&#34;enabled&#34; property=&#34;enabled&#34; javaType=&#34;java.lang.Boolean&#34; jdbcType=&#34;INTEGER&#34;&gt;&lt;/result&gt;
        &lt;/resultMap&gt;
    
        &lt;select id=&#34;getUserByUsernameAndPassword&#34; resultType=&#34;cn.com.hellowood.springsecurity.model.UserModel&#34;&gt;
            SELECT
                id,
                username,
                password,
                enabled
            FROM user
            WHERE username = #{username, jdbcType=VARCHAR}
                  AND password = #{password, jdbcType=VARCHAR}
        &lt;/select&gt;
    &lt;/mapper&gt;
</code></pre><h2 id=添加页面>添加页面</h2><ul><li>index.html</li></ul><pre tabindex=0><code>    &lt;!DOCTYPE html&gt;
    &lt;html xmlns=&#34;http://www.w3.org/1999/xhtml&#34; xmlns:th=&#34;http://www.thymeleaf.org&#34;&gt;
    &lt;head&gt;
        &lt;title&gt;Spring Security&lt;/title&gt;
        &lt;meta charset=&#34;utf-8&#34;/&gt;
        &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1, shrink-to-fit=no&#34;/&gt;
        &lt;link rel=&#34;stylesheet&#34; href=&#34;/css/main.css&#34; th:href=&#34;@{/css/main.css}&#34;/&gt;
        &lt;link rel=&#34;stylesheet&#34; href=&#34;/css/bootstrap.min.css&#34; th:href=&#34;@{/css/bootstrap.min.css}&#34;/&gt;
    &lt;/head&gt;
    &lt;body&gt;
    &lt;div class=&#34;container&#34;&gt;
        &lt;form action=&#34;#&#34; class=&#34;form-signin&#34;&gt;
            &lt;h2 class=&#34;form-signin-heading&#34;&gt;Hello Spring Security&lt;/h2&gt;
            &lt;h5 class=&#34;form-signin-heading content-adjust&#34;&gt;Anyone can access this page&lt;/h5&gt;
            &lt;div th:if=&#34;${session.user} != null&#34;&gt;
                &lt;h5 class=&#34;form-signin-heading content-adjust&#34;&gt;Your username is &lt;span th:text=&#34;${session.user.username}&#34;&gt;&lt;/span&gt;&lt;/h5&gt;
                &lt;a href=&#34;/user/index&#34; th:href=&#34;@{/user/index}&#34; class=&#34;btn btn-success btn-block&#34;&gt;To Security page&lt;/a&gt;
            &lt;/div&gt;
            &lt;div th:if=&#34;${session.user} == null&#34;&gt;
                &lt;a href=&#34;/index&#34; th:href=&#34;@{/login}&#34; class=&#34;btn btn-primary btn-block&#34;&gt;To Login page&lt;/a&gt;
            &lt;/div&gt;
        &lt;/form&gt;
        &lt;div th:fragment=&#34;logout&#34; class=&#34;logout&#34; th:if=&#34;${session.user} != null&#34;&gt;
            &lt;form action=&#34;#&#34; th:action=&#34;@{/logout}&#34; method=&#34;post&#34; class=&#34;form-signin&#34;&gt;
                &lt;button class=&#34;btn btn-warning btn-block&#34; type=&#34;submit&#34;&gt;Log out&lt;/button&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;/body&gt;
    &lt;/html&gt;
</code></pre><ul><li>login.html</li></ul><pre tabindex=0><code>    &lt;!DOCTYPE html&gt;
    &lt;html xmlns=&#34;http://www.w3.org/1999/xhtml&#34; xmlns:th=&#34;http://www.thymeleaf.org&#34;&gt;
    &lt;head&gt;
        &lt;title&gt;Login page&lt;/title&gt;
        &lt;meta charset=&#34;utf-8&#34;/&gt;
        &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1, shrink-to-fit=no&#34;/&gt;
        &lt;link rel=&#34;stylesheet&#34; href=&#34;/css/main.css&#34; th:href=&#34;@{/css/main.css}&#34;/&gt;
        &lt;link rel=&#34;stylesheet&#34; href=&#34;/css/bootstrap.min.css&#34; th:href=&#34;@{/css/bootstrap.min.css}&#34;/&gt;
    &lt;/head&gt;
    &lt;body&gt;
    &lt;div class=&#34;container&#34;&gt;
        &lt;form th:action=&#34;@{/login}&#34; method=&#34;post&#34; class=&#34;form-signin&#34;&gt;
            &lt;h2 class=&#34;form-signin-heading&#34;&gt;Please sign in&lt;/h2&gt;
            &lt;div&gt;
                &lt;label for=&#34;username&#34; class=&#34;sr-only&#34;&gt;Username&lt;/label&gt;
                &lt;input type=&#34;text&#34; id=&#34;username&#34; name=&#34;username&#34;
                       th:class=&#34;${loginError} ? &#39;form-control is-invalid&#39; : &#39;form-control&#39;&#34; placeholder=&#34;Username&#34;
                       required=&#34;required&#34;
                       autofocus=&#34;autofocus&#34;/&gt;
                &lt;div class=&#34;invalid-feedback&#34; th:if=&#34;${loginError}&#34;&gt;
                    Wrong username or password
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div&gt;
                &lt;label for=&#34;password&#34; class=&#34;sr-only&#34;&gt;Password&lt;/label&gt;
                &lt;input type=&#34;password&#34; id=&#34;password&#34; name=&#34;password&#34; class=&#34;form-control&#34; placeholder=&#34;Password&#34;
                       required=&#34;required&#34;/&gt;
            &lt;/div&gt;
            &lt;button class=&#34;btn btn-success btn-block&#34; type=&#34;submit&#34;&gt;Sign in&lt;/button&gt;
            &lt;a href=&#34;/index&#34; th:href=&#34;@{/index}&#34; class=&#34;btn btn-primary btn-block&#34;&gt;Back to Home page&lt;/a&gt;
        &lt;/form&gt;
    &lt;/div&gt;
    &lt;/body&gt;
    &lt;/html&gt;
</code></pre><ul><li>user/index.html</li></ul><pre tabindex=0><code>    &lt;!DOCTYPE html&gt;
    &lt;html xmlns=&#34;http://www.w3.org/1999/xhtml&#34; xmlns:th=&#34;http://www.thymeleaf.org&#34;&gt;
    &lt;head&gt;
        &lt;title&gt;Spring Security&lt;/title&gt;
        &lt;meta charset=&#34;utf-8&#34;/&gt;
        &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1, shrink-to-fit=no&#34;/&gt;
        &lt;link rel=&#34;stylesheet&#34; href=&#34;/css/main.css&#34; th:href=&#34;@{/css/main.css}&#34;/&gt;
        &lt;link rel=&#34;stylesheet&#34; href=&#34;/css/bootstrap.min.css&#34; th:href=&#34;@{/css/bootstrap.min.css}&#34;/&gt;
    &lt;/head&gt;
    &lt;body&gt;
    &lt;div class=&#34;container&#34;&gt;
        &lt;form action=&#34;#&#34; class=&#34;form-signin&#34;&gt;
            &lt;h2 class=&#34;form-signin-heading&#34;&gt;Hello Spring Security&lt;/h2&gt;
            &lt;h5 class=&#34;form-signin-heading content-adjust&#34;&gt;Only logged in user can access this page&lt;/h5&gt;
            &lt;div th:if=&#34;${session.user} != null&#34;&gt;
                &lt;h5 class=&#34;form-signin-heading content-adjust&#34;&gt;Logged user is &lt;span th:text=&#34;${session.user.username}&#34;&gt;&lt;/span&gt;&lt;/h5&gt;
                &lt;a href=&#34;/index&#34; th:href=&#34;@{/index}&#34; class=&#34;btn btn-primary btn-block&#34;&gt;Back to Home page&lt;/a&gt;
            &lt;/div&gt;
        &lt;/form&gt;
        &lt;div th:substituteby=&#34;index::logout&#34;&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;/body&gt;
    &lt;/html&gt;
</code></pre><h2 id=添加-controller>添加 Controller</h2><pre tabindex=0><code>    import org.springframework.stereotype.Controller;
    import org.springframework.ui.Model;
    import org.springframework.web.bind.annotation.RequestMapping;
    
    @Controller
    public class MainController {
    
        /**
         * Root page.
         *
         * @return the index page url
         */
        @RequestMapping(&#34;/&#34;)
        public String root() {
            return &#34;redirect:/index&#34;;
        }
    
        /**
         * Index page.
         *
         * @return the index page url
         */
        @RequestMapping(&#34;/index&#34;)
        public String index() {
            return &#34;index&#34;;
        }
    
        /**
         * User index page.
         *
         * @return the user index page url
         */
        @RequestMapping(&#34;/user/index&#34;)
        public String userIndex() {
            return &#34;user/index&#34;;
        }
    
        /**
         * Login page.
         *
         * @return the login page url
         */
        @RequestMapping(&#34;/login&#34;)
        public String login() {
            return &#34;login&#34;;
        }
    
        /**
         * Login error page.
         *
         * @param model the model
         * @return the login error page url
         */
        @RequestMapping(&#34;/login-error&#34;)
        public String loginError(Model model) {
            model.addAttribute(&#34;loginError&#34;, true);
            return &#34;login&#34;;
        }
    
    }
</code></pre><hr><blockquote><p>启动应用，访问<a href=http://localhost:8080/user/index>http://localhost:8080/user/index</a>，此时没有登录，会被拦截并重定向到登录页面<a href=http://localhost:8080/login>http://localhost:8080/login</a>，输入用户名 <code>username</code> 和密码 <code>password</code>，登录成功后再次访问<a href=http://localhost:8080/user/index>http://localhost:8080/user/index</a>，此时该 url 可以正常访问，当输入错误的用户名或密码时会提示错误信息，说明 Spring Security 配置正确</p></blockquote></div><div class=prev-next></div><svg id="btt-button" class="arrow-logo" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script><div id=comments><script src=https://utteranc.es/client.js repo=helloworlde/helloworlde.github.io issue-term=title theme=github-light crossorigin=anonymous async></script></div></div></main><footer class=footer><span>&copy; 2024 hellowood.dev</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a></span></footer></body></html>