<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>OpenWrt 安装使用 OpenClash</title><meta charset=utf-8><meta name=description content="Ladder@OpenWrt 安装使用 OpenClash Clash 使用方式对比 OpenClash 是 Clash 的 OpenWrt 客户端；Clash 有多种使用方式，如直接使用客户端，或者以容器或进程的方式运行在服务器上，客户端以代理的方式使用，或者运行在 OpenWrt 中等；因为各种因素影响，不同的使用方式有不同的适用场景：
运行客户端 客户端直接使用的方式最灵活，调整代理方式或策略比较方便，可以选择性的开启或关闭，会代理设备上支持代理的所有流量；适用于手机，电脑等有客户端支持等设备
代理方式使用 代理方式适用于没有客户端软件的场景，如命令行，为特定的软件配置代理等；这种方式不够灵活，可按需为特定应用或设备配置
运行在OpenWrt 运行在 OpenWrt 等主路由或旁路由中，可以透明代理整个局域网内的流量，对于一些无法直接操作的 IoT 设备非常方便；也不需要修改客户端任何配置；缺点是如果不稳定会影响局域网内的所有设备
安装 需要使用 Clash 配置网络，用于访问特定的资源；OpenClash 是 Openwrt 的 Clash 客户端；
OpenClash 依赖的是 dnsmasq-full，所以需要移除默认的dnsmasq，否则会导致 OpenClash 安装失败 opkg remove dnsmasq && opkg install dnsmasq-full 下载并安装 OpenClash 可以在 OpenClash 仓库的 Release 页面选择对应的版本进行下载
wget https://github.com/vernesong/OpenClash/releases/download/v0.45.35-beta/luci-app-openclash_0.45.35-beta_all.ipk -O openclash.ipk opkg update opkg install openclash.ipk 添加 luci-compact 并重启，否则会提示进入 luci 页面错误 opkg install luci luci-base luci-compat reboot 待重启完成后重新登录控制台，可以在服务菜单中看到 OpenClash"><meta name=author content="HelloWood"><link rel=canonical href=https://blog.hellowood.dev/posts/openwrt-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8-openclash/><meta name=google-site-verification content="G-3MSGPYTHPZ"><link rel=alternate type=application/rss+xml href=https://blog.hellowood.dev/index.xml title=HelloWood><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ",{anonymize_ip:!1})}</script><script async defer data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301 src=https://umami.hellowood.dev/script.js></script>
<script defer data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}' src=https://static.cloudflareinsights.com/beacon.min.js></script><meta property="og:title" content="OpenWrt  安装使用 OpenClash"><meta property="og:description" content="OpenWrt 安装使用 OpenClash Clash 使用方式对比 OpenClash 是 Clash 的 OpenWrt 客户端；Clash 有多种使用方式，如直接使用客户端，或者以容器或进程的方式运行在服务器上，客户端以代理的方式使用，或者运行在 OpenWrt 中等；因为各种因素影响，不同的使用方式有不同的适用场景：
运行客户端 客户端直接使用的方式最灵活，调整代理方式或策略比较方便，可以选择性的开启或关闭，会代理设备上支持代理的所有流量；适用于手机，电脑等有客户端支持等设备
代理方式使用 代理方式适用于没有客户端软件的场景，如命令行，为特定的软件配置代理等；这种方式不够灵活，可按需为特定应用或设备配置
运行在OpenWrt 运行在 OpenWrt 等主路由或旁路由中，可以透明代理整个局域网内的流量，对于一些无法直接操作的 IoT 设备非常方便；也不需要修改客户端任何配置；缺点是如果不稳定会影响局域网内的所有设备
安装 需要使用 Clash 配置网络，用于访问特定的资源；OpenClash 是 Openwrt 的 Clash 客户端；
OpenClash 依赖的是 dnsmasq-full，所以需要移除默认的dnsmasq，否则会导致 OpenClash 安装失败 opkg remove dnsmasq && opkg install dnsmasq-full 下载并安装 OpenClash 可以在 OpenClash 仓库的 Release 页面选择对应的版本进行下载
wget https://github.com/vernesong/OpenClash/releases/download/v0.45.35-beta/luci-app-openclash_0.45.35-beta_all.ipk -O openclash.ipk opkg update opkg install openclash.ipk 添加 luci-compact 并重启，否则会提示进入 luci 页面错误 opkg install luci luci-base luci-compat reboot 待重启完成后重新登录控制台，可以在服务菜单中看到 OpenClash"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.hellowood.dev/posts/openwrt-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8-openclash/"><meta property="article:section" content="posts"><meta name=twitter:card content="summary"><meta name=twitter:title content="OpenWrt  安装使用 OpenClash"><meta name=twitter:description content="OpenWrt 安装使用 OpenClash Clash 使用方式对比 OpenClash 是 Clash 的 OpenWrt 客户端；Clash 有多种使用方式，如直接使用客户端，或者以容器或进程的方式运行在服务器上，客户端以代理的方式使用，或者运行在 OpenWrt 中等；因为各种因素影响，不同的使用方式有不同的适用场景：
运行客户端 客户端直接使用的方式最灵活，调整代理方式或策略比较方便，可以选择性的开启或关闭，会代理设备上支持代理的所有流量；适用于手机，电脑等有客户端支持等设备
代理方式使用 代理方式适用于没有客户端软件的场景，如命令行，为特定的软件配置代理等；这种方式不够灵活，可按需为特定应用或设备配置
运行在OpenWrt 运行在 OpenWrt 等主路由或旁路由中，可以透明代理整个局域网内的流量，对于一些无法直接操作的 IoT 设备非常方便；也不需要修改客户端任何配置；缺点是如果不稳定会影响局域网内的所有设备
安装 需要使用 Clash 配置网络，用于访问特定的资源；OpenClash 是 Openwrt 的 Clash 客户端；
OpenClash 依赖的是 dnsmasq-full，所以需要移除默认的dnsmasq，否则会导致 OpenClash 安装失败 opkg remove dnsmasq && opkg install dnsmasq-full 下载并安装 OpenClash 可以在 OpenClash 仓库的 Release 页面选择对应的版本进行下载
wget https://github.com/vernesong/OpenClash/releases/download/v0.45.35-beta/luci-app-openclash_0.45.35-beta_all.ipk -O openclash.ipk opkg update opkg install openclash.ipk 添加 luci-compact 并重启，否则会提示进入 luci 页面错误 opkg install luci luci-base luci-compat reboot 待重启完成后重新登录控制台，可以在服务菜单中看到 OpenClash"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://blog.hellowood.dev/posts/"},{"@type":"ListItem","position":3,"name":"OpenWrt  安装使用 OpenClash","item":"https://blog.hellowood.dev/posts/openwrt-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8-openclash/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"OpenWrt  安装使用 OpenClash","name":"OpenWrt  安装使用 OpenClash","description":"OpenWrt 安装使用 OpenClash Clash 使用方式对比 OpenClash 是 Clash 的 OpenWrt 客户端；Clash 有多种使用方式，如直接使用客户端，或者以容器或进程的方式运行在服务器上，客户端以代理的方式使用，或者运行在 OpenWrt 中等；因为各种因素影响，不同的使用方式有不同的适用场景：\n运行客户端 客户端直接使用的方式最灵活，调整代理方式或策略比较方便，可以选择性的开启或关闭，会代理设备上支持代理的所有流量；适用于手机，电脑等有客户端支持等设备\n代理方式使用 代理方式适用于没有客户端软件的场景，如命令行，为特定的软件配置代理等；这种方式不够灵活，可按需为特定应用或设备配置\n运行在OpenWrt 运行在 OpenWrt 等主路由或旁路由中，可以透明代理整个局域网内的流量，对于一些无法直接操作的 IoT 设备非常方便；也不需要修改客户端任何配置；缺点是如果不稳定会影响局域网内的所有设备\n安装 需要使用 Clash 配置网络，用于访问特定的资源；OpenClash 是 Openwrt 的 Clash 客户端；\nOpenClash 依赖的是 dnsmasq-full，所以需要移除默认的dnsmasq，否则会导致 OpenClash 安装失败 opkg remove dnsmasq \u0026amp;\u0026amp; opkg install dnsmasq-full 下载并安装 OpenClash 可以在 OpenClash 仓库的 Release 页面选择对应的版本进行下载\nwget https://github.com/vernesong/OpenClash/releases/download/v0.45.35-beta/luci-app-openclash_0.45.35-beta_all.ipk -O openclash.ipk opkg update opkg install openclash.ipk 添加 luci-compact 并重启，否则会提示进入 luci 页面错误 opkg install luci luci-base luci-compat reboot 待重启完成后重新登录控制台，可以在服务菜单中看到 OpenClash","keywords":["OpenClash","Clash","HomeLab","OpenWrt"],"articleBody":"OpenWrt 安装使用 OpenClash Clash 使用方式对比 OpenClash 是 Clash 的 OpenWrt 客户端；Clash 有多种使用方式，如直接使用客户端，或者以容器或进程的方式运行在服务器上，客户端以代理的方式使用，或者运行在 OpenWrt 中等；因为各种因素影响，不同的使用方式有不同的适用场景：\n运行客户端 客户端直接使用的方式最灵活，调整代理方式或策略比较方便，可以选择性的开启或关闭，会代理设备上支持代理的所有流量；适用于手机，电脑等有客户端支持等设备\n代理方式使用 代理方式适用于没有客户端软件的场景，如命令行，为特定的软件配置代理等；这种方式不够灵活，可按需为特定应用或设备配置\n运行在OpenWrt 运行在 OpenWrt 等主路由或旁路由中，可以透明代理整个局域网内的流量，对于一些无法直接操作的 IoT 设备非常方便；也不需要修改客户端任何配置；缺点是如果不稳定会影响局域网内的所有设备\n安装 需要使用 Clash 配置网络，用于访问特定的资源；OpenClash 是 Openwrt 的 Clash 客户端；\nOpenClash 依赖的是 dnsmasq-full，所以需要移除默认的dnsmasq，否则会导致 OpenClash 安装失败 opkg remove dnsmasq \u0026\u0026 opkg install dnsmasq-full 下载并安装 OpenClash 可以在 OpenClash 仓库的 Release 页面选择对应的版本进行下载\nwget https://github.com/vernesong/OpenClash/releases/download/v0.45.35-beta/luci-app-openclash_0.45.35-beta_all.ipk -O openclash.ipk opkg update opkg install openclash.ipk 添加 luci-compact 并重启，否则会提示进入 luci 页面错误 opkg install luci luci-base luci-compat reboot 待重启完成后重新登录控制台，可以在服务菜单中看到 OpenClash\n配置 配置文件订阅 进入服务-OpenClash，选择配置文件订阅，新增订阅；输入订阅的链接地址，保存并更新即可；这样以 OpenWrt 为网关的设备就可以通过 OpenClash 访问特定的资源了\n配置 DNS OpenClash 默认提供 7874 端口用于 DNS 查询；启动后会劫持 Dnsmasq，只保留自己作为 Dnsmasq 的上游；\n但是目前的版本里并没有将已配置的 DNS 转发作为 OpenClash 的上游（参考issue 启用 DNS 劫持后未将 Dnsmasq 中添加的 DNS 转发作为上游 DNS），这样会导致无法使用 SmartDNS 或其他上游 DNS，因此需要手动修改将 SmartDNS 作为 OpenClash 的上游服务器\n配置 DNS 服务器 在 服务- OpenClash-全局设置-DNS设置中，选择新增，设置自定义上游 DNS服务器为 SmartDNS 启用自定义上游 DNS 服务器 新增完成后，在该页面选择启用 “自定义上游 DNS 服务器”，这样，就可以使用 SmartDNS 作为主 DNS服务器了；如果有其他的上游，也可以同样配置； 配置完成后，DNS的查询流程为 客户端 -\u003e Dnsmasq -\u003e OpenClash -\u003e SmartDNS -\u003e 上游 DNS 服务器\n配置运行模式 参考 OpenClash-常规设置，主要有 Fake-IP 和 Redir-Host 两种模式；经测试，开启了 OpenClash 使用 Redir-Host 会导致部分 UDP 流量超时，如王者荣耀/英雄联盟/吃鸡等使用 UDP 的应用超时或无法连接；使用 Fake-IP TUN 模式则可以正常使用\nFake-IP 当客户端发起请求查询 DNS 时，会先返回一个随机的保留地址，同时查询上游 DNS 服务器，如果需要代理则发送给代理服务器查询，然后再进行连接；客户端立即向Fake-IP 发起的请求会被快速响应，节约了一次本地向DNS服务器查询的时间\n运行模式有 TUN，增强和混合三种模式；区别在与 TUN 可以代理 UDP流量\n这个模式会导致客户端获取到的 DNS 查询到的结果与实际不一致，nslookup/dig等的使用会受影响\nRedir-Host 当客户端发起请求时，会并发查询 DNS，等待返回结果后再尝试进行规则判定和连接，如果需要代理，会使用fallback 的 DNS 服务器再次查询；与不使用 OpenClash 相比，多了过滤，fallback 查询的时间，响应速度可能会变慢\n有兼容，TUN 和混合三种模式，区别在与 TUN 可以代理 UDP流量\n","wordCount":"189","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"HelloWood"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.hellowood.dev/posts/openwrt-%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8-openclash/"},"publisher":{"@type":"Organization","name":"HelloWood","logo":{"@type":"ImageObject","url":"https://blog.hellowood.dev/favicon.ico"}}}</script><link rel=icon href=/images/avatar.png sizes=16x16><link rel=apple-touch-icon href=/images/avatar.png><link rel=manifest href=/images/avatar.png><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.ff1bc260fafbfb440e10194d7d06d57eb5e85eed11d12d06255581262664204e.css integrity="sha256-/xvCYPr7+0QOEBlNfQbVfrXoXu0R0S0GJVWBJiZkIE4=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.872dfd2cd00064018a833a6e8e77a0fbf8fbac159546f2f205d4dad79a5d8e15.js></script>
<script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand data-umami-event=navigation-brand href=/>HOME</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Blog href=/posts>Blog</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Tags href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Archive href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Dashboard href=https://umami.hellowood.dev/share/lab/Blog>Dashboard</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link data-umami-event=navigation-social href=https://github.com/helloworlde><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button data-umami-event=toggle-theme aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>OpenWrt 安装使用 OpenClash</h1></header><p><small>January 1, 1&nbsp;· 189 words&nbsp;· One minute</small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#clash-使用方式对比>Clash 使用方式对比</a></li><li><a href=#安装>安装</a></li><li><a href=#配置>配置</a><ul><li><a href=#配置文件订阅>配置文件订阅</a></li><li><a href=#配置-dns>配置 DNS</a></li><li><a href=#配置运行模式>配置运行模式</a></li></ul></li></ul></nav></div><section class=blog-content><h1 id=openwrt-安装使用-openclash>OpenWrt 安装使用 OpenClash</h1><h2 id=clash-使用方式对比>Clash 使用方式对比</h2><p>OpenClash 是 Clash 的 OpenWrt 客户端；Clash 有多种使用方式，如直接使用客户端，或者以容器或进程的方式运行在服务器上，客户端以代理的方式使用，或者运行在 OpenWrt 中等；因为各种因素影响，不同的使用方式有不同的适用场景：</p><ul><li>运行客户端</li></ul><p>客户端直接使用的方式最灵活，调整代理方式或策略比较方便，可以选择性的开启或关闭，会代理设备上支持代理的所有流量；适用于手机，电脑等有客户端支持等设备</p><ul><li>代理方式使用</li></ul><p>代理方式适用于没有客户端软件的场景，如命令行，为特定的软件配置代理等；这种方式不够灵活，可按需为特定应用或设备配置</p><ul><li>运行在OpenWrt</li></ul><p>运行在 OpenWrt 等主路由或旁路由中，可以透明代理整个局域网内的流量，对于一些无法直接操作的 IoT 设备非常方便；也不需要修改客户端任何配置；缺点是如果不稳定会影响局域网内的所有设备</p><h2 id=安装>安装</h2><p>需要使用 Clash 配置网络，用于访问特定的资源；<a href=https://github.com/vernesong/OpenClash>OpenClash</a> 是 Openwrt 的 Clash 客户端；</p><ol><li>OpenClash 依赖的是 <code>dnsmasq-full</code>，所以需要移除默认的<code>dnsmasq</code>，否则会导致 OpenClash 安装失败</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>opkg remove dnsmasq <span style=color:#f92672>&amp;&amp;</span> opkg install dnsmasq-full
</span></span></code></pre></div><ol start=2><li>下载并安装 OpenClash</li></ol><p>可以在 <a href=https://github.com/vernesong/OpenClash>OpenClash</a> 仓库的 <a href=https://github.com/vernesong/OpenClash/releases>Release</a> 页面选择对应的版本进行下载</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://github.com/vernesong/OpenClash/releases/download/v0.45.35-beta/luci-app-openclash_0.45.35-beta_all.ipk -O openclash.ipk
</span></span><span style=display:flex><span>opkg update
</span></span><span style=display:flex><span>opkg install openclash.ipk
</span></span></code></pre></div><ol start=3><li>添加 <code>luci-compact</code> 并重启，否则会提示进入 luci 页面错误</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>opkg install luci luci-base luci-compat
</span></span><span style=display:flex><span>reboot
</span></span></code></pre></div><p>待重启完成后重新登录控制台，可以在服务菜单中看到 <code>OpenClash</code></p><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/picture/homelab-openwrt-openclash-init-page.png alt=homelab-openwrt-openclash-init-page.png></p><h2 id=配置>配置</h2><h3 id=配置文件订阅>配置文件订阅</h3><p>进入服务-OpenClash，选择配置文件订阅，新增订阅；输入订阅的链接地址，保存并更新即可；这样以 OpenWrt 为网关的设备就可以通过 OpenClash 访问特定的资源了</p><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/picture/homelab-openwrt-init-openclash-config.png alt=homelab-openwrt-init-openclash-config.png></p><h3 id=配置-dns>配置 DNS</h3><p>OpenClash 默认提供 7874 端口用于 DNS 查询；启动后会劫持 Dnsmasq，只保留自己作为 Dnsmasq 的上游；</p><p>但是目前的版本里并没有将已配置的 DNS 转发作为 OpenClash 的上游（参考issue <a href=https://github.com/vernesong/OpenClash/issues/2720>启用 DNS 劫持后未将 Dnsmasq 中添加的 DNS 转发作为上游 DNS</a>），这样会导致无法使用 SmartDNS 或其他上游 DNS，因此需要手动修改将 SmartDNS 作为 OpenClash 的上游服务器</p><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/picture/homelab-openwrt-openclash-dnsmasq-upstream.png alt=homelab-openwrt-openclash-dnsmasq-upstream.png></p><ul><li>配置 DNS 服务器</li></ul><p>在 服务- OpenClash-全局设置-DNS设置中，选择新增，设置自定义上游 DNS服务器为 SmartDNS
<img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/picture/homelab-openwrt-openclash-add-upstream.png alt=homelab-openwrt-openclash-add-upstream.png></p><ul><li>启用自定义上游 DNS 服务器</li></ul><p>新增完成后，在该页面选择启用 &ldquo;自定义上游 DNS 服务器&rdquo;，这样，就可以使用 SmartDNS 作为主 DNS服务器了；如果有其他的上游，也可以同样配置；
<img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/picture/homelab-openwrt-openclash-enable-dns-config.png alt=homelab-openwrt-openclash-enable-dns-config.png>
配置完成后，DNS的查询流程为 客户端 -> Dnsmasq -> OpenClash -> SmartDNS -> 上游 DNS 服务器</p><h3 id=配置运行模式>配置运行模式</h3><p>参考 <a href=https://github.com/vernesong/OpenClash/wiki/%E5%B8%B8%E8%A7%84%E8%AE%BE%E7%BD%AE>OpenClash-常规设置</a>，主要有 Fake-IP 和 Redir-Host 两种模式；经测试，开启了 OpenClash 使用 Redir-Host 会导致部分 UDP 流量超时，如王者荣耀/英雄联盟/吃鸡等使用 UDP 的应用超时或无法连接；使用 Fake-IP TUN 模式则可以正常使用</p><ul><li>Fake-IP</li></ul><p>当客户端发起请求查询 DNS 时，会先返回一个随机的保留地址，同时查询上游 DNS 服务器，如果需要代理则发送给代理服务器查询，然后再进行连接；客户端立即向Fake-IP 发起的请求会被快速响应，节约了一次本地向DNS服务器查询的时间</p><p>运行模式有 TUN，增强和混合三种模式；区别在与 TUN 可以代理 UDP流量</p><p>这个模式会导致客户端获取到的 DNS 查询到的结果与实际不一致，<code>nslookup</code>/<code>dig</code>等的使用会受影响</p><ul><li>Redir-Host</li></ul><p>当客户端发起请求时，会并发查询 DNS，等待返回结果后再尝试进行规则判定和连接，如果需要代理，会使用fallback 的 DNS 服务器再次查询；与不使用 OpenClash 相比，多了过滤，fallback 查询的时间，响应速度可能会变慢</p><p>有兼容，TUN 和混合三种模式，区别在与 TUN 可以代理 UDP流量</p><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/picture/homelab-openwrt-openclash-change-mode.png alt=homelab-openwrt-openclash-change-mode.png></p></section><div class=paginator><a class=prev href=https://blog.hellowood.dev/posts/docker-%E4%BD%BF%E7%94%A8-nfs-%E4%BD%9C%E4%B8%BA%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AD%98%E5%82%A8/><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg><span>Docker 使用 NFS 作为数据卷存储</span></a>
<a class=next href=https://blog.hellowood.dev/posts/ubuntu-22-%E8%AE%BE%E7%BD%AE%E9%9D%99%E6%80%81-ip/><span>Ubuntu 22 设置静态 IP</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div></article></div><footer class=footer><p>&copy; 2023 <a href=https://blog.hellowood.dev>HelloWood</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank data-umami-event=to-hugo>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank data-umami-event=to-ladder>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g data-umami-event=top-link><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg></a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>