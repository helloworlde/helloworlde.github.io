<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>基于 Frigate 使用 Double Take 和 DeepStack 对视频监控进行人脸识别</title>
<meta name=description content="Double Take 是一个训练和识别人脸的工具，支持对 Frigate 中检测到的人物对象进行人脸识别，可以用于统计监控中出现的人物信息。不过经过测试，只适用于门禁、闸机等有清晰人脸的场景，日常的监控因安装位置、角度等原因无法提供清晰的人脸，因此识别的准确度和有效性并不高

Double Take …"><meta name=keywords content='blog,hugo,NVR,HomeLab,Frigate'><meta property="og:url" content="https://blog.hellowood.dev/posts/%E5%9F%BA%E4%BA%8E-frigate-%E4%BD%BF%E7%94%A8-double-take-%E5%92%8C-deepstack-%E5%AF%B9%E8%A7%86%E9%A2%91%E7%9B%91%E6%8E%A7%E8%BF%9B%E8%A1%8C%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/"><meta property="og:type" content="website"><meta property="og:title" content="基于 Frigate 使用 Double Take 和 DeepStack 对视频监控进行人脸识别"><meta property="og:description" content="Double Take 是一个训练和识别人脸的工具，支持对 Frigate 中检测到的人物对象进行人脸识别，可以用于统计监控中出现的人物信息。不过经过测试，只适用于门禁、闸机等有清晰人脸的场景，日常的监控因安装位置、角度等原因无法提供清晰的人脸，因此识别的准确度和有效性并不高

Double Take …"><meta property="og:image" content="https://blog.hellowood.dev/images/avatar.webp"><meta property="og:image:secure_url" content="https://blog.hellowood.dev/images/avatar.webp"><link rel=canonical href=https://blog.hellowood.dev/posts/%E5%9F%BA%E4%BA%8E-frigate-%E4%BD%BF%E7%94%A8-double-take-%E5%92%8C-deepstack-%E5%AF%B9%E8%A7%86%E9%A2%91%E7%9B%91%E6%8E%A7%E8%BF%9B%E8%A1%8C%E4%BA%BA%E8%84%B8%E8%AF%86%E5%88%AB/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.9a920d7dabdbad8363b6a0a94e29a9dfebdb7ee64cfcb193a0145e512ef2bdab.js integrity="sha256-mpINfavbrYNjtqCpTimp3+vbfuZM/LGToBReUS7yvas="></script><script defer src=https://umami.hellowood.dev/script.js data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301></script><script defer src=https://cloud.umami.is/script.js data-website-id=73ff1c8c-9938-43cf-81af-e77e26b0cca3></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}'></script><meta name=google-adsense-account content="ca-pub-3401351766168985"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3401351766168985" crossorigin=anonymous></script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jtbhx98g62")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ")</script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://blog.hellowood.dev/><img src=/images/avatar.webp alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://blog.hellowood.dev/>HelloWood</a></div><div class=nav-links><div class=nav-link><a href=https://blog.hellowood.dev/><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://blog.hellowood.dev/posts/><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://blog.hellowood.dev/tags/><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://github.com/helloworlde><span data-feather=github></span></a></div><div class=nav-link><a href=https://umami.hellowood.dev/share/lab/Blog><span data-feather=pie-chart></span></a></div><div class=nav-link><a href=https://blog.hellowood.dev/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target"></span>
<a><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://blog.hellowood.dev/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://blog.hellowood.dev/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://blog.hellowood.dev/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://github.com/helloworlde><span data-feather=github></span></a></li><li class=nav-item><a href=https://umami.hellowood.dev/share/lab/Blog><span data-feather=pie-chart></span></a></li><li class=nav-item><a href=https://blog.hellowood.dev/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>基于 Frigate 使用 Double Take 和 DeepStack 对视频监控进行人脸识别</h1><small role=doc-subtitle></small><p class=post-date>2024-08-08
| Updated 2024-09-09</p><ul class=post-tags><li class=post-tag><a href=https://blog.hellowood.dev/tags/nvr>NVR</a></li><li class=post-tag><a href=https://blog.hellowood.dev/tags/homelab>HomeLab</a></li><li class=post-tag><a href=https://blog.hellowood.dev/tags/frigate>Frigate</a></li></ul></div><div class=post-content><p>Double Take 是一个训练和识别人脸的工具，支持对 Frigate 中检测到的人物对象进行人脸识别，可以用于统计监控中出现的人物信息。不过经过测试，只适用于门禁、闸机等有清晰人脸的场景，日常的监控因安装位置、角度等原因无法提供清晰的人脸，因此识别的准确度和有效性并不高</p><p><img src=https://img.hellowood.dev/picture/homelab-frigate-double-take-face-double-take-detect.png alt=homelab-frigate-double-take-face-double-take-detect.png></p><p>Double Take 的原理是通过监听 Frigate 识别到对象后发出的 MQTT 消息，根据消息获取对应事件的快照，并将其发送给识别的服务，如 Deepstack/CodeProject.AI 等，然后根据识别结果显示该事件中出现的人脸信息</p><p>Double Take 作者似乎已经放弃维护了，上次更新还是在两年前(2022-10-28)，尽管作者在今年的一月份(2024-1-7)声明计划<a href=https://github.com/jakowenko/double-take/issues/343>开发 2.0 版本</a>，但是截止到8月份也没有任何进展，看起来作者在21年成为 24G.com 这家公司的 DevOps 总监后便没有精力投入到开源项目中了；不过，另外一位作者 skrashevich 在其 fork 的仓库 <a href=https://github.com/skrashevich/double-take>skrashevich/double-take</a>中提交了不少 2.0 版本的计划的功能</p><h2 id=部署依赖服务>部署依赖服务</h2><p>Double Take 依赖 Frigate、MQTT 和人脸识别服务，部署在使用 Intel CPU 的 NUC 上，系统是 Ubuntu 22，地址是 192.168.31.254</p><h3 id=部署-mqtt>部署 MQTT</h3><p>MQTT 使用 emqx 提供的镜像进行部署，方便本地使用，参考<a href=https://docs.emqx.com/zh/emqx/latest/deploy/install-docker-ce.html>通过 Docker 运行 EMQX</a></p><ul><li>docker-compose.yaml</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#e06c75>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>mqtt</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>image</span>: <span style=color:#98c379>emqx/emqx</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>container_name</span>: <span style=color:#98c379>mqtt</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>restart</span>: <span style=color:#98c379>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;1883:1883&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;8083:8083&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;8084:8084&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;8883:8883&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;18083:18083&#34;</span>
</span></span></code></pre></div><p>启动后访问 18083端口，<a href=http://192.168.31.254:18083/>http://192.168.31.254:18083/</a>，默认的用户名密码是 <code>admin</code>，密码是 <code>public</code></p><p><img src=https://img.hellowood.dev/picture/homelab-frigate-double-take-face-mqtt.png alt=homelab-frigate-double-take-face-mqtt.png></p><h3 id=部署-frigate>部署 Frigate</h3><p>为了快速使用，Frigate 使用 Intel GPU 进行识别，如果监控不多，大多数的 NUC 和台式机都是可以满足识别诉求</p><ul><li><code>docker-compose.yaml</code></li></ul><p>将显卡挂载到容器中，用于对象识别；同时将数据目录映射到宿主机，保存相关的数据，避免容器销毁后数据丢失</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#e06c75>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>frigate</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>container_name</span>: <span style=color:#98c379>frigate</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>privileged</span>: <span style=color:#b756ff;font-weight:700>true</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>restart</span>: <span style=color:#98c379>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>image</span>: <span style=color:#98c379>ghcr.io/blakeblackshear/frigate:stable</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>shm_size</span>: <span style=color:#98c379>512mb</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>devices</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>/dev/dri/renderD128</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>/etc/localtime:/etc/localtime:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#98c379>./config/:/config</span>
</span></span><span style=display:flex><span>      - <span style=color:#98c379>./data/db/:/data/db</span>
</span></span><span style=display:flex><span>      - <span style=color:#98c379>./data/storage:/media/frigate</span>
</span></span><span style=display:flex><span>      - <span style=color:#e06c75>type</span>: <span style=color:#98c379>tmpfs</span>
</span></span><span style=display:flex><span>        <span style=color:#e06c75>target</span>: <span style=color:#98c379>/tmp/cache</span>
</span></span><span style=display:flex><span>        <span style=color:#e06c75>tmpfs</span>:
</span></span><span style=display:flex><span>          <span style=color:#e06c75>size</span>: <span style=color:#d19a66>1000000000</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#d19a66>5000</span>:<span style=color:#d19a66>5000</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>TZ=Asia/Shanghai</span>
</span></span></code></pre></div><ul><li><code>config/config.yml</code></li></ul><p>Frigate 的配置文件，详细参考 <a href=https://docs.frigate.video/configuration/reference/>Full Reference Config</a></p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#e06c75>mqtt</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>enabled</span>: <span style=color:#b756ff;font-weight:700>True</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>host</span>: <span style=color:#d19a66>192.168.31.254</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>port</span>: <span style=color:#d19a66>1883</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>database</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>path</span>: <span style=color:#98c379>/data/db/frigate.db</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># 监听 RTSP 地址</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>cameras</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>door</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>ffmpeg</span>:
</span></span><span style=display:flex><span>      <span style=color:#e06c75>inputs</span>:
</span></span><span style=display:flex><span>        - <span style=color:#e06c75>path</span>: <span style=color:#98c379>rtsp://admin:12345678@192.168.2.252:554/stream1&amp;channel=1</span>
</span></span><span style=display:flex><span>          <span style=color:#e06c75>roles</span>:
</span></span><span style=display:flex><span>            - <span style=color:#98c379>record</span>
</span></span><span style=display:flex><span>            - <span style=color:#98c379>detect</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># 使用 GPU 进行检测</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>detectors</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>ov</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>type</span>: <span style=color:#98c379>openvino</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>device</span>: <span style=color:#98c379>GPU</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># OpenVINO 需要指定模型信息</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>model</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>width</span>: <span style=color:#d19a66>300</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>height</span>: <span style=color:#d19a66>300</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>input_tensor</span>: <span style=color:#98c379>nhwc</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>input_pixel_format</span>: <span style=color:#98c379>bgr</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>path</span>: <span style=color:#98c379>/openvino-model/ssdlite_mobilenet_v2.xml</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>labelmap_path</span>: <span style=color:#98c379>/openvino-model/coco_91cl_bkgr.txt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># 使用 GPU 加速 ffmpeg</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>ffmpeg</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>hwaccel_args</span>: <span style=color:#98c379>preset-vaapi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># 检测对象</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>objects</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>track</span>:
</span></span><span style=display:flex><span>    - <span style=color:#98c379>person</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># 保留快照</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>snapshots</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>enabled</span>: <span style=color:#b756ff;font-weight:700>True</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>bounding_box</span>: <span style=color:#b756ff;font-weight:700>False</span>
</span></span></code></pre></div><p>启动后，访问 <a href=http://192.168.31.254:5000>http://192.168.31.254:5000</a> 进入 Frigate
<img src=https://img.hellowood.dev/picture/homelab-frigate-double-take-face-frigate.png alt=homelab-frigate-double-take-face-frigate.png></p><h2 id=人脸识别服务>人脸识别服务</h2><p>Double Take 支持多种探测器，分别是：CompreFace、Amazon Rekognition、DeepStack、CodeProject.AI Server 和 Facebox(Machine Box)，其中 Amazon Rekognition 和 Facebox(Machine Box) 需要上传或者上传部分数据，不符合隐私保护的诉求；其他项目对比如下</p><table><thead><tr><th style=text-align:left>对比项目</th><th style=text-align:left>CompreFace</th><th style=text-align:left>DeepStack</th><th style=text-align:left>CodeProject.AI Server</th></tr></thead><tbody><tr><td style=text-align:left>图形化界面</td><td style=text-align:left>有</td><td style=text-align:left>无</td><td style=text-align:left>有</td></tr><tr><td style=text-align:left>支持模型</td><td style=text-align:left>人脸相关模型</td><td style=text-align:left>人脸检测、对象识别、对象分类</td><td style=text-align:left>人脸检测、对象识别、对象分类、自定义模型</td></tr><tr><td style=text-align:left>自定义模型</td><td style=text-align:left>不支持</td><td style=text-align:left>支持自定义模型</td><td style=text-align:left>支持自定义模型</td></tr><tr><td style=text-align:left>最后更新时间</td><td style=text-align:left>2023-11-14</td><td style=text-align:left>2022-07-01</td><td style=text-align:left>2024-05-22</td></tr><tr><td style=text-align:left>是否支持 GPU</td><td style=text-align:left>支持</td><td style=text-align:left>支持</td><td style=text-align:left>支持</td></tr><tr><td style=text-align:left>加速器支持</td><td style=text-align:left>不支持</td><td style=text-align:left>Jetson</td><td style=text-align:left>Google Coral TPU</td></tr><tr><td style=text-align:left>人脸检测</td><td style=text-align:left>检测不准确，需有明确人脸</td><td style=text-align:left>检测准确，正脸/侧脸均可识别</td><td style=text-align:left>检测准确，正脸/侧脸均可识别</td></tr><tr><td style=text-align:left>人脸识别</td><td style=text-align:left>准确度高</td><td style=text-align:left>小面积人脸识别不准确</td><td style=text-align:left>小面积人脸识别不准确</td></tr></tbody></table><p>DeepStack 使用最简单，因此使用 DeepStack 进行测试</p><ul><li>docker-compose.yaml</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#e06c75>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>deepstack</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>image</span>: <span style=color:#98c379>deepquestai/deepstack</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>container_name</span>: <span style=color:#98c379>deepstack</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>restart</span>: <span style=color:#98c379>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>VISION-FACE=True</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>./data:/datastore</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;5002:5000&#34;</span>
</span></span></code></pre></div><h2 id=double-take>Double Take</h2><h3 id=部署-double-take>部署 Double Take</h3><ul><li>docker-compose.yaml</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#e06c75>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>double-take</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>container_name</span>: <span style=color:#98c379>double-take</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>image</span>: <span style=color:#98c379>skrashevich/double-take</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>restart</span>: <span style=color:#98c379>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>./data:/.storage</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#d19a66>3000</span>:<span style=color:#d19a66>3000</span>
</span></span></code></pre></div><h3 id=配置-double-take>配置 Double Take</h3><p>启动 Double Take，添加配置</p><p><img src=https://img.hellowood.dev/picture/homelab-frigate-double-take-face-double-take-config.png alt=homelab-frigate-double-take-face-double-take-config.png></p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#e06c75>mqtt</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>host</span>: <span style=color:#d19a66>192.168.2.254</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>topics</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>frigate</span>: <span style=color:#98c379>frigate/events</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>matches</span>: <span style=color:#98c379>double-take/matches</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>cameras</span>: <span style=color:#98c379>double-take/cameras</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>detect</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>match</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>save</span>: <span style=color:#b756ff;font-weight:700>true</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># 最低置信度</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>confidence</span>: <span style=color:#d19a66>60</span>
</span></span><span style=display:flex><span>    <span style=color:#8a93a5;font-style:italic># 保留时间，单位是小时</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>purge</span>: <span style=color:#d19a66>168</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>unknown</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>save</span>: <span style=color:#b756ff;font-weight:700>true</span> <span style=color:#8a93a5;font-style:italic># 保留未识别的</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>frigate</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>url</span>: <span style=color:#98c379>http://192.168.2.254:5000</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic># 识别对象</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>labels</span>:
</span></span><span style=display:flex><span>    - <span style=color:#98c379>person</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># 使用 deepstack 识别</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>detectors</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>deepstack</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>url</span>: <span style=color:#98c379>http://192.168.2.254:5002</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>timeout</span>: <span style=color:#d19a66>15</span>
</span></span></code></pre></div><p>保存配置后重新启动 Double Take，当监控中出现人脸时会自动进行检测；可以选择部分进行训练，或者上传已经准备好的照片进行训练，当下次出现时即可进行识别</p><p><img src=https://img.hellowood.dev/picture/homelab-frigate-double-take-face-double-take-detect.png alt=homelab-frigate-double-take-face-double-take-detect.png></p><h2 id=参考文档>参考文档</h2><ul><li><a href=https://docs.frigate.video/integrations/third_party_extensions>Third Party Extensions</a></li><li><a href=https://github.com/skrashevich/double-take>double-take</a></li><li><a href=https://github.com/exadel-inc/CompreFace>CompreFace</a></li><li><a href=https://github.com/johnolafenwa/DeepStack>DeepStack</a></li><li><a href=https://www.codeproject.com/AI/docs/index.html>CodeProject.AI</a></li><li><a href=https://machinebox.io/>Facebox</a></li><li><a href=https://aws.amazon.com/cn/rekognition/>Amazon Rekognition</a></li></ul></div><div class=prev-next></div><svg id="btt-button" class="arrow-logo" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script><div id=comments><script src=https://utteranc.es/client.js repo=helloworlde/helloworlde.github.io issue-term=title theme=github-light crossorigin=anonymous async></script></div></div></main><footer class=footer><span>&copy; 2024 hellowood.dev</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a></span></footer></body></html>