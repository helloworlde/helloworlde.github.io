<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:1.1rem}</style><title>Frigate 使用 Hailo 8 或 Hailo 8L 进行对象识别</title><meta name=description content="Hailo8/Hailo-8L 是一家以色列的边缘人工智能公司发布的边缘加速器，定位和 Google Coral TPU 完全一致；Hailo-8 算力为 26 TOPS，Hailo-8L 算力为 13 TOPS
特性 Google Coral TPU Hailo8 Hailo8L 支持框架 TensorFlow, …"><meta name=keywords content='blog,hugo,NVR,HomeLab,Frigate,Hailo,TPU'><meta property="og:url" content="https://blog.hellowood.dev/posts/frigate-%E4%BD%BF%E7%94%A8-hailo-8-%E6%88%96-hailo-8l-%E8%BF%9B%E8%A1%8C%E5%AF%B9%E8%B1%A1%E8%AF%86%E5%88%AB/"><meta property="og:type" content="website"><meta property="og:title" content="Frigate 使用 Hailo 8 或 Hailo 8L 进行对象识别"><meta property="og:description" content="Hailo8/Hailo-8L 是一家以色列的边缘人工智能公司发布的边缘加速器，定位和 Google Coral TPU 完全一致；Hailo-8 算力为 26 TOPS，Hailo-8L 算力为 13 TOPS
特性 Google Coral TPU Hailo8 Hailo8L 支持框架 TensorFlow, …"><meta property="og:image" content="https://blog.hellowood.dev/images/avatar.webp"><meta property="og:image:secure_url" content="https://blog.hellowood.dev/images/avatar.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Frigate 使用 Hailo 8 或 Hailo 8L 进行对象识别"><meta name=twitter:description content="Hailo8/Hailo-8L 是一家以色列的边缘人工智能公司发布的边缘加速器，定位和 Google Coral TPU 完全一致；Hailo-8 算力为 26 TOPS，Hailo-8L 算力为 13 TOPS
特性 Google Coral TPU Hailo8 Hailo8L 支持框架 TensorFlow, …"><meta property="twitter:domain" content="https://blog.hellowood.dev/posts/frigate-%E4%BD%BF%E7%94%A8-hailo-8-%E6%88%96-hailo-8l-%E8%BF%9B%E8%A1%8C%E5%AF%B9%E8%B1%A1%E8%AF%86%E5%88%AB/"><meta property="twitter:url" content="https://blog.hellowood.dev/posts/frigate-%E4%BD%BF%E7%94%A8-hailo-8-%E6%88%96-hailo-8l-%E8%BF%9B%E8%A1%8C%E5%AF%B9%E8%B1%A1%E8%AF%86%E5%88%AB/"><meta name=twitter:image content="https://blog.hellowood.dev/images/avatar.webp"><link rel=canonical href=https://blog.hellowood.dev/posts/frigate-%E4%BD%BF%E7%94%A8-hailo-8-%E6%88%96-hailo-8l-%E8%BF%9B%E8%A1%8C%E5%AF%B9%E8%B1%A1%E8%AF%86%E5%88%AB/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.70293498aa96b2dbb767ec11a622eb2266d8fc37a0fff88233a82952e3c72b15.js integrity="sha256-cCk0mKqWstu3Z+wRpiLrImbY/Deg//iCM6gpUuPHKxU="></script><link rel=stylesheet type=text/css href=/css/custom.css><script defer src=https://umami.hellowood.dev/script.js data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301></script><script defer src=https://cloud.umami.is/script.js data-website-id=73ff1c8c-9938-43cf-81af-e77e26b0cca3></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}'></script><meta name=google-adsense-account content="ca-pub-5709431067036925"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5709431067036925" crossorigin=anonymous></script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jtbhx98g62")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ")</script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://blog.hellowood.dev/><img src=/images/avatar.webp alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://blog.hellowood.dev/>HelloWood</a></div><div class=nav-links><div class=nav-link><a href=https://blog.hellowood.dev/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://blog.hellowood.dev/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://blog.hellowood.dev/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://github.com/helloworlde aria-label=github><span data-feather=github></span></a></div><div class=nav-link><a href=https://umami.hellowood.dev/share/lab/Blog aria-label=dashboard><span data-feather=pie-chart></span></a></div><div class=nav-link><a href=https://blog.hellowood.dev/index.xml aria-label=rss><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://blog.hellowood.dev/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://blog.hellowood.dev/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://blog.hellowood.dev/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://github.com/helloworlde><span data-feather=github></span></a></li><li class=nav-item><a href=https://umami.hellowood.dev/share/lab/Blog><span data-feather=pie-chart></span></a></li><li class=nav-item><a href=https://blog.hellowood.dev/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Frigate 使用 Hailo 8 或 Hailo 8L 进行对象识别</h1><small role=doc-subtitle></small><p class=post-date>2024-09-01</p><ul class=post-tags><li class=post-tag><a href=https://blog.hellowood.dev/tags/nvr>NVR</a></li><li class=post-tag><a href=https://blog.hellowood.dev/tags/homelab>HomeLab</a></li><li class=post-tag><a href=https://blog.hellowood.dev/tags/frigate>Frigate</a></li><li class=post-tag><a href=https://blog.hellowood.dev/tags/hailo>Hailo</a></li><li class=post-tag><a href=https://blog.hellowood.dev/tags/tpu>TPU</a></li></ul></div><div class=post-content><p>Hailo8/Hailo-8L 是一家以色列的边缘人工智能公司发布的边缘加速器，定位和 <a href=https://coral.ai/products/>Google Coral TPU</a> 完全一致；Hailo-8 算力为 26 TOPS，Hailo-8L 算力为 13 TOPS</p><table><thead><tr><th>特性</th><th>Google Coral TPU</th><th>Hailo8</th><th>Hailo8L</th></tr></thead><tbody><tr><td><strong>支持框架</strong></td><td>TensorFlow, TensorFlow Lite</td><td>TensorFlow, TensorFlow Lite, Keras, PyTorch, ONNX</td><td>TensorFlow, TensorFlow Lite, Keras, PyTorch, ONNX</td></tr><tr><td><strong>支持模型</strong></td><td>MobileNet, Inception, EfficientNet 等</td><td>ResNet-50, MobileNet_v2, SSD, YOLOv3, YOLOv5 等</td><td>ResNet-50, MobileNet_v2, SSD, YOLOv3, YOLOv5 等</td></tr><tr><td><strong>模型功能</strong></td><td>对象识别、对象分类，语义分割，姿态识别，音频分类</td><td>对象识别、对象分类，语义分割，姿态识别，深度估计，人脸检测，人脸识别等</td><td>对象识别、对象分类，语义分割，姿态识别，深度估计，人脸检测，人脸识别等</td></tr><tr><td><strong>硬件性能</strong></td><td>4 TOPS</td><td>26 TOPS</td><td>13 TOPS</td></tr><tr><td><strong>发布时间</strong></td><td>2019年</td><td>2021年</td><td>2023年</td></tr><tr><td><strong>功耗</strong></td><td>0.5-2 W</td><td>2.5-4.6 W</td><td>1.8-3.2 W</td></tr><tr><td><strong>每W性能</strong></td><td>8 TOPS/W</td><td>10.4 TOPS/W</td><td>7.2 TOPS/W</td></tr><tr><td><strong>当前价格</strong></td><td>约300~1000¥</td><td>约 1300¥</td><td>约550¥</td></tr><tr><td><strong>支持的操作系统</strong></td><td>Linux, Windows, MacOS</td><td>Linux, Windows</td><td>Linux, Windows</td></tr><tr><td><strong>可扩展性</strong></td><td>不支持多芯片</td><td>支持多芯片并行处理</td><td>支持多芯片并行处理</td></tr><tr><td><strong>应用领域</strong></td><td>物联网设备、嵌入式系统</td><td>工业自动化、智能监控、自动驾驶</td><td>工业自动化、智能监控、智能零售</td></tr></tbody></table><p>Frigate 的最新的代码已经合并了 Hailo8L 的 PR，预计将会在 0.15 版本中正式发布，PR 参考 <a href=https://github.com/blakeblackshear/frigate/pull/12431>Initial support for Hailo-8L</a> 和 <a href=https://github.com/blakeblackshear/frigate/pull/12820>Hailo amd64 support</a>；虽然 PR 中支持的设备是 Hailo-8L，但是经过测试验证，只需要替换对应的模型，Hailo-8 也是可以正常运行的（Hailo-8 和 Hailo-8L 的模型不能互相使用）</p><h2 id=frigate-使用-hailo88l>Frigate 使用 Hailo8/8L</h2><p>使用之前，需要确保 Hailo 的 PCIE Driver 已经正确安装，参考 <a href=https://blog.hellowood.dev/posts/ubuntu22-%E5%AE%89%E8%A3%85%E5%88%9D%E5%A7%8B%E5%8C%96-hailo-8%E7%B3%BB%E5%88%97-tpu-%E5%8A%A0%E9%80%9F%E5%99%A8/>Ubuntu22 安装初始化 Hailo 8系列 TPU 加速器</a></p><h3 id=将-hailo-设备挂载到容器>将 Hailo 设备挂载到容器</h3><ul><li>docker-compose.yaml</li></ul><p>注意，<code>ghcr.io/helloworlde/frigate:0.15-f4d311c-h8l</code> 是基于 4.18 版本的驱动的，而 Frigate 的仓库是基于 4.17 版本的驱动，如果驱动和容器中的运行环境版本不一致，可能会导致 Hailo 调用失败；最新的镜像版本可以在 <a href=https://github.com/blakeblackshear/frigate/pkgs/container/frigate>Packages</a> 中查找</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>frigate-hailo</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>frigate-hailo</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>privileged</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>ghcr.io/helloworlde/frigate:0.15-f4d311c-h8l</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>shm_size</span>: <span style=color:#ae81ff>512mb</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>devices</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/dev/hailo0:/dev/hailo0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/etc/localtime:/etc/localtime:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./config/:/config</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./data/db/:/data/db</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./data/storage:/media/frigate</span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>type</span>: <span style=color:#ae81ff>tmpfs</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>target</span>: <span style=color:#ae81ff>/tmp/cache</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>tmpfs</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>size</span>: <span style=color:#ae81ff>1000000000</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>5000</span>:<span style=color:#ae81ff>5000</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>TZ=Asia/Shanghai</span>
</span></span></code></pre></div><h3 id=修改配置文件>修改配置文件</h3><p>配置文件路径是 <code>./config/config.yml</code>；指定了 detector 使用 hailo8l，并且指定了模型的路径；如果该路径下没有模型，会自动从 S3 下载；默认使用的是 ssd_mobilenet_v1 模型</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>database</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/data/db/frigate.db</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>cameras</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>bedroom</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>ffmpeg</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>inputs</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>rtsp://admin:123456@192.168.31.100:554/stream1&amp;channel=1</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>roles</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>record</span>
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>detect</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>objects</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>track</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>person</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>cat</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>detectors</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>hailo8l</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>hailo8l</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>device</span>: <span style=color:#ae81ff>PCIe</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>model</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/config/model_cache/h8l_cache/ssd_mobilenet_v1.hef</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>model</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>width</span>: <span style=color:#ae81ff>300</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>height</span>: <span style=color:#ae81ff>300</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>input_tensor</span>: <span style=color:#ae81ff>nhwc</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>input_pixel_format</span>: <span style=color:#ae81ff>bgr</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>model_type</span>: <span style=color:#ae81ff>ssd</span>
</span></span></code></pre></div><p>如果使用的是 Hailo-8，则需要下载 Hailo-8 的模型到本地挂载到容器中，并修改配置为模型对应的配置；Hailo-8 的模型可以从 <a href=https://github.com/hailo-ai/hailo_model_zoo/blob/master/docs/public_models/HAILO8/HAILO8_object_detection.rst>Public Pre-Trained Models</a> 下载，以 yolov8n 为例，修改 path、width 和 height 即可</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>detectors</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>hailo8l</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>hailo8l</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>device</span>: <span style=color:#ae81ff>PCIe</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>model</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/config/model_cache/h8_cache/yolov8n.hef</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>model</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>width</span>: <span style=color:#ae81ff>640</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>height</span>: <span style=color:#ae81ff>640</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>input_tensor</span>: <span style=color:#ae81ff>nhwc</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>input_pixel_format</span>: <span style=color:#ae81ff>bgr</span>
</span></span></code></pre></div><p>使用 12个 1080p 的监控，以 5fps 进行视频内容识别，使用 hailo-8 和 yolox 模型的推理速度约为 60ms，使用 hailo-8/8L 和 ssd_mobilenet_v1 模型的推理速度约为 15ms，而 Google Coral TPU 的推理速度约为 8ms；在当前的 Frigate 版本下，使用 Google Coral TPU 和小模型检测对象更快</p><p><img src=https://img.hellowood.dev/picture/homelab-frigate-tpu-hailo-8-system-metrics.png alt=homelab-frigate-tpu-hailo-8-system-metrics.png loading=lazy></p><h2 id=遇到的问题>遇到的问题</h2><h3 id=invalid-general-ioctl-code-0x400c6705>Invalid general ioctl code 0x400c6705</h3><p>使用官方的镜像启动后包错，提示 hailo_platform.pyhailort._pyhailort.HailoRTStatusException，检查 dmesg 发现错误信息为 <code>Invalid general ioctl code 0x400c6705</code>，这是因为驱动版本不一致导致的；官方镜像中的版本为 4.17，而本地安装的驱动版本为 4.18，导致命令无法识别；重新安装 4.17 版本的驱动，或者将 Frigate 镜像中的 HailoRT 版本改为相同的即可</p><p>frigate 日志：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.835191724</span>  [<span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44</span>] frigate<span style=color:#f92672>.</span>detectors<span style=color:#f92672>.</span>plugins<span style=color:#f92672>.</span>hailo8l ERROR   : HailoRTException during initialization: PCIe driver failure<span style=color:#f92672>.</span> run <span style=color:#e6db74>&#39;dmesg | grep hailo&#39;</span> <span style=color:#66d9ef>for</span> more information
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.836911083</span>  Traceback (most recent call last):
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.836918597</span>    File <span style=color:#e6db74>&#34;/usr/local/lib/python3.9/dist-packages/hailo_platform/pyhailort/pyhailort.py&#34;</span>, line <span style=color:#ae81ff>2610</span>, <span style=color:#f92672>in</span> _open_vdevice
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.836919078</span>      self<span style=color:#f92672>.</span>_vdevice <span style=color:#f92672>=</span> _pyhailort<span style=color:#f92672>.</span>VDevice<span style=color:#f92672>.</span>create(self<span style=color:#f92672>.</span>_params, device_ids)
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.836928015</span>  hailo_platform<span style=color:#f92672>.</span>pyhailort<span style=color:#f92672>.</span>_pyhailort<span style=color:#f92672>.</span>HailoRTStatusException: <span style=color:#ae81ff>36</span>
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837285278</span>
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837286139</span>  The above exception was the direct cause of the following exception:
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837286440</span>
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837286760</span>  Traceback (most recent call last):
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837302350</span>    File <span style=color:#e6db74>&#34;/usr/lib/python3.9/multiprocessing/process.py&#34;</span>, line <span style=color:#ae81ff>315</span>, <span style=color:#f92672>in</span> _bootstrap
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837302841</span>      self<span style=color:#f92672>.</span>run()
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837308171</span>    File <span style=color:#e6db74>&#34;/usr/lib/python3.9/multiprocessing/process.py&#34;</span>, line <span style=color:#ae81ff>108</span>, <span style=color:#f92672>in</span> run
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837308732</span>      self<span style=color:#f92672>.</span>_target(<span style=color:#f92672>*</span>self<span style=color:#f92672>.</span>_args, <span style=color:#f92672>**</span>self<span style=color:#f92672>.</span>_kwargs)
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837309313</span>    File <span style=color:#e6db74>&#34;/opt/frigate/frigate/object_detection.py&#34;</span>, line <span style=color:#ae81ff>102</span>, <span style=color:#f92672>in</span> run_detector
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837309904</span>      object_detector <span style=color:#f92672>=</span> LocalObjectDetector(detector_config<span style=color:#f92672>=</span>detector_config)
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837318260</span>    File <span style=color:#e6db74>&#34;/opt/frigate/frigate/object_detection.py&#34;</span>, line <span style=color:#ae81ff>53</span>, <span style=color:#f92672>in</span> <span style=color:#a6e22e>__init__</span>
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837318961</span>      self<span style=color:#f92672>.</span>detect_api <span style=color:#f92672>=</span> create_detector(detector_config)
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837319482</span>    File <span style=color:#e6db74>&#34;/opt/frigate/frigate/detectors/__init__.py&#34;</span>, line <span style=color:#ae81ff>18</span>, <span style=color:#f92672>in</span> create_detector
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837319943</span>      <span style=color:#66d9ef>return</span> api(detector_config)
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837320514</span>    File <span style=color:#e6db74>&#34;/opt/frigate/frigate/detectors/plugins/hailo8l.py&#34;</span>, line <span style=color:#ae81ff>73</span>, <span style=color:#f92672>in</span> <span style=color:#a6e22e>__init__</span>
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837322888</span>      self<span style=color:#f92672>.</span>target <span style=color:#f92672>=</span> VDevice()
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837328058</span>    File <span style=color:#e6db74>&#34;/usr/local/lib/python3.9/dist-packages/hailo_platform/pyhailort/pyhailort.py&#34;</span>, line <span style=color:#ae81ff>2603</span>, <span style=color:#f92672>in</span> <span style=color:#a6e22e>__init__</span>
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837328599</span>      self<span style=color:#f92672>.</span>_open_vdevice()
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837329281</span>    File <span style=color:#e6db74>&#34;/usr/local/lib/python3.9/dist-packages/hailo_platform/pyhailort/pyhailort.py&#34;</span>, line <span style=color:#ae81ff>2610</span>, <span style=color:#f92672>in</span> _open_vdevice
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837329902</span>      self<span style=color:#f92672>.</span>_vdevice <span style=color:#f92672>=</span> _pyhailort<span style=color:#f92672>.</span>VDevice<span style=color:#f92672>.</span>create(self<span style=color:#f92672>.</span>_params, device_ids)
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837330623</span>    File <span style=color:#e6db74>&#34;/usr/local/lib/python3.9/dist-packages/hailo_platform/pyhailort/pyhailort.py&#34;</span>, line <span style=color:#ae81ff>111</span>, <span style=color:#f92672>in</span> <span style=color:#a6e22e>__exit__</span>
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837331394</span>      self<span style=color:#f92672>.</span>_raise_indicative_status_exception(value)
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837338017</span>    File <span style=color:#e6db74>&#34;/usr/local/lib/python3.9/dist-packages/hailo_platform/pyhailort/pyhailort.py&#34;</span>, line <span style=color:#ae81ff>146</span>, <span style=color:#f92672>in</span> _raise_indicative_status_exception
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837338959</span>      <span style=color:#66d9ef>raise</span> HailoRTPCIeDriverException(<span style=color:#e6db74>&#34;PCIe driver failure. run &#39;dmesg | grep hailo&#39; for more information&#34;</span>) <span style=color:#f92672>from</span> libhailort_exception
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>21</span>:<span style=color:#ae81ff>51</span>:<span style=color:#ae81ff>44.837357273</span>  hailo_platform<span style=color:#f92672>.</span>pyhailort<span style=color:#f92672>.</span>pyhailort<span style=color:#f92672>.</span>HailoRTPCIeDriverException: PCIe driver failure<span style=color:#f92672>.</span> run <span style=color:#e6db74>&#39;dmesg | grep hailo&#39;</span> <span style=color:#66d9ef>for</span> more information
</span></span></code></pre></div><p>查看 dmesg 日志：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dmesg | grep hailo
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>   67.062136<span style=color:#f92672>]</span> hailo_pci: loading out-of-tree module taints kernel.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>   67.062191<span style=color:#f92672>]</span> hailo_pci: module verification failed: signature and/or required key missing - tainting kernel
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>   67.068815<span style=color:#f92672>]</span> hailo: Init module. driver version 4.18.0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>   67.069665<span style=color:#f92672>]</span> hailo 0000:04:00.0: Probing on: 1e60:2864...
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>   67.069670<span style=color:#f92672>]</span> hailo 0000:04:00.0: Probing: Allocate memory <span style=color:#66d9ef>for</span> device extension, <span style=color:#ae81ff>11632</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>  188.404620<span style=color:#f92672>]</span> hailo 0000:04:00.0: Invalid general ioctl code 0x400c6705 <span style=color:#f92672>(</span>nr: 5<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>修改为相同版本镜像后 Hailo 成功加载:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>22</span>:<span style=color:#ae81ff>02</span>:<span style=color:#ae81ff>33.745564255</span>  [<span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>22</span>:<span style=color:#ae81ff>02</span>:<span style=color:#ae81ff>33</span>] frigate<span style=color:#f92672>.</span>detectors<span style=color:#f92672>.</span>plugins<span style=color:#f92672>.</span>hailo8l INFO    : A model file already exists at <span style=color:#f92672>/</span>config<span style=color:#f92672>/</span>model_cache<span style=color:#f92672>/</span>h8l_cache<span style=color:#f92672>/</span>ssd_mobilenet_v1<span style=color:#f92672>.</span>hef <span style=color:#f92672>not</span> downloading one<span style=color:#f92672>.</span>
</span></span><span style=display:flex><span>frigate<span style=color:#f92672>-</span>hailo  <span style=color:#f92672>|</span> <span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>22</span>:<span style=color:#ae81ff>02</span>:<span style=color:#ae81ff>33.871380296</span>  [<span style=color:#ae81ff>2024</span><span style=color:#f92672>-</span><span style=color:#ae81ff>08</span><span style=color:#f92672>-</span><span style=color:#ae81ff>24</span> <span style=color:#ae81ff>22</span>:<span style=color:#ae81ff>02</span>:<span style=color:#ae81ff>33</span>] frigate<span style=color:#f92672>.</span>detectors<span style=color:#f92672>.</span>plugins<span style=color:#f92672>.</span>hailo8l INFO    : Hailo device initialized successfully
</span></span></code></pre></div><h2 id=参考文档>参考文档</h2><ul><li><a href=https://github.com/hailo-ai/hailo_model_zoo/blob/master/docs/public_models/HAILO8L/HAILO8L_object_detection.rst>HAILO8L 对象识别模型</a></li><li><a href=https://github.com/hailo-ai/hailo_model_zoo/blob/master/docs/public_models/HAILO8/HAILO8_object_detection.rst>HAILO8 对象识别模型</a></li><li><a href=https://github.com/helloworlde/frigate/commit/f4d311c4c8fbeb8cd9e16b5bfbb60f3d276a00dd>修改 Frigate HailoRT 版本为 4.18</a></li><li><a href=https://community.hailo.ai/t/hailortpciedriverexception-pcie-driver-failure/2358/2>HailoRTPCIeDriverException: PCIe driver failure</a></li></ul></div><div class=prev-next></div><svg id="btt-button" class="arrow-logo" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script><div id=comments><script src=https://utteranc.es/client.js repo=helloworlde/helloworlde.github.io issue-term=title theme=github-light crossorigin=anonymous async></script></div></div></main><footer class=footer><span>&copy; 2024 hellowood.dev</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>