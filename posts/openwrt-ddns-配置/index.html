<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>Openwrt-DDNS 配置</title><meta charset=utf-8><meta name=description content="Ladder@Openwrt DDNS 配置 DDNS(Dynamic DNS) 一般用于从外部访问家庭网络内的设备，因为家庭宽带没有固定的 IP 地址，所以通过域名访问时需要动态的更新域名的记录为当前的 IP 地址；实现的原理也比较简单，就是通过定时脚本，调用域名解析商的接口，修改域名的记录
和大部分路由器一样，OpenWrt 也支持 DDNS，通过 DDNS 的脚本执行动态更新
申请公网 IP DDNS 需要能从外部访问，因此需要有一个公网IP；通常打电话给宽带运营商即可搞定，理由可以是需要访问 NAS、安装监控之类的；通常运营商会提供，获取到之后 PPPOE 重新拨号或者重启光猫路由器即可；通过访问 https://tool.lu/ip/ 等工具，即可获取到自己的公网 IP
需要注意的是，22/80/443/8080 等常用端口被运营商限制，无法访问，因此，配置 DDNS 后只能通过域名+端口的方式访问； 如果域名是 .dev 这类强制要求 HTTPS 访问的域名是无法在浏览器访问的
配置 DDNS 安装 luci-app-ddns 需要安装 luci-app-ddns，用于从 OpenWrt 控制界面修改配置；通过 opkg命令或者 OpenWrt 控制界面的软件都可以安装
opkg update opkg install luci-app-ddns opkg install luci-i18n-ddns-zh-cn 安装 ddns-scripts-xxx DDNS 的更新由脚本执行，因此需要安装对应域名服务商的更新脚本；如 godaddy 的脚本是 ddns-scripts-godaddy；官方提供的域名服务商脚本可以从 Packagesindexnetwork&mdash;ip-addresses-and-names 查看
其他域名服务商可以在 GitHub 或恩山无线论坛中查找对应的软件
ddns-scripts-godaddy 配置 DDNS 添加 DDNS 配置 添加 DDNS 配置，输入 DDNS 配置名称，选择 IPV4 版本，DDNS 服务提供商选择 Godaddy"><meta name=author content="HelloWood"><link rel=canonical href=https://blog.hellowood.dev/posts/openwrt-ddns-%E9%85%8D%E7%BD%AE/><meta name=google-site-verification content="G-3MSGPYTHPZ"><link rel=alternate type=application/rss+xml href=https://blog.hellowood.dev/index.xml title=HelloWood><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ",{anonymize_ip:!1})}</script><script async defer data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301 src=https://umami.hellowood.dev/script.js></script>
<script defer data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}' src=https://static.cloudflareinsights.com/beacon.min.js></script><meta property="og:title" content="Openwrt-DDNS 配置"><meta property="og:description" content="Openwrt DDNS 配置 DDNS(Dynamic DNS) 一般用于从外部访问家庭网络内的设备，因为家庭宽带没有固定的 IP 地址，所以通过域名访问时需要动态的更新域名的记录为当前的 IP 地址；实现的原理也比较简单，就是通过定时脚本，调用域名解析商的接口，修改域名的记录
和大部分路由器一样，OpenWrt 也支持 DDNS，通过 DDNS 的脚本执行动态更新
申请公网 IP DDNS 需要能从外部访问，因此需要有一个公网IP；通常打电话给宽带运营商即可搞定，理由可以是需要访问 NAS、安装监控之类的；通常运营商会提供，获取到之后 PPPOE 重新拨号或者重启光猫路由器即可；通过访问 https://tool.lu/ip/ 等工具，即可获取到自己的公网 IP
需要注意的是，22/80/443/8080 等常用端口被运营商限制，无法访问，因此，配置 DDNS 后只能通过域名+端口的方式访问； 如果域名是 .dev 这类强制要求 HTTPS 访问的域名是无法在浏览器访问的
配置 DDNS 安装 luci-app-ddns 需要安装 luci-app-ddns，用于从 OpenWrt 控制界面修改配置；通过 opkg命令或者 OpenWrt 控制界面的软件都可以安装
opkg update opkg install luci-app-ddns opkg install luci-i18n-ddns-zh-cn 安装 ddns-scripts-xxx DDNS 的更新由脚本执行，因此需要安装对应域名服务商的更新脚本；如 godaddy 的脚本是 ddns-scripts-godaddy；官方提供的域名服务商脚本可以从 Packagesindexnetwork&mdash;ip-addresses-and-names 查看
其他域名服务商可以在 GitHub 或恩山无线论坛中查找对应的软件
ddns-scripts-godaddy 配置 DDNS 添加 DDNS 配置 添加 DDNS 配置，输入 DDNS 配置名称，选择 IPV4 版本，DDNS 服务提供商选择 Godaddy"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.hellowood.dev/posts/openwrt-ddns-%E9%85%8D%E7%BD%AE/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-26T11:32:08+00:00"><meta property="article:modified_time" content="2022-08-26T11:32:08+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Openwrt-DDNS 配置"><meta name=twitter:description content="Openwrt DDNS 配置 DDNS(Dynamic DNS) 一般用于从外部访问家庭网络内的设备，因为家庭宽带没有固定的 IP 地址，所以通过域名访问时需要动态的更新域名的记录为当前的 IP 地址；实现的原理也比较简单，就是通过定时脚本，调用域名解析商的接口，修改域名的记录
和大部分路由器一样，OpenWrt 也支持 DDNS，通过 DDNS 的脚本执行动态更新
申请公网 IP DDNS 需要能从外部访问，因此需要有一个公网IP；通常打电话给宽带运营商即可搞定，理由可以是需要访问 NAS、安装监控之类的；通常运营商会提供，获取到之后 PPPOE 重新拨号或者重启光猫路由器即可；通过访问 https://tool.lu/ip/ 等工具，即可获取到自己的公网 IP
需要注意的是，22/80/443/8080 等常用端口被运营商限制，无法访问，因此，配置 DDNS 后只能通过域名+端口的方式访问； 如果域名是 .dev 这类强制要求 HTTPS 访问的域名是无法在浏览器访问的
配置 DDNS 安装 luci-app-ddns 需要安装 luci-app-ddns，用于从 OpenWrt 控制界面修改配置；通过 opkg命令或者 OpenWrt 控制界面的软件都可以安装
opkg update opkg install luci-app-ddns opkg install luci-i18n-ddns-zh-cn 安装 ddns-scripts-xxx DDNS 的更新由脚本执行，因此需要安装对应域名服务商的更新脚本；如 godaddy 的脚本是 ddns-scripts-godaddy；官方提供的域名服务商脚本可以从 Packagesindexnetwork&mdash;ip-addresses-and-names 查看
其他域名服务商可以在 GitHub 或恩山无线论坛中查找对应的软件
ddns-scripts-godaddy 配置 DDNS 添加 DDNS 配置 添加 DDNS 配置，输入 DDNS 配置名称，选择 IPV4 版本，DDNS 服务提供商选择 Godaddy"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://blog.hellowood.dev/posts/"},{"@type":"ListItem","position":3,"name":"Openwrt-DDNS 配置","item":"https://blog.hellowood.dev/posts/openwrt-ddns-%E9%85%8D%E7%BD%AE/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Openwrt-DDNS 配置","name":"Openwrt-DDNS 配置","description":"Openwrt DDNS 配置 DDNS(Dynamic DNS) 一般用于从外部访问家庭网络内的设备，因为家庭宽带没有固定的 IP 地址，所以通过域名访问时需要动态的更新域名的记录为当前的 IP 地址；实现的原理也比较简单，就是通过定时脚本，调用域名解析商的接口，修改域名的记录\n和大部分路由器一样，OpenWrt 也支持 DDNS，通过 DDNS 的脚本执行动态更新\n申请公网 IP DDNS 需要能从外部访问，因此需要有一个公网IP；通常打电话给宽带运营商即可搞定，理由可以是需要访问 NAS、安装监控之类的；通常运营商会提供，获取到之后 PPPOE 重新拨号或者重启光猫路由器即可；通过访问 https://tool.lu/ip/ 等工具，即可获取到自己的公网 IP\n需要注意的是，22/80/443/8080 等常用端口被运营商限制，无法访问，因此，配置 DDNS 后只能通过域名+端口的方式访问； 如果域名是 .dev 这类强制要求 HTTPS 访问的域名是无法在浏览器访问的\n配置 DDNS 安装 luci-app-ddns 需要安装 luci-app-ddns，用于从 OpenWrt 控制界面修改配置；通过 opkg命令或者 OpenWrt 控制界面的软件都可以安装\nopkg update opkg install luci-app-ddns opkg install luci-i18n-ddns-zh-cn 安装 ddns-scripts-xxx DDNS 的更新由脚本执行，因此需要安装对应域名服务商的更新脚本；如 godaddy 的脚本是 ddns-scripts-godaddy；官方提供的域名服务商脚本可以从 Packagesindexnetwork\u0026mdash;ip-addresses-and-names 查看\n其他域名服务商可以在 GitHub 或恩山无线论坛中查找对应的软件\nddns-scripts-godaddy 配置 DDNS 添加 DDNS 配置 添加 DDNS 配置，输入 DDNS 配置名称，选择 IPV4 版本，DDNS 服务提供商选择 Godaddy","keywords":["Esxi","OpenWrt","DDNS","HomeLab"],"articleBody":"Openwrt DDNS 配置 DDNS(Dynamic DNS) 一般用于从外部访问家庭网络内的设备，因为家庭宽带没有固定的 IP 地址，所以通过域名访问时需要动态的更新域名的记录为当前的 IP 地址；实现的原理也比较简单，就是通过定时脚本，调用域名解析商的接口，修改域名的记录\n和大部分路由器一样，OpenWrt 也支持 DDNS，通过 DDNS 的脚本执行动态更新\n申请公网 IP DDNS 需要能从外部访问，因此需要有一个公网IP；通常打电话给宽带运营商即可搞定，理由可以是需要访问 NAS、安装监控之类的；通常运营商会提供，获取到之后 PPPOE 重新拨号或者重启光猫路由器即可；通过访问 https://tool.lu/ip/ 等工具，即可获取到自己的公网 IP\n需要注意的是，22/80/443/8080 等常用端口被运营商限制，无法访问，因此，配置 DDNS 后只能通过域名+端口的方式访问； 如果域名是 .dev 这类强制要求 HTTPS 访问的域名是无法在浏览器访问的\n配置 DDNS 安装 luci-app-ddns 需要安装 luci-app-ddns，用于从 OpenWrt 控制界面修改配置；通过 opkg命令或者 OpenWrt 控制界面的软件都可以安装\nopkg update opkg install luci-app-ddns opkg install luci-i18n-ddns-zh-cn 安装 ddns-scripts-xxx DDNS 的更新由脚本执行，因此需要安装对应域名服务商的更新脚本；如 godaddy 的脚本是 ddns-scripts-godaddy；官方提供的域名服务商脚本可以从 Packagesindexnetwork—ip-addresses-and-names 查看\n其他域名服务商可以在 GitHub 或恩山无线论坛中查找对应的软件\nddns-scripts-godaddy 配置 DDNS 添加 DDNS 配置 添加 DDNS 配置，输入 DDNS 配置名称，选择 IPV4 版本，DDNS 服务提供商选择 Godaddy\n配置域名信息 配置要更新的域名和对应云服务商的认证信息，保存并应用\n配置公网 IP 来源 如果是由 OpenWrt 拨号上网，IP 地址来源选择使用网络或者 WAN 接口即可；如果 OpenWrt 作为旁路由，可以通过使用 URL 或者自定义脚本进行获取；如 http://checkip.dyndns.com\n修改更新时间 默认检查时间是 30 分钟，72 小时强制更新一次；可能会出现 IP 变化了，但是没有更新的情况；因此可以缩短强制更新时间，比如每隔 1小时强制更新一次\n启用 DDNS 配置 启用后，会自动检查 IP 信息，并执行脚本更新到 DNS 服务商，随后就可以通过域名访问了\n公网访问内部服务 配置 DDNS 后，通过域名访问 OpenWrt；需要注意，开启之后路由器将会完全暴露在公网，可能会被攻击或劫持；仅用于测试，不建议开启\n配置防火墙 首先需要配置路由器的防火墙策略，允许 wan 口接受入站和转发的数据（如果 OpenWrt 是旁路由，则主路由和 OpenWrt 都需要配置防火墙；如果 OpenWrt 是主路由，配置 OpenWrt 即可）\n可以在外网通过 ping 当前的公网 IP 进行检查；通常可以使用手机开启热点，电脑连接该热点进行测试，观测 ping 返回的结果；假设当前公网 IP 地址是 123.123.123.123\n如下，说明网络是通的，只需要在 OpenWrt 开启允许外网访问即可 ping 123.123.123.123 PING 123.123.123.123 (123.123.123.123): 56 data bytes 64 bytes from 123.123.123.123: icmp_seq=0 ttl=55 time=17.725 ms 64 bytes from 123.123.123.123: icmp_seq=1 ttl=55 time=16.598 ms 64 bytes from 123.123.123.123: icmp_seq=2 ttl=55 time=9.939 ms ^C --- 123.123.123.123 ping statistics --- 8 packets transmitted, 8 packets received, 0.0% packet loss round-trip min/avg/max/stddev = 8.355/12.869/17.725/3.600 ms 如下，说明发出的包超时了，需要检测当前的公网 IP 是否正确有效 ping 123.123.123.123 PING 123.123.123.123 (123.123.123.123): 56 data bytes Request timeout for icmp_seq 0 Request timeout for icmp_seq 1 Request timeout for icmp_seq 2 ^C --- 123.123.123.123 ping statistics --- 4 packets transmitted, 0 packets received, 100.0% packet loss 如下，收到回包，说明发出的包被拒绝了，大部分的路由器都不允许外网 ping，因此需要配置防火墙允许访问（辣鸡小米路由器不支持） PING 123.123.123.123 (123.123.123.123): 56 data bytes 92 bytes from 123.123.123.123: Destination Port Unreachable Vr HL TOS Len ID Flg off TTL Pro cks Src Dst 4 5 00 5400 971e 0 0000 38 01 ff90 127.0.0.1 123.123.123.123 Request timeout for icmp_seq 0 92 bytes from 123.123.123.123: Destination Port Unreachable Vr HL TOS Len ID Flg off TTL Pro cks Src Dst 4 5 00 5400 cc8b 0 0000 38 01 ca23 127.0.0.1 123.123.123.123 添加端口转发 在 OpenWrt 的网络-防火墙-端口转发中添加配置，将路由器指定端口转发给内部服务的端口\n","wordCount":"314","inLanguage":"en","datePublished":"2022-08-26T11:32:08Z","dateModified":"2022-08-26T11:32:08Z","author":{"@type":"Person","name":"HelloWood"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.hellowood.dev/posts/openwrt-ddns-%E9%85%8D%E7%BD%AE/"},"publisher":{"@type":"Organization","name":"HelloWood","logo":{"@type":"ImageObject","url":"https://blog.hellowood.dev/favicon.ico"}}}</script><link rel=icon href=/images/avatar.png sizes=16x16><link rel=apple-touch-icon href=/images/avatar.png><link rel=manifest href=/images/avatar.png><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.ff1bc260fafbfb440e10194d7d06d57eb5e85eed11d12d06255581262664204e.css integrity="sha256-/xvCYPr7+0QOEBlNfQbVfrXoXu0R0S0GJVWBJiZkIE4=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.872dfd2cd00064018a833a6e8e77a0fbf8fbac159546f2f205d4dad79a5d8e15.js></script>
<script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand data-umami-event=navigation-brand href=/>HOME</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Blog href=/posts>Blog</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Tags href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Archive href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Dashboard href=https://umami.hellowood.dev/share/lab/Blog>Dashboard</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link data-umami-event=navigation-social href=https://github.com/helloworlde><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button data-umami-event=toggle-theme aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>Openwrt-DDNS 配置</h1></header><p><small>August 26, 2022&nbsp;· 314 words&nbsp;· 2 min</small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#申请公网-ip>申请公网 IP</a></li><li><a href=#配置-ddns>配置 DDNS</a><ul><li><a href=#安装-luci-app-ddns>安装 luci-app-ddns</a></li><li><a href=#安装-ddns-scripts-xxx>安装 ddns-scripts-xxx</a></li><li><a href=#配置-ddns-1>配置 DDNS</a></li></ul></li><li><a href=#公网访问内部服务>公网访问内部服务</a><ul><li><a href=#配置防火墙>配置防火墙</a></li><li><a href=#添加端口转发>添加端口转发</a></li></ul></li></ul></nav></div><section class=blog-content><h1 id=openwrt-ddns-配置>Openwrt DDNS 配置</h1><p>DDNS(Dynamic DNS) 一般用于从外部访问家庭网络内的设备，因为家庭宽带没有固定的 IP 地址，所以通过域名访问时需要动态的更新域名的记录为当前的 IP 地址；实现的原理也比较简单，就是通过定时脚本，调用域名解析商的接口，修改域名的记录</p><p>和大部分路由器一样，OpenWrt 也支持 DDNS，通过 DDNS 的脚本执行动态更新</p><h2 id=申请公网-ip>申请公网 IP</h2><p>DDNS 需要能从外部访问，因此需要有一个公网IP；通常打电话给宽带运营商即可搞定，理由可以是需要访问 NAS、安装监控之类的；通常运营商会提供，获取到之后 PPPOE 重新拨号或者重启光猫路由器即可；通过访问 <a href=https://tool.lu/ip/>https://tool.lu/ip/</a> 等工具，即可获取到自己的公网 IP</p><p>需要注意的是，22/80/443/8080 等常用端口被运营商限制，无法访问，因此，配置 DDNS 后只能通过域名+端口的方式访问； 如果域名是 <code>.dev</code> 这类强制要求 HTTPS 访问的域名是无法在浏览器访问的</p><h2 id=配置-ddns>配置 DDNS</h2><h3 id=安装-luci-app-ddns>安装 luci-app-ddns</h3><p>需要安装 luci-app-ddns，用于从 OpenWrt 控制界面修改配置；通过 <code>opkg</code>命令或者 OpenWrt 控制界面的软件都可以安装</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>opkg update
</span></span><span style=display:flex><span>opkg install luci-app-ddns
</span></span><span style=display:flex><span>opkg install luci-i18n-ddns-zh-cn
</span></span></code></pre></div><h3 id=安装-ddns-scripts-xxx>安装 ddns-scripts-xxx</h3><p>DDNS 的更新由脚本执行，因此需要安装对应域名服务商的更新脚本；如 godaddy 的脚本是 ddns-scripts-godaddy；官方提供的域名服务商脚本可以从 <a href=https://openwrt.org/packages/index/network---ip-addresses-and-names>Packagesindexnetwork&mdash;ip-addresses-and-names</a> 查看</p><p>其他域名服务商可以在 GitHub 或恩山无线论坛中查找对应的软件</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ddns-scripts-godaddy
</span></span></code></pre></div><h3 id=配置-ddns-1>配置 DDNS</h3><ul><li>添加 DDNS 配置</li></ul><p>添加 DDNS 配置，输入 DDNS 配置名称，选择 IPV4 版本，DDNS 服务提供商选择 Godaddy</p><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/picture/homelab-openwrt-ddns-new-config.png alt=homelab-openwrt-ddns-new-config.png></p><ul><li>配置域名信息</li></ul><p>配置要更新的域名和对应云服务商的认证信息，保存并应用</p><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/picture/homelab-openwrt-ddns-basic-config.png alt=homelab-openwrt-ddns-basic-config.png></p><ul><li>配置公网 IP 来源</li></ul><p>如果是由 OpenWrt 拨号上网，IP 地址来源选择使用网络或者 WAN 接口即可；如果 OpenWrt 作为旁路由，可以通过使用 URL 或者自定义脚本进行获取；如 <a href=http://checkip.dyndns.com>http://checkip.dyndns.com</a></p><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/picture/homelab-openwrt-ddns-ip-address-config.png alt=homelab-openwrt-ddns-ip-address-config.png></p><ul><li>修改更新时间</li></ul><p>默认检查时间是 30 分钟，72 小时强制更新一次；可能会出现 IP 变化了，但是没有更新的情况；因此可以缩短强制更新时间，比如每隔 1小时强制更新一次</p><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/picture/homelab-openwrt-ddns-update-config.png alt=homelab-openwrt-ddns-update-config.png></p><ul><li>启用 DDNS 配置</li></ul><p>启用后，会自动检查 IP 信息，并执行脚本更新到 DNS 服务商，随后就可以通过域名访问了</p><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/picture/homelab-openwrt-ddns-enable-ddns-config-2.png alt=homelab-openwrt-ddns-enable-ddns-config-2.png></p><h2 id=公网访问内部服务>公网访问内部服务</h2><p>配置 DDNS 后，通过域名访问 OpenWrt；需要注意，开启之后路由器将会完全暴露在公网，可能会被攻击或劫持；仅用于测试，不建议开启</p><h3 id=配置防火墙>配置防火墙</h3><p>首先需要配置路由器的防火墙策略，允许 wan 口接受入站和转发的数据（如果 OpenWrt 是旁路由，则主路由和 OpenWrt 都需要配置防火墙；如果 OpenWrt 是主路由，配置 OpenWrt 即可）</p><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/picture/homelab-openwrt-ddns-enable-firewall.png alt=homelab-openwrt-ddns-enable-firewall.png></p><p>可以在外网通过 ping 当前的公网 IP 进行检查；通常可以使用手机开启热点，电脑连接该热点进行测试，观测 ping 返回的结果；假设当前公网 IP 地址是 <code>123.123.123.123</code></p><ul><li>如下，说明网络是通的，只需要在 OpenWrt 开启允许外网访问即可</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ping 123.123.123.123
</span></span><span style=display:flex><span>PING 123.123.123.123 <span style=color:#f92672>(</span>123.123.123.123<span style=color:#f92672>)</span>: <span style=color:#ae81ff>56</span> data bytes
</span></span><span style=display:flex><span><span style=color:#ae81ff>64</span> bytes from 123.123.123.123: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>55</span> time<span style=color:#f92672>=</span>17.725 ms
</span></span><span style=display:flex><span><span style=color:#ae81ff>64</span> bytes from 123.123.123.123: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>55</span> time<span style=color:#f92672>=</span>16.598 ms
</span></span><span style=display:flex><span><span style=color:#ae81ff>64</span> bytes from 123.123.123.123: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>55</span> time<span style=color:#f92672>=</span>9.939 ms
</span></span><span style=display:flex><span>^C
</span></span><span style=display:flex><span>--- 123.123.123.123 ping statistics ---
</span></span><span style=display:flex><span><span style=color:#ae81ff>8</span> packets transmitted, <span style=color:#ae81ff>8</span> packets received, 0.0% packet loss
</span></span><span style=display:flex><span>round-trip min/avg/max/stddev <span style=color:#f92672>=</span> 8.355/12.869/17.725/3.600 ms
</span></span></code></pre></div><ul><li>如下，说明发出的包超时了，需要检测当前的公网 IP 是否正确有效</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ping 123.123.123.123
</span></span><span style=display:flex><span>PING 123.123.123.123 <span style=color:#f92672>(</span>123.123.123.123<span style=color:#f92672>)</span>: <span style=color:#ae81ff>56</span> data bytes
</span></span><span style=display:flex><span>Request timeout <span style=color:#66d9ef>for</span> icmp_seq <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>Request timeout <span style=color:#66d9ef>for</span> icmp_seq <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>Request timeout <span style=color:#66d9ef>for</span> icmp_seq <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>^C
</span></span><span style=display:flex><span>--- 123.123.123.123 ping statistics ---
</span></span><span style=display:flex><span><span style=color:#ae81ff>4</span> packets transmitted, <span style=color:#ae81ff>0</span> packets received, 100.0% packet loss
</span></span></code></pre></div><ul><li>如下，收到回包，说明发出的包被拒绝了，大部分的路由器都不允许外网 ping，因此需要配置防火墙允许访问（辣鸡小米路由器不支持）</li></ul><pre tabindex=0><code>PING 123.123.123.123 (123.123.123.123): 56 data bytes
92 bytes from 123.123.123.123: Destination Port Unreachable
Vr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst
4  5  00 5400 971e   0 0000  38  01 ff90 127.0.0.1  123.123.123.123

Request timeout for icmp_seq 0
92 bytes from 123.123.123.123: Destination Port Unreachable
Vr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst
4  5  00 5400 cc8b   0 0000  38  01 ca23 127.0.0.1  123.123.123.123
</code></pre><h3 id=添加端口转发>添加端口转发</h3><p>在 OpenWrt 的网络-防火墙-端口转发中添加配置，将路由器指定端口转发给内部服务的端口</p><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/picture/homelab-openwrt-ddns-add-port-forward.png alt=homelab-openwrt-ddns-add-port-forward.png></p></section><div class=paginator><a class=prev href=https://blog.hellowood.dev/posts/%E4%BD%BF%E7%94%A8-pi-hole-%E4%BD%9C%E4%B8%BA-dns-%E5%92%8C-dhcp-%E6%9C%8D%E5%8A%A1%E5%99%A8/><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg><span>使用 Pi-hole 作为 DNS 和 DHCP 服务器</span></a>
<a class=next href=https://blog.hellowood.dev/posts/n5105-%E6%9E%84%E5%BB%BA-esxi-%E9%95%9C%E5%83%8F/><span>N5105 构建 Esxi 镜像</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div></article></div><footer class=footer><p>&copy; 2023 <a href=https://blog.hellowood.dev>HelloWood</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank data-umami-event=to-hugo>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank data-umami-event=to-ladder>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g data-umami-event=top-link><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg></a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>