<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>使用 Docker 部署 Clash Premium</title>
<meta name=description content="Copy Paste Worker"><meta name=keywords content='blog,hugo,Clash,Docker,HomeLab'><meta property="og:url" content="https://blog.hellowood.dev/posts/%E4%BD%BF%E7%94%A8docker%E9%83%A8%E7%BD%B2clash-premium/"><meta property="og:type" content="website"><meta property="og:title" content="使用 Docker 部署 Clash Premium"><meta property="og:description" content="Copy Paste Worker"><meta property="og:image" content="https://blog.hellowood.dev/images/avatar.webp"><meta property="og:image:secure_url" content="https://blog.hellowood.dev/images/avatar.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="使用 Docker 部署 Clash Premium"><meta name=twitter:description content="Copy Paste Worker"><meta property="twitter:domain" content="https://blog.hellowood.dev/posts/%E4%BD%BF%E7%94%A8docker%E9%83%A8%E7%BD%B2clash-premium/"><meta property="twitter:url" content="https://blog.hellowood.dev/posts/%E4%BD%BF%E7%94%A8docker%E9%83%A8%E7%BD%B2clash-premium/"><meta name=twitter:image content="https://blog.hellowood.dev/images/avatar.webp"><link rel=canonical href=https://blog.hellowood.dev/posts/%E4%BD%BF%E7%94%A8docker%E9%83%A8%E7%BD%B2clash-premium/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.9a920d7dabdbad8363b6a0a94e29a9dfebdb7ee64cfcb193a0145e512ef2bdab.js integrity="sha256-mpINfavbrYNjtqCpTimp3+vbfuZM/LGToBReUS7yvas="></script><script defer src=https://umami.hellowood.dev/script.js data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301></script><script defer src=https://cloud.umami.is/script.js data-website-id=73ff1c8c-9938-43cf-81af-e77e26b0cca3></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}'></script><meta name=google-adsense-account content="ca-pub-3401351766168985"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3401351766168985" crossorigin=anonymous></script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jtbhx98g62")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ")</script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://blog.hellowood.dev/><img src=/images/avatar.webp alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://blog.hellowood.dev/>HelloWood</a></div><div class=nav-links><div class=nav-link><a href=https://blog.hellowood.dev/><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://blog.hellowood.dev/posts/><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://blog.hellowood.dev/tags/><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://github.com/helloworlde><span data-feather=github></span></a></div><div class=nav-link><a href=https://umami.hellowood.dev/share/lab/Blog><span data-feather=pie-chart></span></a></div><div class=nav-link><a href=https://blog.hellowood.dev/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target"></span>
<a><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://blog.hellowood.dev/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://blog.hellowood.dev/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://blog.hellowood.dev/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://github.com/helloworlde><span data-feather=github></span></a></li><li class=nav-item><a href=https://umami.hellowood.dev/share/lab/Blog><span data-feather=pie-chart></span></a></li><li class=nav-item><a href=https://blog.hellowood.dev/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>使用 Docker 部署 Clash Premium</h1><small role=doc-subtitle></small><p class=post-date>2023-09-09</p><ul class=post-tags><li class=post-tag><a href=https://blog.hellowood.dev/tags/clash>Clash</a></li><li class=post-tag><a href=https://blog.hellowood.dev/tags/docker>Docker</a></li><li class=post-tag><a href=https://blog.hellowood.dev/tags/homelab>HomeLab</a></li></ul></div><div class=post-content><h1 id=使用-docker-部署-clash-premium>使用 Docker 部署 Clash Premium</h1><p>Clash Premium 是 Clash 的闭源内核版本，相比 Clash 开源版本，最大的特点是支持规则集和代理服务订阅能力</p><h2 id=订阅格式转换>订阅格式转换</h2><p>大部分订阅是 base64 编码的节点，无法被 Clash 直接使用，因此需要进行订阅格式转换，具体请参考 <a href=https://blog.hellowood.dev/posts/clash-%E4%BD%BF%E7%94%A8-docker-%E9%83%A8%E7%BD%B2/>Clash 使用 Docker 部署</a> 或使用在线工具直接转换：<a href=https://acl4ssr-sub.github.io/>https://acl4ssr-sub.github.io/</a></p><h2 id=修改配置>修改配置</h2><h3 id=基础配置>基础配置</h3><p>基础配置部分用于指定 Clash 的端口、代理模式等；使用 TUN 后可以代理 UDP 流量，开启 tracing 可以对 Clash 进行性能监控</p><ul><li>config.yaml</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#e06c75>port</span>: <span style=color:#d19a66>7890</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>socks-port</span>: <span style=color:#d19a66>7891</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>redir-port</span>: <span style=color:#d19a66>7892</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>allow-lan</span>: <span style=color:#b756ff;font-weight:700>true</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>mode</span>: <span style=color:#98c379>rule</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>log-level</span>: <span style=color:#98c379>info</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># 控制端口</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>external-controller</span>: :<span style=color:#d19a66>9090</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># 访问密码，建议设置</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>secret</span>: <span style=color:#63c381>&#34;123456&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># TUN 模式，用于代理 TCP、UDP、ICMP 流量</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>tun</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>enable</span>: <span style=color:#b756ff;font-weight:700>true</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>stack</span>: <span style=color:#98c379>system</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>auto-route</span>: <span style=color:#b756ff;font-weight:700>true</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>auto-redir</span>: <span style=color:#b756ff;font-weight:700>true</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>auto-detect-interface</span>: <span style=color:#b756ff;font-weight:700>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># 用于性能分析</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>profile</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>tracing</span>: <span style=color:#b756ff;font-weight:700>true</span>
</span></span></code></pre></div><h3 id=配置策略组>配置策略组</h3><p>代理提供方 <code>proxy-providers</code> 用于为策略组 <code>proxy-groups</code> 提供代理节点；这部分用于取代 Clash 中的 <code>proxies</code></p><p>下面的配置中，<code>proxy-providers</code> 有两个提供者，类型都是 HTTP，即通过订阅链接进行拉取，同时指定了定时拉取时间和健康检查，用于检测节点的可用性;
<code>proxy-groups</code> 指定了这个策略组的名称为 <code>PROXY</code>，用于为 <code>rule</code> 指定策略组名称；使用<code>proxy-providers</code> 中的 self 和 free 提供的节点作为策略组的节点；详细规则可以参考：<a href=https://dreamacro.github.io/clash/zh_CN/configuration/outbound.html#proxy-groups-%E7%AD%96%E7%95%A5%E7%BB%84>Proxy Groups 策略组</a></p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#e06c75>proxy-providers</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>self</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>type</span>: <span style=color:#98c379>http</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>url</span>: <span style=color:#63c381>&#34;你的订阅地址&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>interval</span>: <span style=color:#d19a66>3600</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>path</span>: <span style=color:#98c379>./self.yaml</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>health-check</span>:
</span></span><span style=display:flex><span>      <span style=color:#e06c75>enable</span>: <span style=color:#b756ff;font-weight:700>true</span>
</span></span><span style=display:flex><span>      <span style=color:#e06c75>interval</span>: <span style=color:#d19a66>600</span>
</span></span><span style=display:flex><span>      <span style=color:#e06c75>url</span>: <span style=color:#98c379>http://www.gstatic.com/generate_204</span>
</span></span><span style=display:flex><span>  <span style=color:#8a93a5;font-style:italic># 来自 GitHub  https://github.com/Pawdroid/Free-servers    </span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>free</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>type</span>: <span style=color:#98c379>http</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>url</span>: <span style=color:#63c381>&#34;https://sub.xeton.dev/sub?target=clash&amp;new_name=true&amp;url=https%3A%2F%2Fghproxy.com%2Fhttps%3A%2F%2Fraw.githubusercontent.com%2FPawdroid%2FFree-servers%2Fmain%2Fsub&amp;insert=false&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>interval</span>: <span style=color:#d19a66>3600</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>path</span>: <span style=color:#98c379>./free.yaml</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>health-check</span>:
</span></span><span style=display:flex><span>      <span style=color:#e06c75>enable</span>: <span style=color:#b756ff;font-weight:700>true</span>
</span></span><span style=display:flex><span>      <span style=color:#e06c75>interval</span>: <span style=color:#d19a66>600</span>
</span></span><span style=display:flex><span>      <span style=color:#8a93a5;font-style:italic># lazy: true</span>
</span></span><span style=display:flex><span>      <span style=color:#e06c75>url</span>: <span style=color:#98c379>http://www.gstatic.com/generate_204</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>proxy-groups</span>:
</span></span><span style=display:flex><span>  - <span style=color:#e06c75>name</span>: <span style=color:#63c381>&#34;PROXY&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>type</span>: <span style=color:#98c379>url-test</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>use</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>self</span>
</span></span><span style=display:flex><span>      - <span style=color:#98c379>free</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>url</span>: <span style=color:#98c379>&#39;http://www.gstatic.com/generate_204&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>interval</span>: <span style=color:#d19a66>300</span>
</span></span></code></pre></div><h3 id=配置规则集>配置规则集</h3><p>规则集用于决定流量是否走 Clash 代理，在 Clash 版本中，必须挨个列出处理规则，导致配置非常臃肿，而且不好维护；在 premium 版本中，可以通过 rule-provider 指定订阅的规则集；以下规则集来自 <a href=https://github.com/Loyalsoldier/clash-rules>https://github.com/Loyalsoldier/clash-rules</a>；</p><p><code>rule-providers</code> 部分通过分组的方式指定了规则的处理方式，便于管理；</p><p><code>rules</code> 为 <code>rule-providers</code> 中的 rule-set 指定了策略组；如<code>RULE-SET,icloud,DIRECT</code> 为 icloud 这个规则集下面的内容指定了 DIRECT 的处理方式，即直接访问；<code>RULE-SET,google,PROXY</code> 为 google 这个规则集下面的内容指定了名为 <code>PROXY</code>的策略组进行代理</p><p>最后一行 <code>MATCH,DIRECT</code> 表示未匹配到规则的使用 DIRECT 方式，即直接访问</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#e06c75>rule-providers</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>reject</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>type</span>: <span style=color:#98c379>http</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>behavior</span>: <span style=color:#98c379>domain</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>url</span>: <span style=color:#63c381>&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>path</span>: <span style=color:#98c379>./ruleset/reject.yaml</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>interval</span>: <span style=color:#d19a66>86400</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>icloud</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>type</span>: <span style=color:#98c379>http</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>behavior</span>: <span style=color:#98c379>domain</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>url</span>: <span style=color:#63c381>&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>path</span>: <span style=color:#98c379>./ruleset/icloud.yaml</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>interval</span>: <span style=color:#d19a66>86400</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>apple</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>type</span>: <span style=color:#98c379>http</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>behavior</span>: <span style=color:#98c379>domain</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>url</span>: <span style=color:#63c381>&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>path</span>: <span style=color:#98c379>./ruleset/apple.yaml</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>interval</span>: <span style=color:#d19a66>86400</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>google</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>type</span>: <span style=color:#98c379>http</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>behavior</span>: <span style=color:#98c379>domain</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>url</span>: <span style=color:#63c381>&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/google.txt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>path</span>: <span style=color:#98c379>./ruleset/google.yaml</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>interval</span>: <span style=color:#d19a66>86400</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>proxy</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>type</span>: <span style=color:#98c379>http</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>behavior</span>: <span style=color:#98c379>domain</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>url</span>: <span style=color:#63c381>&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>path</span>: <span style=color:#98c379>./ruleset/proxy.yaml</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>interval</span>: <span style=color:#d19a66>86400</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>direct</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>type</span>: <span style=color:#98c379>http</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>behavior</span>: <span style=color:#98c379>domain</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>url</span>: <span style=color:#63c381>&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>path</span>: <span style=color:#98c379>./ruleset/direct.yaml</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>interval</span>: <span style=color:#d19a66>86400</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>private</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>type</span>: <span style=color:#98c379>http</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>behavior</span>: <span style=color:#98c379>domain</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>url</span>: <span style=color:#63c381>&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>path</span>: <span style=color:#98c379>./ruleset/private.yaml</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>interval</span>: <span style=color:#d19a66>86400</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>gfw</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>type</span>: <span style=color:#98c379>http</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>behavior</span>: <span style=color:#98c379>domain</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>url</span>: <span style=color:#63c381>&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>path</span>: <span style=color:#98c379>./ruleset/gfw.yaml</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>interval</span>: <span style=color:#d19a66>86400</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>tld-not-cn</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>type</span>: <span style=color:#98c379>http</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>behavior</span>: <span style=color:#98c379>domain</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>url</span>: <span style=color:#63c381>&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/tld-not-cn.txt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>path</span>: <span style=color:#98c379>./ruleset/tld-not-cn.yaml</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>interval</span>: <span style=color:#d19a66>86400</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>telegramcidr</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>type</span>: <span style=color:#98c379>http</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>behavior</span>: <span style=color:#98c379>ipcidr</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>url</span>: <span style=color:#63c381>&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>path</span>: <span style=color:#98c379>./ruleset/telegramcidr.yaml</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>interval</span>: <span style=color:#d19a66>86400</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>cncidr</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>type</span>: <span style=color:#98c379>http</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>behavior</span>: <span style=color:#98c379>ipcidr</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>url</span>: <span style=color:#63c381>&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>path</span>: <span style=color:#98c379>./ruleset/cncidr.yaml</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>interval</span>: <span style=color:#d19a66>86400</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>lancidr</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>type</span>: <span style=color:#98c379>http</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>behavior</span>: <span style=color:#98c379>ipcidr</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>url</span>: <span style=color:#63c381>&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>path</span>: <span style=color:#98c379>./ruleset/lancidr.yaml</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>interval</span>: <span style=color:#d19a66>86400</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>applications</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>type</span>: <span style=color:#98c379>http</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>behavior</span>: <span style=color:#98c379>classical</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>url</span>: <span style=color:#63c381>&#34;https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>path</span>: <span style=color:#98c379>./ruleset/applications.yaml</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>interval</span>: <span style=color:#d19a66>86400</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#98c379>RULE-SET,google,PROXY</span>
</span></span><span style=display:flex><span>  - <span style=color:#98c379>RULE-SET,proxy,PROXY</span>
</span></span><span style=display:flex><span>  - <span style=color:#98c379>RULE-SET,telegramcidr,PROXY</span>
</span></span><span style=display:flex><span>  - <span style=color:#98c379>RULE-SET,applications,DIRECT</span>
</span></span><span style=display:flex><span>  - <span style=color:#98c379>RULE-SET,private,DIRECT</span>
</span></span><span style=display:flex><span>  - <span style=color:#98c379>RULE-SET,reject,REJECT</span>
</span></span><span style=display:flex><span>  - <span style=color:#98c379>RULE-SET,icloud,DIRECT</span>
</span></span><span style=display:flex><span>  - <span style=color:#98c379>RULE-SET,apple,DIRECT</span>
</span></span><span style=display:flex><span>  - <span style=color:#98c379>RULE-SET,direct,DIRECT</span>
</span></span><span style=display:flex><span>  - <span style=color:#98c379>RULE-SET,lancidr,DIRECT</span>
</span></span><span style=display:flex><span>  - <span style=color:#98c379>RULE-SET,cncidr,DIRECT</span>
</span></span><span style=display:flex><span>  - <span style=color:#98c379>GEOIP,LAN,DIRECT</span>
</span></span><span style=display:flex><span>  - <span style=color:#98c379>GEOIP,CN,DIRECT</span>
</span></span><span style=display:flex><span>  - <span style=color:#98c379>MATCH,DIRECT</span>
</span></span></code></pre></div><h2 id=部署>部署</h2><p>使用 Docker Compose 部署 Clash 和 yacd 面板</p><ul><li>docker-compose.yaml</li></ul><p>需要将上面的配置合并到 <code>config.yaml</code>文件中，放到 <code>data/config.yaml</code>路径下，用于挂载到容器 <code>/root/.config/clash</code> 目录下，后续的拉取到的规则集和配置文件都会写到这个目录下</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#e06c75>version</span>: <span style=color:#63c381>&#34;3&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>clash</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>image</span>: <span style=color:#98c379>dreamacro/clash-premium</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>container_name</span>: <span style=color:#98c379>clash</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>hostname</span>: <span style=color:#98c379>clash</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>privileged</span>: <span style=color:#b756ff;font-weight:700>true</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>restart</span>: <span style=color:#98c379>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#d19a66>7890</span>:<span style=color:#d19a66>7890</span>
</span></span><span style=display:flex><span>      - <span style=color:#d19a66>7891</span>:<span style=color:#d19a66>7891</span>
</span></span><span style=display:flex><span>      - <span style=color:#d19a66>7892</span>:<span style=color:#d19a66>7892</span>
</span></span><span style=display:flex><span>      - <span style=color:#d19a66>9090</span>:<span style=color:#d19a66>9090</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>./data:/root/.config/clash</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>TZ=Asia/Shanghai</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>yacd</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>image</span>: <span style=color:#98c379>ghcr.io/haishanh/yacd:master</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>container_name</span>: <span style=color:#98c379>yacd</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>hostname</span>: <span style=color:#98c379>yacd</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>restart</span>: <span style=color:#98c379>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#d19a66>9091</span>:<span style=color:#d19a66>80</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>TZ=Asia/Shanghai</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>depends_on</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>clash</span>
</span></span></code></pre></div><h2 id=客户端使用>客户端使用</h2><p>通过容器方式部署的 Clash 可以以代理的方式使用，在手机/电脑或者应用程序中配置代理即可</p><h3 id=命令行>命令行</h3><p>开启代理</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ef8383>export</span> <span style=color:#dcaeea>https_proxy</span><span style=color:#c7bf54>=</span>http://192.168.2.2:7890 
</span></span><span style=display:flex><span><span style=color:#ef8383>export</span> <span style=color:#dcaeea>http_proxy</span><span style=color:#c7bf54>=</span>http://192.168.2.2:7890 
</span></span><span style=display:flex><span><span style=color:#ef8383>export</span> <span style=color:#dcaeea>all_proxy</span><span style=color:#c7bf54>=</span>socks5://192.168.2.2:7891
</span></span></code></pre></div><p>关闭代理</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ef8383>unset</span> http_proxy
</span></span><span style=display:flex><span><span style=color:#ef8383>unset</span> https_proxy
</span></span><span style=display:flex><span><span style=color:#ef8383>unset</span> all_proxy
</span></span></code></pre></div><h3 id=系统>系统</h3><p>在网络-代理中添加配置，指定 HTTP/HTTPS/SOCKS 代理为配置的代理即可</p><p><img src=https://img.hellowood.dev/picture/homelab-clash-proxy-config-macos.png alt=homelab-clash-proxy-config-macos.png></p></div><div class=prev-next></div><svg id="btt-button" class="arrow-logo" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script><div id=comments><script src=https://utteranc.es/client.js repo=helloworlde/helloworlde.github.io issue-term=title theme=github-light crossorigin=anonymous async></script></div></div></main><footer class=footer><span>&copy; 2024 hellowood.dev</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a></span></footer></body></html>