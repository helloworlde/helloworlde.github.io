<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Traefik 使用 Google GitHub OAuth 进行鉴权登陆</title>
<meta name=description content="在使用 Traefik 作为 Homelab 的网关时，考虑到部分服务涉及隐私，因此需要限制用户登陆后才能使用；
Traefik 支持使用 HTTP 中间件，可以将鉴权信息转发给其他服务进行鉴权，因此，使用 https://github.com/thomseddon/traefik-forward-auth 作为鉴权的 …"><meta name=keywords content='blog,hugo,Traefik,HomeLab'><meta property="og:url" content="https://blog.hellowood.dev/posts/traefik-%E4%BD%BF%E7%94%A8-google-github-oauth-%E8%BF%9B%E8%A1%8C%E9%89%B4%E6%9D%83%E7%99%BB%E9%99%86/"><meta property="og:type" content="website"><meta property="og:title" content="Traefik 使用 Google GitHub OAuth 进行鉴权登陆"><meta property="og:description" content="在使用 Traefik 作为 Homelab 的网关时，考虑到部分服务涉及隐私，因此需要限制用户登陆后才能使用；
Traefik 支持使用 HTTP 中间件，可以将鉴权信息转发给其他服务进行鉴权，因此，使用 https://github.com/thomseddon/traefik-forward-auth 作为鉴权的 …"><meta property="og:image" content="https://blog.hellowood.dev/images/avatar.webp"><meta property="og:image:secure_url" content="https://blog.hellowood.dev/images/avatar.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Traefik 使用 Google GitHub OAuth 进行鉴权登陆"><meta name=twitter:description content="在使用 Traefik 作为 Homelab 的网关时，考虑到部分服务涉及隐私，因此需要限制用户登陆后才能使用；
Traefik 支持使用 HTTP 中间件，可以将鉴权信息转发给其他服务进行鉴权，因此，使用 https://github.com/thomseddon/traefik-forward-auth 作为鉴权的 …"><meta property="twitter:domain" content="https://blog.hellowood.dev/posts/traefik-%E4%BD%BF%E7%94%A8-google-github-oauth-%E8%BF%9B%E8%A1%8C%E9%89%B4%E6%9D%83%E7%99%BB%E9%99%86/"><meta property="twitter:url" content="https://blog.hellowood.dev/posts/traefik-%E4%BD%BF%E7%94%A8-google-github-oauth-%E8%BF%9B%E8%A1%8C%E9%89%B4%E6%9D%83%E7%99%BB%E9%99%86/"><meta name=twitter:image content="https://blog.hellowood.dev/images/avatar.webp"><link rel=canonical href=https://blog.hellowood.dev/posts/traefik-%E4%BD%BF%E7%94%A8-google-github-oauth-%E8%BF%9B%E8%A1%8C%E9%89%B4%E6%9D%83%E7%99%BB%E9%99%86/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.3eb19cb61dde9e37b9522867f3e024aeb68e26ab8e03252e46e365abcb19acf7.js integrity="sha256-PrGcth3enje5Uihn8+AkrraOJquOAyUuRuNlq8sZrPc="></script><link rel=stylesheet type=text/css href=/css/custom.css><script defer src=https://umami.hellowood.dev/script.js data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301></script><script defer src=https://cloud.umami.is/script.js data-website-id=73ff1c8c-9938-43cf-81af-e77e26b0cca3></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}'></script><meta name=google-adsense-account content="ca-pub-3401351766168985"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3401351766168985" crossorigin=anonymous></script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jtbhx98g62")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ")</script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://blog.hellowood.dev/><img src=/images/avatar.webp alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://blog.hellowood.dev/>HelloWood</a></div><div class=nav-links><div class=nav-link><a href=https://blog.hellowood.dev/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://blog.hellowood.dev/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://blog.hellowood.dev/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://github.com/helloworlde aria-label=github><span data-feather=github></span></a></div><div class=nav-link><a href=https://umami.hellowood.dev/share/lab/Blog aria-label=dashboard><span data-feather=pie-chart></span></a></div><div class=nav-link><a href=https://blog.hellowood.dev/index.xml aria-label=rss><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://blog.hellowood.dev/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://blog.hellowood.dev/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://blog.hellowood.dev/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://github.com/helloworlde><span data-feather=github></span></a></li><li class=nav-item><a href=https://umami.hellowood.dev/share/lab/Blog><span data-feather=pie-chart></span></a></li><li class=nav-item><a href=https://blog.hellowood.dev/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Traefik 使用 Google GitHub OAuth 进行鉴权登陆</h1><small role=doc-subtitle></small><p class=post-date>2023-02-02</p><ul class=post-tags><li class=post-tag><a href=https://blog.hellowood.dev/tags/traefik>Traefik</a></li><li class=post-tag><a href=https://blog.hellowood.dev/tags/homelab>HomeLab</a></li></ul></div><div class=post-content><p>在使用 Traefik 作为 Homelab 的网关时，考虑到部分服务涉及隐私，因此需要限制用户登陆后才能使用；</p><p>Traefik 支持使用 HTTP 中间件，可以将鉴权信息转发给其他服务进行鉴权，因此，使用 <a href=https://github.com/thomseddon/traefik-forward-auth>https://github.com/thomseddon/traefik-forward-auth</a> 作为鉴权的服务，该服务默认使用 Google OAuth，因此，可以通过 Google 账号登陆访问内部服务；该服务也支持任何 OAuth 标准的认证服务，如 GitHub，微软等</p><h2 id=申请-oauth-应用>申请 OAuth 应用</h2><p>在 <a href=https://console.cloud.google.com/apis/credentials>Google Cloud</a> 创建新的应用，选择 &ldquo;APIs and Services&rdquo; -> &ldquo;Credentials&rdquo;，选择 &ldquo;CREATE CREDENTIALS&rdquo; -> &ldquo;OAuth Client ID&rdquo;，应用类型选择 &ldquo;Web Application&rdquo;，填写名称，重定向 URL 为要访问的 URL + 认证路径，traefik-forward-auth 的认证路径为 <code>/_oauth</code></p><p><img src=https://img.hellowood.dev/picture/homelab-traefik-sso-google-oauth-apply-oauth-app.png alt=homelab-traefik-sso-google-oauth-apply-oauth-app.png></p><p>确认后会提示 Client ID 和 Client Secret，需要保存好，作为 traefik-forward-auth 配置</p><h2 id=为特定的服务添加认证>为特定的服务添加认证</h2><p>认证特定的服务，需要启动 traefik-forward-auth 服务，然后为要认证的服务添加中间件即可；如这里给 whoami 服务添加了名为 <code>traefik-forward-auth</code> 的 HTTP 中间件</p><p>这里通过将域名指向本地的方式进行测试，如在 <code>/etc/hosts</code> 中添加 <code>whoami.homelab.io</code>相关的域名作为 whoami 服务的域名：</p><ul><li><code>/etc/hosts</code></li></ul><pre tabindex=0><code>127.0.0.1 whoami.homelab.io
</code></pre><ul><li>docker-compose.yaml</li></ul><p>需要将 <code>GOOGLE_CLIENT_ID</code> 和 <code>GOOGLE_CLIENT_SECRET</code> 替换为自己申请的</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#e06c75>version</span>: <span style=color:#63c381>&#34;3&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>traefik</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>driver</span>: <span style=color:#98c379>bridge</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>traefik</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>image</span>: <span style=color:#98c379>traefik:v3.0</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>container_name</span>: <span style=color:#98c379>traefik</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>command</span>: --<span style=color:#98c379>api.insecure=true --api.dashboard=true --providers.docker</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;80:80&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;8080:8080&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>traefik</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>/var/run/docker.sock:/var/run/docker.sock</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>traefik-forward-auth</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>image</span>: <span style=color:#98c379>thomseddon/traefik-forward-auth</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>container_name</span>: <span style=color:#63c381>&#34;traefik-forward-auth&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>PROVIDERS_GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}</span>
</span></span><span style=display:flex><span>      - <span style=color:#98c379>PROVIDERS_GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}</span>
</span></span><span style=display:flex><span>      - <span style=color:#98c379>SECRET=traefik</span>
</span></span><span style=display:flex><span>      - <span style=color:#98c379>INSECURE_COOKIE=true</span> <span style=color:#8a93a5;font-style:italic># 允许 HTTP 访问</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>labels</span>:
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;traefik.http.services.traefik-forward-auth.loadbalancer.server.port=4181&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;traefik.http.routers.traefik-forward-auth.middlewares=traefik-forward-auth&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;traefik.http.middlewares.traefik-forward-auth.forwardauth.address=http://traefik-forward-auth:4181&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;traefik.http.middlewares.traefik-forward-auth.forwardauth.authResponseHeaders=X-Forwarded-User&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>traefik</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>whoami</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>image</span>: <span style=color:#63c381>&#34;traefik/whoami&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>container_name</span>: <span style=color:#63c381>&#34;whoami&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>labels</span>:
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;traefik.enable=true&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;traefik.http.services.whoami.loadbalancer.server.port=80&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;traefik.http.routers.whoami.rule=Host(`whoami.homelab.io`)&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;traefik.http.routers.whoami.middlewares=traefik-forward-auth&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>traefik</span>
</span></span></code></pre></div><p>启动成功后，通过无痕浏览器访问 <a href=http://whoami.homelab.io/>http://whoami.homelab.io/</a>，会跳转到 Google 账号登陆，登陆完成后，会重定向到 <a href=http://whoami.homelab.io/_oauth>http://whoami.homelab.io/_oauth</a> 进行认证，认证通过后再次重定向到 <a href=http://whoami.homelab.io/>http://whoami.homelab.io/</a>，同时会添加名称为 <code>_forward_auth</code> 的 Cookie，作为后续访问的凭证</p><h2 id=为域名添加认证>为域名添加认证</h2><p>通常我们会使用子域名指向不同的服务，当有大量服务时，域名的认证配置就会非常复杂，容易漏掉；而且每个都需要登陆一次；因此需要通过给域名添加认证的方式，为所有子域名认证</p><ul><li><code>/etc/hosts</code></li></ul><p>同样，我们还是将域名指向本地进行测试；这次添加了多个域名</p><pre tabindex=0><code>127.0.0.1 homelab.io
127.0.0.1 auth.homelab.io
127.0.0.1 whoami.homelab.io
</code></pre><ul><li>docker-compose.yaml</li></ul><p>配置有以下变动：</p><ol><li>treafik 需要声明 entrypoints 并为其指定中间件为 <code>traefik-forward-auth@docker</code></li><li>treafik-forward-auth 需要指定 <code>COOKIE_DOMAIN</code> 为上级域名，这样所有的子域名都可以访问到；同时需要指定 <code>AUTH_HOST</code>，用于认证服务的域名</li><li>whoami 服务删除了中间件配置</li><li>Google Cloud 应用到 OAuth 配置中的重定向 URL 改为 <a href=http://auth.homelab.io/_oauth>http://auth.homelab.io/_oauth</a></li></ol><p>这样就可以对 Traefik 下所有的服务进行认证；同时，只允许自己的账户访问，因此通过环境变量的方式指定白名单</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#e06c75>version</span>: <span style=color:#d19a66>3</span><span style=color:#98c379>&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>traefik</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>driver</span>: <span style=color:#98c379>bridge</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>traefik</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>image</span>: <span style=color:#98c379>traefik:v3.0</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>container_name</span>: <span style=color:#98c379>traefik</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>command</span>: |<span style=color:#7e97c3>
</span></span></span><span style=display:flex><span><span style=color:#7e97c3>      --api.insecure=true 
</span></span></span><span style=display:flex><span><span style=color:#7e97c3>      --api.dashboard=true 
</span></span></span><span style=display:flex><span><span style=color:#7e97c3>      --providers.docker 
</span></span></span><span style=display:flex><span><span style=color:#7e97c3>      --entrypoints.web.address=:80 
</span></span></span><span style=display:flex><span><span style=color:#7e97c3>      --entrypoints.web.http.middlewares=traefik-forward-auth@docker</span>      
</span></span><span style=display:flex><span>    <span style=color:#e06c75>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;80:80&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;8080:8080&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>labels</span>:
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;traefik.enable=true&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;traefik.http.services.traefik.loadbalancer.server.port=8080&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;traefik.http.routers.traefik.rule=Host(`homelab.io`)&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>traefik</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>/var/run/docker.sock:/var/run/docker.sock</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>traefik-forward-auth</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>image</span>: <span style=color:#98c379>thomseddon/traefik-forward-auth:0</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>container_name</span>: <span style=color:#63c381>&#34;traefik-forward-auth&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>PROVIDERS_GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}</span>
</span></span><span style=display:flex><span>      - <span style=color:#98c379>PROVIDERS_GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}</span>
</span></span><span style=display:flex><span>      - <span style=color:#98c379>SECRET=traefik</span>
</span></span><span style=display:flex><span>      - <span style=color:#98c379>INSECURE_COOKIE=true</span> <span style=color:#8a93a5;font-style:italic># 允许 HTTP 访问</span>
</span></span><span style=display:flex><span>      - <span style=color:#98c379>COOKIE_DOMAIN=homelab.io</span> <span style=color:#8a93a5;font-style:italic># 指定 Cookie 的域名</span>
</span></span><span style=display:flex><span>      - <span style=color:#98c379>AUTH_HOST=auth.homelab.io</span> <span style=color:#8a93a5;font-style:italic># 指定认证服务的域名</span>
</span></span><span style=display:flex><span>      - <span style=color:#98c379>WHITELIST=a@google.com,b@google.com</span> <span style=color:#8a93a5;font-style:italic># 只允许白名单用户访问</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>labels</span>:
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;traefik.http.routers.traefik-forward-auth.rule=Host(`auth.homelab.io`)&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;traefik.http.services.traefik-forward-auth.loadbalancer.server.port=4181&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;traefik.http.middlewares.traefik-forward-auth.forwardauth.address=http://traefik-forward-auth:4181&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;traefik.http.middlewares.traefik-forward-auth.forwardauth.authResponseHeaders=X-Forwarded-User&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>traefik</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>whoami</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>image</span>: <span style=color:#63c381>&#34;traefik/whoami&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>container_name</span>: <span style=color:#63c381>&#34;whoami&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>labels</span>:
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;traefik.enable=true&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;traefik.http.routers.whoami.rule=Host(`whoami.homelab.io`)&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#63c381>&#34;traefik.http.services.whoami.loadbalancer.server.port=80&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#98c379>traefik</span>
</span></span></code></pre></div><h2 id=使用-github-认证>使用 GitHub 认证</h2><p>treafik-forward-auth 支持使用其他的 OAuth 服务进行认证，只需要修改配置即可；通过环境变量指定使用的认证服务类型，以及相关的 URL</p><ul><li>申请 OAuth 应用</li></ul><p>在 GitHub -> Settings -> Developer settings 申请 OAuth 应用，指定 Callback URL 为 <a href=http://auth.homelab.io/_oauth>http://auth.homelab.io/_oauth</a></p><p><img src=https://img.hellowood.dev/picture/homelab-traefik-sso-github-oauth-apply-oauth-app.png alt=homelab-traefik-sso-github-oauth-apply-oauth-app.png></p><ul><li>docker-compose.yaml</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># ...</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>traefik-forward-auth</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>image</span>: <span style=color:#98c379>thomseddon/traefik-forward-auth:0</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>container_name</span>: <span style=color:#63c381>&#34;traefik-forward-auth&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e06c75>environment</span>:
</span></span><span style=display:flex><span>    - <span style=color:#98c379>DEFAULT_PROVIDER=generic-oauth</span> <span style=color:#8a93a5;font-style:italic># 使用通用的 OAuth</span>
</span></span><span style=display:flex><span>    - <span style=color:#98c379>PROVIDERS_GENERIC_OAUTH_AUTH_URL=https://github.com/login/oauth/authorize</span>
</span></span><span style=display:flex><span>    - <span style=color:#98c379>PROVIDERS_GENERIC_OAUTH_CLIENT_ID=${GITHUB_CLIENT_ID}</span>
</span></span><span style=display:flex><span>    - <span style=color:#98c379>PROVIDERS_GENERIC_OAUTH_CLIENT_SECRET=${GITHUB_CLIENT_SECRET}</span>
</span></span><span style=display:flex><span>    - <span style=color:#98c379>PROVIDERS_GENERIC_OAUTH_TOKEN_URL=https://github.com/login/oauth/access_token</span>
</span></span><span style=display:flex><span>    - <span style=color:#98c379>PROVIDERS_GENERIC_OAUTH_USER_URL=https://api.github.com/user</span>
</span></span><span style=display:flex><span>    - <span style=color:#98c379>SECRET=traefik</span>
</span></span><span style=display:flex><span>    - <span style=color:#98c379>INSECURE_COOKIE=true</span> <span style=color:#8a93a5;font-style:italic># 允许 HTTP 访问</span>
</span></span><span style=display:flex><span>    - <span style=color:#98c379>COOKIE_DOMAIN=homelab.io</span> <span style=color:#8a93a5;font-style:italic># 指定 Cookie 的域名</span>
</span></span><span style=display:flex><span>    - <span style=color:#98c379>AUTH_HOST=auth.homelab.io</span> <span style=color:#8a93a5;font-style:italic># 指定认证服务的域名</span>
</span></span><span style=display:flex><span><span style=color:#8a93a5;font-style:italic># ...</span>
</span></span></code></pre></div></div><div class=prev-next></div><svg id="btt-button" class="arrow-logo" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script><div id=comments><script src=https://utteranc.es/client.js repo=helloworlde/helloworlde.github.io issue-term=title theme=github-light crossorigin=anonymous async></script></div></div></main><footer class=footer><span>&copy; 2023 hellowood.dev</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>