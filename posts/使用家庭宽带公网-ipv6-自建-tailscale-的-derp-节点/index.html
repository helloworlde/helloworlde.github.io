<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>使用家庭宽带公网 IPV6 自建 Tailscale 的 DERP 节点</title>
<meta charset=utf-8><meta name=description content="Ladder@使用家庭宽带公网 IPV6 自建 Tailscale 的 DERP 节点 日常使用 Tailscale 连接异地的设备，但是因为经常出现无法直接连接，需要通过香港或东京的 DERP 服务器进行转发，导致延迟很高，影响网络质量；因此计划使用自建的 DERP 解决无法直连的问题；如果部署在国内的服务器上绑定域名需要备案，但是活动购买的服务器限制性能限制带宽限制流量还要单独购买公网 IP，并不合适；国外的延迟高可能还不如 Tailscale 官方的 DERP；
另外自建的 DERP 服务器要求节点能够直接通过公网访问，不能在 NAT 或者负载均衡后面，因此基于家庭宽带的公网 IPV6 自建 DERP 服务器最合适
现状 检测 tailscale 的网络节点，延迟最低的是东京的节点，延迟在 70 ms 左右
tailscale netcheck Report: * UDP: true * IPv4: yes, xxx.xxx.xxx.xxx:39325 * IPv6: yes, [2409:xxxx:xxxx:xxxx::xxxx]:34341 * MappingVariesByDestIP: false * HairPinning: false * PortMapping: * CaptivePortal: false * Nearest DERP: Tokyo * DERP latency: - tok: 71.6ms (Tokyo) - hkg: 93."><meta name=author content="HelloWood"><link rel=canonical href=https://blog.hellowood.dev/posts/%E4%BD%BF%E7%94%A8%E5%AE%B6%E5%BA%AD%E5%AE%BD%E5%B8%A6%E5%85%AC%E7%BD%91-ipv6-%E8%87%AA%E5%BB%BA-tailscale-%E7%9A%84-derp-%E8%8A%82%E7%82%B9/><meta name=google-site-verification content="G-3MSGPYTHPZ"><link rel=alternate type=application/rss+xml href=https://blog.hellowood.dev//index.xml title=HelloWood><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ")}</script><script async defer data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301 src=https://umami.hellowood.dev/script.js></script><script defer data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}' src=https://static.cloudflareinsights.com/beacon.min.js></script><meta property="og:url" content="https://blog.hellowood.dev/posts/%E4%BD%BF%E7%94%A8%E5%AE%B6%E5%BA%AD%E5%AE%BD%E5%B8%A6%E5%85%AC%E7%BD%91-ipv6-%E8%87%AA%E5%BB%BA-tailscale-%E7%9A%84-derp-%E8%8A%82%E7%82%B9/"><meta property="og:site_name" content="HelloWood"><meta property="og:title" content="使用家庭宽带公网 IPV6 自建 Tailscale 的 DERP 节点"><meta property="og:description" content="使用家庭宽带公网 IPV6 自建 Tailscale 的 DERP 节点 日常使用 Tailscale 连接异地的设备，但是因为经常出现无法直接连接，需要通过香港或东京的 DERP 服务器进行转发，导致延迟很高，影响网络质量；因此计划使用自建的 DERP 解决无法直连的问题；如果部署在国内的服务器上绑定域名需要备案，但是活动购买的服务器限制性能限制带宽限制流量还要单独购买公网 IP，并不合适；国外的延迟高可能还不如 Tailscale 官方的 DERP；
另外自建的 DERP 服务器要求节点能够直接通过公网访问，不能在 NAT 或者负载均衡后面，因此基于家庭宽带的公网 IPV6 自建 DERP 服务器最合适
现状 检测 tailscale 的网络节点，延迟最低的是东京的节点，延迟在 70 ms 左右
tailscale netcheck Report: * UDP: true * IPv4: yes, xxx.xxx.xxx.xxx:39325 * IPv6: yes, [2409:xxxx:xxxx:xxxx::xxxx]:34341 * MappingVariesByDestIP: false * HairPinning: false * PortMapping: * CaptivePortal: false * Nearest DERP: Tokyo * DERP latency: - tok: 71.6ms (Tokyo) - hkg: 93."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-06-11T21:33:44+08:00"><meta property="article:modified_time" content="2024-06-11T21:33:44+08:00"><meta property="article:tag" content="HomeLab"><meta property="article:tag" content="Network"><meta property="og:see_also" content="https://blog.hellowood.dev/posts/ubuntu-22-%E7%8E%AF%E5%A2%83%E5%88%9D%E5%A7%8B%E5%8C%96/"><meta property="og:see_also" content="https://blog.hellowood.dev/posts/proxmox-ve-%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84-lxc-%E5%AE%B9%E5%99%A8-ct-%E6%A8%A1%E6%9D%BF/"><meta property="og:see_also" content="https://blog.hellowood.dev/posts/%E5%9C%A8%E9%BB%91%E7%BE%A4%E6%99%96%E4%BD%BF%E7%94%A8-docker-%E9%83%A8%E7%BD%B2-proxmox-backup-server/"><meta property="og:see_also" content="https://blog.hellowood.dev/posts/%E4%BD%BF%E7%94%A8%E9%98%BF%E5%B0%94%E5%8D%A1%E7%89%B9%E7%8C%AB%E6%A3%92%E6%9B%BF%E6%8D%A2%E5%8C%97%E4%BA%AC%E7%A7%BB%E5%8A%A8-gpon-%E5%85%89%E7%8C%AB/"><meta property="og:see_also" content="https://blog.hellowood.dev/posts/%E4%BD%BF%E7%94%A8cloudflare-tunnels%E9%80%9A%E8%BF%87web-ssh%E8%AE%BF%E9%97%AE%E6%9C%8D%E5%8A%A1%E5%99%A8/"><meta property="og:see_also" content="https://blog.hellowood.dev/posts/linux%E7%8E%AF%E5%A2%83%E4%B8%8B%E9%85%8D%E7%BD%AE%E4%B8%8D%E9%97%B4%E6%96%AD%E7%94%B5%E6%BA%90ups/"><meta property="og:see_also" content="https://blog.hellowood.dev/posts/%E4%BD%BF%E7%94%A8%E9%98%BF%E5%B0%94%E5%8D%A1%E7%89%B9%E7%8C%AB%E6%A3%92%E6%9B%BF%E6%8D%A2%E5%8C%97%E4%BA%AC%E7%A7%BB%E5%8A%A8-gpon-%E5%85%89%E7%8C%AB/"><meta name=twitter:card content="summary"><meta name=twitter:title content="使用家庭宽带公网 IPV6 自建 Tailscale 的 DERP 节点"><meta name=twitter:description content="使用家庭宽带公网 IPV6 自建 Tailscale 的 DERP 节点 日常使用 Tailscale 连接异地的设备，但是因为经常出现无法直接连接，需要通过香港或东京的 DERP 服务器进行转发，导致延迟很高，影响网络质量；因此计划使用自建的 DERP 解决无法直连的问题；如果部署在国内的服务器上绑定域名需要备案，但是活动购买的服务器限制性能限制带宽限制流量还要单独购买公网 IP，并不合适；国外的延迟高可能还不如 Tailscale 官方的 DERP；
另外自建的 DERP 服务器要求节点能够直接通过公网访问，不能在 NAT 或者负载均衡后面，因此基于家庭宽带的公网 IPV6 自建 DERP 服务器最合适
现状 检测 tailscale 的网络节点，延迟最低的是东京的节点，延迟在 70 ms 左右
tailscale netcheck Report: * UDP: true * IPv4: yes, xxx.xxx.xxx.xxx:39325 * IPv6: yes, [2409:xxxx:xxxx:xxxx::xxxx]:34341 * MappingVariesByDestIP: false * HairPinning: false * PortMapping: * CaptivePortal: false * Nearest DERP: Tokyo * DERP latency: - tok: 71.6ms (Tokyo) - hkg: 93."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.hellowood.dev/posts/"},{"@type":"ListItem","position":2,"name":"使用家庭宽带公网 IPV6 自建 Tailscale 的 DERP 节点","item":"https://blog.hellowood.dev/posts/%E4%BD%BF%E7%94%A8%E5%AE%B6%E5%BA%AD%E5%AE%BD%E5%B8%A6%E5%85%AC%E7%BD%91-ipv6-%E8%87%AA%E5%BB%BA-tailscale-%E7%9A%84-derp-%E8%8A%82%E7%82%B9/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"使用家庭宽带公网 IPV6 自建 Tailscale 的 DERP 节点","name":"使用家庭宽带公网 IPV6 自建 Tailscale 的 DERP 节点","description":"使用家庭宽带公网 IPV6 自建 Tailscale 的 DERP 节点 日常使用 Tailscale 连接异地的设备，但是因为经常出现无法直接连接，需要通过香港或东京的 DERP 服务器进行转发，导致延迟很高，影响网络质量；因此计划使用自建的 DERP 解决无法直连的问题；如果部署在国内的服务器上绑定域名需要备案，但是活动购买的服务器限制性能限制带宽限制流量还要单独购买公网 IP，并不合适；国外的延迟高可能还不如 Tailscale 官方的 DERP；\n另外自建的 DERP 服务器要求节点能够直接通过公网访问，不能在 NAT 或者负载均衡后面，因此基于家庭宽带的公网 IPV6 自建 DERP 服务器最合适\n现状 检测 tailscale 的网络节点，延迟最低的是东京的节点，延迟在 70 ms 左右\ntailscale netcheck Report: * UDP: true * IPv4: yes, xxx.xxx.xxx.xxx:39325 * IPv6: yes, [2409:xxxx:xxxx:xxxx::xxxx]:34341 * MappingVariesByDestIP: false * HairPinning: false * PortMapping: * CaptivePortal: false * Nearest DERP: Tokyo * DERP latency: - tok: 71.6ms (Tokyo) - hkg: 93.","keywords":["HomeLab","Network"],"articleBody":"使用家庭宽带公网 IPV6 自建 Tailscale 的 DERP 节点 日常使用 Tailscale 连接异地的设备，但是因为经常出现无法直接连接，需要通过香港或东京的 DERP 服务器进行转发，导致延迟很高，影响网络质量；因此计划使用自建的 DERP 解决无法直连的问题；如果部署在国内的服务器上绑定域名需要备案，但是活动购买的服务器限制性能限制带宽限制流量还要单独购买公网 IP，并不合适；国外的延迟高可能还不如 Tailscale 官方的 DERP；\n另外自建的 DERP 服务器要求节点能够直接通过公网访问，不能在 NAT 或者负载均衡后面，因此基于家庭宽带的公网 IPV6 自建 DERP 服务器最合适\n现状 检测 tailscale 的网络节点，延迟最低的是东京的节点，延迟在 70 ms 左右\ntailscale netcheck Report: * UDP: true * IPv4: yes, xxx.xxx.xxx.xxx:39325 * IPv6: yes, [2409:xxxx:xxxx:xxxx::xxxx]:34341 * MappingVariesByDestIP: false * HairPinning: false * PortMapping: * CaptivePortal: false * Nearest DERP: Tokyo * DERP latency: - tok: 71.6ms (Tokyo) - hkg: 93.1ms (Hong Kong) - sin: 100.5ms (Singapore) 自建 DERP 节点 1. 要求 可访问的公网 IPV4 或 IPV6 地址 域名，DERP 不修改源码必须要使用域名访问 开放 DERP和 STUN端口 tailscale 的 Prerequisites文档中要求开放HTTP/HTTPS/STUN 三个端口，默认是 80/443/3478 端口，实际上有 HTTPS/STUN 就够了\n2. 申请 Let’s Encrypt 证书 Tailscale 的流量必须通过 HTTPS 进行转发，因此域名需要有有效的 TLS 证书，可以使用免费的 Let’s Encrypt 证书；\n申请 Let’s Encrypt 证书可以通过 Lego、Certbot、acme.sh 等多种方式；这里使用 Lego；\n在申请证书的过程中，Lego 需要添加一条 _acme-challenge.域名 的 txt 记录用于验证域名的信息，所以需要通过 API 添加 DNS 解析\n我的域名解析是通过 Cloudflare 托管的，所以需要 Clouflare 的认证信息，得申请一个有 DNS 编辑权限的TOKEN，参考 Create an API token\n申请证书 CLOUDFLARE_PROPAGATION_TIMEOUT=300 \\ CLOUDFLARE_DNS_API_TOKEN=申请的 TOKEN \\ lego --dns cloudflare \\ --domains 域名 \\ --email 邮箱 \\ --dns.resolvers 1.1.1.1 \\ run CLOUDFLARE_PROPAGATION_TIMEOUT 用于控制等待 DNS 记录验证的超时时间，默认为2分钟，但是这个时间 DNS 不一定能生效，可能会导致申请失败，因此配置为 5分钟；同时通过 dns.resolvers 指定 DNS 服务器为 1.1.1.1，避免局域网内的 DNS 服务器查询时没有记录导致申请失败\n3. 启动 DERP 服务器 docker-compose.yaml 需要注意的是，STUN 使用的 3478 端口必须是 UDP 协议，否则会导致连接失败；家庭宽带的 80/443 是不允许对外开放的，因此修改 HTTPS 端口为 12345\n另外，需要将申请的证书的 .key 和 .crt 文件上传到 cert 路径下，挂载到容器中\nversion: '3.8' services: derper: image: yangchuansheng/derper:latest container_name: derper restart: always ports: - \"12345:12345\" - \"3478:3478/udp\" volumes: - ./cert:/app/certs environment: - DERP_VERIFY_CLIENTS=false - DERP_CERT_MODE=manual - DERP_ADDR=:12345 - DERP_DOMAIN=域名 - DERP_DEBUG_LOGS=true 启动 docker-compose up -d 输出日志：\nderper | 2024/06/09 11:35:54 no config path specified; using /var/lib/derper/derper.key derper | 2024/06/09 11:35:54 derper: serving on :12345 with TLS derper | 2024/06/09 11:35:54 running STUN server on [::]:3478 检查 DERP 是否可用 配置 DNS 解析到 DERP 所在的公网地址后，如果能通过域名正常访问，说明证书配置没有问题\n4. 修改 tailscale 配置 登录 Tailscale 的控制页面，选择 Access Controls，添加 derpMap 部分的配置，并保存\n{ // ... \"derpMap\": { \"OmitDefaultRegions\": false,// 是否仅使用自定义的 DERP 节点，默认为 false \"Regions\": { \"900\": { \"RegionID\": 900, // 900-999之间 \"RegionCode\": \"homelab\", // 自定义 Code \"RegionName\": \"HomeLab\", // 自定义名称 \"Nodes\": [ // derp 服务器节点 { \"Name\": \"HomeLab Server\",// 名称 \"RegionID\": 900, // 和上面的 regionId 一样 \"HostName\": \"derp.xxx.xxx\", // 域名 \"DERPPort\": 12345, // DERP 服务器 HTTPS 端口，默认为 443,用于数据中转 \"STUNPort\": 3478, // DERP 服务器 STUN 端口，默认为3478，用于 NAT 穿越的端口 // \"IPv6\": \"2409:xxxx:xxxx:xxxx::xxxx\", // IPV6 地址，用于在测试阶段绕过域名解析 // \"InsecureForTests\": true, // 如果 TLS 证书未申请，则可以不检测证书 } ] } } } } 关于配置字段的详细解释可以参考 DERPRegion 和 DERPNode\n检查网络连接 使用 tailscale netcheck 命令检查网络，配置的 HomeLab 节点的可以正常通信，说明配置成功；最近的 DERP 节点是 HomeLab 而不再是东京，延迟为 40ms 左右\ntailscale netcheck Report: * UDP: true * IPv4: yes, xxx.xxx.0.1:34176 * IPv6: yes, [2409:xxxx:xxxx:xxxx]:47123 * MappingVariesByDestIP: true * HairPinning: false * PortMapping: * CaptivePortal: false * Nearest DERP: HomeLab * DERP latency: - homelab: 47.3ms (HomeLab) - tok: 115.7ms (Tokyo) - hkg: 117.9ms (Hong Kong) - sin: 163.4ms (Singapore) - syd: 191.5ms (Sydney) - par: 220.7ms (Paris) 启用客户端校验 不开启客户端校验时，别人只需要将地址添加到 Access Control 中即可进行转发，这样会导致自己的节点的带宽和流量被占用，因此最好开启客户端校验\n开启客户端校验需要部署 DERP 的服务器自己也是 Tailscale 的节点，另外还需要将 /var/run/tailscale/tailscaled.sock 挂载到容器中用于通信\ndocker-compose.yaml version: '3.8' services: derper: image: yangchuansheng/derper:latest container_name: derper restart: always ports: - \"12345:12345\" - \"3478:3478/udp\" volumes: - ./cert:/app/certs - /var/run/tailscale/tailscaled.sock:/var/run/tailscale/tailscaled.sock environment: - DERP_VERIFY_CLIENTS=true - DERP_CERT_MODE=manual - DERP_ADDR=:12345 - DERP_DOMAIN=derp.xxx.xxx - DERP_DEBUG_LOGS=true 参考文档 Custom DERP Servers 浅探 Tailscale DERP 中转服务 How NAT traversal works Tailscale 基础教程：部署私有 DERP 中继服务器 ","wordCount":"501","inLanguage":"en","datePublished":"2024-06-11T21:33:44+08:00","dateModified":"2024-06-11T21:33:44+08:00","author":{"@type":"Person","name":"HelloWood"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.hellowood.dev/posts/%E4%BD%BF%E7%94%A8%E5%AE%B6%E5%BA%AD%E5%AE%BD%E5%B8%A6%E5%85%AC%E7%BD%91-ipv6-%E8%87%AA%E5%BB%BA-tailscale-%E7%9A%84-derp-%E8%8A%82%E7%82%B9/"},"publisher":{"@type":"Organization","name":"HelloWood","logo":{"@type":"ImageObject","url":"https://blog.hellowood.dev/favicon.ico"}}}</script><link rel=icon href=/images/avatar.png sizes=16x16><link rel=apple-touch-icon href=/images/avatar.png><link rel=manifest href=/images/avatar.png><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.ff1bc260fafbfb440e10194d7d06d57eb5e85eed11d12d06255581262664204e.css integrity="sha256-/xvCYPr7+0QOEBlNfQbVfrXoXu0R0S0GJVWBJiZkIE4=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><meta name=google-adsense-account content="ca-pub-3401351766168985"><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jtbhx98g62")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3401351766168985" crossorigin=anonymous></script><script defer src=https://analytics.us.umami.is/script.js data-website-id=73ff1c8c-9938-43cf-81af-e77e26b0cca3></script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand data-umami-event=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Blog href=/posts>Blog</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Tags href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Archive href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Dashboard href=https://umami.hellowood.dev/share/lab/Blog>Dashboard</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link data-umami-event=navigation-social href=https://github.com/helloworlde><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button data-umami-event=toggle-theme aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
<span class=toggle-light><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>使用家庭宽带公网 IPV6 自建 Tailscale 的 DERP 节点</h1></header><p><small>June 11, 2024&nbsp;· 501 words&nbsp;· 3 min</small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#现状>现状</a></li><li><a href=#自建-derp-节点>自建 DERP 节点</a><ul><li><a href=#1-要求>1. 要求</a></li><li><a href=#2-申请-lets-encrypt-证书>2. 申请 Let&rsquo;s Encrypt 证书</a></li><li><a href=#3-启动-derp-服务器>3. 启动 DERP 服务器</a></li><li><a href=#4-修改-tailscale-配置>4. 修改 tailscale 配置</a></li></ul></li><li><a href=#检查网络连接>检查网络连接</a></li><li><a href=#启用客户端校验>启用客户端校验</a></li><li><a href=#参考文档>参考文档</a></li></ul></nav></div><section class=blog-content><h1 id=使用家庭宽带公网-ipv6-自建-tailscale-的-derp-节点>使用家庭宽带公网 IPV6 自建 Tailscale 的 DERP 节点</h1><p>日常使用 Tailscale 连接异地的设备，但是因为经常出现无法直接连接，需要通过香港或东京的 DERP 服务器进行转发，导致延迟很高，影响网络质量；因此计划使用自建的 DERP 解决无法直连的问题；如果部署在国内的服务器上绑定域名需要备案，但是活动购买的服务器限制性能限制带宽限制流量还要单独购买公网 IP，并不合适；国外的延迟高可能还不如 Tailscale 官方的 DERP；</p><p>另外自建的 DERP 服务器要求节点能够直接通过公网访问，不能在 NAT 或者负载均衡后面，因此基于家庭宽带的公网 IPV6 自建 DERP 服务器最合适</p><h2 id=现状>现状</h2><p>检测 tailscale 的网络节点，延迟最低的是东京的节点，延迟在 70 ms 左右</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>tailscale netcheck
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Report:
</span></span><span style=display:flex><span>	* UDP: true
</span></span><span style=display:flex><span>	* IPv4: yes, xxx.xxx.xxx.xxx:39325
</span></span><span style=display:flex><span>	* IPv6: yes, <span style=color:#f92672>[</span>2409:xxxx:xxxx:xxxx::xxxx<span style=color:#f92672>]</span>:34341
</span></span><span style=display:flex><span>	* MappingVariesByDestIP: false
</span></span><span style=display:flex><span>	* HairPinning: false
</span></span><span style=display:flex><span>	* PortMapping:
</span></span><span style=display:flex><span>	* CaptivePortal: false
</span></span><span style=display:flex><span>	* Nearest DERP: Tokyo
</span></span><span style=display:flex><span>	* DERP latency:
</span></span><span style=display:flex><span>		- tok: 71.6ms  <span style=color:#f92672>(</span>Tokyo<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>		- hkg: 93.1ms  <span style=color:#f92672>(</span>Hong Kong<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>		- sin: 100.5ms <span style=color:#f92672>(</span>Singapore<span style=color:#f92672>)</span>
</span></span></code></pre></div><h2 id=自建-derp-节点>自建 DERP 节点</h2><h3 id=1-要求>1. 要求</h3><ul><li>可访问的公网 IPV4 或 IPV6 地址</li><li>域名，DERP 不修改源码必须要使用域名访问</li><li>开放 DERP和 STUN端口</li></ul><p>tailscale 的 <a href=https://tailscale.com/kb/1118/custom-derp-servers#prerequisites>Prerequisites</a>文档中要求开放HTTP/HTTPS/STUN 三个端口，默认是 80/443/3478 端口，实际上有 HTTPS/STUN 就够了</p><h3 id=2-申请-lets-encrypt-证书>2. 申请 Let&rsquo;s Encrypt 证书</h3><p>Tailscale 的流量必须通过 HTTPS 进行转发，因此域名需要有有效的 TLS 证书，可以使用免费的 Let&rsquo;s Encrypt 证书；</p><p>申请 Let&rsquo;s Encrypt 证书可以通过 Lego、Certbot、acme.sh 等多种方式；这里使用 Lego；</p><p>在申请证书的过程中，Lego 需要添加一条 <code>_acme-challenge.域名</code> 的 txt 记录用于验证域名的信息，所以需要通过 API 添加 DNS 解析</p><p>我的域名解析是通过 Cloudflare 托管的，所以需要 Clouflare 的认证信息，得申请一个有 DNS 编辑权限的TOKEN，参考 <a href=https://developers.cloudflare.com/fundamentals/api/get-started/create-token/>Create an API token</a></p><ul><li>申请证书</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>CLOUDFLARE_PROPAGATION_TIMEOUT<span style=color:#f92672>=</span><span style=color:#ae81ff>300</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  CLOUDFLARE_DNS_API_TOKEN<span style=color:#f92672>=</span>申请的 TOKEN <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  lego --dns cloudflare <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --domains 域名 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --email 邮箱 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --dns.resolvers 1.1.1.1 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  run
</span></span></code></pre></div><p><code>CLOUDFLARE_PROPAGATION_TIMEOUT</code> 用于控制等待 DNS 记录验证的超时时间，默认为2分钟，但是这个时间 DNS 不一定能生效，可能会导致申请失败，因此配置为 5分钟；同时通过 <code>dns.resolvers</code> 指定 DNS 服务器为 <code>1.1.1.1</code>，避免局域网内的 DNS 服务器查询时没有记录导致申请失败</p><h3 id=3-启动-derp-服务器>3. 启动 DERP 服务器</h3><ul><li>docker-compose.yaml</li></ul><p>需要注意的是，STUN 使用的 3478 端口必须是 UDP 协议，否则会导致连接失败；家庭宽带的 80/443 是不允许对外开放的，因此修改 HTTPS 端口为 12345</p><p>另外，需要将申请的证书的 <code>.key</code> 和 <code>.crt</code> 文件上传到 <code>cert</code> 路径下，挂载到容器中</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3.8&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>derper</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>yangchuansheng/derper:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>derper</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;12345:12345&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;3478:3478/udp&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./cert:/app/certs</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DERP_VERIFY_CLIENTS=false</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DERP_CERT_MODE=manual</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DERP_ADDR=:12345</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DERP_DOMAIN=域名</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>DERP_DEBUG_LOGS=true</span>
</span></span></code></pre></div><ul><li>启动</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker-compose up -d
</span></span></code></pre></div><p>输出日志：</p><pre tabindex=0><code>derper    | 2024/06/09 11:35:54 no config path specified; using /var/lib/derper/derper.key
derper    | 2024/06/09 11:35:54 derper: serving on :12345 with TLS
derper    | 2024/06/09 11:35:54 running STUN server on [::]:3478
</code></pre><ul><li>检查 DERP 是否可用</li></ul><p>配置 DNS 解析到 DERP 所在的公网地址后，如果能通过域名正常访问，说明证书配置没有问题</p><p><img alt=homelab-net-tailscale-derp-server-homepage.png src=https://img.hellowood.dev/picture/homelab-net-tailscale-derp-server-homepage.png></p><h3 id=4-修改-tailscale-配置>4. 修改 tailscale 配置</h3><p>登录 Tailscale 的控制页面，选择 <a href=https://login.tailscale.com/admin/acls/file>Access Controls</a>，添加 derpMap 部分的配置，并保存</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#f92672>&#34;derpMap&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;OmitDefaultRegions&#34;</span>: <span style=color:#66d9ef>false</span>,<span style=color:#75715e>// 是否仅使用自定义的 DERP 节点，默认为 false
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#f92672>&#34;Regions&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;900&#34;</span>: { 
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;RegionID&#34;</span>: <span style=color:#ae81ff>900</span>, <span style=color:#75715e>// 900-999之间
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>&#34;RegionCode&#34;</span>: <span style=color:#e6db74>&#34;homelab&#34;</span>, <span style=color:#75715e>// 自定义 Code
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>&#34;RegionName&#34;</span>: <span style=color:#e6db74>&#34;HomeLab&#34;</span>, <span style=color:#75715e>// 自定义名称
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>&#34;Nodes&#34;</span>: [ <span style=color:#75715e>// derp 服务器节点
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Name&#34;</span>: <span style=color:#e6db74>&#34;HomeLab Server&#34;</span>,<span style=color:#75715e>// 名称
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#f92672>&#34;RegionID&#34;</span>: <span style=color:#ae81ff>900</span>, <span style=color:#75715e>// 和上面的 regionId 一样
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#f92672>&#34;HostName&#34;</span>: <span style=color:#e6db74>&#34;derp.xxx.xxx&#34;</span>, <span style=color:#75715e>// 域名
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#f92672>&#34;DERPPort&#34;</span>: <span style=color:#ae81ff>12345</span>, <span style=color:#75715e>// DERP 服务器 HTTPS 端口，默认为 443,用于数据中转
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#f92672>&#34;STUNPort&#34;</span>: <span style=color:#ae81ff>3478</span>, <span style=color:#75715e>// DERP 服务器 STUN 端口，默认为3478，用于 NAT 穿越的端口
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>// &#34;IPv6&#34;: &#34;2409:xxxx:xxxx:xxxx::xxxx&#34;, // IPV6 地址，用于在测试阶段绕过域名解析
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#75715e>// &#34;InsecureForTests&#34;: true, // 如果 TLS 证书未申请，则可以不检测证书
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          }
</span></span><span style=display:flex><span>        ]
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>关于配置字段的详细解释可以参考 <a href=https://pkg.go.dev/tailscale.com/tailcfg#DERPRegion>DERPRegion</a> 和 <a href=https://pkg.go.dev/tailscale.com/tailcfg#DERPNode>DERPNode</a></p><h2 id=检查网络连接>检查网络连接</h2><p>使用 <code>tailscale netcheck</code> 命令检查网络，配置的 HomeLab 节点的可以正常通信，说明配置成功；最近的 DERP 节点是 HomeLab 而不再是东京，延迟为 40ms 左右</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>tailscale netcheck
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Report:
</span></span><span style=display:flex><span>	* UDP: true
</span></span><span style=display:flex><span>	* IPv4: yes, xxx.xxx.0.1:34176
</span></span><span style=display:flex><span>	* IPv6: yes, <span style=color:#f92672>[</span>2409:xxxx:xxxx:xxxx<span style=color:#f92672>]</span>:47123
</span></span><span style=display:flex><span>	* MappingVariesByDestIP: true
</span></span><span style=display:flex><span>	* HairPinning: false
</span></span><span style=display:flex><span>	* PortMapping:
</span></span><span style=display:flex><span>	* CaptivePortal: false
</span></span><span style=display:flex><span>	* Nearest DERP: HomeLab
</span></span><span style=display:flex><span>	* DERP latency:
</span></span><span style=display:flex><span>		- homelab: 47.3ms  <span style=color:#f92672>(</span>HomeLab<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>		- tok: 115.7ms <span style=color:#f92672>(</span>Tokyo<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>		- hkg: 117.9ms <span style=color:#f92672>(</span>Hong Kong<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>		- sin: 163.4ms <span style=color:#f92672>(</span>Singapore<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>		- syd: 191.5ms <span style=color:#f92672>(</span>Sydney<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>		- par: 220.7ms <span style=color:#f92672>(</span>Paris<span style=color:#f92672>)</span>
</span></span></code></pre></div><h2 id=启用客户端校验>启用客户端校验</h2><p>不开启客户端校验时，别人只需要将地址添加到 Access Control 中即可进行转发，这样会导致自己的节点的带宽和流量被占用，因此最好开启客户端校验</p><p>开启客户端校验需要部署 DERP 的服务器自己也是 Tailscale 的节点，另外还需要将 <code>/var/run/tailscale/tailscaled.sock</code> 挂载到容器中用于通信</p><ul><li>docker-compose.yaml</li></ul><pre tabindex=0><code>version: &#39;3.8&#39;

services:
  derper:
    image: yangchuansheng/derper:latest
    container_name: derper
    restart: always
    ports:
      - &#34;12345:12345&#34;
      - &#34;3478:3478/udp&#34;
    volumes:
      - ./cert:/app/certs
      - /var/run/tailscale/tailscaled.sock:/var/run/tailscale/tailscaled.sock
    environment:
      - DERP_VERIFY_CLIENTS=true
      - DERP_CERT_MODE=manual
      - DERP_ADDR=:12345
      - DERP_DOMAIN=derp.xxx.xxx
      - DERP_DEBUG_LOGS=true
</code></pre><h2 id=参考文档>参考文档</h2><ul><li><a href=https://tailscale.com/kb/1118/custom-derp-servers#prerequisites>Custom DERP Servers</a></li><li><a href=https://kiprey.github.io/2023/11/tailscale-derp>浅探 Tailscale DERP 中转服务</a></li><li><a href=https://tailscale.com/blog/how-nat-traversal-works>How NAT traversal works</a></li><li><a href=https://icloudnative.io/posts/custom-derp-servers>Tailscale 基础教程：部署私有 DERP 中继服务器</a></li></ul></section><div class=paginator><a class=prev href=https://blog.hellowood.dev/posts/ubuntu-22-%E5%AE%89%E8%A3%85-intel-n100-%E6%98%BE%E5%8D%A1%E9%A9%B1%E5%8A%A8/><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg>
<span>Ubuntu 22 安装 Intel N100 显卡驱动</span></a>
<a class=next href=https://blog.hellowood.dev/posts/linux-docker%E5%AE%B9%E5%99%A8%E5%BC%80%E5%90%AFipv6/><span>Linux Docker容器开启IPv6</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div><div class=related-resources><h3>Related Resources</h3><nav><ul><li><a href=/posts/ubuntu-22-%E7%8E%AF%E5%A2%83%E5%88%9D%E5%A7%8B%E5%8C%96/>Ubuntu 22 环境初始化</a></li><li><a href=/posts/proxmox-ve-%E5%88%9B%E5%BB%BA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84-lxc-%E5%AE%B9%E5%99%A8-ct-%E6%A8%A1%E6%9D%BF/>Proxmox VE 创建自定义的 LXC 容器 CT 模板</a></li><li><a href=/posts/%E5%9C%A8%E9%BB%91%E7%BE%A4%E6%99%96%E4%BD%BF%E7%94%A8-docker-%E9%83%A8%E7%BD%B2-proxmox-backup-server/>在黑群晖使用 Docker 部署 Proxmox Backup Server</a></li><li><a href=/posts/%E4%BD%BF%E7%94%A8%E9%98%BF%E5%B0%94%E5%8D%A1%E7%89%B9%E7%8C%AB%E6%A3%92%E6%9B%BF%E6%8D%A2%E5%8C%97%E4%BA%AC%E7%A7%BB%E5%8A%A8-gpon-%E5%85%89%E7%8C%AB/>使用阿尔卡特猫棒替换北京移动 GPON 光猫</a></li><li><a href=/posts/%E4%BD%BF%E7%94%A8cloudflare-tunnels%E9%80%9A%E8%BF%87web-ssh%E8%AE%BF%E9%97%AE%E6%9C%8D%E5%8A%A1%E5%99%A8/>使用 Cloudflare Tunnels 通过 Web SSH 访问服务器</a></li><li><a href=/posts/linux%E7%8E%AF%E5%A2%83%E4%B8%8B%E9%85%8D%E7%BD%AE%E4%B8%8D%E9%97%B4%E6%96%AD%E7%94%B5%E6%BA%90ups/>Linux 环境下配置不间断电源 UPS</a></li><li><a href=/posts/%E4%BD%BF%E7%94%A8-ubuntu-%E6%90%AD%E5%BB%BA-nfs-%E6%9C%8D%E5%8A%A1%E5%99%A8/>使用 Ubuntu 搭建 NFS 服务器</a></li></ul></nav><h3>Related Resources</h3><nav><ul><li><a href=/posts/%E4%BD%BF%E7%94%A8%E9%98%BF%E5%B0%94%E5%8D%A1%E7%89%B9%E7%8C%AB%E6%A3%92%E6%9B%BF%E6%8D%A2%E5%8C%97%E4%BA%AC%E7%A7%BB%E5%8A%A8-gpon-%E5%85%89%E7%8C%AB/>使用阿尔卡特猫棒替换北京移动 GPON 光猫</a></li></ul></nav></div></article></div><footer class=footer><p>&copy; 2024 <a href=https://blog.hellowood.dev/>HelloWood</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank data-umami-event=to-hugo>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank data-umami-event=to-ladder>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g data-umami-event=top-link><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>