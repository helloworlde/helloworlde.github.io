<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>gRPC 中打印请求二进制日志</title>
<meta charset=utf-8><meta name=description content="Ladder@gRPC 中打印请求二进制日志 gRPC 支持将请求调用的参数、Header 等信息以二进制的方式输出到文件中，方便在必要时排查问题
使用 1. 添加依赖 binlog 的依赖在 grpc-services中，所以需要有该依赖
dependencies { implementation(&#34;io.grpc:grpc-services:${grpcVersion}&#34;) } 2. 添加 BinaryLogSink 实现 @Slf4j public class CustomBinaryLogSink implements BinaryLogSink { private final String outPath; private final OutputStream out; private boolean closed; CustomBinaryLogSink(String path) throws IOException { File outFile = new File(path); outPath = outFile.getAbsolutePath(); log.info(&#34;Writing binary logs to {}&#34;, outFile.getAbsolutePath()); out = new BufferedOutputStream(new FileOutputStream(outFile)); } String getPath() { return this.outPath; } @Override public synchronized void write(MessageLite message) { if (closed) { log."><meta name=author content="HelloWood"><link rel=canonical href=https://blog.hellowood.dev/posts/grpc-%E4%B8%AD%E6%89%93%E5%8D%B0%E8%AF%B7%E6%B1%82%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97/><meta name=google-site-verification content="G-3MSGPYTHPZ"><link rel=alternate type=application/rss+xml href=https://blog.hellowood.dev/index.xml title=HelloWood><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ",{anonymize_ip:!1})}</script><script async defer data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301 src=https://umami.hellowood.dev/script.js></script><script defer data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}' src=https://static.cloudflareinsights.com/beacon.min.js></script><meta property="og:title" content="gRPC 中打印请求二进制日志"><meta property="og:description" content="gRPC 中打印请求二进制日志 gRPC 支持将请求调用的参数、Header 等信息以二进制的方式输出到文件中，方便在必要时排查问题
使用 1. 添加依赖 binlog 的依赖在 grpc-services中，所以需要有该依赖
dependencies { implementation(&#34;io.grpc:grpc-services:${grpcVersion}&#34;) } 2. 添加 BinaryLogSink 实现 @Slf4j public class CustomBinaryLogSink implements BinaryLogSink { private final String outPath; private final OutputStream out; private boolean closed; CustomBinaryLogSink(String path) throws IOException { File outFile = new File(path); outPath = outFile.getAbsolutePath(); log.info(&#34;Writing binary logs to {}&#34;, outFile.getAbsolutePath()); out = new BufferedOutputStream(new FileOutputStream(outFile)); } String getPath() { return this.outPath; } @Override public synchronized void write(MessageLite message) { if (closed) { log."><meta property="og:type" content="article"><meta property="og:url" content="https://blog.hellowood.dev/posts/grpc-%E4%B8%AD%E6%89%93%E5%8D%B0%E8%AF%B7%E6%B1%82%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-01-04T22:34:46+00:00"><meta property="article:modified_time" content="2021-01-04T22:34:46+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="gRPC 中打印请求二进制日志"><meta name=twitter:description content="gRPC 中打印请求二进制日志 gRPC 支持将请求调用的参数、Header 等信息以二进制的方式输出到文件中，方便在必要时排查问题
使用 1. 添加依赖 binlog 的依赖在 grpc-services中，所以需要有该依赖
dependencies { implementation(&#34;io.grpc:grpc-services:${grpcVersion}&#34;) } 2. 添加 BinaryLogSink 实现 @Slf4j public class CustomBinaryLogSink implements BinaryLogSink { private final String outPath; private final OutputStream out; private boolean closed; CustomBinaryLogSink(String path) throws IOException { File outFile = new File(path); outPath = outFile.getAbsolutePath(); log.info(&#34;Writing binary logs to {}&#34;, outFile.getAbsolutePath()); out = new BufferedOutputStream(new FileOutputStream(outFile)); } String getPath() { return this.outPath; } @Override public synchronized void write(MessageLite message) { if (closed) { log."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://blog.hellowood.dev/posts/"},{"@type":"ListItem","position":3,"name":"gRPC 中打印请求二进制日志","item":"https://blog.hellowood.dev/posts/grpc-%E4%B8%AD%E6%89%93%E5%8D%B0%E8%AF%B7%E6%B1%82%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"gRPC 中打印请求二进制日志","name":"gRPC 中打印请求二进制日志","description":"gRPC 中打印请求二进制日志 gRPC 支持将请求调用的参数、Header 等信息以二进制的方式输出到文件中，方便在必要时排查问题\n使用 1. 添加依赖 binlog 的依赖在 grpc-services中，所以需要有该依赖\ndependencies { implementation(\u0026#34;io.grpc:grpc-services:${grpcVersion}\u0026#34;) } 2. 添加 BinaryLogSink 实现 @Slf4j public class CustomBinaryLogSink implements BinaryLogSink { private final String outPath; private final OutputStream out; private boolean closed; CustomBinaryLogSink(String path) throws IOException { File outFile = new File(path); outPath = outFile.getAbsolutePath(); log.info(\u0026#34;Writing binary logs to {}\u0026#34;, outFile.getAbsolutePath()); out = new BufferedOutputStream(new FileOutputStream(outFile)); } String getPath() { return this.outPath; } @Override public synchronized void write(MessageLite message) { if (closed) { log.","keywords":["gRPC"],"articleBody":"gRPC 中打印请求二进制日志 gRPC 支持将请求调用的参数、Header 等信息以二进制的方式输出到文件中，方便在必要时排查问题\n使用 1. 添加依赖 binlog 的依赖在 grpc-services中，所以需要有该依赖\ndependencies { implementation(\"io.grpc:grpc-services:${grpcVersion}\") } 2. 添加 BinaryLogSink 实现 @Slf4j public class CustomBinaryLogSink implements BinaryLogSink { private final String outPath; private final OutputStream out; private boolean closed; CustomBinaryLogSink(String path) throws IOException { File outFile = new File(path); outPath = outFile.getAbsolutePath(); log.info(\"Writing binary logs to {}\", outFile.getAbsolutePath()); out = new BufferedOutputStream(new FileOutputStream(outFile)); } String getPath() { return this.outPath; } @Override public synchronized void write(MessageLite message) { if (closed) { log.info(\"Attempt to write after TempFileSink is closed.\"); return; } try { message.writeDelimitedTo(out); out.flush(); } catch (IOException e) { log.info(\"Caught exception while writing\", e); closeQuietly(); } } @Override public synchronized void close() throws IOException { if (closed) { return; } closed = true; try { out.flush(); } finally { out.close(); } } private synchronized void closeQuietly() { try { close(); } catch (IOException e) { log.info(\"Caught exception while closing\", e); } } } 3. 创建 Channel 时指定 BinaryLog BinaryLog binaryLog = BinaryLogs.createBinaryLog(new CustomBinaryLogSink(\"CUSTOM_PATH\"), \"*\"); this.channel = ManagedChannelBuilder.forAddress(host, port) .usePlaintext() .setBinaryLog(binaryLog) .build(); 4. 指定环境变量 需要指定环境变量，设置需要输出的方法才会生效，设置 GRPC_BINARY_LOG_CONFIG=*，*代表打印所有的方法，具体指定可以参考 Control Interface\n然后就会将请求的 header、message 等内容以二进制输出到文件中，如：\n] �������� (2E 1/io.github.helloworlde.grpc.HelloService/SayHello127.0.0.1:9090$ 5. 修改输出内容 二进制文件无法直接读取，依赖读取之后再将其输出为其他格式才可以，可以在写入时从 MessageLite 读取内容，修改为想要输出的格式\npublic synchronized void write(MessageLite message) { if (closed) { log.info(\"Attempt to write after TempFileSink is closed.\"); return; } try { - // message.writeDelimitedTo(out); + out.write(message.toString().getBytes(StandardCharsets.UTF_8)); out.flush(); } catch (IOException e) { log.info(\"Caught exception while writing\", e); closeQuietly(); } } 这样，就会将 MessageLite 的内容直接转为 String 后输出：\ntimestamp { seconds: 1609735898 nanos: 879000000 } call_id: 1 sequence_id_within_call: 5 type: EVENT_TYPE_SERVER_MESSAGE logger: LOGGER_CLIENT message { length: 14 data: \"\\n\\fHello Binlog\" } timestamp { seconds: 1609735898 nanos: 882000000 } call_id: 1 sequence_id_within_call: 6 type: EVENT_TYPE_SERVER_TRAILER logger: LOGGER_CLIENT trailer { metadata { } } 实现原理 在方法调用时，会判断有没有设置 binlog 对象，如果有则会封装方法，添加处理器和监听器；然后重新创建 ServerMethodDefinition；通过二进制日志拦截器 io.grpc.services.BinlogHelper#getClientInterceptor 拦截请求并写入日志\nio.grpc.internal.ServerImpl.ServerTransportListenerImpl#startCall private \u003cReqT, RespT\u003e ServerStreamListener startCall(ServerStream stream, String fullMethodName, ServerMethodDefinition\u003cReqT, RespT\u003e methodDef, Metadata headers, Context.CancellableContext context, StatsTraceContext statsTraceCtx, Tag tag) { // 如果 binlog 不为空，即需要记录binlog，则添加请求监听器和方法处理器记录 binlog ServerMethodDefinition\u003c?, ?\u003e wMethodDef = binlog == null ? interceptedDef : binlog.wrapMethodDefinition(interceptedDef); return startWrappedCall(fullMethodName, wMethodDef, stream, headers, context, tag); } io.grpc.services.BinaryLogProvider#wrapMethodDefinition public final \u003cReqT, RespT\u003e ServerMethodDefinition\u003c?, ?\u003e wrapMethodDefinition(ServerMethodDefinition\u003cReqT, RespT\u003e oMethodDef) { // 根据方法获取二进制日志拦截器，如果没有该方法则不拦截 ServerInterceptor binlogInterceptor = getServerInterceptor(oMethodDef.getMethodDescriptor().getFullMethodName()); if (binlogInterceptor == null) { return oMethodDef; } MethodDescriptor\u003cbyte[], byte[]\u003e binMethod = BinaryLogProvider.toByteBufferMethod(oMethodDef.getMethodDescriptor()); // 包装方法，添加了处理器和监听器 ServerMethodDefinition\u003cbyte[], byte[]\u003e binDef = InternalServerInterceptors.wrapMethod(oMethodDef, binMethod); // 创建处理器 ServerCallHandler\u003cbyte[], byte[]\u003e binlogHandler = InternalServerInterceptors.interceptCallHandlerCreate(binlogInterceptor, binDef.getServerCallHandler()); // 创建服务方法定义 return ServerMethodDefinition.create(binMethod, binlogHandler); } io.grpc.services.BinlogHelper#getClientInterceptor 会在每一个事件中输出具体的信息到 BinaryLog 中\npublic ClientInterceptor getClientInterceptor(final long callId) { return new ClientInterceptor() { boolean trailersOnlyResponse = true; @Override public \u003cReqT, RespT\u003e ClientCall\u003cReqT, RespT\u003e interceptCall(final MethodDescriptor\u003cReqT, RespT\u003e method, CallOptions callOptions, Channel next) { final String methodName = method.getFullMethodName(); final String authority = next.authority(); final Deadline deadline = min(callOptions.getDeadline(), Context.current().getDeadline()); return new SimpleForwardingClientCall\u003cReqT, RespT\u003e(next.newCall(method, callOptions)) { @Override public void start(final ClientCall.Listener\u003cRespT\u003e responseListener, Metadata headers) { final Duration timeout = deadline == null ? null : Durations.fromNanos(deadline.timeRemaining(TimeUnit.NANOSECONDS)); writer.logClientHeader(seq.getAndIncrement(), methodName, authority, timeout, headers, GrpcLogEntry.Logger.LOGGER_CLIENT,callId, /*peerAddress=*/ null); ClientCall.Listener\u003cRespT\u003e wListener = new SimpleForwardingClientCallListener\u003cRespT\u003e(responseListener) { @Override public void onMessage(RespT message) { writer.logRpcMessage(seq.getAndIncrement(), EventType.EVENT_TYPE_SERVER_MESSAGE, method.getResponseMarshaller(), message, GrpcLogEntry.Logger.LOGGER_CLIENT, callId); super.onMessage(message); } @Override public void onHeaders(Metadata headers) { trailersOnlyResponse = false; writer.logServerHeader(seq.getAndIncrement(), headers, GrpcLogEntry.Logger.LOGGER_CLIENT, callId, getPeerSocket(getAttributes())); super.onHeaders(headers); } @Override public void onClose(Status status, Metadata trailers) { SocketAddress peer = trailersOnlyResponse ? getPeerSocket(getAttributes()) : null; writer.logTrailer(seq.getAndIncrement(), status, trailers, GrpcLogEntry.Logger.LOGGER_CLIENT, callId, peer); super.onClose(status, trailers); } }; super.start(wListener, headers); } @Override public void sendMessage(ReqT message) { writer.logRpcMessage(seq.getAndIncrement(), EventType.EVENT_TYPE_CLIENT_MESSAGE, method.getRequestMarshaller(), message, GrpcLogEntry.Logger.LOGGER_CLIENT, callId); super.sendMessage(message); } @Override public void halfClose() { writer.logHalfClose(seq.getAndIncrement(), GrpcLogEntry.Logger.LOGGER_CLIENT, callId); super.halfClose(); } @Override public void cancel(String message, Throwable cause) { writer.logCancel(seq.getAndIncrement(), GrpcLogEntry.Logger.LOGGER_CLIENT, callId); super.cancel(message, cause); } }; } }; } ","wordCount":"568","inLanguage":"en","datePublished":"2021-01-04T22:34:46Z","dateModified":"2021-01-04T22:34:46Z","author":{"@type":"Person","name":"HelloWood"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.hellowood.dev/posts/grpc-%E4%B8%AD%E6%89%93%E5%8D%B0%E8%AF%B7%E6%B1%82%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97/"},"publisher":{"@type":"Organization","name":"HelloWood","logo":{"@type":"ImageObject","url":"https://blog.hellowood.dev/favicon.ico"}}}</script><link rel=icon href=/images/avatar.png sizes=16x16><link rel=apple-touch-icon href=/images/avatar.png><link rel=manifest href=/images/avatar.png><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.ff1bc260fafbfb440e10194d7d06d57eb5e85eed11d12d06255581262664204e.css integrity="sha256-/xvCYPr7+0QOEBlNfQbVfrXoXu0R0S0GJVWBJiZkIE4=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.af9899d47b21c333d192dccc82e0aa6650046e1a76ff4eaf89be703b64d94684.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jtbhx98g62")</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand data-umami-event=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Blog href=/posts>Blog</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Tags href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Archive href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Dashboard href=https://umami.hellowood.dev/share/lab/Blog>Dashboard</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link data-umami-event=navigation-social href=https://github.com/helloworlde><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button data-umami-event=toggle-theme aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
<span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>gRPC 中打印请求二进制日志</h1></header><p><small>January 4, 2021&nbsp;· 568 words&nbsp;· 3 min</small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#使用>使用</a><ul><li></li></ul></li><li><a href=#实现原理>实现原理</a></li></ul></nav></div><section class=blog-content><h1 id=grpc-中打印请求二进制日志>gRPC 中打印请求二进制日志</h1><p>gRPC 支持将请求调用的参数、Header 等信息以二进制的方式输出到文件中，方便在必要时排查问题</p><h2 id=使用>使用</h2><h4 id=1-添加依赖>1. 添加依赖</h4><p>binlog 的依赖在 <code>grpc-services</code>中，所以需要有该依赖</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span>dependencies {
</span></span><span style=display:flex><span>    implementation(<span style=color:#e6db74>&#34;io.grpc:grpc-services:</span><span style=color:#e6db74>${grpcVersion}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=2-添加-binarylogsink-实现>2. 添加 BinaryLogSink 实现</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CustomBinaryLogSink</span> <span style=color:#66d9ef>implements</span> BinaryLogSink {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> String outPath;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> OutputStream out;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>boolean</span> closed;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    CustomBinaryLogSink(String path) <span style=color:#66d9ef>throws</span> IOException {
</span></span><span style=display:flex><span>        File outFile <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> File(path);
</span></span><span style=display:flex><span>        outPath <span style=color:#f92672>=</span> outFile.<span style=color:#a6e22e>getAbsolutePath</span>();
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;Writing binary logs to {}&#34;</span>, outFile.<span style=color:#a6e22e>getAbsolutePath</span>());
</span></span><span style=display:flex><span>        out <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> BufferedOutputStream(<span style=color:#66d9ef>new</span> FileOutputStream(outFile));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    String <span style=color:#a6e22e>getPath</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>outPath</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>write</span>(MessageLite message) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (closed) {
</span></span><span style=display:flex><span>            log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;Attempt to write after TempFileSink is closed.&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            message.<span style=color:#a6e22e>writeDelimitedTo</span>(out);
</span></span><span style=display:flex><span>            out.<span style=color:#a6e22e>flush</span>();
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (IOException e) {
</span></span><span style=display:flex><span>            log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;Caught exception while writing&#34;</span>, e);
</span></span><span style=display:flex><span>            closeQuietly();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>close</span>() <span style=color:#66d9ef>throws</span> IOException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (closed) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        closed <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            out.<span style=color:#a6e22e>flush</span>();
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>finally</span> {
</span></span><span style=display:flex><span>            out.<span style=color:#a6e22e>close</span>();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>synchronized</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>closeQuietly</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            close();
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (IOException e) {
</span></span><span style=display:flex><span>            log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;Caught exception while closing&#34;</span>, e);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=3-创建-channel-时指定-binarylog>3. 创建 Channel 时指定 BinaryLog</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>BinaryLog binaryLog <span style=color:#f92672>=</span> BinaryLogs.<span style=color:#a6e22e>createBinaryLog</span>(<span style=color:#66d9ef>new</span> CustomBinaryLogSink(<span style=color:#e6db74>&#34;CUSTOM_PATH&#34;</span>), <span style=color:#e6db74>&#34;*&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>channel</span> <span style=color:#f92672>=</span> ManagedChannelBuilder.<span style=color:#a6e22e>forAddress</span>(host, port)
</span></span><span style=display:flex><span>                                    .<span style=color:#a6e22e>usePlaintext</span>()
</span></span><span style=display:flex><span>                                    .<span style=color:#a6e22e>setBinaryLog</span>(binaryLog)
</span></span><span style=display:flex><span>                                    .<span style=color:#a6e22e>build</span>();
</span></span></code></pre></div><h4 id=4-指定环境变量>4. 指定环境变量</h4><p>需要指定环境变量，设置需要输出的方法才会生效，设置 <code>GRPC_BINARY_LOG_CONFIG=*</code>，<code>*</code>代表打印所有的方法，具体指定可以参考 <a href=https://github.com/helloworlde/proposal/blob/master/A16-binary-logging.md#control-interface>Control Interface</a></p><p>然后就会将请求的 header、message 等内容以二进制输出到文件中，如：</p><pre tabindex=0><code>]

�������� (2E
1/io.github.helloworlde.grpc.HelloService/SayHello127.0.0.1:9090$
</code></pre><h4 id=5-修改输出内容>5. 修改输出内容</h4><p>二进制文件无法直接读取，依赖读取之后再将其输出为其他格式才可以，可以在写入时从 <code>MessageLite</code> 读取内容，修改为想要输出的格式</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>    public synchronized void write(MessageLite message) {
</span></span><span style=display:flex><span>        if (closed) {
</span></span><span style=display:flex><span>            log.info(&#34;Attempt to write after TempFileSink is closed.&#34;);
</span></span><span style=display:flex><span>            return;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        try {
</span></span><span style=display:flex><span><span style=color:#f92672>-           // message.writeDelimitedTo(out);
</span></span></span><span style=display:flex><span><span style=color:#f92672></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>+            out.write(message.toString().getBytes(StandardCharsets.UTF_8));
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>            out.flush();
</span></span><span style=display:flex><span>        } catch (IOException e) {
</span></span><span style=display:flex><span>            log.info(&#34;Caught exception while writing&#34;, e);
</span></span><span style=display:flex><span>            closeQuietly();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>这样，就会将 <code>MessageLite</code> 的内容直接转为 String 后输出：</p><pre tabindex=0><code>timestamp {
  seconds: 1609735898
  nanos: 879000000
}
call_id: 1
sequence_id_within_call: 5
type: EVENT_TYPE_SERVER_MESSAGE
logger: LOGGER_CLIENT
message {
  length: 14
  data: &#34;\n\fHello Binlog&#34;
}

timestamp {
  seconds: 1609735898
  nanos: 882000000
}
call_id: 1
sequence_id_within_call: 6
type: EVENT_TYPE_SERVER_TRAILER
logger: LOGGER_CLIENT
trailer {
  metadata {
  }
}
</code></pre><h2 id=实现原理>实现原理</h2><p>在方法调用时，会判断有没有设置 binlog 对象，如果有则会封装方法，添加处理器和监听器；然后重新创建 <code>ServerMethodDefinition</code>；通过二进制日志拦截器 <code>io.grpc.services.BinlogHelper#getClientInterceptor</code> 拦截请求并写入日志</p><ul><li>io.grpc.internal.ServerImpl.ServerTransportListenerImpl#startCall</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#f92672>&lt;</span>ReqT, RespT<span style=color:#f92672>&gt;</span> ServerStreamListener <span style=color:#a6e22e>startCall</span>(ServerStream stream, String fullMethodName,
</span></span><span style=display:flex><span>        ServerMethodDefinition<span style=color:#f92672>&lt;</span>ReqT, RespT<span style=color:#f92672>&gt;</span> methodDef, Metadata headers,
</span></span><span style=display:flex><span>        Context.<span style=color:#a6e22e>CancellableContext</span> context, StatsTraceContext statsTraceCtx, Tag tag) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e>// 如果 binlog 不为空，即需要记录binlog，则添加请求监听器和方法处理器记录 binlog</span>
</span></span><span style=display:flex><span>      ServerMethodDefinition<span style=color:#f92672>&lt;?</span>, <span style=color:#f92672>?&gt;</span> wMethodDef <span style=color:#f92672>=</span> binlog <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> interceptedDef : binlog.<span style=color:#a6e22e>wrapMethodDefinition</span>(interceptedDef);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> startWrappedCall(fullMethodName, wMethodDef, stream, headers, context, tag);
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><ul><li>io.grpc.services.BinaryLogProvider#wrapMethodDefinition</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>  <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> <span style=color:#f92672>&lt;</span>ReqT, RespT<span style=color:#f92672>&gt;</span> ServerMethodDefinition<span style=color:#f92672>&lt;?</span>, <span style=color:#f92672>?&gt;</span> wrapMethodDefinition(ServerMethodDefinition<span style=color:#f92672>&lt;</span>ReqT, RespT<span style=color:#f92672>&gt;</span> oMethodDef) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 根据方法获取二进制日志拦截器，如果没有该方法则不拦截</span>
</span></span><span style=display:flex><span>    ServerInterceptor binlogInterceptor <span style=color:#f92672>=</span> getServerInterceptor(oMethodDef.<span style=color:#a6e22e>getMethodDescriptor</span>().<span style=color:#a6e22e>getFullMethodName</span>());
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (binlogInterceptor <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> oMethodDef;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    MethodDescriptor<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span>, <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]&gt;</span> binMethod <span style=color:#f92672>=</span> BinaryLogProvider.<span style=color:#a6e22e>toByteBufferMethod</span>(oMethodDef.<span style=color:#a6e22e>getMethodDescriptor</span>());
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 包装方法，添加了处理器和监听器</span>
</span></span><span style=display:flex><span>    ServerMethodDefinition<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span>, <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]&gt;</span> binDef <span style=color:#f92672>=</span> InternalServerInterceptors.<span style=color:#a6e22e>wrapMethod</span>(oMethodDef, binMethod);
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 创建处理器</span>
</span></span><span style=display:flex><span>    ServerCallHandler<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>byte</span><span style=color:#f92672>[]</span>, <span style=color:#66d9ef>byte</span><span style=color:#f92672>[]&gt;</span> binlogHandler <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>            InternalServerInterceptors.<span style=color:#a6e22e>interceptCallHandlerCreate</span>(binlogInterceptor, binDef.<span style=color:#a6e22e>getServerCallHandler</span>());
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 创建服务方法定义</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> ServerMethodDefinition.<span style=color:#a6e22e>create</span>(binMethod, binlogHandler);
</span></span><span style=display:flex><span>  }
</span></span></code></pre></div><ul><li>io.grpc.services.BinlogHelper#getClientInterceptor</li></ul><p>会在每一个事件中输出具体的信息到 BinaryLog 中</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>  <span style=color:#66d9ef>public</span> ClientInterceptor <span style=color:#a6e22e>getClientInterceptor</span>(<span style=color:#66d9ef>final</span> <span style=color:#66d9ef>long</span> callId) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> ClientInterceptor() {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>boolean</span> trailersOnlyResponse <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>public</span> <span style=color:#f92672>&lt;</span>ReqT, RespT<span style=color:#f92672>&gt;</span> ClientCall<span style=color:#f92672>&lt;</span>ReqT, RespT<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>interceptCall</span>(<span style=color:#66d9ef>final</span> MethodDescriptor<span style=color:#f92672>&lt;</span>ReqT, RespT<span style=color:#f92672>&gt;</span> method, CallOptions callOptions, Channel next) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>final</span> String methodName <span style=color:#f92672>=</span> method.<span style=color:#a6e22e>getFullMethodName</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>final</span> String authority <span style=color:#f92672>=</span> next.<span style=color:#a6e22e>authority</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>final</span> Deadline deadline <span style=color:#f92672>=</span> min(callOptions.<span style=color:#a6e22e>getDeadline</span>(), Context.<span style=color:#a6e22e>current</span>().<span style=color:#a6e22e>getDeadline</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> SimpleForwardingClientCall<span style=color:#f92672>&lt;</span>ReqT, RespT<span style=color:#f92672>&gt;</span>(next.<span style=color:#a6e22e>newCall</span>(method, callOptions)) {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>start</span>(<span style=color:#66d9ef>final</span> ClientCall.<span style=color:#a6e22e>Listener</span><span style=color:#f92672>&lt;</span>RespT<span style=color:#f92672>&gt;</span> responseListener, Metadata headers) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>final</span> Duration timeout <span style=color:#f92672>=</span> deadline <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>?</span> <span style=color:#66d9ef>null</span> : Durations.<span style=color:#a6e22e>fromNanos</span>(deadline.<span style=color:#a6e22e>timeRemaining</span>(TimeUnit.<span style=color:#a6e22e>NANOSECONDS</span>));
</span></span><span style=display:flex><span>            writer.<span style=color:#a6e22e>logClientHeader</span>(seq.<span style=color:#a6e22e>getAndIncrement</span>(), methodName, authority, timeout, headers, GrpcLogEntry.<span style=color:#a6e22e>Logger</span>.<span style=color:#a6e22e>LOGGER_CLIENT</span>,callId, <span style=color:#75715e>/*peerAddress=*/</span> <span style=color:#66d9ef>null</span>);
</span></span><span style=display:flex><span>            ClientCall.<span style=color:#a6e22e>Listener</span><span style=color:#f92672>&lt;</span>RespT<span style=color:#f92672>&gt;</span> wListener <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>new</span> SimpleForwardingClientCallListener<span style=color:#f92672>&lt;</span>RespT<span style=color:#f92672>&gt;</span>(responseListener) {
</span></span><span style=display:flex><span>                      <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>                      <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onMessage</span>(RespT message) {
</span></span><span style=display:flex><span>                        writer.<span style=color:#a6e22e>logRpcMessage</span>(seq.<span style=color:#a6e22e>getAndIncrement</span>(), EventType.<span style=color:#a6e22e>EVENT_TYPE_SERVER_MESSAGE</span>, method.<span style=color:#a6e22e>getResponseMarshaller</span>(), message, GrpcLogEntry.<span style=color:#a6e22e>Logger</span>.<span style=color:#a6e22e>LOGGER_CLIENT</span>, callId);
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>super</span>.<span style=color:#a6e22e>onMessage</span>(message);
</span></span><span style=display:flex><span>                      }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                      <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>                      <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onHeaders</span>(Metadata headers) {
</span></span><span style=display:flex><span>                        trailersOnlyResponse <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>                        writer.<span style=color:#a6e22e>logServerHeader</span>(seq.<span style=color:#a6e22e>getAndIncrement</span>(), headers, GrpcLogEntry.<span style=color:#a6e22e>Logger</span>.<span style=color:#a6e22e>LOGGER_CLIENT</span>, callId, getPeerSocket(getAttributes()));
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>super</span>.<span style=color:#a6e22e>onHeaders</span>(headers);
</span></span><span style=display:flex><span>                      }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                      <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>                      <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>onClose</span>(Status status, Metadata trailers) {
</span></span><span style=display:flex><span>                        SocketAddress peer <span style=color:#f92672>=</span> trailersOnlyResponse <span style=color:#f92672>?</span> getPeerSocket(getAttributes()) : <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>                        writer.<span style=color:#a6e22e>logTrailer</span>(seq.<span style=color:#a6e22e>getAndIncrement</span>(), status, trailers, GrpcLogEntry.<span style=color:#a6e22e>Logger</span>.<span style=color:#a6e22e>LOGGER_CLIENT</span>, callId, peer);
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>super</span>.<span style=color:#a6e22e>onClose</span>(status, trailers);
</span></span><span style=display:flex><span>                      }
</span></span><span style=display:flex><span>                    };
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span>.<span style=color:#a6e22e>start</span>(wListener, headers);
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>sendMessage</span>(ReqT message) {
</span></span><span style=display:flex><span>            writer.<span style=color:#a6e22e>logRpcMessage</span>(seq.<span style=color:#a6e22e>getAndIncrement</span>(), EventType.<span style=color:#a6e22e>EVENT_TYPE_CLIENT_MESSAGE</span>, method.<span style=color:#a6e22e>getRequestMarshaller</span>(), message, GrpcLogEntry.<span style=color:#a6e22e>Logger</span>.<span style=color:#a6e22e>LOGGER_CLIENT</span>, callId);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span>.<span style=color:#a6e22e>sendMessage</span>(message);
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>halfClose</span>() {
</span></span><span style=display:flex><span>            writer.<span style=color:#a6e22e>logHalfClose</span>(seq.<span style=color:#a6e22e>getAndIncrement</span>(), GrpcLogEntry.<span style=color:#a6e22e>Logger</span>.<span style=color:#a6e22e>LOGGER_CLIENT</span>, callId);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span>.<span style=color:#a6e22e>halfClose</span>();
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cancel</span>(String message, Throwable cause) {
</span></span><span style=display:flex><span>            writer.<span style=color:#a6e22e>logCancel</span>(seq.<span style=color:#a6e22e>getAndIncrement</span>(), GrpcLogEntry.<span style=color:#a6e22e>Logger</span>.<span style=color:#a6e22e>LOGGER_CLIENT</span>, callId);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>super</span>.<span style=color:#a6e22e>cancel</span>(message, cause);
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  }
</span></span></code></pre></div></section><div class=paginator><a class=prev href=https://blog.hellowood.dev/posts/grpc-%E4%B8%AD%E4%BD%BF%E7%94%A8-channelz/><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg>
<span>gRPC 中使用 Channelz</span></a>
<a class=next href=https://blog.hellowood.dev/posts/grpc-%E6%8B%A6%E6%88%AA%E5%99%A8%E5%92%8C%E7%9B%91%E5%90%AC%E5%99%A8/><span>gRPC 拦截器和监听器</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div></article></div><footer class=footer><p>&copy; 2024 <a href=https://blog.hellowood.dev>HelloWood</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank data-umami-event=to-hugo>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank data-umami-event=to-ladder>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g data-umami-event=top-link><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>