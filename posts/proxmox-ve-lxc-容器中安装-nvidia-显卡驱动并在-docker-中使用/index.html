<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>Proxmox VE LXC 容器中安装 NVIDIA 显卡驱动并在 Docker 中使用</title>
<meta name=description content="在 PVE 的 LXC 容器中使用 NVIDIA 显卡，用于 Ollama 等模型推理或者 GPU 加速的应用
一、PVE 安装 NVIDIA 驱动 1.1 修改订阅源 修改 /etc/apt/sources.list 文件，添加 pve-no-subscription 源；完整的配置如下: deb …"><meta name=keywords content='blog,hugo,Proxmox VE,HomeLab,NVIDIA'><meta property="og:url" content="https://blog.hellowood.dev/posts/proxmox-ve-lxc-%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%AE%89%E8%A3%85-nvidia-%E6%98%BE%E5%8D%A1%E9%A9%B1%E5%8A%A8%E5%B9%B6%E5%9C%A8-docker-%E4%B8%AD%E4%BD%BF%E7%94%A8/"><meta property="og:type" content="website"><meta property="og:title" content="Proxmox VE LXC 容器中安装 NVIDIA 显卡驱动并在 Docker 中使用"><meta property="og:description" content="在 PVE 的 LXC 容器中使用 NVIDIA 显卡，用于 Ollama 等模型推理或者 GPU 加速的应用
一、PVE 安装 NVIDIA 驱动 1.1 修改订阅源 修改 /etc/apt/sources.list 文件，添加 pve-no-subscription 源；完整的配置如下: deb …"><meta property="og:image" content="https://blog.hellowood.dev/images/avatar.webp"><meta property="og:image:secure_url" content="https://blog.hellowood.dev/images/avatar.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Proxmox VE LXC 容器中安装 NVIDIA 显卡驱动并在 Docker 中使用"><meta name=twitter:description content="在 PVE 的 LXC 容器中使用 NVIDIA 显卡，用于 Ollama 等模型推理或者 GPU 加速的应用
一、PVE 安装 NVIDIA 驱动 1.1 修改订阅源 修改 /etc/apt/sources.list 文件，添加 pve-no-subscription 源；完整的配置如下: deb …"><meta property="twitter:domain" content="https://blog.hellowood.dev/posts/proxmox-ve-lxc-%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%AE%89%E8%A3%85-nvidia-%E6%98%BE%E5%8D%A1%E9%A9%B1%E5%8A%A8%E5%B9%B6%E5%9C%A8-docker-%E4%B8%AD%E4%BD%BF%E7%94%A8/"><meta property="twitter:url" content="https://blog.hellowood.dev/posts/proxmox-ve-lxc-%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%AE%89%E8%A3%85-nvidia-%E6%98%BE%E5%8D%A1%E9%A9%B1%E5%8A%A8%E5%B9%B6%E5%9C%A8-docker-%E4%B8%AD%E4%BD%BF%E7%94%A8/"><meta name=twitter:image content="https://blog.hellowood.dev/images/avatar.webp"><link rel=canonical href=https://blog.hellowood.dev/posts/proxmox-ve-lxc-%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%AE%89%E8%A3%85-nvidia-%E6%98%BE%E5%8D%A1%E9%A9%B1%E5%8A%A8%E5%B9%B6%E5%9C%A8-docker-%E4%B8%AD%E4%BD%BF%E7%94%A8/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.a036ebe92c17ea3f0c07761c2135b82bec6f37c8efb7f49ddad1f28c22fc4769.js integrity="sha256-oDbr6SwX6j8MB3YcITW4K+xvN8jvt/Sd2tHyjCL8R2k="></script><link rel=stylesheet type=text/css href=/css/custom.css><script defer src=https://umami.hellowood.dev/script.js data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301></script><script defer src=https://cloud.umami.is/script.js data-website-id=73ff1c8c-9938-43cf-81af-e77e26b0cca3></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}'></script><meta name=google-adsense-account content="ca-pub-3401351766168985"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3401351766168985" crossorigin=anonymous></script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jtbhx98g62")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ")</script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://blog.hellowood.dev/><img src=/images/avatar.webp alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://blog.hellowood.dev/>HelloWood</a></div><div class=nav-links><div class=nav-link><a href=https://blog.hellowood.dev/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://blog.hellowood.dev/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://blog.hellowood.dev/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://github.com/helloworlde aria-label=github><span data-feather=github></span></a></div><div class=nav-link><a href=https://umami.hellowood.dev/share/lab/Blog aria-label=dashboard><span data-feather=pie-chart></span></a></div><div class=nav-link><a href=https://blog.hellowood.dev/index.xml aria-label=rss><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://blog.hellowood.dev/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://blog.hellowood.dev/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://blog.hellowood.dev/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://github.com/helloworlde><span data-feather=github></span></a></li><li class=nav-item><a href=https://umami.hellowood.dev/share/lab/Blog><span data-feather=pie-chart></span></a></li><li class=nav-item><a href=https://blog.hellowood.dev/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Proxmox VE LXC 容器中安装 NVIDIA 显卡驱动并在 Docker 中使用</h1><small role=doc-subtitle></small><p class=post-date>2025-03-24</p><ul class=post-tags><li class=post-tag><a href=https://blog.hellowood.dev/tags/proxmox-ve>Proxmox VE</a></li><li class=post-tag><a href=https://blog.hellowood.dev/tags/homelab>HomeLab</a></li><li class=post-tag><a href=https://blog.hellowood.dev/tags/nvidia>NVIDIA</a></li></ul></div><div class=post-content><p>在 PVE 的 LXC 容器中使用 NVIDIA 显卡，用于 Ollama 等模型推理或者 GPU 加速的应用</p><h2 id=一pve-安装-nvidia-驱动>一、PVE 安装 NVIDIA 驱动</h2><h3 id=11-修改订阅源>1.1 修改订阅源</h3><ul><li>修改 <code>/etc/apt/sources.list</code> 文件，添加 pve-no-subscription 源；完整的配置如下:</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>deb http://mirrors.tuna.tsinghua.edu.cn/debian bookworm main contrib non-free non-free-firmware
</span></span><span style=display:flex><span>deb http://mirrors.tuna.tsinghua.edu.cn/debian bookworm-updates main contrib non-free non-free-firmware
</span></span><span style=display:flex><span>deb http://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware
</span></span><span style=display:flex><span>deb http://download.proxmox.com/debian/pve bookworm pve-no-subscription
</span></span></code></pre></div><ul><li>更新</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apt update
</span></span></code></pre></div><h3 id=12-安装-nvidia-驱动>1.2 安装 NVIDIA 驱动</h3><ul><li>安装内核头文件</li></ul><p>pve-headers 允许 DKMS 机制在内核更新时自动重新编译需要编译和安装动态内核模块，即 NVIDIA 驱动</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apt install pve-headers
</span></span></code></pre></div><ul><li>下载驱动</li></ul><p>访问 <a href=https://www.nvidia.cn/drivers/unix/>https://www.nvidia.cn/drivers/unix/</a>，找到 <code>Linux x86_64/AMD64/EM64T</code>
<img src=https://img.hellowood.dev/picture/homelab-pve-nvidia-driver-install-download-0.png alt=homelab-pve-nvidia-driver-install-download-0.png></p><p>点击<a href=https://www.nvidia.cn/drivers/unix/linux-amd64-display-archive/>压缩文件</a>查看历史版本，选择 <code>535.216.01</code> 版本，
<img src=https://img.hellowood.dev/picture/homelab-pve-nvidia-driver-install-download-1.png alt=homelab-pve-nvidia-driver-install-download-1.png></p><p>点击链接查看驱动详细信息，右键复制下载链接地址
<img src=https://img.hellowood.dev/picture/homelab-pve-nvidia-driver-install-download-2.png alt=homelab-pve-nvidia-driver-install-download-2.png></p><p>然后在 PVE 宿主机中通过 wget 下载驱动</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://cn.download.nvidia.com/XFree86/Linux-x86_64/535.216.01/NVIDIA-Linux-x86_64-535.216.01.run
</span></span></code></pre></div><p><img src=https://img.hellowood.dev/picture/homelab-pve-nvidia-driver-install-lxc-install.png alt=homelab-pve-nvidia-driver-install-lxc-install.png></p><ul><li>授予执行权限</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod +x ./NVIDIA-Linux-x86_64-535.216.01.run
</span></span></code></pre></div><ul><li>安装驱动</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./NVIDIA-Linux-x86_64-535.216.01.run
</span></span></code></pre></div><h3 id=13-重启系统>1.3 重启系统</h3><p>安装完成后需要重启 PVE</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>reboot
</span></span></code></pre></div><h3 id=14-验证-nvidia-驱动>1.4 验证 NVIDIA 驱动</h3><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nvidia-smi
</span></span></code></pre></div><p>正确返回显卡的信息说明驱动已经正确安装</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Sat Mar <span style=color:#d19a66>29</span> 23:31:27 <span style=color:#d19a66>2025</span>
</span></span><span style=display:flex><span>+---------------------------------------------------------------------------------------+
</span></span><span style=display:flex><span>| NVIDIA-SMI 535.216.01             Driver Version: 535.216.01   CUDA Version: 12.2     |
</span></span><span style=display:flex><span>|-----------------------------------------+----------------------+----------------------+
</span></span><span style=display:flex><span>| GPU  Name                 Persistence-M | Bus-Id        Disp.A | Volatile Uncorr. ECC |
</span></span><span style=display:flex><span>| Fan  Temp   Perf          Pwr:Usage/Cap |         Memory-Usage | GPU-Util  Compute M. |
</span></span><span style=display:flex><span>|                                         |                      |               MIG M. |
</span></span><span style=display:flex><span>|<span style=color:#c7bf54>=========================================</span>+<span style=color:#c7bf54>======================</span>+<span style=color:#c7bf54>======================</span>|
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>0</span>  NVIDIA GeForce RTX <span style=color:#d19a66>3060</span>        On  | 00000000:01:00.0 Off |                  N/A |
</span></span><span style=display:flex><span>| 53%   49C    P8              14W / 170W |      3MiB / 12288MiB |      0%      Default |
</span></span><span style=display:flex><span>|                                         |                      |                  N/A |
</span></span><span style=display:flex><span>+-----------------------------------------+----------------------+----------------------+
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>+---------------------------------------------------------------------------------------+
</span></span><span style=display:flex><span>| Processes:                                                                            |
</span></span><span style=display:flex><span>|  GPU   GI   CI        PID   Type   Process name                            GPU Memory |
</span></span><span style=display:flex><span>|        ID   ID                                                             Usage      |
</span></span><span style=display:flex><span>|<span style=color:#c7bf54>=======================================================================================</span>|
</span></span><span style=display:flex><span>|  No running processes found                                                           |
</span></span><span style=display:flex><span>+---------------------------------------------------------------------------------------+
</span></span></code></pre></div><h2 id=二lxc-容器安装-nvidia-驱动>二、LXC 容器安装 NVIDIA 驱动</h2><p>LXC 容器中安装 NVIDIA 驱动之前需要先将显卡挂载到容器中，然后在容器中安装 NVIDIA 驱动</p><h3 id=21-挂载-nvidia-设备>2.1 挂载 NVIDIA 设备</h3><p>在 PVE 宿主机中将显卡挂载到容器中</p><h4 id=211-获取-nvidia-设备的主次编号>2.1.1 获取 NVIDIA 设备的主次编号</h4><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ls /dev/nvidia* -l
</span></span></code></pre></div><p>返回信息如下, 对应的设备编号是 <code>195, 0</code> 和 <code>195, 255</code> 等</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>crw-rw-rw- <span style=color:#d19a66>1</span> root root 195,   <span style=color:#d19a66>0</span> Mar <span style=color:#d19a66>23</span> 23:02 /dev/nvidia0
</span></span><span style=display:flex><span>crw-rw-rw- <span style=color:#d19a66>1</span> root root 195, <span style=color:#d19a66>255</span> Mar <span style=color:#d19a66>23</span> 23:02 /dev/nvidiactl
</span></span><span style=display:flex><span>crw-rw-rw- <span style=color:#d19a66>1</span> root root 195, <span style=color:#d19a66>254</span> Mar <span style=color:#d19a66>23</span> 23:02 /dev/nvidia-modeset
</span></span><span style=display:flex><span>crw-rw-rw- <span style=color:#d19a66>1</span> root root 234,   <span style=color:#d19a66>0</span> Mar <span style=color:#d19a66>23</span> 23:03 /dev/nvidia-uvm
</span></span><span style=display:flex><span>crw-rw-rw- <span style=color:#d19a66>1</span> root root 234,   <span style=color:#d19a66>1</span> Mar <span style=color:#d19a66>23</span> 23:03 /dev/nvidia-uvm-tools
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/dev/nvidia-caps:
</span></span><span style=display:flex><span>total <span style=color:#d19a66>0</span>
</span></span><span style=display:flex><span>cr-------- <span style=color:#d19a66>1</span> root root 238, <span style=color:#d19a66>1</span> Mar <span style=color:#d19a66>23</span> 23:03 nvidia-cap1
</span></span><span style=display:flex><span>cr--r--r-- <span style=color:#d19a66>1</span> root root 238, <span style=color:#d19a66>2</span> Mar <span style=color:#d19a66>23</span> 23:03 nvidia-cap2
</span></span></code></pre></div><p>相关设备作用如下：</p><ul><li>设备文件列表及作用</li></ul><table><thead><tr><th>设备文件</th><th>作用描述</th></tr></thead><tbody><tr><td><strong><code>/dev/nvidia0</code></strong></td><td>代表第一块 GPU，多个 GPU 会有 <code>/dev/nvidia1</code> 等</td></tr><tr><td><strong><code>/dev/nvidiactl</code></strong></td><td>控制 NVIDIA 驱动程序，管理 GPU 资源</td></tr><tr><td><strong><code>/dev/nvidia-modeset</code></strong></td><td>负责 GPU 显示模式管理（适用于 Xorg/Wayland）</td></tr><tr><td><strong><code>/dev/nvidia-uvm</code></strong></td><td>负责 <strong>Unified Virtual Memory (UVM)</strong> 机制，支持 CPU-GPU 共享内存</td></tr><tr><td><strong><code>/dev/nvidia-uvm-tools</code></strong></td><td>提供 UVM 相关的工具支持</td></tr></tbody></table><ul><li><code>/dev/nvidia-caps/</code> 目录</li></ul><p>此目录包含 <strong>与 GPU 访问控制相关的设备文件</strong>，用于限制对某些 GPU 功能的访问。</p><table><thead><tr><th>设备文件</th><th>作用描述</th></tr></thead><tbody><tr><td><strong><code>/dev/nvidia-caps/nvidia-cap1</code></strong></td><td>仅 <code>root</code> 可访问，通常与安全关键的 GPU 功能（如 <code>nvidia-persistenced</code>）相关</td></tr><tr><td><strong><code>/dev/nvidia-caps/nvidia-cap2</code></strong></td><td>允许所有用户读取，可能用于 GPU 监控等非特权操作</td></tr></tbody></table><h4 id=212-将设备挂载到-lxc-容器中>2.1.2 将设备挂载到 LXC 容器中</h4><p>设备部分的主设备号填写上面获取的主设备号，次设备号填写 <code>*</code>即可；3060 显卡的设备号是 <code>195</code>，<code>234</code>，<code>238</code></p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nano /etc/pve/lxc/100.conf
</span></span></code></pre></div><p>添加以下内容：</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>lxc.cgroup2.devices.allow: c 195:* rwm
</span></span><span style=display:flex><span>lxc.cgroup2.devices.allow: c 234:* rwm
</span></span><span style=display:flex><span>lxc.cgroup2.devices.allow: c 238:* rwm
</span></span><span style=display:flex><span>lxc.mount.entry: /dev/nvidia0 dev/nvidia0 none bind,optional,create<span style=color:#c7bf54>=</span>file
</span></span><span style=display:flex><span>lxc.mount.entry: /dev/nvidiactl dev/nvidiactl none bind,optional,create<span style=color:#c7bf54>=</span>file
</span></span><span style=display:flex><span>lxc.mount.entry: /dev/nvidia-uvm dev/nvidia-uvm none bind,optional,create<span style=color:#c7bf54>=</span>file
</span></span><span style=display:flex><span>lxc.mount.entry: /dev/nvidia-modeset dev/nvidia-modeset none bind,optional,create<span style=color:#c7bf54>=</span>file
</span></span><span style=display:flex><span>lxc.mount.entry: /dev/nvidia-uvm-tools dev/nvidia-uvm-tools none bind,optional,create<span style=color:#c7bf54>=</span>file
</span></span><span style=display:flex><span>lxc.mount.entry: /dev/nvidia-uvm-tools dev/nvidia-caps/nvidia-cap1 none bind,optional,create<span style=color:#c7bf54>=</span>file
</span></span><span style=display:flex><span>lxc.mount.entry: /dev/nvidia-uvm-tools dev/nvidia-caps/nvidia-cap2 none bind,optional,create<span style=color:#c7bf54>=</span>file
</span></span></code></pre></div><p>然后重启 LXC 容器即可</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pct reboot <span style=color:#d19a66>120</span>
</span></span></code></pre></div><h3 id=22-安装-nvidia-驱动>2.2 安装 NVIDIA 驱动</h3><p>进入 LXC 容器安装 NVIDIA 驱动，LXC 容器中的驱动版本需要和宿主机的版本一致，否则可能会返回 <code>Failed to initialize NVML: Driver/library version mismatch NVML library version: 535.230</code></p><p><del>在宿主机可以直接使用 apt 安装，这样能保证驱动是 PVE 兼容的版本；但是在 LXC 容器中可能因为系统、版本不一样，安装的驱动并不是宿主机兼容的版本，所以需要手动下载驱动</del>
即使在 PVE 中通过 apt 安装的驱动版本和 LXC 中安装的版本一样，依然可能存在不兼容的问题，所以无论是 LXC容器还是 PVE 宿主机，都建议手动下载安装相同的驱动</p><h4 id=221-下载驱动>2.2.1 下载驱动</h4><ul><li>下载驱动</li></ul><p>和宿主机下载驱动一样通过 wget 下载即可</p><h4 id=222-安装驱动>2.2.2 安装驱动</h4><ul><li>授予执行权限</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>chmod +x ./NVIDIA-Linux-x86_64-535.216.01.run
</span></span></code></pre></div><ul><li>安装驱动</li></ul><p>因为 LXC 容器共享宿主机的内核，所以安装时需要指定 <code>--no-kernel-module</code> 参数，避免安装内核模块</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./NVIDIA-Linux-x86_64-535.216.01.run --no-kernel-module
</span></span></code></pre></div><p><img src=https://img.hellowood.dev/picture/homelab-pve-nvidia-driver-install-lxc-install-2.png alt=homelab-pve-nvidia-driver-install-lxc-install-2.png></p><ul><li>重启 LXC 容器</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>reboot
</span></span></code></pre></div><h3 id=23-验证-nvidia-驱动>2.3 验证 NVIDIA 驱动</h3><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nvidia-smi
</span></span></code></pre></div><p>正确返回显卡的信息说明驱动已经正确安装</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Sun Mar <span style=color:#d19a66>30</span> 03:25:12 <span style=color:#d19a66>2025</span>
</span></span><span style=display:flex><span>+---------------------------------------------------------------------------------------+
</span></span><span style=display:flex><span>| NVIDIA-SMI 535.216.01             Driver Version: 535.216.01   CUDA Version: 12.2     |
</span></span><span style=display:flex><span>|-----------------------------------------+----------------------+----------------------+
</span></span><span style=display:flex><span>| GPU  Name                 Persistence-M | Bus-Id        Disp.A | Volatile Uncorr. ECC |
</span></span><span style=display:flex><span>| Fan  Temp   Perf          Pwr:Usage/Cap |         Memory-Usage | GPU-Util  Compute M. |
</span></span><span style=display:flex><span>|                                         |                      |               MIG M. |
</span></span><span style=display:flex><span>|<span style=color:#c7bf54>=========================================</span>+<span style=color:#c7bf54>======================</span>+<span style=color:#c7bf54>======================</span>|
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>0</span>  NVIDIA GeForce RTX <span style=color:#d19a66>3060</span>        Off | 00000000:01:00.0 Off |                  N/A |
</span></span><span style=display:flex><span>|  0%   43C    P8               6W / 170W |      1MiB / 12288MiB |      0%      Default |
</span></span><span style=display:flex><span>|                                         |                      |                  N/A |
</span></span><span style=display:flex><span>+-----------------------------------------+----------------------+----------------------+
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>+---------------------------------------------------------------------------------------+
</span></span><span style=display:flex><span>| Processes:                                                                            |
</span></span><span style=display:flex><span>|  GPU   GI   CI        PID   Type   Process name                            GPU Memory |
</span></span><span style=display:flex><span>|        ID   ID                                                             Usage      |
</span></span><span style=display:flex><span>|<span style=color:#c7bf54>=======================================================================================</span>|
</span></span><span style=display:flex><span>|  No running processes found                                                           |
</span></span><span style=display:flex><span>+---------------------------------------------------------------------------------------+
</span></span></code></pre></div><h2 id=三docker-容器使用-nvidia-显卡>三、Docker 容器使用 NVIDIA 显卡</h2><h3 id=31-修改-lxc-配置>3.1 修改 LXC 配置</h3><p>在 LXC 容器中安装 NVIDIA Container Toolkit，需要修改 LXC 容器的配置，允许容器使用 GPU</p><ul><li>修改 <code>/etc/pve/lxc/100.conf</code> 文件</li></ul><p>禁用 AppArmor 安全策略，授予 Docker 容器完全访问权限</p><pre tabindex=0><code class=language-conf data-lang=conf>lxc.apparmor.profile: unconfined
</code></pre><h3 id=31-安装-nvidia-container-toolkit>3.1 安装 NVIDIA Container Toolkit</h3><ul><li>添加 NVIDIA Container Toolkit 软件源</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://nvidia.github.io/libnvidia-container/gpgkey | sudo gpg --dearmor -o /usr/share/keyrings/nvidia-container-toolkit-keyring.gpg <span style=color:#d26464;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#d26464;font-weight:700></span>  <span style=color:#c7bf54>&amp;&amp;</span> curl -s -L https://nvidia.github.io/libnvidia-container/stable/deb/nvidia-container-toolkit.list | <span style=color:#d26464;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#d26464;font-weight:700></span>    sed <span style=color:#98c379>&#39;s#deb https://#deb [signed-by=/usr/share/keyrings/nvidia-container-toolkit-keyring.gpg] https://#g&#39;</span> | <span style=color:#d26464;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#d26464;font-weight:700></span>    sudo tee /etc/apt/sources.list.d/nvidia-container-toolkit.list
</span></span></code></pre></div><ul><li>更新并安装 NVIDIA Container Toolkit</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update <span style=color:#c7bf54>&amp;&amp;</span> sudo apt install -y nvidia-container-toolkit
</span></span></code></pre></div><h3 id=32-配置运行时环境>3.2 配置运行时环境</h3><ul><li>配置 Docker 运行时环境</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nvidia-ctk runtime configure --runtime<span style=color:#c7bf54>=</span>docker
</span></span></code></pre></div><p>将会修改 <code>/etc/docker/daemon.json</code> 文件，添加 nvidia-container-runtime 配置</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>INFO<span style=color:#c7bf54>[</span>0000<span style=color:#c7bf54>]</span> Loading config from /etc/docker/daemon.json
</span></span><span style=display:flex><span>INFO<span style=color:#c7bf54>[</span>0000<span style=color:#c7bf54>]</span> Wrote updated config to /etc/docker/daemon.json
</span></span><span style=display:flex><span>INFO<span style=color:#c7bf54>[</span>0000<span style=color:#c7bf54>]</span> It is recommended that docker daemon be restarted.
</span></span></code></pre></div><ul><li>重启 Docker 服务</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl restart docker
</span></span></code></pre></div><h3 id=容器中使用-nvidia-显卡>容器中使用 NVIDIA 显卡</h3><ul><li>启动容器</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --rm --gpus all nvidia/cuda:12.2.2-base-ubuntu22.04 nvidia-smi
</span></span></code></pre></div><p>正确返回显卡的信息说明 NVIDIA 显卡已经正确挂载到容器</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Sun Mar <span style=color:#d19a66>30</span> 03:38:52 <span style=color:#d19a66>2025</span>
</span></span><span style=display:flex><span>+---------------------------------------------------------------------------------------+
</span></span><span style=display:flex><span>| NVIDIA-SMI 535.216.01             Driver Version: 535.216.01   CUDA Version: 12.2     |
</span></span><span style=display:flex><span>|-----------------------------------------+----------------------+----------------------+
</span></span><span style=display:flex><span>| GPU  Name                 Persistence-M | Bus-Id        Disp.A | Volatile Uncorr. ECC |
</span></span><span style=display:flex><span>| Fan  Temp   Perf          Pwr:Usage/Cap |         Memory-Usage | GPU-Util  Compute M. |
</span></span><span style=display:flex><span>|                                         |                      |               MIG M. |
</span></span><span style=display:flex><span>|<span style=color:#c7bf54>=========================================</span>+<span style=color:#c7bf54>======================</span>+<span style=color:#c7bf54>======================</span>|
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>0</span>  NVIDIA GeForce RTX <span style=color:#d19a66>3060</span>        Off | 00000000:01:00.0 Off |                  N/A |
</span></span><span style=display:flex><span>|  0%   43C    P8               6W / 170W |      1MiB / 12288MiB |      0%      Default |
</span></span><span style=display:flex><span>|                                         |                      |                  N/A |
</span></span><span style=display:flex><span>+-----------------------------------------+----------------------+----------------------+
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>+---------------------------------------------------------------------------------------+
</span></span><span style=display:flex><span>| Processes:                                                                            |
</span></span><span style=display:flex><span>|  GPU   GI   CI        PID   Type   Process name                            GPU Memory |
</span></span><span style=display:flex><span>|        ID   ID                                                             Usage      |
</span></span><span style=display:flex><span>|<span style=color:#c7bf54>=======================================================================================</span>|
</span></span><span style=display:flex><span>|  No running processes found                                                           |
</span></span><span style=display:flex><span>+---------------------------------------------------------------------------------------+
</span></span></code></pre></div><ul><li>Docker Compose 中使用 NVIDIA 显卡</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#e06c75>version</span>: <span style=color:#98c379>&#39;3.8&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#e06c75>cuda-nvidia-smi</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>image</span>: <span style=color:#98c379>nvidia/cuda:12.2.2-base-ubuntu22.04</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>runtime</span>: <span style=color:#98c379>nvidia</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>deploy</span>:
</span></span><span style=display:flex><span>      <span style=color:#e06c75>resources</span>:
</span></span><span style=display:flex><span>        <span style=color:#e06c75>reservations</span>:
</span></span><span style=display:flex><span>          <span style=color:#e06c75>devices</span>:
</span></span><span style=display:flex><span>            - <span style=color:#e06c75>capabilities</span>: [<span style=color:#63c381>&#34;gpu&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#e06c75>entrypoint</span>: [<span style=color:#63c381>&#34;nvidia-smi&#34;</span>]
</span></span></code></pre></div><h2 id=参考文档>参考文档</h2><ul><li><a href=https://gist.github.com/Cyberes/bc33b3f4d36742ea7a036a8c7c37061e>How to Install Nvidia Drivers on Proxmox</a></li><li><a href=https://gist.github.com/egg82/90164a31db6b71d36fa4f4056bbee2eb#containerlxc>egg82/proxmox_nvidia.md</a></li><li><a href=https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html>Installing the NVIDIA Container Toolkit</a></li></ul></div><div class=prev-next></div><svg id="btt-button" class="arrow-logo" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script><div id=comments><script src=https://utteranc.es/client.js repo=helloworlde/helloworlde.github.io issue-term=title theme=github-light crossorigin=anonymous async></script></div></div></main><footer class=footer><span>&copy; 2025 hellowood.dev</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>