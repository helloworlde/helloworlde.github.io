<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>gRPC Channel</title><meta charset=utf-8><meta name=description content="Ladder@gRPC Channel Channel 是用于执行 RPC 请求的概念上的端点连接，基于负载和配置，一个 Channel 可以有 0 或多个真实连接
Subchannel 代表逻辑连接，最多维护一个物理连接发送 RPC，对应多个 Transport
Channel 有多个子类：
ManagedChannel： 实现了生命周期管理能力的抽象子类 ManagedChannelImpl： ManagedChannel 的实现类，Channel 的主要实现 ManagedChannelOrphanWrapper: ManagedChannel 的包装类，用于引用 ManagedChannel RealChannel：真正执行创建 ClientCallImpl 实例 SubchannelAsChannel: 将 Subchannel 转为 Channel Subchannel 的子类：
SubchannelImpl：Subchannel 的实现类 方法 Channel 发起调用 public abstract <RequestT, ResponseT> ClientCall<RequestT, ResponseT> newCall(MethodDescriptor<RequestT, ResponseT> methodDescriptor, CallOptions callOptions); 目标地址 public abstract String authority(); ManagedChannel ManagedChannel 是 Channel 的子类，提供生命周期管理的 Channel；由 ManagedChannelImpl 实现功能
关闭 shutdown 初始化一个顺序关闭，既有的调用会继续执行，但是新的调用会被立即取消
public abstract ManagedChannel shutdown(); shutdownNow 强制关闭 Channel，会取消所有的调用；即使是强制关闭也不会瞬间停止"><meta name=author content="HelloWood"><link rel=canonical href=https://blog.hellowood.dev/posts/grpc-channel/><meta name=google-site-verification content="G-3MSGPYTHPZ"><link rel=alternate type=application/rss+xml href=https://blog.hellowood.dev/index.xml title=HelloWood><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ",{anonymize_ip:!1})}</script><script async defer data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301 src=https://statistics.lab.hellowood.dev/umami.js></script><meta property="og:title" content="gRPC Channel"><meta property="og:description" content="gRPC Channel Channel 是用于执行 RPC 请求的概念上的端点连接，基于负载和配置，一个 Channel 可以有 0 或多个真实连接
Subchannel 代表逻辑连接，最多维护一个物理连接发送 RPC，对应多个 Transport
Channel 有多个子类：
ManagedChannel： 实现了生命周期管理能力的抽象子类 ManagedChannelImpl： ManagedChannel 的实现类，Channel 的主要实现 ManagedChannelOrphanWrapper: ManagedChannel 的包装类，用于引用 ManagedChannel RealChannel：真正执行创建 ClientCallImpl 实例 SubchannelAsChannel: 将 Subchannel 转为 Channel Subchannel 的子类：
SubchannelImpl：Subchannel 的实现类 方法 Channel 发起调用 public abstract <RequestT, ResponseT> ClientCall<RequestT, ResponseT> newCall(MethodDescriptor<RequestT, ResponseT> methodDescriptor, CallOptions callOptions); 目标地址 public abstract String authority(); ManagedChannel ManagedChannel 是 Channel 的子类，提供生命周期管理的 Channel；由 ManagedChannelImpl 实现功能
关闭 shutdown 初始化一个顺序关闭，既有的调用会继续执行，但是新的调用会被立即取消
public abstract ManagedChannel shutdown(); shutdownNow 强制关闭 Channel，会取消所有的调用；即使是强制关闭也不会瞬间停止"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.hellowood.dev/posts/grpc-channel/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-11-18T22:34:46+00:00"><meta property="article:modified_time" content="2020-11-18T22:34:46+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="gRPC Channel"><meta name=twitter:description content="gRPC Channel Channel 是用于执行 RPC 请求的概念上的端点连接，基于负载和配置，一个 Channel 可以有 0 或多个真实连接
Subchannel 代表逻辑连接，最多维护一个物理连接发送 RPC，对应多个 Transport
Channel 有多个子类：
ManagedChannel： 实现了生命周期管理能力的抽象子类 ManagedChannelImpl： ManagedChannel 的实现类，Channel 的主要实现 ManagedChannelOrphanWrapper: ManagedChannel 的包装类，用于引用 ManagedChannel RealChannel：真正执行创建 ClientCallImpl 实例 SubchannelAsChannel: 将 Subchannel 转为 Channel Subchannel 的子类：
SubchannelImpl：Subchannel 的实现类 方法 Channel 发起调用 public abstract <RequestT, ResponseT> ClientCall<RequestT, ResponseT> newCall(MethodDescriptor<RequestT, ResponseT> methodDescriptor, CallOptions callOptions); 目标地址 public abstract String authority(); ManagedChannel ManagedChannel 是 Channel 的子类，提供生命周期管理的 Channel；由 ManagedChannelImpl 实现功能
关闭 shutdown 初始化一个顺序关闭，既有的调用会继续执行，但是新的调用会被立即取消
public abstract ManagedChannel shutdown(); shutdownNow 强制关闭 Channel，会取消所有的调用；即使是强制关闭也不会瞬间停止"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://blog.hellowood.dev/posts/"},{"@type":"ListItem","position":3,"name":"gRPC Channel","item":"https://blog.hellowood.dev/posts/grpc-channel/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"gRPC Channel","name":"gRPC Channel","description":"gRPC Channel Channel 是用于执行 RPC 请求的概念上的端点连接，基于负载和配置，一个 Channel 可以有 0 或多个真实连接\nSubchannel 代表逻辑连接，最多维护一个物理连接发送 RPC，对应多个 Transport\nChannel 有多个子类：\nManagedChannel： 实现了生命周期管理能力的抽象子类 ManagedChannelImpl： ManagedChannel 的实现类，Channel 的主要实现 ManagedChannelOrphanWrapper: ManagedChannel 的包装类，用于引用 ManagedChannel RealChannel：真正执行创建 ClientCallImpl 实例 SubchannelAsChannel: 将 Subchannel 转为 Channel Subchannel 的子类：\nSubchannelImpl：Subchannel 的实现类 方法 Channel 发起调用 public abstract \u0026lt;RequestT, ResponseT\u0026gt; ClientCall\u0026lt;RequestT, ResponseT\u0026gt; newCall(MethodDescriptor\u0026lt;RequestT, ResponseT\u0026gt; methodDescriptor, CallOptions callOptions); 目标地址 public abstract String authority(); ManagedChannel ManagedChannel 是 Channel 的子类，提供生命周期管理的 Channel；由 ManagedChannelImpl 实现功能\n关闭 shutdown 初始化一个顺序关闭，既有的调用会继续执行，但是新的调用会被立即取消\npublic abstract ManagedChannel shutdown(); shutdownNow 强制关闭 Channel，会取消所有的调用；即使是强制关闭也不会瞬间停止","keywords":["gRPC"],"articleBody":"gRPC Channel Channel 是用于执行 RPC 请求的概念上的端点连接，基于负载和配置，一个 Channel 可以有 0 或多个真实连接\nSubchannel 代表逻辑连接，最多维护一个物理连接发送 RPC，对应多个 Transport\nChannel 有多个子类：\nManagedChannel： 实现了生命周期管理能力的抽象子类 ManagedChannelImpl： ManagedChannel 的实现类，Channel 的主要实现 ManagedChannelOrphanWrapper: ManagedChannel 的包装类，用于引用 ManagedChannel RealChannel：真正执行创建 ClientCallImpl 实例 SubchannelAsChannel: 将 Subchannel 转为 Channel Subchannel 的子类：\nSubchannelImpl：Subchannel 的实现类 方法 Channel 发起调用 public abstract \u003cRequestT, ResponseT\u003e ClientCall\u003cRequestT, ResponseT\u003e newCall(MethodDescriptor\u003cRequestT, ResponseT\u003e methodDescriptor, CallOptions callOptions); 目标地址 public abstract String authority(); ManagedChannel ManagedChannel 是 Channel 的子类，提供生命周期管理的 Channel；由 ManagedChannelImpl 实现功能\n关闭 shutdown 初始化一个顺序关闭，既有的调用会继续执行，但是新的调用会被立即取消\npublic abstract ManagedChannel shutdown(); shutdownNow 强制关闭 Channel，会取消所有的调用；即使是强制关闭也不会瞬间停止\npublic abstract ManagedChannel shutdownNow(); isShutdown 返回 Channel 是否终止，终止的 Channel 没有执行中的调用，相关的资源被释放\npublic abstract boolean isShutdown(); awiatTermination 等待 Channel 变为终止，如果超时则放弃等待\npublic abstract boolean awaitTermination(long timeout, TimeUnit unit) throws InterruptedException; 状态 getState 获取当前连接的状态，当参数为 true 是，如果 Channel 处于 IDLE 模式，则会退出 IDLE 模式，尝试建立连接\npublic ConnectivityState getState(boolean requestConnection) { throw new UnsupportedOperationException(\"Not implemented\"); } notifyWhenStateChanged 当 Channel 的状态和给定的状态不同时触发，用于执行状态变化的回调\npublic void notifyWhenStateChanged(ConnectivityState source, Runnable callback) { throw new UnsupportedOperationException(\"Not implemented\"); } enterIdle 进入空闲模式，Channel 的状态将变为 IDLE，触发 Channel 的名称解析和负载均衡关闭，Channel 上执行中的请求会继续执行，新的 RPC 请求会触发建立新的连接\npublic void enterIdle() { } resetConnectBackoff 对于 TRANSIENT_FAILURE 状态的 Subchannel，使退避计时器短路，并立即重新连接，也会尝试 NameResovler#refresh；主要用于 Android 平台\npublic void resetConnectBackoff() { } Subchannel 生命周期 start 开始 Subchannel，只能调用一次，同时会启动监听器\npublic void start(SubchannelStateListener listener) { throw new UnsupportedOperationException(\"Not implemented\"); } requestConnection 如果没有活跃的连接，在要求建立活跃的连接\npublic abstract void requestConnection() shutdown 关闭 Subchannel，当调用这个方法后，SubchannelPicker 不会再返回这个 Subchannel\npublic abstract void shutdown(); 操作地址 getAddresses 获取第一个地址集合\npublic final EquivalentAddressGroup getAddresses() { List\u003cEquivalentAddressGroup\u003e groups = getAllAddresses(); Preconditions.checkState(groups.size() == 1, \"%s does not have exactly one group\", groups); return groups.get(0); } getAllAddresses 返回 Subchannel 绑定的所有地址\npublic List\u003cEquivalentAddressGroup\u003e getAllAddresses() { throw new UnsupportedOperationException(); } updateAddresses 更新 Subchannel 的地址\npublic void updateAddresses(List\u003cEquivalentAddressGroup\u003e addrs) { throw new UnsupportedOperationException(); } 其他方法 asChannel 使用当前的 Subchannel 创建 Channel，用于健康检查等内部操作\npublic Channel asChannel() { throw new UnsupportedOperationException(); } getInternalSubchannel 获取 Subchannel 的内部的 Subchannel，表示用于发送 RPC 的基础的 Subchannel\npublic Object getInternalSubchannel() { throw new UnsupportedOperationException(); } getAttributes 获取 `Subchannel 的属性\npublic abstract Attributes getAttributes(); ","wordCount":"285","inLanguage":"en","datePublished":"2020-11-18T22:34:46Z","dateModified":"2020-11-18T22:34:46Z","author":{"@type":"Person","name":"HelloWood"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.hellowood.dev/posts/grpc-channel/"},"publisher":{"@type":"Organization","name":"HelloWood","logo":{"@type":"ImageObject","url":"https://blog.hellowood.dev/favicon.ico"}}}</script><link rel=icon href=/images/avatar.png sizes=16x16><link rel=apple-touch-icon href=/images/avatar.png><link rel=manifest href=/images/avatar.png><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.f8020eba33d585b82c30b2a1ceb0d4c4e8e41fb6d8843d07d8ad056da8712972.css integrity="sha256-+AIOujPVhbgsMLKhzrDUxOjkH7bYhD0H2K0FbahxKXI=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.872dfd2cd00064018a833a6e8e77a0fbf8fbac159546f2f205d4dad79a5d8e15.js></script>
<script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>HOME</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/posts>Blog</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=https://statistics.lab.hellowood.dev/share/r2Llssnu/Blog>Dashboard</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/helloworlde><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>gRPC Channel</h1></header><p><small>November 18, 2020&nbsp;· 285 words&nbsp;· 2 min</small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#方法>方法</a><ul><li><a href=#channel>Channel</a></li><li><a href=#managedchannel>ManagedChannel</a></li><li><a href=#subchannel>Subchannel</a></li></ul></li></ul></nav></div><section class=blog-content><h1 id=grpc-channel>gRPC Channel</h1><p><code>Channel</code> 是用于执行 RPC 请求的概念上的端点连接，基于负载和配置，一个 <code>Channel</code> 可以有 0 或多个真实连接</p><p><code>Subchannel</code> 代表逻辑连接，最多维护一个物理连接发送 RPC，对应多个 Transport</p><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/picture/grpc-source-code-channel-class-diagram.png alt=grpc-source-code-channel-class-diagram.png></p><p>Channel 有多个子类：</p><ul><li><code>ManagedChannel</code>： 实现了生命周期管理能力的抽象子类<ul><li><code>ManagedChannelImpl</code>： <code>ManagedChannel</code> 的实现类，<code>Channel</code> 的主要实现</li><li><code>ManagedChannelOrphanWrapper</code>: <code>ManagedChannel</code> 的包装类，用于引用 <code>ManagedChannel</code></li></ul></li><li><code>RealChannel</code>：真正执行创建 <code>ClientCallImpl</code> 实例</li><li><code>SubchannelAsChannel</code>: 将 <code>Subchannel</code> 转为 <code>Channel</code></li></ul><p>Subchannel 的子类：</p><ul><li><code>SubchannelImpl</code>：Subchannel 的实现类</li></ul><h2 id=方法>方法</h2><h3 id=channel>Channel</h3><ul><li>发起调用</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#f92672>&lt;</span>RequestT<span style=color:#f92672>,</span> ResponseT<span style=color:#f92672>&gt;</span> ClientCall<span style=color:#f92672>&lt;</span>RequestT<span style=color:#f92672>,</span> ResponseT<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>newCall</span><span style=color:#f92672>(</span>MethodDescriptor<span style=color:#f92672>&lt;</span>RequestT<span style=color:#f92672>,</span> ResponseT<span style=color:#f92672>&gt;</span> methodDescriptor<span style=color:#f92672>,</span> CallOptions callOptions<span style=color:#f92672>);</span>
</span></span></code></pre></div><ul><li>目标地址</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> String <span style=color:#a6e22e>authority</span><span style=color:#f92672>();</span>
</span></span></code></pre></div><h3 id=managedchannel>ManagedChannel</h3><p><code>ManagedChannel</code> 是 <code>Channel</code> 的子类，提供生命周期管理的 <code>Channel</code>；由 <code>ManagedChannelImpl</code> 实现功能</p><h5 id=关闭>关闭</h5><ul><li>shutdown</li></ul><p>初始化一个顺序关闭，既有的调用会继续执行，但是新的调用会被立即取消</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> ManagedChannel <span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span></code></pre></div><ul><li>shutdownNow</li></ul><p>强制关闭 Channel，会取消所有的调用；即使是强制关闭也不会瞬间停止</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> ManagedChannel <span style=color:#a6e22e>shutdownNow</span><span style=color:#f92672>();</span>
</span></span></code></pre></div><ul><li>isShutdown</li></ul><p>返回 <code>Channel</code> 是否终止，终止的 <code>Channel</code> 没有执行中的调用，相关的资源被释放</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isShutdown</span><span style=color:#f92672>();</span>
</span></span></code></pre></div><ul><li>awiatTermination</li></ul><p>等待 <code>Channel</code> 变为终止，如果超时则放弃等待</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>awaitTermination</span><span style=color:#f92672>(</span><span style=color:#66d9ef>long</span> timeout<span style=color:#f92672>,</span> TimeUnit unit<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> InterruptedException<span style=color:#f92672>;</span>
</span></span></code></pre></div><h4 id=状态>状态</h4><ul><li>getState</li></ul><p>获取当前连接的状态，当参数为 true 是，如果 <code>Channel</code> 处于 <code>IDLE</code> 模式，则会退出 <code>IDLE</code> 模式，尝试建立连接</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> ConnectivityState <span style=color:#a6e22e>getState</span><span style=color:#f92672>(</span><span style=color:#66d9ef>boolean</span> requestConnection<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> UnsupportedOperationException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Not implemented&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>notifyWhenStateChanged</li></ul><p>当 <code>Channel</code> 的状态和给定的状态不同时触发，用于执行状态变化的回调</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>notifyWhenStateChanged</span><span style=color:#f92672>(</span>ConnectivityState source<span style=color:#f92672>,</span> Runnable callback<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> UnsupportedOperationException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Not implemented&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>enterIdle</li></ul><p>进入空闲模式，<code>Channel</code> 的状态将变为 <code>IDLE</code>，触发 <code>Channel</code> 的名称解析和负载均衡关闭，<code>Channel</code> 上执行中的请求会继续执行，新的 RPC 请求会触发建立新的连接</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>enterIdle</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>resetConnectBackoff</li></ul><p>对于 <code>TRANSIENT_FAILURE</code> 状态的 <code>Subchannel</code>，使退避计时器短路，并立即重新连接，也会尝试 <code>NameResovler#refresh</code>；主要用于 Android 平台</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>resetConnectBackoff</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=subchannel>Subchannel</h3><h4 id=生命周期>生命周期</h4><ul><li>start</li></ul><p>开始 <code>Subchannel</code>，只能调用一次，同时会启动监听器</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>start</span><span style=color:#f92672>(</span>SubchannelStateListener listener<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> UnsupportedOperationException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Not implemented&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>requestConnection</li></ul><p>如果没有活跃的连接，在要求建立活跃的连接</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>requestConnection</span><span style=color:#f92672>()</span>
</span></span></code></pre></div><ul><li>shutdown</li></ul><p>关闭 <code>Subchannel</code>，当调用这个方法后，<code>SubchannelPicker</code> 不会再返回这个 <code>Subchannel</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>shutdown</span><span style=color:#f92672>();</span>
</span></span></code></pre></div><h4 id=操作地址>操作地址</h4><ul><li>getAddresses</li></ul><p>获取第一个地址集合</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>final</span> EquivalentAddressGroup <span style=color:#a6e22e>getAddresses</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  List<span style=color:#f92672>&lt;</span>EquivalentAddressGroup<span style=color:#f92672>&gt;</span> groups <span style=color:#f92672>=</span> getAllAddresses<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>  Preconditions<span style=color:#f92672>.</span><span style=color:#a6e22e>checkState</span><span style=color:#f92672>(</span>groups<span style=color:#f92672>.</span><span style=color:#a6e22e>size</span><span style=color:#f92672>()</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;%s does not have exactly one group&#34;</span><span style=color:#f92672>,</span> groups<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> groups<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span><span style=color:#ae81ff>0</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>getAllAddresses</li></ul><p>返回 <code>Subchannel</code> 绑定的所有地址</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>EquivalentAddressGroup<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getAllAddresses</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> UnsupportedOperationException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>updateAddresses</li></ul><p>更新 <code>Subchannel</code> 的地址</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>updateAddresses</span><span style=color:#f92672>(</span>List<span style=color:#f92672>&lt;</span>EquivalentAddressGroup<span style=color:#f92672>&gt;</span> addrs<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> UnsupportedOperationException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=其他方法>其他方法</h4><ul><li>asChannel</li></ul><p>使用当前的 <code>Subchannel</code> 创建 <code>Channel</code>，用于健康检查等内部操作</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> Channel <span style=color:#a6e22e>asChannel</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> UnsupportedOperationException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>getInternalSubchannel</li></ul><p>获取 <code>Subchannel</code> 的内部的 <code>Subchannel</code>，表示用于发送 RPC 的基础的 <code>Subchannel</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>getInternalSubchannel</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> UnsupportedOperationException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>getAttributes</li></ul><p>获取 `Subchannel 的属性</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> Attributes <span style=color:#a6e22e>getAttributes</span><span style=color:#f92672>();</span>
</span></span></code></pre></div></section><div class=paginator><a class=prev href=https://blog.hellowood.dev/posts/grpc-server-%E7%AB%AF%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/><span>&larr;&nbsp;&nbsp;</span><span>gRPC Server 端启动流程</span></a>
<a class=next href=https://blog.hellowood.dev/posts/grpc-client-%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/><span>gRPC Client 启动流程</span><span>&nbsp;&nbsp;&rarr;</span></a></div></article></div><footer class=footer><p>&copy; 2023 <a href=https://blog.hellowood.dev>HelloWood</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg></a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>