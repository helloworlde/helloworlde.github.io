<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>Traefik 使用 Let’s Encrypt 申请 HTTPS 证书</title>
<meta charset=utf-8><meta name=description content="Ladder@Traefik 使用 Let&rsquo;s Encrypt 申请 HTTPS 证书 在 Traefik 中，支持通过 Let&rsquo;s Encrypt 从 ACME 自动申请 HTTPS 证书
从 ACME 申请证书 Traefik 申请证书基于 Lego ，所以同样支持基于 TLS、HTTP、DNS 三种申请方式
因为要申请的域名没有部署服务，所以基于 DNS 的方式验证；在申请证书时会向域名解析中添加 _acme-challenge前缀的 TXT 记录用于验证
添加配置 traefik.yaml 需要向 Traefik 的配置文件中添加 certificatesResolvers 的配置
certificatesResolvers: default: acme: email: yourname@mail.com storage: /etc/traefik/certificates/acme.json dnsChallenge: provider: alidns 其中 email为注册 ACME 的邮箱，storage 是存储生成的证书内容的文件；dnsChallenge 指定了以 DNS 的方式验证；provider 指定域名解析平台，常见的平台参考 providers
docker-compose.yaml 因为使用的是 DNS Provider 是阿里云，所以需要将阿里云的鉴权方式通过环境变量的方式添加到容器中
version: '3' services: reverse-proxy: container_name: reverse-proxy image: traefik:2."><meta name=author content="HelloWood"><link rel=canonical href=https://blog.hellowood.dev/posts/traefik-%E4%BD%BF%E7%94%A8-lets-encrypt-%E7%94%B3%E8%AF%B7-https-%E8%AF%81%E4%B9%A6/><meta name=google-site-verification content="G-3MSGPYTHPZ"><link rel=alternate type=application/rss+xml href=https://blog.hellowood.dev//index.xml title=HelloWood><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ")}</script><script async defer data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301 src=https://umami.hellowood.dev/script.js></script><script defer data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}' src=https://static.cloudflareinsights.com/beacon.min.js></script><meta property="og:url" content="https://blog.hellowood.dev/posts/traefik-%E4%BD%BF%E7%94%A8-lets-encrypt-%E7%94%B3%E8%AF%B7-https-%E8%AF%81%E4%B9%A6/"><meta property="og:site_name" content="HelloWood"><meta property="og:title" content="Traefik 使用 Let’s Encrypt 申请 HTTPS 证书"><meta property="og:description" content="Traefik 使用 Let’s Encrypt 申请 HTTPS 证书 在 Traefik 中，支持通过 Let’s Encrypt 从 ACME 自动申请 HTTPS 证书
从 ACME 申请证书 Traefik 申请证书基于 Lego ，所以同样支持基于 TLS、HTTP、DNS 三种申请方式
因为要申请的域名没有部署服务，所以基于 DNS 的方式验证；在申请证书时会向域名解析中添加 _acme-challenge前缀的 TXT 记录用于验证
添加配置 traefik.yaml 需要向 Traefik 的配置文件中添加 certificatesResolvers 的配置
certificatesResolvers: default: acme: email: yourname@mail.com storage: /etc/traefik/certificates/acme.json dnsChallenge: provider: alidns 其中 email为注册 ACME 的邮箱，storage 是存储生成的证书内容的文件；dnsChallenge 指定了以 DNS 的方式验证；provider 指定域名解析平台，常见的平台参考 providers
docker-compose.yaml 因为使用的是 DNS Provider 是阿里云，所以需要将阿里云的鉴权方式通过环境变量的方式添加到容器中
version: '3' services: reverse-proxy: container_name: reverse-proxy image: traefik:2."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-07T11:32:08+00:00"><meta property="article:modified_time" content="2022-08-07T11:32:08+00:00"><meta property="article:tag" content="Traefik"><meta property="article:tag" content="LetsEncrypt"><meta property="article:tag" content="HomeLab"><meta name=twitter:card content="summary"><meta name=twitter:title content="Traefik 使用 Let’s Encrypt 申请 HTTPS 证书"><meta name=twitter:description content="Traefik 使用 Let’s Encrypt 申请 HTTPS 证书 在 Traefik 中，支持通过 Let’s Encrypt 从 ACME 自动申请 HTTPS 证书
从 ACME 申请证书 Traefik 申请证书基于 Lego ，所以同样支持基于 TLS、HTTP、DNS 三种申请方式
因为要申请的域名没有部署服务，所以基于 DNS 的方式验证；在申请证书时会向域名解析中添加 _acme-challenge前缀的 TXT 记录用于验证
添加配置 traefik.yaml 需要向 Traefik 的配置文件中添加 certificatesResolvers 的配置
certificatesResolvers: default: acme: email: yourname@mail.com storage: /etc/traefik/certificates/acme.json dnsChallenge: provider: alidns 其中 email为注册 ACME 的邮箱，storage 是存储生成的证书内容的文件；dnsChallenge 指定了以 DNS 的方式验证；provider 指定域名解析平台，常见的平台参考 providers
docker-compose.yaml 因为使用的是 DNS Provider 是阿里云，所以需要将阿里云的鉴权方式通过环境变量的方式添加到容器中
version: '3' services: reverse-proxy: container_name: reverse-proxy image: traefik:2."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.hellowood.dev/posts/"},{"@type":"ListItem","position":2,"name":"Traefik 使用 Let’s Encrypt 申请 HTTPS 证书","item":"https://blog.hellowood.dev/posts/traefik-%E4%BD%BF%E7%94%A8-lets-encrypt-%E7%94%B3%E8%AF%B7-https-%E8%AF%81%E4%B9%A6/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Traefik 使用 Let’s Encrypt 申请 HTTPS 证书","name":"Traefik 使用 Let’s Encrypt 申请 HTTPS 证书","description":"Traefik 使用 Let\u0026rsquo;s Encrypt 申请 HTTPS 证书 在 Traefik 中，支持通过 Let\u0026rsquo;s Encrypt 从 ACME 自动申请 HTTPS 证书\n从 ACME 申请证书 Traefik 申请证书基于 Lego ，所以同样支持基于 TLS、HTTP、DNS 三种申请方式\n因为要申请的域名没有部署服务，所以基于 DNS 的方式验证；在申请证书时会向域名解析中添加 _acme-challenge前缀的 TXT 记录用于验证\n添加配置 traefik.yaml 需要向 Traefik 的配置文件中添加 certificatesResolvers 的配置\ncertificatesResolvers: default: acme: email: yourname@mail.com storage: /etc/traefik/certificates/acme.json dnsChallenge: provider: alidns 其中 email为注册 ACME 的邮箱，storage 是存储生成的证书内容的文件；dnsChallenge 指定了以 DNS 的方式验证；provider 指定域名解析平台，常见的平台参考 providers\ndocker-compose.yaml 因为使用的是 DNS Provider 是阿里云，所以需要将阿里云的鉴权方式通过环境变量的方式添加到容器中\nversion: \u0026#39;3\u0026#39; services: reverse-proxy: container_name: reverse-proxy image: traefik:2.","keywords":["Traefik","LetsEncrypt","HomeLab"],"articleBody":"Traefik 使用 Let’s Encrypt 申请 HTTPS 证书 在 Traefik 中，支持通过 Let’s Encrypt 从 ACME 自动申请 HTTPS 证书\n从 ACME 申请证书 Traefik 申请证书基于 Lego ，所以同样支持基于 TLS、HTTP、DNS 三种申请方式\n因为要申请的域名没有部署服务，所以基于 DNS 的方式验证；在申请证书时会向域名解析中添加 _acme-challenge前缀的 TXT 记录用于验证\n添加配置 traefik.yaml 需要向 Traefik 的配置文件中添加 certificatesResolvers 的配置\ncertificatesResolvers: default: acme: email: yourname@mail.com storage: /etc/traefik/certificates/acme.json dnsChallenge: provider: alidns 其中 email为注册 ACME 的邮箱，storage 是存储生成的证书内容的文件；dnsChallenge 指定了以 DNS 的方式验证；provider 指定域名解析平台，常见的平台参考 providers\ndocker-compose.yaml 因为使用的是 DNS Provider 是阿里云，所以需要将阿里云的鉴权方式通过环境变量的方式添加到容器中\nversion: '3' services: reverse-proxy: container_name: reverse-proxy image: traefik:2.8 command: - \"--configFile=/etc/traefik/traefik.yml\" ports: - \"80:80\" - \"443:443\" - \"8080:8080\" volumes: - \"/var/run/docker.sock:/var/run/docker.sock:ro\" - \"/root/workspaces/homelab/traefik/traefik.yml:/etc/traefik/traefik.yml\" environment: - ALICLOUD_ACCESS_KEY=${ALICLOUD_ACCESS_KEY} - ALICLOUD_SECRET_KEY=${ALICLOUD_SECRET_KEY} 为服务指定域名 在服务路由规则中指定域名，这样 Traefik 就会为这个域名自动申请证书；需要开启 TLS 并且指定 certresolver，名称即为配置文件 certificatesResolvers中定义的名称，即 defualt\nversion: '3' services: whoami: image: \"traefik/whoami\" container_name: \"whoami\" labels: - \"traefik.enable=true\" - \"traefik.http.routers.whoami.rule=Host(`whoami.homelab.example.com`)\" - \"traefik.http.routers.whoami.entrypoints=websecure\" - \"traefik.http.routers.whoami.tls=true\" - \"traefik.http.routers.whoami.tls.certresolver=default\" 这样，就会在 Traefik 启动后主动为 whoami.homelab.example.com申请 HTTPS 证书，并保存到 /etc/traefik/certificates/acme.json 文件中：\n{ \"letsencrypt\": { \"Account\": { \"Email\": \"yourname@mail.com\", \"Registration\": { \"body\": { \"status\": \"valid\", \"contact\": [ \"mailto:yourname@mail.com\" ] }, \"uri\": \"https://acme-v02.api.letsencrypt.org/acme/acct/1234\" }, \"PrivateKey\": \"xxx\", \"KeyType\": \"4096\" }, \"Certificates\": [ { \"domain\": { \"main\": \"whoami.homelab.example.com\" }, \"certificate\": \"xxx\", \"key\": \"xxx\", \"Store\": \"default\" } ] } } 泛域名证书申请 在使用过程中，通常会有多个域名，需要频繁申请证书，当服务重启后同时更新可能会被 Let’s Encrypt 限流导致申请失败，因此，Let’s Encrypt 支持为泛域名申请证书；这个证书可以用于所有的子域名；\n如要转发的 Host 都是 xxx.homelab.example.com，那么为 *.homelab.example.com申请证书即可\ntraefik.yaml 同样需要先指定 certificatesResolvers；然后在 entryPoints.websecure.http.tls 中指定要申请的域名；这样 Traefik 启动后就会自动为 homelab.example.com 和 *.homelab.example.com 申请 HTTPS 证书，之后访问 xxx.homelab.example.com 都可以用这个证书\ncertificatesResolvers: default: acme: email: yourname@mail.com storage: /etc/traefik/certificates/acme.json dnsChallenge: provider: alidns entryPoints: web: address: \":80\" websecure: address: \":443\" http: tls: certResolver: default domains: - main: \"homelab.example.com\" sans: - \"homelab.example.com\" - \"*.homelab.example.com\" 申请后得到的证书内容为：\n{ \"default\": { \"Account\": { \"Email\": \"yourname@mail.com\", \"Registration\": { \"body\": { \"status\": \"valid\", \"contact\": [ \"mailto:yourname@mail.com\" ] }, \"uri\": \"https://acme-v02.api.letsencrypt.org/acme/acct/1234\" }, \"PrivateKey\": \"xxx\", \"KeyType\": \"4096\" }, \"Certificates\": [ { \"domain\": { \"main\": \"homelab.example.com\", \"sans\": [ \"homelab.example.com\", \"*.homelab.example.com\" ] }, \"certificate\": \"xxx\", \"key\": \"xxx\", \"Store\": \"default\" } ] } } ","wordCount":"279","inLanguage":"en","datePublished":"2022-08-07T11:32:08Z","dateModified":"2022-08-07T11:32:08Z","author":{"@type":"Person","name":"HelloWood"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.hellowood.dev/posts/traefik-%E4%BD%BF%E7%94%A8-lets-encrypt-%E7%94%B3%E8%AF%B7-https-%E8%AF%81%E4%B9%A6/"},"publisher":{"@type":"Organization","name":"HelloWood","logo":{"@type":"ImageObject","url":"https://blog.hellowood.dev/favicon.ico"}}}</script><link rel=icon href=/images/avatar.png sizes=16x16><link rel=apple-touch-icon href=/images/avatar.png><link rel=manifest href=/images/avatar.png><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.ff1bc260fafbfb440e10194d7d06d57eb5e85eed11d12d06255581262664204e.css integrity="sha256-/xvCYPr7+0QOEBlNfQbVfrXoXu0R0S0GJVWBJiZkIE4=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><meta name=google-adsense-account content="ca-pub-3401351766168985"><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jtbhx98g62")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3401351766168985" crossorigin=anonymous></script><script defer src=https://analytics.us.umami.is/script.js data-website-id=73ff1c8c-9938-43cf-81af-e77e26b0cca3></script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand data-umami-event=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Blog href=/posts>Blog</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Tags href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Archive href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Dashboard href=https://umami.hellowood.dev/share/lab/Blog>Dashboard</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link data-umami-event=navigation-social href=https://github.com/helloworlde><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button data-umami-event=toggle-theme aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
<span class=toggle-light><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>Traefik 使用 Let’s Encrypt 申请 HTTPS 证书</h1></header><p><small>August 7, 2022&nbsp;· 279 words&nbsp;· 2 min</small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#从-acme-申请证书>从 ACME 申请证书</a><ul><li><a href=#添加配置>添加配置</a></li></ul></li><li><a href=#泛域名证书申请>泛域名证书申请</a></li></ul></nav></div><section class=blog-content><h1 id=traefik-使用-lets-encrypt-申请-https-证书>Traefik 使用 Let&rsquo;s Encrypt 申请 HTTPS 证书</h1><p>在 Traefik 中，支持通过 Let&rsquo;s Encrypt 从 ACME <a href=https://doc.traefik.io/traefik/https/acme/>自动申请 HTTPS 证书</a></p><h2 id=从-acme-申请证书>从 ACME 申请证书</h2><p>Traefik 申请证书基于 <a href=https://github.com/go-acme/lego>Lego</a> ，所以同样支持基于 TLS、HTTP、DNS 三种申请方式</p><p>因为要申请的域名没有部署服务，所以基于 DNS 的方式验证；在申请证书时会向域名解析中添加 <code>_acme-challenge</code>前缀的 TXT 记录用于验证</p><h3 id=添加配置>添加配置</h3><ul><li>traefik.yaml</li></ul><p>需要向 Traefik 的配置文件中添加 <code>certificatesResolvers</code> 的配置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>certificatesResolvers</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>default</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>acme</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>email</span>: <span style=color:#ae81ff>yourname@mail.com</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>/etc/traefik/certificates/acme.json</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dnsChallenge</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>alidns</span>
</span></span></code></pre></div><p>其中 <code>email</code>为注册 ACME 的邮箱，<code>storage</code> 是存储生成的证书内容的文件；<code>dnsChallenge</code> 指定了以 DNS 的方式验证；<code>provider</code> 指定域名解析平台，常见的平台参考 <a href=https://doc.traefik.io/traefik/https/acme/#providers>providers</a></p><ul><li>docker-compose.yaml</li></ul><p>因为使用的是 DNS Provider 是阿里云，所以需要将阿里云的鉴权方式通过环境变量的方式添加到容器中</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>reverse-proxy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>reverse-proxy</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>traefik:2.8</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;--configFile=/etc/traefik/traefik.yml&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;80:80&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;443:443&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;8080:8080&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;/var/run/docker.sock:/var/run/docker.sock:ro&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;/root/workspaces/homelab/traefik/traefik.yml:/etc/traefik/traefik.yml&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ALICLOUD_ACCESS_KEY=${ALICLOUD_ACCESS_KEY}</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ALICLOUD_SECRET_KEY=${ALICLOUD_SECRET_KEY}</span>
</span></span></code></pre></div><ul><li>为服务指定域名</li></ul><p>在服务路由规则中指定域名，这样 Traefik 就会为这个域名自动申请证书；需要开启 TLS 并且指定 <code>certresolver</code>，名称即为配置文件 <code>certificatesResolvers</code>中定义的名称，即 <code>defualt</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>whoami</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#e6db74>&#34;traefik/whoami&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#e6db74>&#34;whoami&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.enable=true&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.whoami.rule=Host(`whoami.homelab.example.com`)&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.whoami.entrypoints=websecure&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.whoami.tls=true&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;traefik.http.routers.whoami.tls.certresolver=default&#34;</span>
</span></span></code></pre></div><p>这样，就会在 Traefik 启动后主动为 <code>whoami.homelab.example.com</code>申请 HTTPS 证书，并保存到 <code>/etc/traefik/certificates/acme.json</code> 文件中：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;letsencrypt&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Account&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Email&#34;</span>: <span style=color:#e6db74>&#34;yourname@mail.com&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Registration&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;body&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;status&#34;</span>: <span style=color:#e6db74>&#34;valid&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;contact&#34;</span>: [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;mailto:yourname@mail.com&#34;</span>
</span></span><span style=display:flex><span>          ]
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;uri&#34;</span>: <span style=color:#e6db74>&#34;https://acme-v02.api.letsencrypt.org/acme/acct/1234&#34;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;PrivateKey&#34;</span>: <span style=color:#e6db74>&#34;xxx&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;KeyType&#34;</span>: <span style=color:#e6db74>&#34;4096&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Certificates&#34;</span>: [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;domain&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;main&#34;</span>: <span style=color:#e6db74>&#34;whoami.homelab.example.com&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;certificate&#34;</span>: <span style=color:#e6db74>&#34;xxx&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;key&#34;</span>: <span style=color:#e6db74>&#34;xxx&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Store&#34;</span>: <span style=color:#e6db74>&#34;default&#34;</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=泛域名证书申请>泛域名证书申请</h2><p>在使用过程中，通常会有多个域名，需要频繁申请证书，当服务重启后同时更新可能会被 Let&rsquo;s Encrypt 限流导致申请失败，因此，Let&rsquo;s Encrypt 支持为泛域名申请证书；这个证书可以用于所有的子域名；</p><p>如要转发的 Host 都是 <code>xxx.homelab.example.com</code>，那么为 <code>*.homelab.example.com</code>申请证书即可</p><ul><li>traefik.yaml</li></ul><p>同样需要先指定 <code>certificatesResolvers</code>；然后在 <code>entryPoints.websecure.http.tls</code> 中指定要申请的域名；这样 Traefik 启动后就会自动为 <code>homelab.example.com</code> 和 <code>*.homelab.example.com</code> 申请 HTTPS 证书，之后访问 <code>xxx.homelab.example.com</code> 都可以用这个证书</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>certificatesResolvers</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>default</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>acme</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>email</span>: <span style=color:#ae81ff>yourname@mail.com</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>storage</span>: <span style=color:#ae81ff>/etc/traefik/certificates/acme.json</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dnsChallenge</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>alidns</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>entryPoints</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>web</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>address</span>: <span style=color:#e6db74>&#34;:80&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>websecure</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>address</span>: <span style=color:#e6db74>&#34;:443&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>http</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>tls</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>certResolver</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>domains</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>main</span>: <span style=color:#e6db74>&#34;homelab.example.com&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>sans</span>:
</span></span><span style=display:flex><span>            - <span style=color:#e6db74>&#34;homelab.example.com&#34;</span>
</span></span><span style=display:flex><span>            - <span style=color:#e6db74>&#34;*.homelab.example.com&#34;</span>
</span></span></code></pre></div><p>申请后得到的证书内容为：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;default&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Account&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Email&#34;</span>: <span style=color:#e6db74>&#34;yourname@mail.com&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Registration&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;body&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;status&#34;</span>: <span style=color:#e6db74>&#34;valid&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;contact&#34;</span>: [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;mailto:yourname@mail.com&#34;</span>
</span></span><span style=display:flex><span>          ]
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;uri&#34;</span>: <span style=color:#e6db74>&#34;https://acme-v02.api.letsencrypt.org/acme/acct/1234&#34;</span>
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;PrivateKey&#34;</span>: <span style=color:#e6db74>&#34;xxx&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;KeyType&#34;</span>: <span style=color:#e6db74>&#34;4096&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Certificates&#34;</span>: [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;domain&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;main&#34;</span>: <span style=color:#e6db74>&#34;homelab.example.com&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;sans&#34;</span>: [
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;homelab.example.com&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;*.homelab.example.com&#34;</span>
</span></span><span style=display:flex><span>          ]
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;certificate&#34;</span>: <span style=color:#e6db74>&#34;xxx&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;key&#34;</span>: <span style=color:#e6db74>&#34;xxx&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Store&#34;</span>: <span style=color:#e6db74>&#34;default&#34;</span>
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><div class=paginator><a class=prev href=https://blog.hellowood.dev/posts/openwrt-%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE/><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg>
<span>Openwrt-初始化配置</span></a>
<a class=next href=https://blog.hellowood.dev/posts/%E4%BD%BF%E7%94%A8-lets-encrypt-%E7%94%B3%E8%AF%B7-https-%E8%AF%81%E4%B9%A6/><span>使用 Let’s Encrypt 申请 HTTPS 证书</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div></article></div><footer class=footer><p>&copy; 2024 <a href=https://blog.hellowood.dev/>HelloWood</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank data-umami-event=to-hugo>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank data-umami-event=to-ladder>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g data-umami-event=top-link><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>