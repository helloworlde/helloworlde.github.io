<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>SpringBoot 使用QuartzJob实现任务控制</title>
<meta charset=utf-8><meta name=description content='Ladder@SpringBoot 使用QuartzJob实现任务控制

项目地址https://github.com/helloworlde/SpringBootCollection/tree/master/SpringBoot-ScheduledJob


在 SpringBoot 中通过 @Schedule注解就可以简单的实现定时任务，但是这种方式够灵活，如果想要修改执行状态就必须修改代码；另外一种实现方式是通过 Quartz 实现任务调度

通过 SpringBoot 实现简单任务
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.scheduling.annotation.Scheduled;

import static cn.com.hellowood.scheduledjob.utils.ApplicationUtils.currentDateTime;

@Component
public class StaticJob {

    private final Logger logger = LoggerFactory.getLogger(getClass());

    private final static long SECOND = 1000;


    /**
     * fixedDelay: 固定延迟时间执行
     */
    @Scheduled(fixedDelay = 10 * SECOND)
    public void fixedDelayJob() {
        logger.info("{}\tfixedDelay", currentDateTime());
    }

    /**
     * fixedRate: 固定间隔时间执行
     */
    @Scheduled(fixedRate = 10 * SECOND)
    public void fixedRate() {
        logger.info("{}\tfixedRate", currentDateTime());
    }

    /**
     * cron: 通过 Cron 表达式控制执行
     */
    @Scheduled(cron = "*/10 * * * * *")
    public void cron() {
        logger.info("{}\tcron", currentDateTime());
    }
}

SpringBoot 集成 Quartz 实现可控的任务

在 SpringBoot 的2.0 以上版本直接集成了 Quartz；
本文通过 RESTful 接口 来实现，实现的大概思路是通过实现 org.quartz.Job接口，在其execute()中实现自己的逻辑；通过调用 org.quartz.Scheduler的接口实现任务的创建，运行，暂停，更新，删除功能，核心的代码在 cn.com.hellowood.scheduledjob.job.ScheduleUtil里'><meta name=author content="HelloWood"><link rel=canonical href=https://blog.hellowood.dev/posts/springboot-%E4%BD%BF%E7%94%A8quartzjob%E5%AE%9E%E7%8E%B0%E4%BB%BB%E5%8A%A1%E6%8E%A7%E5%88%B6/><meta name=google-site-verification content="G-3MSGPYTHPZ"><link rel=alternate type=application/rss+xml href=https://blog.hellowood.dev//index.xml title=HelloWood><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ")}</script><script async defer data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301 src=https://umami.hellowood.dev/script.js></script><script defer data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}' src=https://static.cloudflareinsights.com/beacon.min.js></script><meta property="og:url" content="https://blog.hellowood.dev/posts/springboot-%E4%BD%BF%E7%94%A8quartzjob%E5%AE%9E%E7%8E%B0%E4%BB%BB%E5%8A%A1%E6%8E%A7%E5%88%B6/"><meta property="og:site_name" content="HelloWood"><meta property="og:title" content="SpringBoot 使用QuartzJob实现任务控制"><meta property="og:description" content='SpringBoot 使用QuartzJob实现任务控制 项目地址https://github.com/helloworlde/SpringBootCollection/tree/master/SpringBoot-ScheduledJob
在 SpringBoot 中通过 @Schedule注解就可以简单的实现定时任务，但是这种方式够灵活，如果想要修改执行状态就必须修改代码；另外一种实现方式是通过 Quartz 实现任务调度
通过 SpringBoot 实现简单任务 import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.scheduling.annotation.Scheduled; import static cn.com.hellowood.scheduledjob.utils.ApplicationUtils.currentDateTime; @Component public class StaticJob { private final Logger logger = LoggerFactory.getLogger(getClass()); private final static long SECOND = 1000; /** * fixedDelay: 固定延迟时间执行 */ @Scheduled(fixedDelay = 10 * SECOND) public void fixedDelayJob() { logger.info("{}\tfixedDelay", currentDateTime()); } /** * fixedRate: 固定间隔时间执行 */ @Scheduled(fixedRate = 10 * SECOND) public void fixedRate() { logger.info("{}\tfixedRate", currentDateTime()); } /** * cron: 通过 Cron 表达式控制执行 */ @Scheduled(cron = "*/10 * * * * *") public void cron() { logger.info("{}\tcron", currentDateTime()); } } SpringBoot 集成 Quartz 实现可控的任务 在 SpringBoot 的2.0 以上版本直接集成了 Quartz； 本文通过 RESTful 接口 来实现，实现的大概思路是通过实现 org.quartz.Job接口，在其execute()中实现自己的逻辑；通过调用 org.quartz.Scheduler的接口实现任务的创建，运行，暂停，更新，删除功能，核心的代码在 cn.com.hellowood.scheduledjob.job.ScheduleUtil里'><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-02-12T18:22:43+00:00"><meta property="article:modified_time" content="2018-02-12T18:22:43+00:00"><meta property="article:tag" content="Java"><meta property="article:tag" content="SpringBoot"><meta property="article:tag" content="Quartz"><meta property="article:tag" content="Job"><meta name=twitter:card content="summary"><meta name=twitter:title content="SpringBoot 使用QuartzJob实现任务控制"><meta name=twitter:description content='SpringBoot 使用QuartzJob实现任务控制 项目地址https://github.com/helloworlde/SpringBootCollection/tree/master/SpringBoot-ScheduledJob
在 SpringBoot 中通过 @Schedule注解就可以简单的实现定时任务，但是这种方式够灵活，如果想要修改执行状态就必须修改代码；另外一种实现方式是通过 Quartz 实现任务调度
通过 SpringBoot 实现简单任务 import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.scheduling.annotation.Scheduled; import static cn.com.hellowood.scheduledjob.utils.ApplicationUtils.currentDateTime; @Component public class StaticJob { private final Logger logger = LoggerFactory.getLogger(getClass()); private final static long SECOND = 1000; /** * fixedDelay: 固定延迟时间执行 */ @Scheduled(fixedDelay = 10 * SECOND) public void fixedDelayJob() { logger.info("{}\tfixedDelay", currentDateTime()); } /** * fixedRate: 固定间隔时间执行 */ @Scheduled(fixedRate = 10 * SECOND) public void fixedRate() { logger.info("{}\tfixedRate", currentDateTime()); } /** * cron: 通过 Cron 表达式控制执行 */ @Scheduled(cron = "*/10 * * * * *") public void cron() { logger.info("{}\tcron", currentDateTime()); } } SpringBoot 集成 Quartz 实现可控的任务 在 SpringBoot 的2.0 以上版本直接集成了 Quartz； 本文通过 RESTful 接口 来实现，实现的大概思路是通过实现 org.quartz.Job接口，在其execute()中实现自己的逻辑；通过调用 org.quartz.Scheduler的接口实现任务的创建，运行，暂停，更新，删除功能，核心的代码在 cn.com.hellowood.scheduledjob.job.ScheduleUtil里'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://blog.hellowood.dev/posts/"},{"@type":"ListItem","position":2,"name":"SpringBoot 使用QuartzJob实现任务控制","item":"https://blog.hellowood.dev/posts/springboot-%E4%BD%BF%E7%94%A8quartzjob%E5%AE%9E%E7%8E%B0%E4%BB%BB%E5%8A%A1%E6%8E%A7%E5%88%B6/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"SpringBoot 使用QuartzJob实现任务控制","name":"SpringBoot 使用QuartzJob实现任务控制","description":"SpringBoot 使用QuartzJob实现任务控制 项目地址https://github.com/helloworlde/SpringBootCollection/tree/master/SpringBoot-ScheduledJob\n在 SpringBoot 中通过 @Schedule注解就可以简单的实现定时任务，但是这种方式够灵活，如果想要修改执行状态就必须修改代码；另外一种实现方式是通过 Quartz 实现任务调度\n通过 SpringBoot 实现简单任务 import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.scheduling.annotation.Scheduled; import static cn.com.hellowood.scheduledjob.utils.ApplicationUtils.currentDateTime; @Component public class StaticJob { private final Logger logger = LoggerFactory.getLogger(getClass()); private final static long SECOND = 1000; /** * fixedDelay: 固定延迟时间执行 */ @Scheduled(fixedDelay = 10 * SECOND) public void fixedDelayJob() { logger.info(\u0026#34;{}\\tfixedDelay\u0026#34;, currentDateTime()); } /** * fixedRate: 固定间隔时间执行 */ @Scheduled(fixedRate = 10 * SECOND) public void fixedRate() { logger.info(\u0026#34;{}\\tfixedRate\u0026#34;, currentDateTime()); } /** * cron: 通过 Cron 表达式控制执行 */ @Scheduled(cron = \u0026#34;*/10 * * * * *\u0026#34;) public void cron() { logger.info(\u0026#34;{}\\tcron\u0026#34;, currentDateTime()); } } SpringBoot 集成 Quartz 实现可控的任务 在 SpringBoot 的2.0 以上版本直接集成了 Quartz； 本文通过 RESTful 接口 来实现，实现的大概思路是通过实现 org.quartz.Job接口，在其execute()中实现自己的逻辑；通过调用 org.quartz.Scheduler的接口实现任务的创建，运行，暂停，更新，删除功能，核心的代码在 cn.com.hellowood.scheduledjob.job.ScheduleUtil里\n","keywords":["Java","SpringBoot","Quartz","Job"],"articleBody":"SpringBoot 使用QuartzJob实现任务控制 项目地址https://github.com/helloworlde/SpringBootCollection/tree/master/SpringBoot-ScheduledJob\n在 SpringBoot 中通过 @Schedule注解就可以简单的实现定时任务，但是这种方式够灵活，如果想要修改执行状态就必须修改代码；另外一种实现方式是通过 Quartz 实现任务调度\n通过 SpringBoot 实现简单任务 import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.scheduling.annotation.Scheduled; import static cn.com.hellowood.scheduledjob.utils.ApplicationUtils.currentDateTime; @Component public class StaticJob { private final Logger logger = LoggerFactory.getLogger(getClass()); private final static long SECOND = 1000; /** * fixedDelay: 固定延迟时间执行 */ @Scheduled(fixedDelay = 10 * SECOND) public void fixedDelayJob() { logger.info(\"{}\\tfixedDelay\", currentDateTime()); } /** * fixedRate: 固定间隔时间执行 */ @Scheduled(fixedRate = 10 * SECOND) public void fixedRate() { logger.info(\"{}\\tfixedRate\", currentDateTime()); } /** * cron: 通过 Cron 表达式控制执行 */ @Scheduled(cron = \"*/10 * * * * *\") public void cron() { logger.info(\"{}\\tcron\", currentDateTime()); } } SpringBoot 集成 Quartz 实现可控的任务 在 SpringBoot 的2.0 以上版本直接集成了 Quartz； 本文通过 RESTful 接口 来实现，实现的大概思路是通过实现 org.quartz.Job接口，在其execute()中实现自己的逻辑；通过调用 org.quartz.Scheduler的接口实现任务的创建，运行，暂停，更新，删除功能，核心的代码在 cn.com.hellowood.scheduledjob.job.ScheduleUtil里\n添加依赖 build.gradle buildscript { ext { springBootVersion = '2.0.0.RC1' } repositories { maven { url 'http://maven.aliyun.com/nexus/content/groups/public/' } mavenCentral() maven { url \"https://repo.spring.io/snapshot\" } maven { url \"https://repo.spring.io/milestone\" } } dependencies { classpath(\"org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}\") } } apply plugin: 'java' apply plugin: 'eclipse' apply plugin: 'org.springframework.boot' apply plugin: 'io.spring.dependency-management' repositories { maven { url 'http://maven.aliyun.com/nexus/content/groups/public/' } mavenCentral() maven { url \"https://repo.spring.io/snapshot\" } maven { url \"https://repo.spring.io/milestone\" } } dependencies { compile('org.springframework.boot:spring-boot-starter-quartz') compile('org.springframework.boot:spring-boot-starter-web') compile('org.mybatis.spring.boot:mybatis-spring-boot-starter:1.3.1') runtime('mysql:mysql-connector-java') runtime('com.h2database:h2') testCompile('org.springframework.boot:spring-boot-starter-test') } 添加配置 application.properties # DataSource #spring.datasource.driver-class-name=com.mysql.jdbc.Driver #spring.datasource.url=jdbc:mysql://localhost:3306/quartz?useSSL=false #spring.datasource.username=root #spring.datasource.password=123456 #spring.datasource.platform=mysql spring.datasource.driver-class-name=org.h2.Driver spring.datasource.url=jdbc:h2:mem:test spring.datasource.username=root spring.datasource.password=123456 spring.datasource.platform=h2 spring.datasource.initialization-mode=embedded spring.datasource.schema=classpath:schema/schema-${spring.datasource.platform}.sql spring.quartz.jdbc.initialize-schema=embedded spring.quartz.job-store-type=jdbc # MyBatis mybatis.type-aliases-package=cn.com.hellowood.scheduledjob.dao mybatis.mapper-locations=mappers/**Mapper.xml # Log logging.level.root=info logging.level.cn.com.hellowood=trace spring.profiles.active=dev 如果使用 MySQL 的数据库还需要创建 Quartz 相关的表，创建的脚本是 schema/schema-mysql.sql ，其他的数据库脚本在 org/quartz/impl/dbcjobstore/tables_@@platform@@.sql 下 实现 ScheduleJob.java public class ScheduleJob implements Serializable { private static final Long serialVersionUID = 1435515995276255188L; private Long id; private String className; private String cronExpression; private String jobName; private String jobGroup; private String triggerName; private String triggerGroup; private Boolean pause; private Boolean enable; private String description; private Date createTime; private Date lastUpdateTime; // get, set ... ScheduleUtil.java import cn.com.hellowood.scheduledjob.model.ScheduleJob; import cn.com.hellowood.scheduledjob.utils.ServiceException; import org.quartz.*; import org.slf4j.Logger; import org.slf4j.LoggerFactory; public class ScheduleUtil { private final static Logger logger = LoggerFactory.getLogger(ScheduleUtil.class); /** * 获取 Trigger Key * * @param scheduleJob * @return */ public static TriggerKey getTriggerKey(ScheduleJob scheduleJob) { return TriggerKey.triggerKey(scheduleJob.getTriggerName(), scheduleJob.getTriggerGroup()); } /** * 获取 Job Key * * @param scheduleJob * @return */ public static JobKey getJobKey(ScheduleJob scheduleJob) { return JobKey.jobKey(scheduleJob.getJobName(), scheduleJob.getJobGroup()); } /** * 获取 Cron Trigger * * @param scheduler * @param scheduleJob * @return * @throws ServiceException */ public static CronTrigger getCronTrigger(Scheduler scheduler, ScheduleJob scheduleJob) throws ServiceException { try { return (CronTrigger) scheduler.getTrigger(getTriggerKey(scheduleJob)); } catch (SchedulerException e) { throw new ServiceException(\"Get Cron trigger failed\", e); } } /** * 创建任务 * * @param scheduler * @param scheduleJob * @throws ServiceException */ public static void createScheduleJob(Scheduler scheduler, ScheduleJob scheduleJob) throws ServiceException { try { // 要执行的 Job 的类 Class\u003c? extends Job\u003e jobClass = (Class\u003c? extends Job\u003e) Class.forName(scheduleJob.getClassName()).newInstance().getClass(); JobDetail jobDetail = JobBuilder.newJob(jobClass) .withIdentity(scheduleJob.getJobName(), scheduleJob.getJobGroup()) .withDescription(scheduleJob.getDescription()) .build(); CronScheduleBuilder scheduleBuilder = CronScheduleBuilder.cronSchedule(scheduleJob.getCronExpression()) .withMisfireHandlingInstructionDoNothing(); CronTrigger cronTrigger = TriggerBuilder.newTrigger() .withIdentity(scheduleJob.getTriggerName(), scheduleJob.getTriggerGroup()) .withDescription(scheduleJob.getDescription()) .withSchedule(scheduleBuilder) .startNow() .build(); scheduler.scheduleJob(jobDetail, cronTrigger); logger.info(\"Create schedule job {}-{} success\", scheduleJob.getJobGroup(), scheduleJob.getJobName()); if (scheduleJob.isPause()) { pauseJob(scheduler, scheduleJob); } } catch (Exception e) { e.printStackTrace(); logger.error(\"Execute schedule job failed\"); throw new ServiceException(\"Execute schedule job failed\", e); } } /** * 更新任务 * * @param scheduler * @param scheduleJob * @throws ServiceException */ public static void updateScheduleJob(Scheduler scheduler, ScheduleJob scheduleJob) throws ServiceException { try { TriggerKey triggerKey = getTriggerKey(scheduleJob); CronScheduleBuilder cronScheduleBuilder = CronScheduleBuilder.cronSchedule(scheduleJob.getCronExpression()) .withMisfireHandlingInstructionDoNothing(); CronTrigger cronTrigger = getCronTrigger(scheduler, scheduleJob); cronTrigger = cronTrigger.getTriggerBuilder() .withIdentity(triggerKey) .withDescription(scheduleJob.getDescription()) .withSchedule(cronScheduleBuilder).build(); scheduler.rescheduleJob(triggerKey, cronTrigger); logger.info(\"Update schedule job {}-{} success\", scheduleJob.getJobGroup(), scheduleJob.getJobName()); if (scheduleJob.isPause()) { pauseJob(scheduler, scheduleJob); } } catch (SchedulerException e) { e.printStackTrace(); logger.error(\"Update schedule job failed\"); throw new ServiceException(\"Update schedule job failed\", e); } } /** * 执行任务 * * @param scheduler * @param scheduleJob * @throws ServiceException */ public static void run(Scheduler scheduler, ScheduleJob scheduleJob) throws ServiceException { try { scheduler.triggerJob(getJobKey(scheduleJob)); logger.info(\"Run schedule job {}-{} success\", scheduleJob.getJobGroup(), scheduleJob.getJobName()); } catch (SchedulerException e) { e.printStackTrace(); logger.error(\"Run schedule job failed\"); throw new ServiceException(\"Run schedule job failed\", e); } } /** * 暂停任务 * * @param scheduler * @param scheduleJob */ public static void pauseJob(Scheduler scheduler, ScheduleJob scheduleJob) throws ServiceException { try { scheduler.pauseJob(getJobKey(scheduleJob)); logger.info(\"Pause schedule job {}-{} success\", scheduleJob.getJobGroup(), scheduleJob.getJobName()); } catch (SchedulerException e) { e.printStackTrace(); logger.error(\"Pause schedule job failed\"); throw new ServiceException(\"Pause job failed\", e); } } /** * 继续执行任务 * * @param scheduler * @param scheduleJob * @throws ServiceException */ public static void resumeJob(Scheduler scheduler, ScheduleJob scheduleJob) throws ServiceException { try { scheduler.resumeJob(getJobKey(scheduleJob)); logger.info(\"Resume schedule job {}-{} success\", scheduleJob.getJobGroup(), scheduleJob.getJobName()); } catch (SchedulerException e) { e.printStackTrace(); logger.error(\"Resume schedule job failed\"); throw new ServiceException(\"Resume job failed\", e); } } /** * 删除任务 * * @param scheduler * @param scheduleJob * @throws ServiceException */ public static void deleteJob(Scheduler scheduler, ScheduleJob scheduleJob) throws ServiceException { try { scheduler.deleteJob(getJobKey(scheduleJob)); logger.info(\"Delete schedule job {}-{} success\", scheduleJob.getJobGroup(), scheduleJob.getJobName()); } catch (SchedulerException e) { e.printStackTrace(); logger.error(\"Delete schedule job failed\"); throw new ServiceException(\"Delete job failed\", e); } } } JobService.java import cn.com.hellowood.scheduledjob.dao.JobDao; import cn.com.hellowood.scheduledjob.job.ScheduleUtil; import cn.com.hellowood.scheduledjob.model.ScheduleJob; import cn.com.hellowood.scheduledjob.utils.ServiceException; import org.quartz.Scheduler; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.dao.DataAccessException; import org.springframework.stereotype.Service; import org.springframework.transaction.annotation.Transactional; import java.util.List; @Service public class JobService { @Autowired private JobDao jobDao; @Autowired private Scheduler scheduler; private final Logger logger = LoggerFactory.getLogger(getClass()); public List\u003cScheduleJob\u003e getAllEnableJob() { return jobDao.getAllEnableJob(); } public ScheduleJob select(Long jobId) throws ServiceException { ScheduleJob scheduleJob = jobDao.select(jobId); if (scheduleJob == null) { throw new ServiceException(\"ScheduleJob:\" + jobId + \" not found\"); } return scheduleJob; } @Transactional(rollbackFor = DataAccessException.class) public ScheduleJob update(Long jobId, ScheduleJob scheduleJob) throws ServiceException { if (jobDao.update(scheduleJob) \u003c= 0) { throw new ServiceException(\"Update product:\" + jobId + \"failed\"); } ScheduleUtil.updateScheduleJob(scheduler, scheduleJob); return scheduleJob; } @Transactional(rollbackFor = DataAccessException.class) public boolean add(ScheduleJob scheduleJob) throws ServiceException { Integer num = jobDao.insert(scheduleJob); if (num \u003c= 0) { throw new ServiceException(\"Add product failed\"); } ScheduleUtil.createScheduleJob(scheduler, scheduleJob); return true; } @Transactional(rollbackFor = DataAccessException.class) public boolean delete(Long jobId) throws ServiceException { ScheduleJob scheduleJob = select(jobId); Integer num = jobDao.delete(jobId); if (num \u003c= 0) { throw new ServiceException(\"Delete product:\" + jobId + \"failed\"); } ScheduleUtil.deleteJob(scheduler, scheduleJob); return true; } public List\u003cScheduleJob\u003e getAllJob() { return jobDao.getAllJob(); } public boolean resume(Long jobId) throws ServiceException { ScheduleJob scheduleJob = updateScheduleJobStatus(jobId, false); ScheduleUtil.resumeJob(scheduler, scheduleJob); return true; } public boolean pause(Long jobId) throws ServiceException { ScheduleJob scheduleJob = updateScheduleJobStatus(jobId, true); ScheduleUtil.pauseJob(scheduler, scheduleJob); return true; } public boolean run(Long jobId) throws ServiceException { ScheduleJob scheduleJob = updateScheduleJobStatus(jobId, false); ScheduleUtil.run(scheduler, scheduleJob); return true; } private ScheduleJob updateScheduleJobStatus(Long jobId, Boolean isPause) throws ServiceException { ScheduleJob scheduleJob = select(jobId); scheduleJob.setPause(isPause); update(scheduleJob.getId(), scheduleJob); return scheduleJob; } } JobController.java import cn.com.hellowood.scheduledjob.common.CommonResponse; import cn.com.hellowood.scheduledjob.common.ResponseUtil; import cn.com.hellowood.scheduledjob.model.ScheduleJob; import cn.com.hellowood.scheduledjob.service.JobService; import cn.com.hellowood.scheduledjob.utils.ServiceException; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.web.bind.annotation.*; @RestController @RequestMapping(\"/job\") public class JobController { @Autowired private JobService jobService; @GetMapping public CommonResponse getAllJob() { return ResponseUtil.generateResponse(jobService.getAllJob()); } @GetMapping(\"/{id}\") public CommonResponse getJob(@PathVariable(\"id\") Long jobId) throws ServiceException { return ResponseUtil.generateResponse(jobService.select(jobId)); } @PutMapping(\"/update/{id}\") public CommonResponse updateJob(@PathVariable(\"id\") Long jobId, @RequestBody ScheduleJob newScheduleJob) throws ServiceException { return ResponseUtil.generateResponse(jobService.update(jobId, newScheduleJob)); } @DeleteMapping(\"/delete/{id}\") public CommonResponse deleteJob(@PathVariable(\"id\") Long jobId) throws ServiceException { return ResponseUtil.generateResponse(jobService.delete(jobId)); } @PostMapping(\"/save\") public CommonResponse saveJob(@RequestBody ScheduleJob newScheduleJob) throws ServiceException { return ResponseUtil.generateResponse(jobService.add(newScheduleJob)); } @GetMapping(\"/run/{id}\") public CommonResponse runJob(@PathVariable(\"id\") Long jobId) throws ServiceException { return ResponseUtil.generateResponse(jobService.run(jobId)); } @GetMapping(\"/pause/{id}\") public CommonResponse pauseJob(@PathVariable(\"id\") Long jobId) throws ServiceException { return ResponseUtil.generateResponse(jobService.pause(jobId)); } @GetMapping(\"/resume/{id}\") public CommonResponse resumeJob(@PathVariable(\"id\") Long jobId) throws ServiceException { return ResponseUtil.generateResponse(jobService.resume(jobId)); } } ApplicationListener.java import cn.com.hellowood.scheduledjob.job.ScheduleUtil; import cn.com.hellowood.scheduledjob.model.ScheduleJob; import cn.com.hellowood.scheduledjob.service.JobService; import cn.com.hellowood.scheduledjob.utils.ServiceException; import org.quartz.CronTrigger; import org.quartz.Scheduler; import org.slf4j.Logger; import org.slf4j.LoggerFactory; import org.springframework.beans.factory.annotation.Autowired; import org.springframework.boot.CommandLineRunner; import org.springframework.stereotype.Component; import java.util.List; @Component public class ApplicationListener implements CommandLineRunner { private final Logger logger = LoggerFactory.getLogger(getClass()); @Autowired private JobService jobService; @Autowired private Scheduler scheduler; @Override public void run(String... args) throws Exception { // 应用启动之后执行所有可执行的的任务 List\u003cScheduleJob\u003e scheduleJobList = jobService.getAllEnableJob(); for (ScheduleJob scheduleJob : scheduleJobList) { try { CronTrigger cronTrigger = ScheduleUtil.getCronTrigger(scheduler, scheduleJob); if (cronTrigger == null) { ScheduleUtil.createScheduleJob(scheduler, scheduleJob); } else { ScheduleUtil.updateScheduleJob(scheduler, scheduleJob); } logger.info(\"Startup {}-{} success\", scheduleJob.getJobGroup(), scheduleJob.getJobName()); } catch (ServiceException e) { e.printStackTrace(); } } } } 使用 添加任务 POST /job/save HTTP/1.1 Host: localhost:8080 Content-Type: application/json Cache-Control: no-cache Postman-Token: c919bb29-40ab-45c8-2328-edd13c396d82 { \"className\":\"cn.com.hellowood.scheduledjob.job.TestJob\", \"cronExpression\":\"*/10 * * * * ?\", \"jobName\":\"TestJob\", \"jobGroup\":\"TEST_GROUP\", \"triggerName\":\"TEST_TRIGGER\", \"triggerGroup\":\"TEST_GROUP\", \"pause\": \"false\", \"enable\": \"true\", \"description\":\"Test Job for SpringBoot\" } 暂停任务 GET /job/pause/1 HTTP/1.1 Host: localhost:8080 Cache-Control: no-cache Postman-Token: a16d0256-0b2c-d2c4-6e96-21902c3ee88d 继续执行任务 GET /job/resume/1 HTTP/1.1 Host: localhost:8080 Cache-Control: no-cache Postman-Token: e9c93950-e073-26de-9a75-1e281a23a719 更新任务 PUT /job/update/1 HTTP/1.1 Host: localhost:8080 Content-Type: application/json Cache-Control: no-cache Postman-Token: 5aad8357-522e-9adb-7452-ed84c2383418 { \"id\":1, \"className\":\"cn.com.hellowood.scheduledjob.job.TestJob\", \"cronExpression\":\"*/5 * * * * ?\", \"jobName\":\"testJob\", \"jobGroup\":\"TEST_GROUP\", \"triggerName\":\"TEST_TRIGGER\", \"triggerGroup\":\"TEST_GROUP\", \"pause\": \"false\", \"enable\": \"true\", \"description\":\"test Job for SpringBoot\" } 删除任务 DELETE /job/delete/1 HTTP/1.1 Host: localhost:8080 Cache-Control: no-cache Postman-Token: a1331b4c-1a6a-5499-4106-50880e63e725 ","wordCount":"1350","inLanguage":"en","datePublished":"2018-02-12T18:22:43Z","dateModified":"2018-02-12T18:22:43Z","author":{"@type":"Person","name":"HelloWood"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.hellowood.dev/posts/springboot-%E4%BD%BF%E7%94%A8quartzjob%E5%AE%9E%E7%8E%B0%E4%BB%BB%E5%8A%A1%E6%8E%A7%E5%88%B6/"},"publisher":{"@type":"Organization","name":"HelloWood","logo":{"@type":"ImageObject","url":"https://blog.hellowood.dev/favicon.ico"}}}</script><link rel=icon href=/images/avatar.png sizes=16x16><link rel=apple-touch-icon href=/images/avatar.png><link rel=manifest href=/images/avatar.png><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.7f82854fa0e999ec07c4835d3029de9f484030e254b80d470b3ca48eb934720e.css integrity="sha256-f4KFT6DpmewHxINdMCnen0hAMOJUuA1HCzykjrk0cg4=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><meta name=google-adsense-account content="ca-pub-3401351766168985"><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jtbhx98g62")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3401351766168985" crossorigin=anonymous></script><script defer src=https://analytics.us.umami.is/script.js data-website-id=73ff1c8c-9938-43cf-81af-e77e26b0cca3></script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand data-umami-event=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Blog href=/posts>Blog</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Tags href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Archive href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Dashboard href=https://umami.hellowood.dev/share/lab/Blog>Dashboard</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link data-umami-event=navigation-social href=https://github.com/helloworlde><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button data-umami-event=toggle-theme aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
<span class=toggle-light><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>SpringBoot 使用QuartzJob实现任务控制</h1></header><p><small>February 12, 2018&nbsp;· 1350 words&nbsp;· 7 min</small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#通过-springboot-实现简单任务>通过 SpringBoot 实现简单任务</a></li><li><a href=#springboot-集成-quartz-实现可控的任务>SpringBoot 集成 Quartz 实现可控的任务</a><ul><li><a href=#添加依赖>添加依赖</a></li><li><a href=#添加配置>添加配置</a></li><li><a href=#实现>实现</a></li><li><a href=#使用>使用</a></li></ul></li></ul></nav></div><section class=blog-content><h1 id=springboot-使用quartzjob实现任务控制>SpringBoot 使用QuartzJob实现任务控制</h1><blockquote><p>项目地址<a href=https://github.com/helloworlde/SpringBootCollection/tree/master/SpringBoot-ScheduledJob>https://github.com/helloworlde/SpringBootCollection/tree/master/SpringBoot-ScheduledJob</a></p></blockquote><blockquote><p>在 SpringBoot 中通过 <code>@Schedule</code>注解就可以简单的实现定时任务，但是这种方式够灵活，如果想要修改执行状态就必须修改代码；另外一种实现方式是通过 <a href=http://www.quartz-scheduler.org/><code>Quartz</code></a> 实现任务调度</p></blockquote><h2 id=通过-springboot-实现简单任务>通过 SpringBoot 实现简单任务</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> org.slf4j.Logger;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.slf4j.LoggerFactory;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.scheduling.annotation.Scheduled;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import static</span> cn.com.hellowood.scheduledjob.utils.ApplicationUtils.currentDateTime;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StaticJob</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Logger logger <span style=color:#f92672>=</span> LoggerFactory.<span style=color:#a6e22e>getLogger</span>(getClass());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>long</span> SECOND <span style=color:#f92672>=</span> 1000;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * fixedDelay: 固定延迟时间执行
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Scheduled</span>(fixedDelay <span style=color:#f92672>=</span> 10 <span style=color:#f92672>*</span> SECOND)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>fixedDelayJob</span>() {
</span></span><span style=display:flex><span>        logger.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;{}\tfixedDelay&#34;</span>, currentDateTime());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * fixedRate: 固定间隔时间执行
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Scheduled</span>(fixedRate <span style=color:#f92672>=</span> 10 <span style=color:#f92672>*</span> SECOND)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>fixedRate</span>() {
</span></span><span style=display:flex><span>        logger.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;{}\tfixedRate&#34;</span>, currentDateTime());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * cron: 通过 Cron 表达式控制执行
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Scheduled</span>(cron <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;*/10 * * * * *&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>cron</span>() {
</span></span><span style=display:flex><span>        logger.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;{}\tcron&#34;</span>, currentDateTime());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><h2 id=springboot-集成-quartz-实现可控的任务>SpringBoot 集成 Quartz 实现可控的任务</h2><blockquote><p>在 SpringBoot 的2.0 以上版本直接集成了 Quartz；
本文通过 RESTful 接口 来实现，实现的大概思路是通过实现 <code>org.quartz.Job</code>接口，在其<code>execute()</code>中实现自己的逻辑；通过调用 <code>org.quartz.Scheduler</code>的接口实现任务的创建，运行，暂停，更新，删除功能，核心的代码在 <code>cn.com.hellowood.scheduledjob.job.ScheduleUtil</code>里</p></blockquote><h3 id=添加依赖>添加依赖</h3><ul><li>build.gradle</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gradle data-lang=gradle><span style=display:flex><span>buildscript <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    ext <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        springBootVersion <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;2.0.0.RC1&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    repositories <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        maven <span style=color:#f92672>{</span> url <span style=color:#e6db74>&#39;http://maven.aliyun.com/nexus/content/groups/public/&#39;</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        mavenCentral<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>        maven <span style=color:#f92672>{</span> url <span style=color:#e6db74>&#34;https://repo.spring.io/snapshot&#34;</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        maven <span style=color:#f92672>{</span> url <span style=color:#e6db74>&#34;https://repo.spring.io/milestone&#34;</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    dependencies <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        classpath<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>apply plugin: <span style=color:#e6db74>&#39;java&#39;</span>
</span></span><span style=display:flex><span>apply plugin: <span style=color:#e6db74>&#39;eclipse&#39;</span>
</span></span><span style=display:flex><span>apply plugin: <span style=color:#e6db74>&#39;org.springframework.boot&#39;</span>
</span></span><span style=display:flex><span>apply plugin: <span style=color:#e6db74>&#39;io.spring.dependency-management&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>repositories <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    maven <span style=color:#f92672>{</span> url <span style=color:#e6db74>&#39;http://maven.aliyun.com/nexus/content/groups/public/&#39;</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    mavenCentral<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>    maven <span style=color:#f92672>{</span> url <span style=color:#e6db74>&#34;https://repo.spring.io/snapshot&#34;</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    maven <span style=color:#f92672>{</span> url <span style=color:#e6db74>&#34;https://repo.spring.io/milestone&#34;</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dependencies <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    compile<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-quartz&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    compile<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-web&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    compile<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;org.mybatis.spring.boot:mybatis-spring-boot-starter:1.3.1&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    runtime<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;mysql:mysql-connector-java&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    runtime<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;com.h2database:h2&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    testCompile<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-test&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h3 id=添加配置>添加配置</h3><ul><li>application.properties</li></ul><pre tabindex=0><code># DataSource
#spring.datasource.driver-class-name=com.mysql.jdbc.Driver
#spring.datasource.url=jdbc:mysql://localhost:3306/quartz?useSSL=false
#spring.datasource.username=root
#spring.datasource.password=123456
#spring.datasource.platform=mysql

spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.url=jdbc:h2:mem:test
spring.datasource.username=root
spring.datasource.password=123456
spring.datasource.platform=h2

spring.datasource.initialization-mode=embedded
spring.datasource.schema=classpath:schema/schema-${spring.datasource.platform}.sql

spring.quartz.jdbc.initialize-schema=embedded
spring.quartz.job-store-type=jdbc

# MyBatis
mybatis.type-aliases-package=cn.com.hellowood.scheduledjob.dao
mybatis.mapper-locations=mappers/**Mapper.xml

# Log
logging.level.root=info
logging.level.cn.com.hellowood=trace

spring.profiles.active=dev
</code></pre><ul><li>如果使用 MySQL 的数据库还需要创建 Quartz 相关的表，创建的脚本是 <code>schema/schema-mysql.sql</code> ，其他的数据库脚本在 <code>org/quartz/impl/dbcjobstore/tables_@@platform@@.sql</code> 下</li></ul><h3 id=实现>实现</h3><ul><li>ScheduleJob.java</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ScheduleJob</span> <span style=color:#66d9ef>implements</span> Serializable {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> Long serialVersionUID <span style=color:#f92672>=</span> 1435515995276255188L;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Long id;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String className;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String cronExpression;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String jobName;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String jobGroup;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String triggerName;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String triggerGroup;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Boolean pause;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Boolean enable;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> String description;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Date createTime;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Date lastUpdateTime;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// get, set ...</span>
</span></span></code></pre></div><ul><li>ScheduleUtil.java</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> cn.com.hellowood.scheduledjob.model.ScheduleJob;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> cn.com.hellowood.scheduledjob.utils.ServiceException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.quartz.*;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.slf4j.Logger;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.slf4j.LoggerFactory;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ScheduleUtil</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> <span style=color:#66d9ef>static</span> Logger logger <span style=color:#f92672>=</span> LoggerFactory.<span style=color:#a6e22e>getLogger</span>(ScheduleUtil.<span style=color:#a6e22e>class</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 获取 Trigger Key
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param scheduleJob
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> TriggerKey <span style=color:#a6e22e>getTriggerKey</span>(ScheduleJob scheduleJob) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> TriggerKey.<span style=color:#a6e22e>triggerKey</span>(scheduleJob.<span style=color:#a6e22e>getTriggerName</span>(), scheduleJob.<span style=color:#a6e22e>getTriggerGroup</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 获取 Job Key
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param scheduleJob
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> JobKey <span style=color:#a6e22e>getJobKey</span>(ScheduleJob scheduleJob) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> JobKey.<span style=color:#a6e22e>jobKey</span>(scheduleJob.<span style=color:#a6e22e>getJobName</span>(), scheduleJob.<span style=color:#a6e22e>getJobGroup</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 获取 Cron Trigger
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param scheduler
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param scheduleJob
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @return
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @throws ServiceException
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> CronTrigger <span style=color:#a6e22e>getCronTrigger</span>(Scheduler scheduler, ScheduleJob scheduleJob) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> (CronTrigger) scheduler.<span style=color:#a6e22e>getTrigger</span>(getTriggerKey(scheduleJob));
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (SchedulerException e) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;Get Cron trigger failed&#34;</span>, e);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 创建任务
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param scheduler
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param scheduleJob
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @throws ServiceException
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>createScheduleJob</span>(Scheduler scheduler, ScheduleJob scheduleJob) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 要执行的 Job 的类</span>
</span></span><span style=display:flex><span>            Class<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>extends</span> Job<span style=color:#f92672>&gt;</span> jobClass <span style=color:#f92672>=</span> (Class<span style=color:#f92672>&lt;?</span> <span style=color:#66d9ef>extends</span> Job<span style=color:#f92672>&gt;</span>) Class.<span style=color:#a6e22e>forName</span>(scheduleJob.<span style=color:#a6e22e>getClassName</span>()).<span style=color:#a6e22e>newInstance</span>().<span style=color:#a6e22e>getClass</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            JobDetail jobDetail <span style=color:#f92672>=</span> JobBuilder.<span style=color:#a6e22e>newJob</span>(jobClass)
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>withIdentity</span>(scheduleJob.<span style=color:#a6e22e>getJobName</span>(), scheduleJob.<span style=color:#a6e22e>getJobGroup</span>())
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>withDescription</span>(scheduleJob.<span style=color:#a6e22e>getDescription</span>())
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            CronScheduleBuilder scheduleBuilder <span style=color:#f92672>=</span> CronScheduleBuilder.<span style=color:#a6e22e>cronSchedule</span>(scheduleJob.<span style=color:#a6e22e>getCronExpression</span>())
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>withMisfireHandlingInstructionDoNothing</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            CronTrigger cronTrigger <span style=color:#f92672>=</span> TriggerBuilder.<span style=color:#a6e22e>newTrigger</span>()
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>withIdentity</span>(scheduleJob.<span style=color:#a6e22e>getTriggerName</span>(), scheduleJob.<span style=color:#a6e22e>getTriggerGroup</span>())
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>withDescription</span>(scheduleJob.<span style=color:#a6e22e>getDescription</span>())
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>withSchedule</span>(scheduleBuilder)
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>startNow</span>()
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            scheduler.<span style=color:#a6e22e>scheduleJob</span>(jobDetail, cronTrigger);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            logger.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;Create schedule job {}-{} success&#34;</span>, scheduleJob.<span style=color:#a6e22e>getJobGroup</span>(), scheduleJob.<span style=color:#a6e22e>getJobName</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (scheduleJob.<span style=color:#a6e22e>isPause</span>()) {
</span></span><span style=display:flex><span>                pauseJob(scheduler, scheduleJob);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (Exception e) {
</span></span><span style=display:flex><span>            e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>            logger.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;Execute schedule job failed&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;Execute schedule job failed&#34;</span>, e);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 更新任务
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param scheduler
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param scheduleJob
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @throws ServiceException
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>updateScheduleJob</span>(Scheduler scheduler, ScheduleJob scheduleJob) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            TriggerKey triggerKey <span style=color:#f92672>=</span> getTriggerKey(scheduleJob);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            CronScheduleBuilder cronScheduleBuilder <span style=color:#f92672>=</span> CronScheduleBuilder.<span style=color:#a6e22e>cronSchedule</span>(scheduleJob.<span style=color:#a6e22e>getCronExpression</span>())
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>withMisfireHandlingInstructionDoNothing</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            CronTrigger cronTrigger <span style=color:#f92672>=</span> getCronTrigger(scheduler, scheduleJob);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            cronTrigger <span style=color:#f92672>=</span> cronTrigger.<span style=color:#a6e22e>getTriggerBuilder</span>()
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>withIdentity</span>(triggerKey)
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>withDescription</span>(scheduleJob.<span style=color:#a6e22e>getDescription</span>())
</span></span><span style=display:flex><span>                    .<span style=color:#a6e22e>withSchedule</span>(cronScheduleBuilder).<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            scheduler.<span style=color:#a6e22e>rescheduleJob</span>(triggerKey, cronTrigger);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            logger.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;Update schedule job {}-{} success&#34;</span>, scheduleJob.<span style=color:#a6e22e>getJobGroup</span>(), scheduleJob.<span style=color:#a6e22e>getJobName</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (scheduleJob.<span style=color:#a6e22e>isPause</span>()) {
</span></span><span style=display:flex><span>                pauseJob(scheduler, scheduleJob);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (SchedulerException e) {
</span></span><span style=display:flex><span>            e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>            logger.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;Update schedule job failed&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;Update schedule job failed&#34;</span>, e);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 执行任务
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param scheduler
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param scheduleJob
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @throws ServiceException
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span>(Scheduler scheduler, ScheduleJob scheduleJob) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            scheduler.<span style=color:#a6e22e>triggerJob</span>(getJobKey(scheduleJob));
</span></span><span style=display:flex><span>            logger.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;Run schedule job {}-{} success&#34;</span>, scheduleJob.<span style=color:#a6e22e>getJobGroup</span>(), scheduleJob.<span style=color:#a6e22e>getJobName</span>());
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (SchedulerException e) {
</span></span><span style=display:flex><span>            e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>            logger.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;Run schedule job failed&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;Run schedule job failed&#34;</span>, e);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 暂停任务
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param scheduler
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param scheduleJob
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>pauseJob</span>(Scheduler scheduler, ScheduleJob scheduleJob) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            scheduler.<span style=color:#a6e22e>pauseJob</span>(getJobKey(scheduleJob));
</span></span><span style=display:flex><span>            logger.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;Pause schedule job {}-{} success&#34;</span>, scheduleJob.<span style=color:#a6e22e>getJobGroup</span>(), scheduleJob.<span style=color:#a6e22e>getJobName</span>());
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (SchedulerException e) {
</span></span><span style=display:flex><span>            e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>            logger.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;Pause schedule job failed&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;Pause job failed&#34;</span>, e);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 继续执行任务
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param scheduler
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param scheduleJob
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @throws ServiceException
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>resumeJob</span>(Scheduler scheduler, ScheduleJob scheduleJob) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            scheduler.<span style=color:#a6e22e>resumeJob</span>(getJobKey(scheduleJob));
</span></span><span style=display:flex><span>            logger.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;Resume schedule job {}-{} success&#34;</span>, scheduleJob.<span style=color:#a6e22e>getJobGroup</span>(), scheduleJob.<span style=color:#a6e22e>getJobName</span>());
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (SchedulerException e) {
</span></span><span style=display:flex><span>            e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>            logger.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;Resume schedule job failed&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;Resume job failed&#34;</span>, e);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * 删除任务
</span></span></span><span style=display:flex><span><span style=color:#75715e>     *
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param scheduler
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @param scheduleJob
</span></span></span><span style=display:flex><span><span style=color:#75715e>     * @throws ServiceException
</span></span></span><span style=display:flex><span><span style=color:#75715e>     */</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>deleteJob</span>(Scheduler scheduler, ScheduleJob scheduleJob) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            scheduler.<span style=color:#a6e22e>deleteJob</span>(getJobKey(scheduleJob));
</span></span><span style=display:flex><span>            logger.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;Delete schedule job {}-{} success&#34;</span>, scheduleJob.<span style=color:#a6e22e>getJobGroup</span>(), scheduleJob.<span style=color:#a6e22e>getJobName</span>());
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (SchedulerException e) {
</span></span><span style=display:flex><span>            e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>            logger.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;Delete schedule job failed&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;Delete job failed&#34;</span>, e);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>JobService.java</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> cn.com.hellowood.scheduledjob.dao.JobDao;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> cn.com.hellowood.scheduledjob.job.ScheduleUtil;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> cn.com.hellowood.scheduledjob.model.ScheduleJob;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> cn.com.hellowood.scheduledjob.utils.ServiceException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.quartz.Scheduler;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.slf4j.Logger;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.slf4j.LoggerFactory;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.dao.DataAccessException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.stereotype.Service;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.transaction.annotation.Transactional;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.List;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Service</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>JobService</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> JobDao jobDao;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Scheduler scheduler;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Logger logger <span style=color:#f92672>=</span> LoggerFactory.<span style=color:#a6e22e>getLogger</span>(getClass());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>ScheduleJob<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getAllEnableJob</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> jobDao.<span style=color:#a6e22e>getAllEnableJob</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ScheduleJob <span style=color:#a6e22e>select</span>(Long jobId) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        ScheduleJob scheduleJob <span style=color:#f92672>=</span> jobDao.<span style=color:#a6e22e>select</span>(jobId);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (scheduleJob <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;ScheduleJob:&#34;</span> <span style=color:#f92672>+</span> jobId <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; not found&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> scheduleJob;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Transactional</span>(rollbackFor <span style=color:#f92672>=</span> DataAccessException.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> ScheduleJob <span style=color:#a6e22e>update</span>(Long jobId, ScheduleJob scheduleJob) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (jobDao.<span style=color:#a6e22e>update</span>(scheduleJob) <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;Update product:&#34;</span> <span style=color:#f92672>+</span> jobId <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;failed&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        ScheduleUtil.<span style=color:#a6e22e>updateScheduleJob</span>(scheduler, scheduleJob);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> scheduleJob;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Transactional</span>(rollbackFor <span style=color:#f92672>=</span> DataAccessException.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>add</span>(ScheduleJob scheduleJob) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        Integer num <span style=color:#f92672>=</span> jobDao.<span style=color:#a6e22e>insert</span>(scheduleJob);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (num <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;Add product failed&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        ScheduleUtil.<span style=color:#a6e22e>createScheduleJob</span>(scheduler, scheduleJob);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Transactional</span>(rollbackFor <span style=color:#f92672>=</span> DataAccessException.<span style=color:#a6e22e>class</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>delete</span>(Long jobId) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        ScheduleJob scheduleJob <span style=color:#f92672>=</span> select(jobId);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Integer num <span style=color:#f92672>=</span> jobDao.<span style=color:#a6e22e>delete</span>(jobId);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (num <span style=color:#f92672>&lt;=</span> 0) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ServiceException(<span style=color:#e6db74>&#34;Delete product:&#34;</span> <span style=color:#f92672>+</span> jobId <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;failed&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        ScheduleUtil.<span style=color:#a6e22e>deleteJob</span>(scheduler, scheduleJob);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> List<span style=color:#f92672>&lt;</span>ScheduleJob<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getAllJob</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> jobDao.<span style=color:#a6e22e>getAllJob</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>resume</span>(Long jobId) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        ScheduleJob scheduleJob <span style=color:#f92672>=</span> updateScheduleJobStatus(jobId, <span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>        ScheduleUtil.<span style=color:#a6e22e>resumeJob</span>(scheduler, scheduleJob);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>pause</span>(Long jobId) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        ScheduleJob scheduleJob <span style=color:#f92672>=</span> updateScheduleJobStatus(jobId, <span style=color:#66d9ef>true</span>);
</span></span><span style=display:flex><span>        ScheduleUtil.<span style=color:#a6e22e>pauseJob</span>(scheduler, scheduleJob);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>run</span>(Long jobId) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        ScheduleJob scheduleJob <span style=color:#f92672>=</span> updateScheduleJobStatus(jobId, <span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>        ScheduleUtil.<span style=color:#a6e22e>run</span>(scheduler, scheduleJob);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> ScheduleJob <span style=color:#a6e22e>updateScheduleJobStatus</span>(Long jobId, Boolean isPause) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        ScheduleJob scheduleJob <span style=color:#f92672>=</span> select(jobId);
</span></span><span style=display:flex><span>        scheduleJob.<span style=color:#a6e22e>setPause</span>(isPause);
</span></span><span style=display:flex><span>        update(scheduleJob.<span style=color:#a6e22e>getId</span>(), scheduleJob);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> scheduleJob;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>JobController.java</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> cn.com.hellowood.scheduledjob.common.CommonResponse;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> cn.com.hellowood.scheduledjob.common.ResponseUtil;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> cn.com.hellowood.scheduledjob.model.ScheduleJob;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> cn.com.hellowood.scheduledjob.service.JobService;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> cn.com.hellowood.scheduledjob.utils.ServiceException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.web.bind.annotation.*;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RequestMapping</span>(<span style=color:#e6db74>&#34;/job&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>JobController</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> JobService jobService;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> CommonResponse <span style=color:#a6e22e>getAllJob</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ResponseUtil.<span style=color:#a6e22e>generateResponse</span>(jobService.<span style=color:#a6e22e>getAllJob</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/{id}&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> CommonResponse <span style=color:#a6e22e>getJob</span>(<span style=color:#a6e22e>@PathVariable</span>(<span style=color:#e6db74>&#34;id&#34;</span>) Long jobId) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ResponseUtil.<span style=color:#a6e22e>generateResponse</span>(jobService.<span style=color:#a6e22e>select</span>(jobId));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@PutMapping</span>(<span style=color:#e6db74>&#34;/update/{id}&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> CommonResponse <span style=color:#a6e22e>updateJob</span>(<span style=color:#a6e22e>@PathVariable</span>(<span style=color:#e6db74>&#34;id&#34;</span>) Long jobId, <span style=color:#a6e22e>@RequestBody</span> ScheduleJob newScheduleJob) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ResponseUtil.<span style=color:#a6e22e>generateResponse</span>(jobService.<span style=color:#a6e22e>update</span>(jobId, newScheduleJob));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@DeleteMapping</span>(<span style=color:#e6db74>&#34;/delete/{id}&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> CommonResponse <span style=color:#a6e22e>deleteJob</span>(<span style=color:#a6e22e>@PathVariable</span>(<span style=color:#e6db74>&#34;id&#34;</span>) Long jobId) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ResponseUtil.<span style=color:#a6e22e>generateResponse</span>(jobService.<span style=color:#a6e22e>delete</span>(jobId));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@PostMapping</span>(<span style=color:#e6db74>&#34;/save&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> CommonResponse <span style=color:#a6e22e>saveJob</span>(<span style=color:#a6e22e>@RequestBody</span> ScheduleJob newScheduleJob) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ResponseUtil.<span style=color:#a6e22e>generateResponse</span>(jobService.<span style=color:#a6e22e>add</span>(newScheduleJob));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/run/{id}&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> CommonResponse <span style=color:#a6e22e>runJob</span>(<span style=color:#a6e22e>@PathVariable</span>(<span style=color:#e6db74>&#34;id&#34;</span>) Long jobId) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ResponseUtil.<span style=color:#a6e22e>generateResponse</span>(jobService.<span style=color:#a6e22e>run</span>(jobId));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/pause/{id}&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> CommonResponse <span style=color:#a6e22e>pauseJob</span>(<span style=color:#a6e22e>@PathVariable</span>(<span style=color:#e6db74>&#34;id&#34;</span>) Long jobId) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ResponseUtil.<span style=color:#a6e22e>generateResponse</span>(jobService.<span style=color:#a6e22e>pause</span>(jobId));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/resume/{id}&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> CommonResponse <span style=color:#a6e22e>resumeJob</span>(<span style=color:#a6e22e>@PathVariable</span>(<span style=color:#e6db74>&#34;id&#34;</span>) Long jobId) <span style=color:#66d9ef>throws</span> ServiceException {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> ResponseUtil.<span style=color:#a6e22e>generateResponse</span>(jobService.<span style=color:#a6e22e>resume</span>(jobId));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>ApplicationListener.java</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>import</span> cn.com.hellowood.scheduledjob.job.ScheduleUtil;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> cn.com.hellowood.scheduledjob.model.ScheduleJob;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> cn.com.hellowood.scheduledjob.service.JobService;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> cn.com.hellowood.scheduledjob.utils.ServiceException;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.quartz.CronTrigger;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.quartz.Scheduler;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.slf4j.Logger;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.slf4j.LoggerFactory;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.beans.factory.annotation.Autowired;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.boot.CommandLineRunner;
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.stereotype.Component;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.List;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ApplicationListener</span> <span style=color:#66d9ef>implements</span> CommandLineRunner {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>final</span> Logger logger <span style=color:#f92672>=</span> LoggerFactory.<span style=color:#a6e22e>getLogger</span>(getClass());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> JobService jobService;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> Scheduler scheduler;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>run</span>(String... args) <span style=color:#66d9ef>throws</span> Exception {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 应用启动之后执行所有可执行的的任务</span>
</span></span><span style=display:flex><span>        List<span style=color:#f92672>&lt;</span>ScheduleJob<span style=color:#f92672>&gt;</span> scheduleJobList <span style=color:#f92672>=</span> jobService.<span style=color:#a6e22e>getAllEnableJob</span>();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (ScheduleJob scheduleJob : scheduleJobList) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>                CronTrigger cronTrigger <span style=color:#f92672>=</span> ScheduleUtil.<span style=color:#a6e22e>getCronTrigger</span>(scheduler, scheduleJob);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (cronTrigger <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span>) {
</span></span><span style=display:flex><span>                    ScheduleUtil.<span style=color:#a6e22e>createScheduleJob</span>(scheduler, scheduleJob);
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                    ScheduleUtil.<span style=color:#a6e22e>updateScheduleJob</span>(scheduler, scheduleJob);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                logger.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;Startup {}-{} success&#34;</span>, scheduleJob.<span style=color:#a6e22e>getJobGroup</span>(), scheduleJob.<span style=color:#a6e22e>getJobName</span>());
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>catch</span> (ServiceException e) {
</span></span><span style=display:flex><span>                e.<span style=color:#a6e22e>printStackTrace</span>();
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=使用>使用</h3><ul><li>添加任务</li></ul><pre tabindex=0><code>POST /job/save HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Cache-Control: no-cache
Postman-Token: c919bb29-40ab-45c8-2328-edd13c396d82

{
    &#34;className&#34;:&#34;cn.com.hellowood.scheduledjob.job.TestJob&#34;,
    &#34;cronExpression&#34;:&#34;*/10 * * * * ?&#34;,
    &#34;jobName&#34;:&#34;TestJob&#34;,
    &#34;jobGroup&#34;:&#34;TEST_GROUP&#34;,
    &#34;triggerName&#34;:&#34;TEST_TRIGGER&#34;,
    &#34;triggerGroup&#34;:&#34;TEST_GROUP&#34;,
    &#34;pause&#34;: &#34;false&#34;,
    &#34;enable&#34;: &#34;true&#34;,
    &#34;description&#34;:&#34;Test Job for SpringBoot&#34;
}
</code></pre><ul><li>暂停任务</li></ul><pre tabindex=0><code>GET /job/pause/1 HTTP/1.1
Host: localhost:8080
Cache-Control: no-cache
Postman-Token: a16d0256-0b2c-d2c4-6e96-21902c3ee88d
</code></pre><ul><li>继续执行任务</li></ul><pre tabindex=0><code>GET /job/resume/1 HTTP/1.1
Host: localhost:8080
Cache-Control: no-cache
Postman-Token: e9c93950-e073-26de-9a75-1e281a23a719
</code></pre><ul><li>更新任务</li></ul><pre tabindex=0><code>PUT /job/update/1 HTTP/1.1
Host: localhost:8080
Content-Type: application/json
Cache-Control: no-cache
Postman-Token: 5aad8357-522e-9adb-7452-ed84c2383418

{
    &#34;id&#34;:1,
    &#34;className&#34;:&#34;cn.com.hellowood.scheduledjob.job.TestJob&#34;,
    &#34;cronExpression&#34;:&#34;*/5 * * * * ?&#34;,
    &#34;jobName&#34;:&#34;testJob&#34;,
    &#34;jobGroup&#34;:&#34;TEST_GROUP&#34;,
    &#34;triggerName&#34;:&#34;TEST_TRIGGER&#34;,
    &#34;triggerGroup&#34;:&#34;TEST_GROUP&#34;,
    &#34;pause&#34;: &#34;false&#34;,
    &#34;enable&#34;: &#34;true&#34;,
    &#34;description&#34;:&#34;test Job for SpringBoot&#34;
}
</code></pre><ul><li>删除任务</li></ul><pre tabindex=0><code>DELETE /job/delete/1 HTTP/1.1
Host: localhost:8080
Cache-Control: no-cache
Postman-Token: a1331b4c-1a6a-5499-4106-50880e63e725
</code></pre></section><div class=paginator><a class=prev href=https://blog.hellowood.dev/posts/springboot-%E4%BD%BF%E7%94%A8-spring-session-%E5%AE%9E%E7%8E%B0-session-%E5%85%B1%E4%BA%AB/><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg>
<span>SpringBoot-使用 Spring Session 实现 Session 共享</span></a>
<a class=next href=https://blog.hellowood.dev/posts/springboot-%E4%BD%BF%E7%94%A8-mybatis-pagehelper-%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6/><span>SpringBoot 使用 MyBatis PageHelper 分页插件</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div></article></div><footer class=footer><p>&copy; 2024 <a href=https://blog.hellowood.dev/>HelloWood</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank data-umami-event=to-hugo>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank data-umami-event=to-ladder>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g data-umami-event=top-link><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>