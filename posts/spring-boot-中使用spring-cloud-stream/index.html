<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>Spring Boot 中使用Spring Cloud Stream</title>
<meta charset=utf-8><meta name=description content="Ladder@Spring Boot 中使用Spring Cloud Stream Spring Cloud Stream 用于构建高可扩展的使用消息系统连接的事件驱动服务的框架
Binder: 负责提供与外部消息系统集成的组件 Binding: 提供外部消息系统与应用之间桥接的生产者和消费者 Message: 生产者和消费者与外部消息系统之间通信的数据结构 构建应用 假设一个点咖啡场景：调用下单接口后，需要通知店员制作咖啡，待制作完成后，需要更新订单状态为完成，并通知客户；假设有两个服务，一个是订单服务(Order Service)，一个是店员服务(Waiter Service)
使用 RabbitMQ 作为MQ 服务
Order Service 添加依赖 build.gradle dependencies { implementation 'org.springframework.boot:spring-boot-starter-web' implementation 'org.springframework.cloud:spring-cloud-stream-binder-rabbit' compileOnly 'org.projectlombok:lombok' annotationProcessor 'org.projectlombok:lombok' testImplementation 'org.springframework.boot:spring-boot-starter-test' testImplementation 'org.springframework.cloud:spring-cloud-stream-test-support' } 添加配置 application.properties spring.application.name=producer server.port=8082 spring.rabbitmq.host=localhost spring.rabbitmq.port=5672 spring.rabbitmq.username=guest spring.rabbitmq.password=guest Binding OrderBinding public interface OrderBinding { String NEW_ORDERS = &#34;newOrders&#34;; String FINISHED_ORDERS = &#34;finishedOrders&#34;; @Input SubscribableChannel finishedOrders(); @Output MessageChannel newOrders(); } @Input用于指定订阅消息Topic，当有该 Topic 的消息时会调用监听该消息的处理器 @Output用于指定发送消息Topic，可以通过该MessageChannel发送消息"><meta name=author content="HelloWood"><link rel=canonical href=https://blog.hellowood.dev/posts/spring-boot-%E4%B8%AD%E4%BD%BF%E7%94%A8spring-cloud-stream/><meta name=google-site-verification content="G-3MSGPYTHPZ"><link rel=alternate type=application/rss+xml href=https://blog.hellowood.dev/index.xml title=HelloWood><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ",{anonymize_ip:!1})}</script><script async defer data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301 src=https://umami.hellowood.dev/script.js></script><script defer data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}' src=https://static.cloudflareinsights.com/beacon.min.js></script><meta property="og:title" content="Spring Boot 中使用Spring Cloud Stream"><meta property="og:description" content="Spring Boot 中使用Spring Cloud Stream Spring Cloud Stream 用于构建高可扩展的使用消息系统连接的事件驱动服务的框架
Binder: 负责提供与外部消息系统集成的组件 Binding: 提供外部消息系统与应用之间桥接的生产者和消费者 Message: 生产者和消费者与外部消息系统之间通信的数据结构 构建应用 假设一个点咖啡场景：调用下单接口后，需要通知店员制作咖啡，待制作完成后，需要更新订单状态为完成，并通知客户；假设有两个服务，一个是订单服务(Order Service)，一个是店员服务(Waiter Service)
使用 RabbitMQ 作为MQ 服务
Order Service 添加依赖 build.gradle dependencies { implementation 'org.springframework.boot:spring-boot-starter-web' implementation 'org.springframework.cloud:spring-cloud-stream-binder-rabbit' compileOnly 'org.projectlombok:lombok' annotationProcessor 'org.projectlombok:lombok' testImplementation 'org.springframework.boot:spring-boot-starter-test' testImplementation 'org.springframework.cloud:spring-cloud-stream-test-support' } 添加配置 application.properties spring.application.name=producer server.port=8082 spring.rabbitmq.host=localhost spring.rabbitmq.port=5672 spring.rabbitmq.username=guest spring.rabbitmq.password=guest Binding OrderBinding public interface OrderBinding { String NEW_ORDERS = &#34;newOrders&#34;; String FINISHED_ORDERS = &#34;finishedOrders&#34;; @Input SubscribableChannel finishedOrders(); @Output MessageChannel newOrders(); } @Input用于指定订阅消息Topic，当有该 Topic 的消息时会调用监听该消息的处理器 @Output用于指定发送消息Topic，可以通过该MessageChannel发送消息"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.hellowood.dev/posts/spring-boot-%E4%B8%AD%E4%BD%BF%E7%94%A8spring-cloud-stream/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-09-08T18:50:09+00:00"><meta property="article:modified_time" content="2019-09-08T18:50:09+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Spring Boot 中使用Spring Cloud Stream"><meta name=twitter:description content="Spring Boot 中使用Spring Cloud Stream Spring Cloud Stream 用于构建高可扩展的使用消息系统连接的事件驱动服务的框架
Binder: 负责提供与外部消息系统集成的组件 Binding: 提供外部消息系统与应用之间桥接的生产者和消费者 Message: 生产者和消费者与外部消息系统之间通信的数据结构 构建应用 假设一个点咖啡场景：调用下单接口后，需要通知店员制作咖啡，待制作完成后，需要更新订单状态为完成，并通知客户；假设有两个服务，一个是订单服务(Order Service)，一个是店员服务(Waiter Service)
使用 RabbitMQ 作为MQ 服务
Order Service 添加依赖 build.gradle dependencies { implementation 'org.springframework.boot:spring-boot-starter-web' implementation 'org.springframework.cloud:spring-cloud-stream-binder-rabbit' compileOnly 'org.projectlombok:lombok' annotationProcessor 'org.projectlombok:lombok' testImplementation 'org.springframework.boot:spring-boot-starter-test' testImplementation 'org.springframework.cloud:spring-cloud-stream-test-support' } 添加配置 application.properties spring.application.name=producer server.port=8082 spring.rabbitmq.host=localhost spring.rabbitmq.port=5672 spring.rabbitmq.username=guest spring.rabbitmq.password=guest Binding OrderBinding public interface OrderBinding { String NEW_ORDERS = &#34;newOrders&#34;; String FINISHED_ORDERS = &#34;finishedOrders&#34;; @Input SubscribableChannel finishedOrders(); @Output MessageChannel newOrders(); } @Input用于指定订阅消息Topic，当有该 Topic 的消息时会调用监听该消息的处理器 @Output用于指定发送消息Topic，可以通过该MessageChannel发送消息"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://blog.hellowood.dev/posts/"},{"@type":"ListItem","position":3,"name":"Spring Boot 中使用Spring Cloud Stream","item":"https://blog.hellowood.dev/posts/spring-boot-%E4%B8%AD%E4%BD%BF%E7%94%A8spring-cloud-stream/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Spring Boot 中使用Spring Cloud Stream","name":"Spring Boot 中使用Spring Cloud Stream","description":"Spring Boot 中使用Spring Cloud Stream Spring Cloud Stream 用于构建高可扩展的使用消息系统连接的事件驱动服务的框架\nBinder: 负责提供与外部消息系统集成的组件 Binding: 提供外部消息系统与应用之间桥接的生产者和消费者 Message: 生产者和消费者与外部消息系统之间通信的数据结构 构建应用 假设一个点咖啡场景：调用下单接口后，需要通知店员制作咖啡，待制作完成后，需要更新订单状态为完成，并通知客户；假设有两个服务，一个是订单服务(Order Service)，一个是店员服务(Waiter Service)\n使用 RabbitMQ 作为MQ 服务\nOrder Service 添加依赖 build.gradle dependencies { implementation \u0026#39;org.springframework.boot:spring-boot-starter-web\u0026#39; implementation \u0026#39;org.springframework.cloud:spring-cloud-stream-binder-rabbit\u0026#39; compileOnly \u0026#39;org.projectlombok:lombok\u0026#39; annotationProcessor \u0026#39;org.projectlombok:lombok\u0026#39; testImplementation \u0026#39;org.springframework.boot:spring-boot-starter-test\u0026#39; testImplementation \u0026#39;org.springframework.cloud:spring-cloud-stream-test-support\u0026#39; } 添加配置 application.properties spring.application.name=producer server.port=8082 spring.rabbitmq.host=localhost spring.rabbitmq.port=5672 spring.rabbitmq.username=guest spring.rabbitmq.password=guest Binding OrderBinding public interface OrderBinding { String NEW_ORDERS = \u0026#34;newOrders\u0026#34;; String FINISHED_ORDERS = \u0026#34;finishedOrders\u0026#34;; @Input SubscribableChannel finishedOrders(); @Output MessageChannel newOrders(); } @Input用于指定订阅消息Topic，当有该 Topic 的消息时会调用监听该消息的处理器 @Output用于指定发送消息Topic，可以通过该MessageChannel发送消息","keywords":["Java","SpringBoot","Stream"],"articleBody":"Spring Boot 中使用Spring Cloud Stream Spring Cloud Stream 用于构建高可扩展的使用消息系统连接的事件驱动服务的框架\nBinder: 负责提供与外部消息系统集成的组件 Binding: 提供外部消息系统与应用之间桥接的生产者和消费者 Message: 生产者和消费者与外部消息系统之间通信的数据结构 构建应用 假设一个点咖啡场景：调用下单接口后，需要通知店员制作咖啡，待制作完成后，需要更新订单状态为完成，并通知客户；假设有两个服务，一个是订单服务(Order Service)，一个是店员服务(Waiter Service)\n使用 RabbitMQ 作为MQ 服务\nOrder Service 添加依赖 build.gradle dependencies { implementation 'org.springframework.boot:spring-boot-starter-web' implementation 'org.springframework.cloud:spring-cloud-stream-binder-rabbit' compileOnly 'org.projectlombok:lombok' annotationProcessor 'org.projectlombok:lombok' testImplementation 'org.springframework.boot:spring-boot-starter-test' testImplementation 'org.springframework.cloud:spring-cloud-stream-test-support' } 添加配置 application.properties spring.application.name=producer server.port=8082 spring.rabbitmq.host=localhost spring.rabbitmq.port=5672 spring.rabbitmq.username=guest spring.rabbitmq.password=guest Binding OrderBinding public interface OrderBinding { String NEW_ORDERS = \"newOrders\"; String FINISHED_ORDERS = \"finishedOrders\"; @Input SubscribableChannel finishedOrders(); @Output MessageChannel newOrders(); } @Input用于指定订阅消息Topic，当有该 Topic 的消息时会调用监听该消息的处理器 @Output用于指定发送消息Topic，可以通过该MessageChannel发送消息\n发送消息 @RestController public class OrderController { @Autowired private OrderBinding orderBinding; @GetMapping(\"/newOrder\") public Object sendMessage(Long orderId, Long userId) { OrderVO orderVO = OrderVO.builder() .orderId(orderId) .userId(userId) .build(); boolean result = orderBinding.newOrders().send(MessageBuilder.withPayload(orderVO).build()); return new HashMap\u003cString, String\u003e() {{ put(\"message\", result ? \"下单成功\" : \"下单失败\"); }}; } } 发送消息可以通过注入 Binding 对象，或者注入 MessageChannel对象时指定 Bean 来实现\n@Autowired private OrderBinding orderBinding; // 或者 @Autowired @Qualifier(OrderBinding.FINISHED_ORDERS) private MessageChannel messageChannel; OrderServiceApplication.java @SpringBootApplication @EnableBinding({OrderBinding.class}) public class OrderServiceApplication { public static void main(String[] args) { SpringApplication.run(OrderServiceApplication.class, args); } } Waiter Service 添加依赖 build.gradle dependencies { implementation 'org.springframework.cloud:spring-cloud-stream-binder-rabbit' compileOnly 'org.projectlombok:lombok' annotationProcessor 'org.projectlombok:lombok' testImplementation 'org.springframework.boot:spring-boot-starter-test' testImplementation 'org.springframework.cloud:spring-cloud-stream-test-support' } 添加配置 application.properties spring.rabbitmq.host=localhost spring.rabbitmq.port=5672 spring.rabbitmq.username=guest spring.rabbitmq.password=guest 监听消息 OrderBinding public interface OrderBinding { String NEW_ORDERS = \"newOrders\"; String FINISHED_ORDERS = \"finishedOrders\"; @Input SubscribableChannel newOrders(); @Output MessageChannel finishedOrders(); } WaiterListener @Component @Slf4j public class WaiterListener { @StreamListener(OrderBinding.NEW_ORDERS) @SendTo(OrderBinding.FINISHED_ORDERS) public OrderVO newOrders(OrderVO orderVO) { log.info(\"收到用户:{} 的新订单:{}\", orderVO.getUserId(), orderVO.getOrderId()); try { Thread.sleep(10000); } catch (InterruptedException e) { log.error(\"制作失败\", e); } return orderVO; } } 这里在收到消息后等待制作完成，发送订单完成的消息给 Order Service，执行后续动作\n@StreamListener用于监听指定 Topic 并处理 @SendTo用于指定处理的结果要发送的下一个 Topic\nWaiterServiceApplication.java @SpringBootApplication @EnableBinding({OrderBinding.class}) public class WaiterServiceApplication { public static void main(String[] args) { SpringApplication.run(WaiterServiceApplication.class, args); } } Order Service 处理后续消息 订单完成消息 收到订单完成的消息后发送通知消息\nNotifyBinding.java public interface NotifyBinding { String SEND_NOTIFY = \"sendNotify\"; @Output MessageChannel sendNotify(); } OrderListener.java @Component @Slf4j public class OrderListener { @StreamListener(OrderBinding.FINISHED_ORDERS) @SendTo(NotifyBinding.SEND_NOTIFY) public NotifyMessage finishedOrdersHandler(OrderVO orderVO) { log.info(\"用户:{} 的订单:{} 已完成\", orderVO.getUserId(), orderVO.getOrderId()); return NotifyMessage.builder() .title(\"订单已完成\") .userId(orderVO.getUserId()) .sendTime(LocalDateTime.now()) .build(); } } 处理通知消息 NotifyListener.java @Component @Slf4j public class NotifyListener { @StreamListener(NotifyBinding.SEND_NOTIFY) public void sendNotifyHandler(NotifyMessage notifyMessage) { log.info(\"发送标题为:{} 的消息给用户:{}\", notifyMessage.getTitle(), notifyMessage.getUserId()); } } 测试 启动RabbitMQ docker run -d --name rabbit -p 4369:4369 -p 5672:5672 -p 15671:15671 -p 15672:15672 -p 25672:25672 --hostname localhost -e RABBITMQ_DEFAULT_USER=guest -e RABBITMQ_DEFAULT_PASS=guest rabbitmq:3-management 启动 WaiterService 和 OrderService 发送下单请求 curl 'localhost:8082/newOrder?orderId=1\u0026userId=2' {\"message\":\"下单成功\"}% 然后会看到 WaiterService 和 OrderService 的相应的监听器都接收到了消息并打印日志 其他类型消息 Transform 如果一个消息需要处理加工后继续发给下一个，可以直接使用@Transformer注解来代替@StreamListener和@SendTo\n@Component public class TransformerListener { @Transformer(inputChannel = TransoformBinding.INPUT, outputChannel = TransoformBinding.OUTPUT) public Object transform(String message) { return message.toUpperCase(); } } 定时消息 @Component public class TimerAdapter { @InboundChannelAdapter(value = OrderBinding.NEW_ORDERS, poller = @Poller(fixedDelay = \"10\", maxMessagesPerPoll = \"1\")) @Bean public MessageSource\u003cOrderVO\u003e timerMessageSource() { OrderVO orderVO = OrderVO.builder() .userId(1L) .orderId(1L) .build(); return () -\u003e new GenericMessage\u003c\u003e(orderVO); } } 项目地址 https://github.com/helloworlde/SpringBootCollection/tree/master/SpringBoot-Stream\n","wordCount":"417","inLanguage":"en","datePublished":"2019-09-08T18:50:09Z","dateModified":"2019-09-08T18:50:09Z","author":{"@type":"Person","name":"HelloWood"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.hellowood.dev/posts/spring-boot-%E4%B8%AD%E4%BD%BF%E7%94%A8spring-cloud-stream/"},"publisher":{"@type":"Organization","name":"HelloWood","logo":{"@type":"ImageObject","url":"https://blog.hellowood.dev/favicon.ico"}}}</script><link rel=icon href=/images/avatar.png sizes=16x16><link rel=apple-touch-icon href=/images/avatar.png><link rel=manifest href=/images/avatar.png><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.ff1bc260fafbfb440e10194d7d06d57eb5e85eed11d12d06255581262664204e.css integrity="sha256-/xvCYPr7+0QOEBlNfQbVfrXoXu0R0S0GJVWBJiZkIE4=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.af9899d47b21c333d192dccc82e0aa6650046e1a76ff4eaf89be703b64d94684.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jtbhx98g62")</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand data-umami-event=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Blog href=/posts>Blog</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Tags href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Archive href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Dashboard href=https://umami.hellowood.dev/share/lab/Blog>Dashboard</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link data-umami-event=navigation-social href=https://github.com/helloworlde><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button data-umami-event=toggle-theme aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
<span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>Spring Boot 中使用Spring Cloud Stream</h1></header><p><small>September 8, 2019&nbsp;· 417 words&nbsp;· 2 min</small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#构建应用>构建应用</a><ul><li><a href=#order-service>Order Service</a></li><li><a href=#waiter-service>Waiter Service</a></li><li><a href=#order-service-处理后续消息>Order Service 处理后续消息</a></li><li><a href=#测试>测试</a></li></ul></li><li><a href=#其他类型消息>其他类型消息</a><ul><li><a href=#项目地址>项目地址</a></li></ul></li></ul></nav></div><section class=blog-content><h1 id=spring-boot-中使用spring-cloud-stream>Spring Boot 中使用Spring Cloud Stream</h1><blockquote><p><a href=https://spring.io/projects/spring-cloud-stream>Spring Cloud Stream</a> 用于构建高可扩展的使用消息系统连接的事件驱动服务的框架</p></blockquote><ul><li>Binder: 负责提供与外部消息系统集成的组件</li><li>Binding: 提供外部消息系统与应用之间桥接的生产者和消费者</li><li>Message: 生产者和消费者与外部消息系统之间通信的数据结构</li></ul><h2 id=构建应用>构建应用</h2><p>假设一个点咖啡场景：调用下单接口后，需要通知店员制作咖啡，待制作完成后，需要更新订单状态为完成，并通知客户；假设有两个服务，一个是订单服务(Order Service)，一个是店员服务(Waiter Service)</p><p>使用 RabbitMQ 作为MQ 服务</p><h3 id=order-service>Order Service</h3><h5 id=添加依赖>添加依赖</h5><ul><li>build.gradle</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gradle data-lang=gradle><span style=display:flex><span>dependencies <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-web&#39;</span>
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#39;org.springframework.cloud:spring-cloud-stream-binder-rabbit&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    compileOnly <span style=color:#e6db74>&#39;org.projectlombok:lombok&#39;</span>
</span></span><span style=display:flex><span>    annotationProcessor <span style=color:#e6db74>&#39;org.projectlombok:lombok&#39;</span>
</span></span><span style=display:flex><span>    testImplementation <span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-test&#39;</span>
</span></span><span style=display:flex><span>    testImplementation <span style=color:#e6db74>&#39;org.springframework.cloud:spring-cloud-stream-test-support&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=添加配置>添加配置</h5><ul><li>application.properties</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#a6e22e>spring.application.name</span><span style=color:#f92672>=</span><span style=color:#e6db74>producer</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>server.port</span><span style=color:#f92672>=</span><span style=color:#e6db74>8082</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.rabbitmq.host</span><span style=color:#f92672>=</span><span style=color:#e6db74>localhost</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.rabbitmq.port</span><span style=color:#f92672>=</span><span style=color:#e6db74>5672</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.rabbitmq.username</span><span style=color:#f92672>=</span><span style=color:#e6db74>guest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.rabbitmq.password</span><span style=color:#f92672>=</span><span style=color:#e6db74>guest</span>
</span></span></code></pre></div><h5 id=binding>Binding</h5><ul><li>OrderBinding</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>OrderBinding</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    String NEW_ORDERS <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;newOrders&#34;</span>;
</span></span><span style=display:flex><span>    String FINISHED_ORDERS <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;finishedOrders&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Input</span>
</span></span><span style=display:flex><span>    SubscribableChannel <span style=color:#a6e22e>finishedOrders</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Output</span>
</span></span><span style=display:flex><span>    MessageChannel <span style=color:#a6e22e>newOrders</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>@Input</code>用于指定订阅消息Topic，当有该 Topic 的消息时会调用监听该消息的处理器
<code>@Output</code>用于指定发送消息Topic，可以通过该MessageChannel发送消息</p><h5 id=发送消息>发送消息</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderController</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> OrderBinding orderBinding;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@GetMapping</span>(<span style=color:#e6db74>&#34;/newOrder&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>sendMessage</span>(Long orderId, Long userId) {
</span></span><span style=display:flex><span>        OrderVO orderVO <span style=color:#f92672>=</span> OrderVO.<span style=color:#a6e22e>builder</span>()
</span></span><span style=display:flex><span>                                 .<span style=color:#a6e22e>orderId</span>(orderId)
</span></span><span style=display:flex><span>                                 .<span style=color:#a6e22e>userId</span>(userId)
</span></span><span style=display:flex><span>                                 .<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>boolean</span> result <span style=color:#f92672>=</span> orderBinding.<span style=color:#a6e22e>newOrders</span>().<span style=color:#a6e22e>send</span>(MessageBuilder.<span style=color:#a6e22e>withPayload</span>(orderVO).<span style=color:#a6e22e>build</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;</span>String, String<span style=color:#f92672>&gt;</span>() {{
</span></span><span style=display:flex><span>            put(<span style=color:#e6db74>&#34;message&#34;</span>, result <span style=color:#f92672>?</span> <span style=color:#e6db74>&#34;下单成功&#34;</span> : <span style=color:#e6db74>&#34;下单失败&#34;</span>);
</span></span><span style=display:flex><span>        }};
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>发送消息可以通过注入 Binding 对象，或者注入 <code>MessageChannel</code>对象时指定 Bean 来实现</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> OrderBinding orderBinding;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 或者</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Autowired</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Qualifier</span>(OrderBinding.<span style=color:#a6e22e>FINISHED_ORDERS</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> MessageChannel messageChannel;
</span></span></code></pre></div><ul><li>OrderServiceApplication.java</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootApplication</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@EnableBinding</span>({OrderBinding.<span style=color:#a6e22e>class</span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderServiceApplication</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        SpringApplication.<span style=color:#a6e22e>run</span>(OrderServiceApplication.<span style=color:#a6e22e>class</span>, args);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=waiter-service>Waiter Service</h3><h5 id=添加依赖-1>添加依赖</h5><ul><li>build.gradle</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gradle data-lang=gradle><span style=display:flex><span>dependencies <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    implementation <span style=color:#e6db74>&#39;org.springframework.cloud:spring-cloud-stream-binder-rabbit&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    compileOnly <span style=color:#e6db74>&#39;org.projectlombok:lombok&#39;</span>
</span></span><span style=display:flex><span>    annotationProcessor <span style=color:#e6db74>&#39;org.projectlombok:lombok&#39;</span>
</span></span><span style=display:flex><span>    testImplementation <span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-test&#39;</span>
</span></span><span style=display:flex><span>    testImplementation <span style=color:#e6db74>&#39;org.springframework.cloud:spring-cloud-stream-test-support&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h5 id=添加配置-1>添加配置</h5><ul><li>application.properties</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-properties data-lang=properties><span style=display:flex><span><span style=color:#a6e22e>spring.rabbitmq.host</span><span style=color:#f92672>=</span><span style=color:#e6db74>localhost</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.rabbitmq.port</span><span style=color:#f92672>=</span><span style=color:#e6db74>5672</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.rabbitmq.username</span><span style=color:#f92672>=</span><span style=color:#e6db74>guest</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>spring.rabbitmq.password</span><span style=color:#f92672>=</span><span style=color:#e6db74>guest</span>
</span></span></code></pre></div><h5 id=监听消息>监听消息</h5><ul><li>OrderBinding</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>OrderBinding</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    String NEW_ORDERS <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;newOrders&#34;</span>;
</span></span><span style=display:flex><span>    String FINISHED_ORDERS <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;finishedOrders&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Input</span>
</span></span><span style=display:flex><span>    SubscribableChannel <span style=color:#a6e22e>newOrders</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Output</span>
</span></span><span style=display:flex><span>    MessageChannel <span style=color:#a6e22e>finishedOrders</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>WaiterListener</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WaiterListener</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@StreamListener</span>(OrderBinding.<span style=color:#a6e22e>NEW_ORDERS</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@SendTo</span>(OrderBinding.<span style=color:#a6e22e>FINISHED_ORDERS</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> OrderVO <span style=color:#a6e22e>newOrders</span>(OrderVO orderVO) {
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;收到用户:{} 的新订单:{}&#34;</span>, orderVO.<span style=color:#a6e22e>getUserId</span>(), orderVO.<span style=color:#a6e22e>getOrderId</span>());
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>            Thread.<span style=color:#a6e22e>sleep</span>(10000);
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>catch</span> (InterruptedException e) {
</span></span><span style=display:flex><span>            log.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;制作失败&#34;</span>, e);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> orderVO;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>这里在收到消息后等待制作完成，发送订单完成的消息给 Order Service，执行后续动作</p><p><code>@StreamListener</code>用于监听指定 Topic 并处理
<code>@SendTo</code>用于指定处理的结果要发送的下一个 Topic</p><ul><li>WaiterServiceApplication.java</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@SpringBootApplication</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@EnableBinding</span>({OrderBinding.<span style=color:#a6e22e>class</span>})
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>WaiterServiceApplication</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span>(String<span style=color:#f92672>[]</span> args) {
</span></span><span style=display:flex><span>        SpringApplication.<span style=color:#a6e22e>run</span>(WaiterServiceApplication.<span style=color:#a6e22e>class</span>, args);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=order-service-处理后续消息>Order Service 处理后续消息</h3><h5 id=订单完成消息>订单完成消息</h5><p>收到订单完成的消息后发送通知消息</p><ul><li>NotifyBinding.java</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>NotifyBinding</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    String SEND_NOTIFY <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;sendNotify&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Output</span>
</span></span><span style=display:flex><span>    MessageChannel <span style=color:#a6e22e>sendNotify</span>();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>OrderListener.java</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OrderListener</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@StreamListener</span>(OrderBinding.<span style=color:#a6e22e>FINISHED_ORDERS</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@SendTo</span>(NotifyBinding.<span style=color:#a6e22e>SEND_NOTIFY</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> NotifyMessage <span style=color:#a6e22e>finishedOrdersHandler</span>(OrderVO orderVO) {
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;用户:{} 的订单:{} 已完成&#34;</span>, orderVO.<span style=color:#a6e22e>getUserId</span>(), orderVO.<span style=color:#a6e22e>getOrderId</span>());
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> NotifyMessage.<span style=color:#a6e22e>builder</span>()
</span></span><span style=display:flex><span>                            .<span style=color:#a6e22e>title</span>(<span style=color:#e6db74>&#34;订单已完成&#34;</span>)
</span></span><span style=display:flex><span>                            .<span style=color:#a6e22e>userId</span>(orderVO.<span style=color:#a6e22e>getUserId</span>())
</span></span><span style=display:flex><span>                            .<span style=color:#a6e22e>sendTime</span>(LocalDateTime.<span style=color:#a6e22e>now</span>())
</span></span><span style=display:flex><span>                            .<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h5 id=处理通知消息>处理通知消息</h5><ul><li>NotifyListener.java</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@Slf4j</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>NotifyListener</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@StreamListener</span>(NotifyBinding.<span style=color:#a6e22e>SEND_NOTIFY</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>sendNotifyHandler</span>(NotifyMessage notifyMessage) {
</span></span><span style=display:flex><span>        log.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;发送标题为:{} 的消息给用户:{}&#34;</span>, notifyMessage.<span style=color:#a6e22e>getTitle</span>(), notifyMessage.<span style=color:#a6e22e>getUserId</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=测试>测试</h3><ul><li>启动RabbitMQ</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d --name rabbit -p 4369:4369 -p 5672:5672 -p 15671:15671 -p 15672:15672 -p 25672:25672 --hostname localhost -e RABBITMQ_DEFAULT_USER<span style=color:#f92672>=</span>guest -e RABBITMQ_DEFAULT_PASS<span style=color:#f92672>=</span>guest rabbitmq:3-management
</span></span></code></pre></div><ul><li>启动 WaiterService 和 OrderService</li><li>发送下单请求</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl <span style=color:#e6db74>&#39;localhost:8082/newOrder?orderId=1&amp;userId=2&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;下单成功&#34;</span><span style=color:#f92672>}</span>%
</span></span></code></pre></div><ul><li>然后会看到 WaiterService 和 OrderService 的相应的监听器都接收到了消息并打印日志</li></ul><hr><h2 id=其他类型消息>其他类型消息</h2><ul><li>Transform</li></ul><p>如果一个消息需要处理加工后继续发给下一个，可以直接使用<code>@Transformer</code>注解来代替<code>@StreamListener</code>和<code>@SendTo</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TransformerListener</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Transformer</span>(inputChannel <span style=color:#f92672>=</span> TransoformBinding.<span style=color:#a6e22e>INPUT</span>, outputChannel <span style=color:#f92672>=</span> TransoformBinding.<span style=color:#a6e22e>OUTPUT</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>transform</span>(String message) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> message.<span style=color:#a6e22e>toUpperCase</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>定时消息</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#a6e22e>@Component</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TimerAdapter</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@InboundChannelAdapter</span>(value <span style=color:#f92672>=</span> OrderBinding.<span style=color:#a6e22e>NEW_ORDERS</span>, poller <span style=color:#f92672>=</span> <span style=color:#a6e22e>@Poller</span>(fixedDelay <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;10&#34;</span>, maxMessagesPerPoll <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;1&#34;</span>))
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Bean</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> MessageSource<span style=color:#f92672>&lt;</span>OrderVO<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>timerMessageSource</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        OrderVO orderVO <span style=color:#f92672>=</span> OrderVO.<span style=color:#a6e22e>builder</span>()
</span></span><span style=display:flex><span>                                 .<span style=color:#a6e22e>userId</span>(1L)
</span></span><span style=display:flex><span>                                 .<span style=color:#a6e22e>orderId</span>(1L)
</span></span><span style=display:flex><span>                                 .<span style=color:#a6e22e>build</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> () <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>new</span> GenericMessage<span style=color:#f92672>&lt;&gt;</span>(orderVO);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=项目地址>项目地址</h3><p><a href=https://github.com/helloworlde/SpringBootCollection/tree/master/SpringBoot-Stream>https://github.com/helloworlde/SpringBootCollection/tree/master/SpringBoot-Stream</a></p></section><div class=paginator><a class=prev href=https://blog.hellowood.dev/posts/go-%E5%BC%80%E5%8F%91%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7-oss%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg>
<span>Go 开发命令行工具-OSS文件上传</span></a>
<a class=next href=https://blog.hellowood.dev/posts/spring-boot-%E4%B8%AD%E4%BD%BF%E7%94%A8-websocket/><span>Spring Boot 中使用 WebSocket</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div></article></div><footer class=footer><p>&copy; 2024 <a href=https://blog.hellowood.dev>HelloWood</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank data-umami-event=to-hugo>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank data-umami-event=to-ladder>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g data-umami-event=top-link><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>