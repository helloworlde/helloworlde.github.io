<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>Spring Cloud 使用 Kubernetes 作为配置中心</title>
<meta name=description content="Spring Cloud 支持使用 Kubernetes 作为配置中心，通过 ConfigMap 或 Secret，将配置添加到应用中
加载配置 加载配置是通过 PropertySourceLocator 来实现的，ConfigMap 使用 ConfigMapPropertySourceLocator 加 …"><meta name=keywords content='blog,hugo,Java,SpringCloud'><meta property="og:url" content="https://blog.hellowood.dev/posts/spring-cloud-%E4%BD%BF%E7%94%A8-kubernetes-%E4%BD%9C%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-1/"><meta property="og:type" content="website"><meta property="og:title" content="Spring Cloud 使用 Kubernetes 作为配置中心"><meta property="og:description" content="Spring Cloud 支持使用 Kubernetes 作为配置中心，通过 ConfigMap 或 Secret，将配置添加到应用中
加载配置 加载配置是通过 PropertySourceLocator 来实现的，ConfigMap 使用 ConfigMapPropertySourceLocator 加 …"><meta property="og:image" content="https://blog.hellowood.dev/images/avatar.webp"><meta property="og:image:secure_url" content="https://blog.hellowood.dev/images/avatar.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Spring Cloud 使用 Kubernetes 作为配置中心"><meta name=twitter:description content="Spring Cloud 支持使用 Kubernetes 作为配置中心，通过 ConfigMap 或 Secret，将配置添加到应用中
加载配置 加载配置是通过 PropertySourceLocator 来实现的，ConfigMap 使用 ConfigMapPropertySourceLocator 加 …"><meta property="twitter:domain" content="https://blog.hellowood.dev/posts/spring-cloud-%E4%BD%BF%E7%94%A8-kubernetes-%E4%BD%9C%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-1/"><meta property="twitter:url" content="https://blog.hellowood.dev/posts/spring-cloud-%E4%BD%BF%E7%94%A8-kubernetes-%E4%BD%9C%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-1/"><meta name=twitter:image content="https://blog.hellowood.dev/images/avatar.webp"><link rel=canonical href=https://blog.hellowood.dev/posts/spring-cloud-%E4%BD%BF%E7%94%A8-kubernetes-%E4%BD%9C%E4%B8%BA%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83-1/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.9a920d7dabdbad8363b6a0a94e29a9dfebdb7ee64cfcb193a0145e512ef2bdab.js integrity="sha256-mpINfavbrYNjtqCpTimp3+vbfuZM/LGToBReUS7yvas="></script><script defer src=https://umami.hellowood.dev/script.js data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301></script><script defer src=https://cloud.umami.is/script.js data-website-id=73ff1c8c-9938-43cf-81af-e77e26b0cca3></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}'></script><meta name=google-adsense-account content="ca-pub-3401351766168985"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3401351766168985" crossorigin=anonymous></script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","jtbhx98g62")</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ")</script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://blog.hellowood.dev/><img src=/images/avatar.webp alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://blog.hellowood.dev/>HelloWood</a></div><div class=nav-links><div class=nav-link><a href=https://blog.hellowood.dev/><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://blog.hellowood.dev/posts/><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://blog.hellowood.dev/tags/><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://github.com/helloworlde><span data-feather=github></span></a></div><div class=nav-link><a href=https://umami.hellowood.dev/share/lab/Blog><span data-feather=pie-chart></span></a></div><div class=nav-link><a href=https://blog.hellowood.dev/index.xml><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target"></span>
<a><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://blog.hellowood.dev/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://blog.hellowood.dev/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://blog.hellowood.dev/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://github.com/helloworlde><span data-feather=github></span></a></li><li class=nav-item><a href=https://umami.hellowood.dev/share/lab/Blog><span data-feather=pie-chart></span></a></li><li class=nav-item><a href=https://blog.hellowood.dev/index.xml><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>Spring Cloud 使用 Kubernetes 作为配置中心</h1><small role=doc-subtitle></small><p class=post-date>2020-09-09
| Updated 2024-09-09</p><ul class=post-tags><li class=post-tag><a href=https://blog.hellowood.dev/tags/java>Java</a></li><li class=post-tag><a href=https://blog.hellowood.dev/tags/springcloud>SpringCloud</a></li></ul></div><div class=post-content><p>Spring Cloud 支持使用 Kubernetes 作为配置中心，通过 ConfigMap 或 Secret，将配置添加到应用中</p><h2 id=加载配置>加载配置</h2><p>加载配置是通过 PropertySourceLocator 来实现的，ConfigMap 使用 <code>ConfigMapPropertySourceLocator</code> 加载，Secret 使用 <code>SecretsPropertySourceLocator</code>加载</p><h3 id=bean-初始化>Bean 初始化</h3><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>		<span style=color:#e5c07b>@Bean</span>
</span></span><span style=display:flex><span>		<span style=color:#e5c07b>@ConditionalOnProperty</span>(<span style=color:#c1abea>name</span> <span style=color:#c7bf54>=</span> <span style=color:#98c379>&#34;spring.cloud.kubernetes.config.enabled&#34;</span>, <span style=color:#c1abea>matchIfMissing</span> <span style=color:#c7bf54>=</span> <span style=color:#b756ff;font-weight:700>true</span>)
</span></span><span style=display:flex><span>		<span style=color:#c678dd>public</span> <span style=color:#c1abea>ConfigMapPropertySourceLocator</span> <span style=color:#00b1f7>configMapPropertySourceLocator</span>(<span style=color:#c1abea>ConfigMapConfigProperties</span> <span style=color:#c1abea>properties</span>) {
</span></span><span style=display:flex><span>			<span style=color:#c678dd>return</span> <span style=color:#c678dd>new</span> <span style=color:#c1abea>ConfigMapPropertySourceLocator</span>(<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>client</span>, <span style=color:#c1abea>properties</span>);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#e5c07b>@Bean</span>
</span></span><span style=display:flex><span>		<span style=color:#e5c07b>@ConditionalOnProperty</span>(<span style=color:#c1abea>name</span> <span style=color:#c7bf54>=</span> <span style=color:#98c379>&#34;spring.cloud.kubernetes.secrets.enabled&#34;</span>, <span style=color:#c1abea>matchIfMissing</span> <span style=color:#c7bf54>=</span> <span style=color:#b756ff;font-weight:700>true</span>)
</span></span><span style=display:flex><span>		<span style=color:#c678dd>public</span> <span style=color:#c1abea>SecretsPropertySourceLocator</span> <span style=color:#00b1f7>secretsPropertySourceLocator</span>(<span style=color:#c1abea>SecretsConfigProperties</span> <span style=color:#c1abea>properties</span>) {
</span></span><span style=display:flex><span>			<span style=color:#c678dd>return</span> <span style=color:#c678dd>new</span> <span style=color:#c1abea>SecretsPropertySourceLocator</span>(<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>client</span>, <span style=color:#c1abea>properties</span>);
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div><h3 id=获取配置>获取配置</h3><p>获取配置是通过 PropertySourceLocator#locate 方法实现的，最终将获取到属性添加到环境中</p><h4 id=configmap>ConfigMap</h4><ul><li>ConfigMapPropertySourceLocator#locate</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>	<span style=color:#e5c07b>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#c678dd>public</span> <span style=color:#c1abea>PropertySource</span> <span style=color:#00b1f7>locate</span>(<span style=color:#c1abea>Environment</span> <span style=color:#c1abea>environment</span>) {
</span></span><span style=display:flex><span>		<span style=color:#c678dd>if</span> (<span style=color:#c1abea>environment</span> <span style=color:#c678dd>instanceof</span> <span style=color:#c1abea>ConfigurableEnvironment</span>) {
</span></span><span style=display:flex><span>			<span style=color:#c1abea>ConfigurableEnvironment</span> <span style=color:#c1abea>env</span> <span style=color:#c7bf54>=</span> (<span style=color:#c1abea>ConfigurableEnvironment</span>) <span style=color:#c1abea>environment</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#c1abea>List</span><span style=color:#c7bf54>&lt;</span><span style=color:#c1abea>ConfigMapConfigProperties</span>.<span style=color:#b3d23c>NormalizedSource</span><span style=color:#c7bf54>&gt;</span> <span style=color:#c1abea>sources</span> <span style=color:#c7bf54>=</span> <span style=color:#c678dd>this</span>.<span style=color:#b3d23c>properties</span>.<span style=color:#b3d23c>determineSources</span>();
</span></span><span style=display:flex><span>			<span style=color:#c1abea>CompositePropertySource</span> <span style=color:#c1abea>composite</span> <span style=color:#c7bf54>=</span> <span style=color:#c678dd>new</span> <span style=color:#c1abea>CompositePropertySource</span>(<span style=color:#98c379>&#34;composite-configmap&#34;</span>);
</span></span><span style=display:flex><span>			<span style=color:#c678dd>if</span> (<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>properties</span>.<span style=color:#b3d23c>isEnableApi</span>()) {
</span></span><span style=display:flex><span>				<span style=color:#c1abea>sources</span>.<span style=color:#b3d23c>forEach</span>(<span style=color:#c1abea>s</span> <span style=color:#c7bf54>-&gt;</span> <span style=color:#c1abea>composite</span>.<span style=color:#b3d23c>addFirstPropertySource</span>(
</span></span><span style=display:flex><span>					<span style=color:#c1abea>getMapPropertySourceForSingleConfigMap</span>(<span style=color:#c1abea>env</span>, <span style=color:#c1abea>s</span>)));
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#8a93a5;font-style:italic>// 将配置添加的容器环境中</span>
</span></span><span style=display:flex><span>			<span style=color:#c1abea>addPropertySourcesFromPaths</span>(<span style=color:#c1abea>environment</span>, <span style=color:#c1abea>composite</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#c678dd>return</span> <span style=color:#c1abea>composite</span>;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#c678dd>return</span> <span style=color:#b756ff;font-weight:700>null</span>;
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><p>真正向 Kubernetes 发起请求的是通过调用 <code>getMapPropertySourceForSingleConfigMap</code> 方法，创建<code>ConfigMapPropertySource</code>实例的时候，会根据 <code>getData</code> 方法，从 ConfigMap 获取属性解析并添加到环境中</p><ul><li>ConfigMapPropertySourceLocator#getMapPropertySourceForSingleConfigMap</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>	<span style=color:#c678dd>private</span> <span style=color:#c1abea>MapPropertySource</span> <span style=color:#00b1f7>getMapPropertySourceForSingleConfigMap</span>(
</span></span><span style=display:flex><span>		<span style=color:#c1abea>ConfigurableEnvironment</span> <span style=color:#c1abea>environment</span>, <span style=color:#c1abea>NormalizedSource</span> <span style=color:#c1abea>normalizedSource</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#c1abea>String</span> <span style=color:#c1abea>configurationTarget</span> <span style=color:#c7bf54>=</span> <span style=color:#c678dd>this</span>.<span style=color:#b3d23c>properties</span>.<span style=color:#b3d23c>getConfigurationTarget</span>();
</span></span><span style=display:flex><span>		<span style=color:#8a93a5;font-style:italic>// 创建新的属性</span>
</span></span><span style=display:flex><span>		<span style=color:#c678dd>return</span> <span style=color:#c678dd>new</span> <span style=color:#c1abea>ConfigMapPropertySource</span>(<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>client</span>,
</span></span><span style=display:flex><span>			<span style=color:#c1abea>getApplicationName</span>(<span style=color:#c1abea>environment</span>, <span style=color:#c1abea>normalizedSource</span>.<span style=color:#b3d23c>getName</span>(), <span style=color:#c1abea>configurationTarget</span>),
</span></span><span style=display:flex><span>			<span style=color:#c1abea>getApplicationNamespace</span>(<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>client</span>, <span style=color:#c1abea>normalizedSource</span>.<span style=color:#b3d23c>getNamespace</span>(), <span style=color:#c1abea>configurationTarget</span>),
</span></span><span style=display:flex><span>			<span style=color:#c1abea>environment</span>);
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><ul><li>ConfigMapPropertySource</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>	<span style=color:#c678dd>public</span> <span style=color:#00b1f7>ConfigMapPropertySource</span>(<span style=color:#c1abea>KubernetesClient</span> <span style=color:#c1abea>client</span>,
</span></span><span style=display:flex><span>	                               <span style=color:#c1abea>String</span> <span style=color:#c1abea>name</span>,
</span></span><span style=display:flex><span>	                               <span style=color:#c1abea>String</span> <span style=color:#c1abea>namespace</span>,
</span></span><span style=display:flex><span>	                               <span style=color:#c1abea>Environment</span> <span style=color:#c1abea>environment</span>) {
</span></span><span style=display:flex><span>		<span style=color:#c678dd>super</span>(<span style=color:#c1abea>getName</span>(<span style=color:#c1abea>client</span>, <span style=color:#c1abea>name</span>, <span style=color:#c1abea>namespace</span>),
</span></span><span style=display:flex><span>			<span style=color:#c1abea>asObjectMap</span>(<span style=color:#c1abea>getData</span>(<span style=color:#c1abea>client</span>, <span style=color:#c1abea>name</span>, <span style=color:#c1abea>namespace</span>, <span style=color:#c1abea>environment</span>)));
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><ul><li>ConfigMapPropertySource#getData</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>	<span style=color:#c678dd>private</span> <span style=color:#c678dd>static</span> <span style=color:#c1abea>Map</span><span style=color:#c7bf54>&lt;</span><span style=color:#c1abea>String</span>, <span style=color:#c1abea>Object</span><span style=color:#c7bf54>&gt;</span> <span style=color:#00b1f7>getData</span>(<span style=color:#c1abea>KubernetesClient</span> <span style=color:#c1abea>client</span>, <span style=color:#c1abea>String</span> <span style=color:#c1abea>name</span>,
</span></span><span style=display:flex><span>	                                           <span style=color:#c1abea>String</span> <span style=color:#c1abea>namespace</span>, <span style=color:#c1abea>Environment</span> <span style=color:#c1abea>environment</span>) {
</span></span><span style=display:flex><span>		<span style=color:#c678dd>try</span> {
</span></span><span style=display:flex><span>			<span style=color:#c1abea>Map</span><span style=color:#c7bf54>&lt;</span><span style=color:#c1abea>String</span>, <span style=color:#c1abea>Object</span><span style=color:#c7bf54>&gt;</span> <span style=color:#c1abea>result</span> <span style=color:#c7bf54>=</span> <span style=color:#c678dd>new</span> <span style=color:#c1abea>LinkedHashMap</span><span style=color:#c7bf54>&lt;&gt;</span>();
</span></span><span style=display:flex><span>			<span style=color:#8a93a5;font-style:italic>// 获取 ConfigMap</span>
</span></span><span style=display:flex><span>			<span style=color:#c1abea>ConfigMap</span> <span style=color:#c1abea>map</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>StringUtils</span>.<span style=color:#b3d23c>isEmpty</span>(<span style=color:#c1abea>namespace</span>)
</span></span><span style=display:flex><span>				<span style=color:#c7bf54>?</span> <span style=color:#c1abea>client</span>.<span style=color:#b3d23c>configMaps</span>().<span style=color:#b3d23c>withName</span>(<span style=color:#c1abea>name</span>).<span style=color:#b3d23c>get</span>()
</span></span><span style=display:flex><span>				: <span style=color:#c1abea>client</span>.<span style=color:#b3d23c>configMaps</span>().<span style=color:#b3d23c>inNamespace</span>(<span style=color:#c1abea>namespace</span>).<span style=color:#b3d23c>withName</span>(<span style=color:#c1abea>name</span>).<span style=color:#b3d23c>get</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#8a93a5;font-style:italic>// 添加到map 中</span>
</span></span><span style=display:flex><span>			<span style=color:#c678dd>if</span> (<span style=color:#c1abea>map</span> <span style=color:#c7bf54>!=</span> <span style=color:#b756ff;font-weight:700>null</span>) {
</span></span><span style=display:flex><span>				<span style=color:#c1abea>result</span>.<span style=color:#b3d23c>putAll</span>(<span style=color:#c1abea>processAllEntries</span>(<span style=color:#c1abea>map</span>.<span style=color:#b3d23c>getData</span>(), <span style=color:#c1abea>environment</span>));
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#c678dd>if</span> (<span style=color:#c1abea>environment</span> <span style=color:#c7bf54>!=</span> <span style=color:#b756ff;font-weight:700>null</span>) {
</span></span><span style=display:flex><span>				<span style=color:#8a93a5;font-style:italic>// 根据 Profile 加载 ConfigMap</span>
</span></span><span style=display:flex><span>				<span style=color:#c678dd>for</span> (<span style=color:#c1abea>String</span> <span style=color:#c1abea>activeProfile</span> : <span style=color:#c1abea>environment</span>.<span style=color:#b3d23c>getActiveProfiles</span>()) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>					<span style=color:#c1abea>String</span> <span style=color:#c1abea>mapNameWithProfile</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>name</span> <span style=color:#c7bf54>+</span> <span style=color:#98c379>&#34;-&#34;</span> <span style=color:#c7bf54>+</span> <span style=color:#c1abea>activeProfile</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>					<span style=color:#c1abea>ConfigMap</span> <span style=color:#c1abea>mapWithProfile</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>StringUtils</span>.<span style=color:#b3d23c>isEmpty</span>(<span style=color:#c1abea>namespace</span>)
</span></span><span style=display:flex><span>						<span style=color:#c7bf54>?</span> <span style=color:#c1abea>client</span>.<span style=color:#b3d23c>configMaps</span>().<span style=color:#b3d23c>withName</span>(<span style=color:#c1abea>mapNameWithProfile</span>).<span style=color:#b3d23c>get</span>()
</span></span><span style=display:flex><span>						: <span style=color:#c1abea>client</span>.<span style=color:#b3d23c>configMaps</span>().<span style=color:#b3d23c>inNamespace</span>(<span style=color:#c1abea>namespace</span>)
</span></span><span style=display:flex><span>						        .<span style=color:#b3d23c>withName</span>(<span style=color:#c1abea>mapNameWithProfile</span>).<span style=color:#b3d23c>get</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>					<span style=color:#c678dd>if</span> (<span style=color:#c1abea>mapWithProfile</span> <span style=color:#c7bf54>!=</span> <span style=color:#b756ff;font-weight:700>null</span>) {
</span></span><span style=display:flex><span>						<span style=color:#c1abea>result</span>.<span style=color:#b3d23c>putAll</span>(
</span></span><span style=display:flex><span>							<span style=color:#c1abea>processAllEntries</span>(<span style=color:#c1abea>mapWithProfile</span>.<span style=color:#b3d23c>getData</span>(), <span style=color:#c1abea>environment</span>));
</span></span><span style=display:flex><span>					}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#c678dd>return</span> <span style=color:#c1abea>result</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		} <span style=color:#c678dd>catch</span> (<span style=color:#c1abea>Exception</span> <span style=color:#c1abea>e</span>) {
</span></span><span style=display:flex><span>			<span style=color:#c1abea>LOG</span>.<span style=color:#b3d23c>warn</span>(<span style=color:#98c379>&#34;Can&#39;t read configMap with name: [&#34;</span> <span style=color:#c7bf54>+</span> <span style=color:#c1abea>name</span> <span style=color:#c7bf54>+</span> <span style=color:#98c379>&#34;] in namespace:[&#34;</span>
</span></span><span style=display:flex><span>				<span style=color:#c7bf54>+</span> <span style=color:#c1abea>namespace</span> <span style=color:#c7bf54>+</span> <span style=color:#98c379>&#34;]. Ignoring.&#34;</span>, <span style=color:#c1abea>e</span>);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#c678dd>return</span> <span style=color:#c678dd>new</span> <span style=color:#c1abea>LinkedHashMap</span><span style=color:#c7bf54>&lt;&gt;</span>();
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><h4 id=secret>Secret</h4><ul><li>SecretsPropertySourceLocator#locate</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>	<span style=color:#e5c07b>@Override</span>
</span></span><span style=display:flex><span>	<span style=color:#c678dd>public</span> <span style=color:#c1abea>PropertySource</span> <span style=color:#00b1f7>locate</span>(<span style=color:#c1abea>Environment</span> <span style=color:#c1abea>environment</span>) {
</span></span><span style=display:flex><span>		<span style=color:#c678dd>if</span> (<span style=color:#c1abea>environment</span> <span style=color:#c678dd>instanceof</span> <span style=color:#c1abea>ConfigurableEnvironment</span>) {
</span></span><span style=display:flex><span>			<span style=color:#c1abea>ConfigurableEnvironment</span> <span style=color:#c1abea>env</span> <span style=color:#c7bf54>=</span> (<span style=color:#c1abea>ConfigurableEnvironment</span>) <span style=color:#c1abea>environment</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#c1abea>List</span><span style=color:#c7bf54>&lt;</span><span style=color:#c1abea>SecretsConfigProperties</span>.<span style=color:#b3d23c>NormalizedSource</span><span style=color:#c7bf54>&gt;</span> <span style=color:#c1abea>sources</span> <span style=color:#c7bf54>=</span> <span style=color:#c678dd>this</span>.<span style=color:#b3d23c>properties</span>.<span style=color:#b3d23c>determineSources</span>();
</span></span><span style=display:flex><span>			<span style=color:#c1abea>CompositePropertySource</span> <span style=color:#c1abea>composite</span> <span style=color:#c7bf54>=</span> <span style=color:#c678dd>new</span> <span style=color:#c1abea>CompositePropertySource</span>(<span style=color:#98c379>&#34;composite-secrets&#34;</span>);
</span></span><span style=display:flex><span>			<span style=color:#c678dd>if</span> (<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>properties</span>.<span style=color:#b3d23c>isEnableApi</span>()) {
</span></span><span style=display:flex><span>				<span style=color:#8a93a5;font-style:italic>// 获取Secret</span>
</span></span><span style=display:flex><span>				<span style=color:#c1abea>sources</span>.<span style=color:#b3d23c>forEach</span>(<span style=color:#c1abea>s</span> <span style=color:#c7bf54>-&gt;</span> <span style=color:#c1abea>composite</span>.<span style=color:#b3d23c>addFirstPropertySource</span>(
</span></span><span style=display:flex><span>					<span style=color:#c1abea>getKubernetesPropertySourceForSingleSecret</span>(<span style=color:#c1abea>env</span>, <span style=color:#c1abea>s</span>)));
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#8a93a5;font-style:italic>// read for secrets mount</span>
</span></span><span style=display:flex><span>			<span style=color:#8a93a5;font-style:italic>// 读取并加入到容器中</span>
</span></span><span style=display:flex><span>			<span style=color:#c1abea>putPathConfig</span>(<span style=color:#c1abea>composite</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#c678dd>return</span> <span style=color:#c1abea>composite</span>;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#c678dd>return</span> <span style=color:#b756ff;font-weight:700>null</span>;
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><ul><li>SecretsPropertySourceLocator#getKubernetesPropertySourceForSingleSecret</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>	<span style=color:#c678dd>private</span> <span style=color:#c1abea>MapPropertySource</span> <span style=color:#00b1f7>getKubernetesPropertySourceForSingleSecret</span>(
</span></span><span style=display:flex><span>		<span style=color:#c1abea>ConfigurableEnvironment</span> <span style=color:#c1abea>environment</span>,
</span></span><span style=display:flex><span>		<span style=color:#c1abea>SecretsConfigProperties</span>.<span style=color:#b3d23c>NormalizedSource</span> <span style=color:#c1abea>normalizedSource</span>) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#c1abea>String</span> <span style=color:#c1abea>configurationTarget</span> <span style=color:#c7bf54>=</span> <span style=color:#c678dd>this</span>.<span style=color:#b3d23c>properties</span>.<span style=color:#b3d23c>getConfigurationTarget</span>();
</span></span><span style=display:flex><span>		<span style=color:#8a93a5;font-style:italic>// 加载 Secret 属性 source</span>
</span></span><span style=display:flex><span>		<span style=color:#c678dd>return</span> <span style=color:#c678dd>new</span> <span style=color:#c1abea>SecretsPropertySource</span>(<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>client</span>,
</span></span><span style=display:flex><span>			<span style=color:#c1abea>environment</span>,
</span></span><span style=display:flex><span>			<span style=color:#c1abea>getApplicationName</span>(<span style=color:#c1abea>environment</span>, <span style=color:#c1abea>normalizedSource</span>.<span style=color:#b3d23c>getName</span>(), <span style=color:#c1abea>configurationTarget</span>),
</span></span><span style=display:flex><span>			<span style=color:#c1abea>getApplicationNamespace</span>(<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>client</span>, <span style=color:#c1abea>normalizedSource</span>.<span style=color:#b3d23c>getNamespace</span>(), <span style=color:#c1abea>configurationTarget</span>),
</span></span><span style=display:flex><span>			<span style=color:#c1abea>normalizedSource</span>.<span style=color:#b3d23c>getLabels</span>());
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><ul><li>SecretsPropertySource</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>	<span style=color:#c678dd>public</span> <span style=color:#00b1f7>SecretsPropertySource</span>(<span style=color:#c1abea>KubernetesClient</span> <span style=color:#c1abea>client</span>, <span style=color:#c1abea>Environment</span> <span style=color:#c1abea>env</span>, <span style=color:#c1abea>String</span> <span style=color:#c1abea>name</span>,
</span></span><span style=display:flex><span>	                             <span style=color:#c1abea>String</span> <span style=color:#c1abea>namespace</span>, <span style=color:#c1abea>Map</span><span style=color:#c7bf54>&lt;</span><span style=color:#c1abea>String</span>, <span style=color:#c1abea>String</span><span style=color:#c7bf54>&gt;</span> <span style=color:#c1abea>labels</span>) {
</span></span><span style=display:flex><span>		<span style=color:#c678dd>super</span>(<span style=color:#c1abea>getSourceName</span>(<span style=color:#c1abea>client</span>, <span style=color:#c1abea>env</span>, <span style=color:#c1abea>name</span>, <span style=color:#c1abea>namespace</span>),
</span></span><span style=display:flex><span>			<span style=color:#c1abea>getSourceData</span>(<span style=color:#c1abea>client</span>, <span style=color:#c1abea>env</span>, <span style=color:#c1abea>name</span>, <span style=color:#c1abea>namespace</span>, <span style=color:#c1abea>labels</span>));
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><ul><li>SecretsPropertySource#getSourceData</li></ul><p>获取 Secret 的流程和获取 ConfigMap 一样，不同的是 Secret 在放入环境中之前，需要先通过 Base64 解码</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>	<span style=color:#c678dd>private</span> <span style=color:#c678dd>static</span> <span style=color:#c1abea>Map</span><span style=color:#c7bf54>&lt;</span><span style=color:#c1abea>String</span>, <span style=color:#c1abea>Object</span><span style=color:#c7bf54>&gt;</span> <span style=color:#00b1f7>getSourceData</span>(<span style=color:#c1abea>KubernetesClient</span> <span style=color:#c1abea>client</span>,
</span></span><span style=display:flex><span>	                                                 <span style=color:#c1abea>Environment</span> <span style=color:#c1abea>env</span>, <span style=color:#c1abea>String</span> <span style=color:#c1abea>name</span>, <span style=color:#c1abea>String</span> <span style=color:#c1abea>namespace</span>, <span style=color:#c1abea>Map</span><span style=color:#c7bf54>&lt;</span><span style=color:#c1abea>String</span>, <span style=color:#c1abea>String</span><span style=color:#c7bf54>&gt;</span> <span style=color:#c1abea>labels</span>) {
</span></span><span style=display:flex><span>		<span style=color:#c1abea>Map</span><span style=color:#c7bf54>&lt;</span><span style=color:#c1abea>String</span>, <span style=color:#c1abea>Object</span><span style=color:#c7bf54>&gt;</span> <span style=color:#c1abea>result</span> <span style=color:#c7bf54>=</span> <span style=color:#c678dd>new</span> <span style=color:#c1abea>HashMap</span><span style=color:#c7bf54>&lt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#c678dd>try</span> {
</span></span><span style=display:flex><span>			<span style=color:#8a93a5;font-style:italic>// Read for secrets api (named)</span>
</span></span><span style=display:flex><span>			<span style=color:#8a93a5;font-style:italic>// 根据名称和命名空间获取 secret</span>
</span></span><span style=display:flex><span>			<span style=color:#c1abea>Secret</span> <span style=color:#c1abea>secret</span>;
</span></span><span style=display:flex><span>			<span style=color:#c678dd>if</span> (<span style=color:#c1abea>StringUtils</span>.<span style=color:#b3d23c>isEmpty</span>(<span style=color:#c1abea>namespace</span>)) {
</span></span><span style=display:flex><span>				<span style=color:#c1abea>secret</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>client</span>.<span style=color:#b3d23c>secrets</span>()
</span></span><span style=display:flex><span>				               .<span style=color:#b3d23c>withName</span>(<span style=color:#c1abea>name</span>)
</span></span><span style=display:flex><span>				               .<span style=color:#b3d23c>get</span>();
</span></span><span style=display:flex><span>			} <span style=color:#c678dd>else</span> {
</span></span><span style=display:flex><span>				<span style=color:#c1abea>secret</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>client</span>.<span style=color:#b3d23c>secrets</span>()
</span></span><span style=display:flex><span>				               .<span style=color:#b3d23c>inNamespace</span>(<span style=color:#c1abea>namespace</span>)
</span></span><span style=display:flex><span>				               .<span style=color:#b3d23c>withName</span>(<span style=color:#c1abea>name</span>)
</span></span><span style=display:flex><span>				               .<span style=color:#b3d23c>get</span>();
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#8a93a5;font-style:italic>// 解码</span>
</span></span><span style=display:flex><span>			<span style=color:#c1abea>putAll</span>(<span style=color:#c1abea>secret</span>, <span style=color:#c1abea>result</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#8a93a5;font-style:italic>// Read for secrets api (label)</span>
</span></span><span style=display:flex><span>			<span style=color:#8a93a5;font-style:italic>// 根据 label 读取 Secret</span>
</span></span><span style=display:flex><span>			<span style=color:#c678dd>if</span> (<span style=color:#c7bf54>!</span><span style=color:#c1abea>labels</span>.<span style=color:#b3d23c>isEmpty</span>()) {
</span></span><span style=display:flex><span>				<span style=color:#c678dd>if</span> (<span style=color:#c1abea>StringUtils</span>.<span style=color:#b3d23c>isEmpty</span>(<span style=color:#c1abea>namespace</span>)) {
</span></span><span style=display:flex><span>					<span style=color:#c1abea>client</span>.<span style=color:#b3d23c>secrets</span>()
</span></span><span style=display:flex><span>					      .<span style=color:#b3d23c>withLabels</span>(<span style=color:#c1abea>labels</span>)
</span></span><span style=display:flex><span>					      .<span style=color:#b3d23c>list</span>()
</span></span><span style=display:flex><span>					      .<span style=color:#b3d23c>getItems</span>()
</span></span><span style=display:flex><span>					      .<span style=color:#b3d23c>forEach</span>(<span style=color:#c1abea>s</span> <span style=color:#c7bf54>-&gt;</span> <span style=color:#c1abea>putAll</span>(<span style=color:#c1abea>s</span>, <span style=color:#c1abea>result</span>));
</span></span><span style=display:flex><span>				} <span style=color:#c678dd>else</span> {
</span></span><span style=display:flex><span>					<span style=color:#c1abea>client</span>.<span style=color:#b3d23c>secrets</span>()
</span></span><span style=display:flex><span>					      .<span style=color:#b3d23c>inNamespace</span>(<span style=color:#c1abea>namespace</span>)
</span></span><span style=display:flex><span>					      .<span style=color:#b3d23c>withLabels</span>(<span style=color:#c1abea>labels</span>)
</span></span><span style=display:flex><span>					      .<span style=color:#b3d23c>list</span>()
</span></span><span style=display:flex><span>					      .<span style=color:#b3d23c>getItems</span>()
</span></span><span style=display:flex><span>					      .<span style=color:#b3d23c>forEach</span>(<span style=color:#c1abea>s</span> <span style=color:#c7bf54>-&gt;</span> <span style=color:#c1abea>putAll</span>(<span style=color:#c1abea>s</span>, <span style=color:#c1abea>result</span>));
</span></span><span style=display:flex><span>				}
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		} <span style=color:#c678dd>catch</span> (<span style=color:#c1abea>Exception</span> <span style=color:#c1abea>e</span>) {
</span></span><span style=display:flex><span>			<span style=color:#c1abea>LOG</span>.<span style=color:#b3d23c>warn</span>(<span style=color:#98c379>&#34;Can&#39;t read secret with name: [&#34;</span> <span style=color:#c7bf54>+</span> <span style=color:#c1abea>name</span> <span style=color:#c7bf54>+</span> <span style=color:#98c379>&#34;] or labels [&#34;</span> <span style=color:#c7bf54>+</span> <span style=color:#c1abea>labels</span>
</span></span><span style=display:flex><span>				<span style=color:#c7bf54>+</span> <span style=color:#98c379>&#34;] in namespace:[&#34;</span> <span style=color:#c7bf54>+</span> <span style=color:#c1abea>namespace</span> <span style=color:#c7bf54>+</span> <span style=color:#98c379>&#34;] (cause: &#34;</span> <span style=color:#c7bf54>+</span> <span style=color:#c1abea>e</span>.<span style=color:#b3d23c>getMessage</span>()
</span></span><span style=display:flex><span>				<span style=color:#c7bf54>+</span> <span style=color:#98c379>&#34;). Ignoring&#34;</span>);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#c678dd>return</span> <span style=color:#c1abea>result</span>;
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><h2 id=监听配置>监听配置</h2><p>支持两种方式的监听配置，一种是通过和 Kubernetes 建立长连接，当配置发生变化时可以立即推送，另一种是通过长轮询的方式，通过定时任务来实现</p><p>配置的监听必须显式开启</p><h3 id=bean-初始化-1>Bean 初始化</h3><p>Bean 的初始化是在 <code>org.springframework.cloud.kubernetes.config.reload.ConfigReloadAutoConfiguration.ConfigReloadAutoConfigurationBeans</code> 中实现的</p><ul><li>监听配置变化</li></ul><p>根据配置选择是通过轮询还是监听事件方式实现，默认是监听事件</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>		<span style=color:#e5c07b>@Bean</span>
</span></span><span style=display:flex><span>		<span style=color:#e5c07b>@ConditionalOnMissingBean</span>
</span></span><span style=display:flex><span>		<span style=color:#c678dd>public</span> <span style=color:#c1abea>ConfigurationChangeDetector</span> <span style=color:#00b1f7>propertyChangeWatcher</span>(<span style=color:#c1abea>ConfigReloadProperties</span> <span style=color:#c1abea>properties</span>, <span style=color:#c1abea>ConfigurationUpdateStrategy</span> <span style=color:#c1abea>strategy</span>) {
</span></span><span style=display:flex><span>			<span style=color:#c678dd>switch</span> (<span style=color:#c1abea>properties</span>.<span style=color:#b3d23c>getMode</span>()) {
</span></span><span style=display:flex><span>				<span style=color:#c678dd>case</span> <span style=color:#c1abea>POLLING</span>:
</span></span><span style=display:flex><span>					<span style=color:#c678dd>return</span> <span style=color:#c678dd>new</span> <span style=color:#c1abea>PollingConfigurationChangeDetector</span>(<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>environment</span>,
</span></span><span style=display:flex><span>						<span style=color:#c1abea>properties</span>,
</span></span><span style=display:flex><span>						<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>kubernetesClient</span>,
</span></span><span style=display:flex><span>						<span style=color:#c1abea>strategy</span>,
</span></span><span style=display:flex><span>						<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>configMapPropertySourceLocator</span>,
</span></span><span style=display:flex><span>						<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>secretsPropertySourceLocator</span>);
</span></span><span style=display:flex><span>				<span style=color:#c678dd>case</span> <span style=color:#c1abea>EVENT</span>:
</span></span><span style=display:flex><span>					<span style=color:#c678dd>return</span> <span style=color:#c678dd>new</span> <span style=color:#c1abea>EventBasedConfigurationChangeDetector</span>(<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>environment</span>,
</span></span><span style=display:flex><span>						<span style=color:#c1abea>properties</span>,
</span></span><span style=display:flex><span>						<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>kubernetesClient</span>,
</span></span><span style=display:flex><span>						<span style=color:#c1abea>strategy</span>,
</span></span><span style=display:flex><span>						<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>configMapPropertySourceLocator</span>,
</span></span><span style=display:flex><span>						<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>secretsPropertySourceLocator</span>);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#c678dd>throw</span> <span style=color:#c678dd>new</span> <span style=color:#c1abea>IllegalStateException</span>(<span style=color:#98c379>&#34;Unsupported configuration reload mode: &#34;</span> <span style=color:#c7bf54>+</span> <span style=color:#c1abea>properties</span>.<span style=color:#b3d23c>getMode</span>());
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div><ul><li>配置更新策略</li></ul><p>配置更新支持三种策略，分别是重启，刷新，和关闭，关闭应用依赖于健康检查，当发现应用被关闭后需要通过 Kubernetes 主动拉起</p><p>默认策略是刷新上下文</p><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>		<span style=color:#e5c07b>@Bean</span>
</span></span><span style=display:flex><span>		<span style=color:#e5c07b>@ConditionalOnMissingBean</span>
</span></span><span style=display:flex><span>		<span style=color:#c678dd>public</span> <span style=color:#c1abea>ConfigurationUpdateStrategy</span> <span style=color:#00b1f7>configurationUpdateStrategy</span>(
</span></span><span style=display:flex><span>			<span style=color:#c1abea>ConfigReloadProperties</span> <span style=color:#c1abea>properties</span>,
</span></span><span style=display:flex><span>			<span style=color:#c1abea>ConfigurableApplicationContext</span> <span style=color:#c1abea>ctx</span>,
</span></span><span style=display:flex><span>			<span style=color:#e5c07b>@Autowired</span>(<span style=color:#c1abea>required</span> <span style=color:#c7bf54>=</span> <span style=color:#b756ff;font-weight:700>false</span>) <span style=color:#c1abea>RestartEndpoint</span> <span style=color:#c1abea>restarter</span>,
</span></span><span style=display:flex><span>			<span style=color:#c1abea>ContextRefresher</span> <span style=color:#c1abea>refresher</span>) {
</span></span><span style=display:flex><span>			<span style=color:#c678dd>switch</span> (<span style=color:#c1abea>properties</span>.<span style=color:#b3d23c>getStrategy</span>()) {
</span></span><span style=display:flex><span>				<span style=color:#8a93a5;font-style:italic>// 重启</span>
</span></span><span style=display:flex><span>				<span style=color:#c678dd>case</span> <span style=color:#c1abea>RESTART_CONTEXT</span>:
</span></span><span style=display:flex><span>					<span style=color:#c1abea>Assert</span>.<span style=color:#b3d23c>notNull</span>(<span style=color:#c1abea>restarter</span>, <span style=color:#98c379>&#34;Restart endpoint is not enabled&#34;</span>);
</span></span><span style=display:flex><span>					<span style=color:#c678dd>return</span> <span style=color:#c678dd>new</span> <span style=color:#c1abea>ConfigurationUpdateStrategy</span>(<span style=color:#c1abea>properties</span>.<span style=color:#b3d23c>getStrategy</span>().<span style=color:#b3d23c>name</span>(),
</span></span><span style=display:flex><span>						() <span style=color:#c7bf54>-&gt;</span> {
</span></span><span style=display:flex><span>							<span style=color:#c1abea>wait</span>(<span style=color:#c1abea>properties</span>);
</span></span><span style=display:flex><span>							<span style=color:#c1abea>restarter</span>.<span style=color:#b3d23c>restart</span>();
</span></span><span style=display:flex><span>						});
</span></span><span style=display:flex><span>				<span style=color:#8a93a5;font-style:italic>//	刷新</span>
</span></span><span style=display:flex><span>				<span style=color:#c678dd>case</span> <span style=color:#c1abea>REFRESH</span>:
</span></span><span style=display:flex><span>					<span style=color:#c678dd>return</span> <span style=color:#c678dd>new</span> <span style=color:#c1abea>ConfigurationUpdateStrategy</span>(<span style=color:#c1abea>properties</span>.<span style=color:#b3d23c>getStrategy</span>().<span style=color:#b3d23c>name</span>(),
</span></span><span style=display:flex><span>						<span style=color:#c1abea>refresher</span>::<span style=color:#c1abea>refresh</span>);
</span></span><span style=display:flex><span>				<span style=color:#8a93a5;font-style:italic>//	关闭</span>
</span></span><span style=display:flex><span>				<span style=color:#c678dd>case</span> <span style=color:#c1abea>SHUTDOWN</span>:
</span></span><span style=display:flex><span>					<span style=color:#c678dd>return</span> <span style=color:#c678dd>new</span> <span style=color:#c1abea>ConfigurationUpdateStrategy</span>(<span style=color:#c1abea>properties</span>.<span style=color:#b3d23c>getStrategy</span>().<span style=color:#b3d23c>name</span>(),
</span></span><span style=display:flex><span>						() <span style=color:#c7bf54>-&gt;</span> {
</span></span><span style=display:flex><span>							<span style=color:#c1abea>wait</span>(<span style=color:#c1abea>properties</span>);
</span></span><span style=display:flex><span>							<span style=color:#c1abea>ctx</span>.<span style=color:#b3d23c>close</span>();
</span></span><span style=display:flex><span>						});
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>			<span style=color:#c678dd>throw</span> <span style=color:#c678dd>new</span> <span style=color:#c1abea>IllegalStateException</span>(<span style=color:#98c379>&#34;Unsupported configuration update strategy: &#34;</span>
</span></span><span style=display:flex><span>				<span style=color:#c7bf54>+</span> <span style=color:#c1abea>properties</span>.<span style=color:#b3d23c>getStrategy</span>());
</span></span><span style=display:flex><span>		}
</span></span></code></pre></div><h3 id=监听实现>监听实现</h3><p><img src=https://img.hellowood.dev/picture/spring-cloud-kubernetes-configuration-change-detector.png alt=spring-cloud-kubernetes-configuration-change-detector.png></p><p><code>PollingConfigurationChangeDetector</code> 和 <code>EventBasedConfigurationChangeDetector</code> 都是 <code>ConfigurationChangeDetector</code>的子类</p><h4 id=polling>polling</h4><p>默认 15s 拉取一次配置</p><ul><li>PollingConfigurationChangeDetector#executeCycle</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>	<span style=color:#e5c07b>@Scheduled</span>(<span style=color:#c1abea>initialDelayString</span> <span style=color:#c7bf54>=</span> <span style=color:#98c379>&#34;${spring.cloud.kubernetes.reload.period:15000}&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#c1abea>fixedDelayString</span> <span style=color:#c7bf54>=</span> <span style=color:#98c379>&#34;${spring.cloud.kubernetes.reload.period:15000}&#34;</span>)
</span></span><span style=display:flex><span>	<span style=color:#c678dd>public</span> <span style=color:#ef8383>void</span> <span style=color:#00b1f7>executeCycle</span>() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#ef8383>boolean</span> <span style=color:#c1abea>changedConfigMap</span> <span style=color:#c7bf54>=</span> <span style=color:#b756ff;font-weight:700>false</span>;
</span></span><span style=display:flex><span>		<span style=color:#8a93a5;font-style:italic>// 监控 ConfigMap</span>
</span></span><span style=display:flex><span>		<span style=color:#c678dd>if</span> (<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>properties</span>.<span style=color:#b3d23c>isMonitoringConfigMaps</span>()) {
</span></span><span style=display:flex><span>			<span style=color:#c1abea>List</span><span style=color:#c7bf54>&lt;?</span> <span style=color:#c678dd>extends</span> <span style=color:#c1abea>MapPropertySource</span><span style=color:#c7bf54>&gt;</span> <span style=color:#c1abea>currentConfigMapSources</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>findPropertySources</span>(<span style=color:#c1abea>ConfigMapPropertySource</span>.<span style=color:#b3d23c>class</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#c678dd>if</span> (<span style=color:#c7bf54>!</span><span style=color:#c1abea>currentConfigMapSources</span>.<span style=color:#b3d23c>isEmpty</span>()) {
</span></span><span style=display:flex><span>				<span style=color:#c1abea>changedConfigMap</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>changed</span>(
</span></span><span style=display:flex><span>					<span style=color:#c1abea>locateMapPropertySources</span>(<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>configMapPropertySourceLocator</span>, <span style=color:#c678dd>this</span>.<span style=color:#b3d23c>environment</span>),
</span></span><span style=display:flex><span>					<span style=color:#c1abea>currentConfigMapSources</span>);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#ef8383>boolean</span> <span style=color:#c1abea>changedSecrets</span> <span style=color:#c7bf54>=</span> <span style=color:#b756ff;font-weight:700>false</span>;
</span></span><span style=display:flex><span>		<span style=color:#8a93a5;font-style:italic>//  监控 Secret</span>
</span></span><span style=display:flex><span>		<span style=color:#c678dd>if</span> (<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>properties</span>.<span style=color:#b3d23c>isMonitoringSecrets</span>()) {
</span></span><span style=display:flex><span>			<span style=color:#c1abea>List</span><span style=color:#c7bf54>&lt;</span><span style=color:#c1abea>MapPropertySource</span><span style=color:#c7bf54>&gt;</span> <span style=color:#c1abea>currentSecretSources</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>locateMapPropertySources</span>(<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>secretsPropertySourceLocator</span>, <span style=color:#c678dd>this</span>.<span style=color:#b3d23c>environment</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>			<span style=color:#c678dd>if</span> (<span style=color:#c1abea>currentSecretSources</span> <span style=color:#c7bf54>!=</span> <span style=color:#b756ff;font-weight:700>null</span> <span style=color:#c7bf54>&amp;&amp;</span> <span style=color:#c7bf54>!</span><span style=color:#c1abea>currentSecretSources</span>.<span style=color:#b3d23c>isEmpty</span>()) {
</span></span><span style=display:flex><span>				<span style=color:#c1abea>List</span><span style=color:#c7bf54>&lt;</span><span style=color:#c1abea>SecretsPropertySource</span><span style=color:#c7bf54>&gt;</span> <span style=color:#c1abea>propertySources</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>findPropertySources</span>(<span style=color:#c1abea>SecretsPropertySource</span>.<span style=color:#b3d23c>class</span>);
</span></span><span style=display:flex><span>				<span style=color:#c1abea>changedSecrets</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>changed</span>(<span style=color:#c1abea>currentSecretSources</span>, <span style=color:#c1abea>propertySources</span>);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#8a93a5;font-style:italic>// 当发生变化时，更新属性</span>
</span></span><span style=display:flex><span>		<span style=color:#c678dd>if</span> (<span style=color:#c1abea>changedConfigMap</span> <span style=color:#c7bf54>||</span> <span style=color:#c1abea>changedSecrets</span>) {
</span></span><span style=display:flex><span>			<span style=color:#c1abea>reloadProperties</span>();
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><p>拉取配置，通过调用<code>change</code>方法进行比较，判断是否发生变化，如果发生变化，则调用 <code>reloadProperties</code> 方法刷新</p><ul><li>ConfigurationChangeDetector#reloadProperties</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>	<span style=color:#c678dd>public</span> <span style=color:#ef8383>void</span> <span style=color:#00b1f7>reloadProperties</span>() {
</span></span><span style=display:flex><span>		<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>log</span>.<span style=color:#b3d23c>info</span>(<span style=color:#98c379>&#34;Reloading using strategy: &#34;</span> <span style=color:#c7bf54>+</span> <span style=color:#c678dd>this</span>.<span style=color:#b3d23c>strategy</span>.<span style=color:#b3d23c>getName</span>());
</span></span><span style=display:flex><span>		<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>strategy</span>.<span style=color:#b3d23c>reload</span>();
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><p>最终调用配置策略的 reload 方法，重新加载配置，需要注意的是，要被刷新的属性类应当通过 <code>@RefreshScope</code>或 <code>@ConfigurationProperties</code>注解修饰，这样才能监听到上下文的变化</p><h4 id=event>Event</h4><ul><li>EventBasedConfigurationChangeDetector#watch</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>	<span style=color:#e5c07b>@PostConstruct</span>
</span></span><span style=display:flex><span>	<span style=color:#c678dd>public</span> <span style=color:#ef8383>void</span> <span style=color:#00b1f7>watch</span>() {
</span></span><span style=display:flex><span>		<span style=color:#ef8383>boolean</span> <span style=color:#c1abea>activated</span> <span style=color:#c7bf54>=</span> <span style=color:#b756ff;font-weight:700>false</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#8a93a5;font-style:italic>// 如果监控 ConfigMap</span>
</span></span><span style=display:flex><span>		<span style=color:#c678dd>if</span> (<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>properties</span>.<span style=color:#b3d23c>isMonitoringConfigMaps</span>()) {
</span></span><span style=display:flex><span>			<span style=color:#c678dd>try</span> {
</span></span><span style=display:flex><span>				<span style=color:#c1abea>String</span> <span style=color:#c1abea>name</span> <span style=color:#c7bf54>=</span> <span style=color:#98c379>&#34;config-maps-watch&#34;</span>;
</span></span><span style=display:flex><span>				<span style=color:#8a93a5;font-style:italic>// Watch 是通过 WebSocket 实现的</span>
</span></span><span style=display:flex><span>				<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>watches</span>.<span style=color:#b3d23c>put</span>(<span style=color:#c1abea>name</span>, <span style=color:#c678dd>this</span>.<span style=color:#b3d23c>kubernetesClient</span>.<span style=color:#b3d23c>configMaps</span>()
</span></span><span style=display:flex><span>				                                            .<span style=color:#b3d23c>watch</span>(<span style=color:#c678dd>new</span> <span style=color:#c1abea>Watcher</span><span style=color:#c7bf54>&lt;</span><span style=color:#c1abea>ConfigMap</span><span style=color:#c7bf54>&gt;</span>() {
</span></span><span style=display:flex><span>					                                            <span style=color:#e5c07b>@Override</span>
</span></span><span style=display:flex><span>					                                            <span style=color:#c678dd>public</span> <span style=color:#ef8383>void</span> <span style=color:#00b1f7>eventReceived</span>(<span style=color:#c1abea>Action</span> <span style=color:#c1abea>action</span>,
</span></span><span style=display:flex><span>					                                                                      <span style=color:#c1abea>ConfigMap</span> <span style=color:#c1abea>configMap</span>) {
</span></span><span style=display:flex><span>						                                            <span style=color:#c1abea>onEvent</span>(<span style=color:#c1abea>configMap</span>);
</span></span><span style=display:flex><span>					                                            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>					                                            <span style=color:#e5c07b>@Override</span>
</span></span><span style=display:flex><span>					                                            <span style=color:#c678dd>public</span> <span style=color:#ef8383>void</span> <span style=color:#00b1f7>onClose</span>(<span style=color:#c1abea>KubernetesClientException</span> <span style=color:#c1abea>e</span>) {
</span></span><span style=display:flex><span>					                                            }
</span></span><span style=display:flex><span>				                                            }));
</span></span><span style=display:flex><span>				<span style=color:#c1abea>activated</span> <span style=color:#c7bf54>=</span> <span style=color:#b756ff;font-weight:700>true</span>;
</span></span><span style=display:flex><span>				<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>log</span>.<span style=color:#b3d23c>info</span>(<span style=color:#98c379>&#34;Added new Kubernetes watch: &#34;</span> <span style=color:#c7bf54>+</span> <span style=color:#c1abea>name</span>);
</span></span><span style=display:flex><span>			} <span style=color:#c678dd>catch</span> (<span style=color:#c1abea>Exception</span> <span style=color:#c1abea>e</span>) {
</span></span><span style=display:flex><span>				<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>log</span>.<span style=color:#b3d23c>error</span>(
</span></span><span style=display:flex><span>					<span style=color:#98c379>&#34;Error while establishing a connection to watch config maps: configuration may remain stale&#34;</span>,
</span></span><span style=display:flex><span>					<span style=color:#c1abea>e</span>);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#8a93a5;font-style:italic>// 如果监控 Secret</span>
</span></span><span style=display:flex><span>		<span style=color:#c678dd>if</span> (<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>properties</span>.<span style=color:#b3d23c>isMonitoringSecrets</span>()) {
</span></span><span style=display:flex><span>			<span style=color:#c678dd>try</span> {
</span></span><span style=display:flex><span>				<span style=color:#c1abea>activated</span> <span style=color:#c7bf54>=</span> <span style=color:#b756ff;font-weight:700>false</span>;
</span></span><span style=display:flex><span>				<span style=color:#c1abea>String</span> <span style=color:#c1abea>name</span> <span style=color:#c7bf54>=</span> <span style=color:#98c379>&#34;secrets-watch&#34;</span>;
</span></span><span style=display:flex><span>				<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>watches</span>.<span style=color:#b3d23c>put</span>(<span style=color:#c1abea>name</span>,
</span></span><span style=display:flex><span>					<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>kubernetesClient</span>.<span style=color:#b3d23c>secrets</span>().<span style=color:#b3d23c>watch</span>(<span style=color:#c678dd>new</span> <span style=color:#c1abea>Watcher</span><span style=color:#c7bf54>&lt;</span><span style=color:#c1abea>Secret</span><span style=color:#c7bf54>&gt;</span>() {
</span></span><span style=display:flex><span>						<span style=color:#e5c07b>@Override</span>
</span></span><span style=display:flex><span>						<span style=color:#c678dd>public</span> <span style=color:#ef8383>void</span> <span style=color:#00b1f7>eventReceived</span>(<span style=color:#c1abea>Action</span> <span style=color:#c1abea>action</span>, <span style=color:#c1abea>Secret</span> <span style=color:#c1abea>secret</span>) {
</span></span><span style=display:flex><span>							<span style=color:#c1abea>onEvent</span>(<span style=color:#c1abea>secret</span>);
</span></span><span style=display:flex><span>						}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>						<span style=color:#e5c07b>@Override</span>
</span></span><span style=display:flex><span>						<span style=color:#c678dd>public</span> <span style=color:#ef8383>void</span> <span style=color:#00b1f7>onClose</span>(<span style=color:#c1abea>KubernetesClientException</span> <span style=color:#c1abea>e</span>) {
</span></span><span style=display:flex><span>						}
</span></span><span style=display:flex><span>					}));
</span></span><span style=display:flex><span>				<span style=color:#c1abea>activated</span> <span style=color:#c7bf54>=</span> <span style=color:#b756ff;font-weight:700>true</span>;
</span></span><span style=display:flex><span>				<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>log</span>.<span style=color:#b3d23c>info</span>(<span style=color:#98c379>&#34;Added new Kubernetes watch: &#34;</span> <span style=color:#c7bf54>+</span> <span style=color:#c1abea>name</span>);
</span></span><span style=display:flex><span>			} <span style=color:#c678dd>catch</span> (<span style=color:#c1abea>Exception</span> <span style=color:#c1abea>e</span>) {
</span></span><span style=display:flex><span>				<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>log</span>.<span style=color:#b3d23c>error</span>(
</span></span><span style=display:flex><span>					<span style=color:#98c379>&#34;Error while establishing a connection to watch secrets: configuration may remain stale&#34;</span>,
</span></span><span style=display:flex><span>					<span style=color:#c1abea>e</span>);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#c678dd>if</span> (<span style=color:#c1abea>activated</span>) {
</span></span><span style=display:flex><span>			<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>log</span>.<span style=color:#b3d23c>info</span>(
</span></span><span style=display:flex><span>				<span style=color:#98c379>&#34;Kubernetes event-based configuration change detector activated&#34;</span>);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><p>当收到消息时，将会调用 <code>onEvent</code>方法处理事件</p><ul><li>EventBasedConfigurationChangeDetector#onEvent</li></ul><div class=highlight><pre tabindex=0 style=color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>	<span style=color:#c678dd>private</span> <span style=color:#ef8383>void</span> <span style=color:#00b1f7>onEvent</span>(<span style=color:#c1abea>ConfigMap</span> <span style=color:#c1abea>configMap</span>) {
</span></span><span style=display:flex><span>		<span style=color:#8a93a5;font-style:italic>// 加载配置，检测是否变化</span>
</span></span><span style=display:flex><span>		<span style=color:#ef8383>boolean</span> <span style=color:#c1abea>changed</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>changed</span>(
</span></span><span style=display:flex><span>			<span style=color:#c1abea>locateMapPropertySources</span>(<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>configMapPropertySourceLocator</span>, <span style=color:#c678dd>this</span>.<span style=color:#b3d23c>environment</span>),
</span></span><span style=display:flex><span>			<span style=color:#c1abea>findPropertySources</span>(<span style=color:#c1abea>ConfigMapPropertySource</span>.<span style=color:#b3d23c>class</span>)
</span></span><span style=display:flex><span>		);
</span></span><span style=display:flex><span>		<span style=color:#8a93a5;font-style:italic>// 如果变化了，则重新加载属性</span>
</span></span><span style=display:flex><span>		<span style=color:#c678dd>if</span> (<span style=color:#c1abea>changed</span>) {
</span></span><span style=display:flex><span>			<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>log</span>.<span style=color:#b3d23c>info</span>(<span style=color:#98c379>&#34;Detected change in config maps&#34;</span>);
</span></span><span style=display:flex><span>			<span style=color:#c1abea>reloadProperties</span>();
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#c678dd>private</span> <span style=color:#ef8383>void</span> <span style=color:#00b1f7>onEvent</span>(<span style=color:#c1abea>Secret</span> <span style=color:#c1abea>secret</span>) {
</span></span><span style=display:flex><span>		<span style=color:#ef8383>boolean</span> <span style=color:#c1abea>changed</span> <span style=color:#c7bf54>=</span> <span style=color:#c1abea>changed</span>(
</span></span><span style=display:flex><span>			<span style=color:#c1abea>locateMapPropertySources</span>(<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>secretsPropertySourceLocator</span>, <span style=color:#c678dd>this</span>.<span style=color:#b3d23c>environment</span>),
</span></span><span style=display:flex><span>			<span style=color:#c1abea>findPropertySources</span>(<span style=color:#c1abea>SecretsPropertySource</span>.<span style=color:#b3d23c>class</span>));
</span></span><span style=display:flex><span>		<span style=color:#c678dd>if</span> (<span style=color:#c1abea>changed</span>) {
</span></span><span style=display:flex><span>			<span style=color:#c678dd>this</span>.<span style=color:#b3d23c>log</span>.<span style=color:#b3d23c>info</span>(<span style=color:#98c379>&#34;Detected change in secrets&#34;</span>);
</span></span><span style=display:flex><span>			<span style=color:#c1abea>reloadProperties</span>();
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><p>重新加载配置，当发现配置发生变化时会调用 <code>reloadProperties</code>方法更新配置</p></div><div class=prev-next></div><svg id="btt-button" class="arrow-logo" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script><div id=comments><script src=https://utteranc.es/client.js repo=helloworlde/helloworlde.github.io issue-term=title theme=github-light crossorigin=anonymous async></script></div></div></main><footer class=footer><span>&copy; 2024 hellowood.dev</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a></span></footer></body></html>