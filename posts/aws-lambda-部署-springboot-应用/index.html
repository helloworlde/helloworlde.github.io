<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>AWS Lambda 部署 SpringBoot 应用</title><meta charset=utf-8><meta name=description content="Ladder@AWS Lambda 部署 SpringBoot 应用 配置 AWS CLI 和 Severless AWS CLI 和 Serverless 都可以用于部署 Serverless 应用
获取密钥 登录 AWS， 在服务中搜索并选择 IAM，之后选择用户，添加用户 输入用户名，选择编程访问 选择权限-直接附加现有策略，搜索AdministratorAccess并选中(有最高权限) 选择下一步直到完成，然后保存好密钥(只会出现这一次，否则就只能重新创建) 安装配置 AWS CLI 安装 参考 AWS 命令行界面 安装
Win 下载 https://s3.amazonaws.com/aws-cli/AWSCLI64.msi 安装 Mac/Linux 执行 pip install awscli 配置 AWS CLI aws configure 然后输入刚才的密钥的 Key 和 Secret，Region 可以选择常用的 region，如us-east-1
安装配置 Severless 安装 npm install -g serverless 或 yarn global add serverless 配置 serverless config credentials --provider aws --key YOUR_KEY --secret YOUR_SECRET 安装配置 AWS SAM Local aws-sam-local 是用于本地调试 Serverless 应用的工具"><meta name=author content="HelloWood"><link rel=canonical href=https://blog.hellowood.dev/posts/aws-lambda-%E9%83%A8%E7%BD%B2-springboot-%E5%BA%94%E7%94%A8/><meta name=google-site-verification content="G-3MSGPYTHPZ"><link rel=alternate type=application/rss+xml href=https://blog.hellowood.dev/index.xml title=HelloWood><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ",{anonymize_ip:!1})}</script><script async defer data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301 src=https://umami.hellowood.dev/script.js></script>
<script defer data-cf-beacon='{"token": "b2e481d136dc428c8c96c8673e2a04cf"}' src=https://static.cloudflareinsights.com/beacon.min.js></script><meta property="og:title" content="AWS Lambda 部署 SpringBoot 应用"><meta property="og:description" content="AWS Lambda 部署 SpringBoot 应用 配置 AWS CLI 和 Severless AWS CLI 和 Serverless 都可以用于部署 Serverless 应用
获取密钥 登录 AWS， 在服务中搜索并选择 IAM，之后选择用户，添加用户 输入用户名，选择编程访问 选择权限-直接附加现有策略，搜索AdministratorAccess并选中(有最高权限) 选择下一步直到完成，然后保存好密钥(只会出现这一次，否则就只能重新创建) 安装配置 AWS CLI 安装 参考 AWS 命令行界面 安装
Win 下载 https://s3.amazonaws.com/aws-cli/AWSCLI64.msi 安装 Mac/Linux 执行 pip install awscli 配置 AWS CLI aws configure 然后输入刚才的密钥的 Key 和 Secret，Region 可以选择常用的 region，如us-east-1
安装配置 Severless 安装 npm install -g serverless 或 yarn global add serverless 配置 serverless config credentials --provider aws --key YOUR_KEY --secret YOUR_SECRET 安装配置 AWS SAM Local aws-sam-local 是用于本地调试 Serverless 应用的工具"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.hellowood.dev/posts/aws-lambda-%E9%83%A8%E7%BD%B2-springboot-%E5%BA%94%E7%94%A8/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-05-06T11:36:14+00:00"><meta property="article:modified_time" content="2019-05-06T11:36:14+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="AWS Lambda 部署 SpringBoot 应用"><meta name=twitter:description content="AWS Lambda 部署 SpringBoot 应用 配置 AWS CLI 和 Severless AWS CLI 和 Serverless 都可以用于部署 Serverless 应用
获取密钥 登录 AWS， 在服务中搜索并选择 IAM，之后选择用户，添加用户 输入用户名，选择编程访问 选择权限-直接附加现有策略，搜索AdministratorAccess并选中(有最高权限) 选择下一步直到完成，然后保存好密钥(只会出现这一次，否则就只能重新创建) 安装配置 AWS CLI 安装 参考 AWS 命令行界面 安装
Win 下载 https://s3.amazonaws.com/aws-cli/AWSCLI64.msi 安装 Mac/Linux 执行 pip install awscli 配置 AWS CLI aws configure 然后输入刚才的密钥的 Key 和 Secret，Region 可以选择常用的 region，如us-east-1
安装配置 Severless 安装 npm install -g serverless 或 yarn global add serverless 配置 serverless config credentials --provider aws --key YOUR_KEY --secret YOUR_SECRET 安装配置 AWS SAM Local aws-sam-local 是用于本地调试 Serverless 应用的工具"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://blog.hellowood.dev/posts/"},{"@type":"ListItem","position":3,"name":"AWS Lambda 部署 SpringBoot 应用","item":"https://blog.hellowood.dev/posts/aws-lambda-%E9%83%A8%E7%BD%B2-springboot-%E5%BA%94%E7%94%A8/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"AWS Lambda 部署 SpringBoot 应用","name":"AWS Lambda 部署 SpringBoot 应用","description":"AWS Lambda 部署 SpringBoot 应用 配置 AWS CLI 和 Severless AWS CLI 和 Serverless 都可以用于部署 Serverless 应用\n获取密钥 登录 AWS， 在服务中搜索并选择 IAM，之后选择用户，添加用户 输入用户名，选择编程访问 选择权限-直接附加现有策略，搜索AdministratorAccess并选中(有最高权限) 选择下一步直到完成，然后保存好密钥(只会出现这一次，否则就只能重新创建) 安装配置 AWS CLI 安装 参考 AWS 命令行界面 安装\nWin 下载 https://s3.amazonaws.com/aws-cli/AWSCLI64.msi 安装 Mac/Linux 执行 pip install awscli 配置 AWS CLI aws configure 然后输入刚才的密钥的 Key 和 Secret，Region 可以选择常用的 region，如us-east-1\n安装配置 Severless 安装 npm install -g serverless 或 yarn global add serverless 配置 serverless config credentials --provider aws --key YOUR_KEY --secret YOUR_SECRET 安装配置 AWS SAM Local aws-sam-local 是用于本地调试 Serverless 应用的工具","keywords":["Serverless","SpringBoot","Lambda","AWS"],"articleBody":"AWS Lambda 部署 SpringBoot 应用 配置 AWS CLI 和 Severless AWS CLI 和 Serverless 都可以用于部署 Serverless 应用\n获取密钥 登录 AWS， 在服务中搜索并选择 IAM，之后选择用户，添加用户 输入用户名，选择编程访问 选择权限-直接附加现有策略，搜索AdministratorAccess并选中(有最高权限) 选择下一步直到完成，然后保存好密钥(只会出现这一次，否则就只能重新创建) 安装配置 AWS CLI 安装 参考 AWS 命令行界面 安装\nWin 下载 https://s3.amazonaws.com/aws-cli/AWSCLI64.msi 安装 Mac/Linux 执行 pip install awscli 配置 AWS CLI aws configure 然后输入刚才的密钥的 Key 和 Secret，Region 可以选择常用的 region，如us-east-1\n安装配置 Severless 安装 npm install -g serverless 或 yarn global add serverless 配置 serverless config credentials --provider aws --key YOUR_KEY --secret YOUR_SECRET 安装配置 AWS SAM Local aws-sam-local 是用于本地调试 Serverless 应用的工具\n安装 npm install -g aws-sam-local 或 yarn global add aws-sam-local 创建 Spring Boot 应用 通过 Maven 插件快速生成 mvn archetype:generate \\ -DgroupId=io.github.helloworlde \\ -DartifactId=serverless-spring-boot \\ -Dversion=1.0-SNAPSHOT \\ -DarchetypeGroupId=com.amazonaws.serverless.archetypes \\ -DarchetypeArtifactId=aws-serverless-springboot2-archetype \\ -DarchetypeVersion=1.3.1 项目文件 . ├── README.md ├── build.gradle ├── pom.xml ├── sam.yaml └── src ├── assembly │ └── bin.xml ├── main │ ├── java │ │ └── io │ │ └── github │ │ └── helloworlde │ │ ├── Application.java │ │ ├── StreamLambdaHandler.java │ │ └── controller │ │ └── PingController.java │ └── resources │ └── application.properties └── test └── java └── io └── github └── helloworlde └── StreamLambdaHandlerTest.java 手动创建 创建 SpringBoot 应用 修改 build.gradle buildscript { ext { springBootVersion = '2.1.1.RELEASE' } repositories { mavenCentral() } dependencies { classpath(\"org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}\") } } apply plugin: 'java' apply plugin: 'org.springframework.boot' apply plugin: 'io.spring.dependency-management' archivesBaseName = 'serverless-spring-boot' group = 'io.github.helloworlde' version = '0.0.1-SNAPSHOT' sourceCompatibility = 1.8 repositories { jcenter() mavenLocal() mavenCentral() } dependencies { compile( 'org.springframework.boot:spring-boot-starter-web', 'com.amazonaws.serverless:aws-serverless-java-container-spring:[1.0,)', 'io.symphonia:lambda-logging:1.0.1' ) testCompile(\"junit:junit:4.12\") } task buildZip(type: Zip) { from compileJava from processResources into('lib') { from(configurations.compileClasspath) { exclude 'tomcat-embed-*' } } } build.dependsOn buildZip 添加 PingController.java package io.github.helloworlde.controller; import org.springframework.web.bind.annotation.*; import org.springframework.web.servlet.config.annotation.EnableWebMvc; import java.util.HashMap; import java.util.Map; @RestController @EnableWebMvc public class PingController { @RequestMapping(path = \"/ping\", method = RequestMethod.GET) public Map\u003cString, String\u003e ping() { Map\u003cString, String\u003e pong = new HashMap\u003c\u003e(); pong.put(\"pong\", \"Hello, World!\"); return pong; } } 添加 StreamLamdbaHandler.java StreamLamdbaHandler 相当于一个代理层，将访问 Lambda 的流量转发给 SpringBoot应用；handleRequest方法每次请求都会被调用\npackage io.github.helloworlde; import com.amazonaws.serverless.exceptions.ContainerInitializationException; import com.amazonaws.serverless.proxy.model.AwsProxyRequest; import com.amazonaws.serverless.proxy.model.AwsProxyResponse; import com.amazonaws.serverless.proxy.spring.SpringBootLambdaContainerHandler; import com.amazonaws.services.lambda.runtime.Context; import com.amazonaws.services.lambda.runtime.RequestStreamHandler; import java.io.IOException; import java.io.InputStream; import java.io.OutputStream; public class StreamLambdaHandler implements RequestStreamHandler { private static SpringBootLambdaContainerHandler\u003cAwsProxyRequest, AwsProxyResponse\u003e handler; static { try { handler = SpringBootLambdaContainerHandler.getAwsProxyHandler(Application.class); } catch (ContainerInitializationException e) { // if we fail here. We re-throw the exception to force another cold start e.printStackTrace(); throw new RuntimeException(\"Could not initialize Spring Boot application\", e); } } @Override public void handleRequest(InputStream inputStream, OutputStream outputStream, Context context) throws IOException { handler.proxyStream(inputStream, outputStream, context); } } 添加 sam.yaml sam 用于本地测试Serverless 应用，依赖于 Python 和 Docker\n需要注意的是，Resources.ServerlessSpringBootFunction.Properties.CodeUri这个路径需要根据使用 Gradle 或 Maven 进行修改\nAWSTemplateFormatVersion: '2010-09-09' Transform: AWS::Serverless-2016-10-31 Description: AWS Serverless Spring Boot 2 API - io.github.helloworlde::serverless-spring-boot Globals: Api: EndpointConfiguration: REGIONAL Resources: ServerlessSpringBootFunction: Type: AWS::Serverless::Function Properties: Handler: io.github.helloworlde.StreamLambdaHandler::handleRequest Runtime: java8 CodeUri: build/distributions/serverless-spring-boot.zip MemorySize: 512 Policies: AWSLambdaBasicExecutionRole Timeout: 30 Events: GetResource: Type: Api Properties: Path: /{proxy+} Method: any Outputs: ServerlessSpringBootApi: Description: URL for application Value: !Sub 'https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/ping' Export: Name: ServerlessSpringBootApi 测试 编译生成 zip gradle clean build 测试应用接口 启动应用 访问 http://localhost:8080/ping，应当返回结果： { \"pong\": \"Hello, World!\" } 使用 SAM 测试 sam local start-api --template sam.yaml curl -s http://127.0.0.1:3000/ping 将会看到输出结果：\n{\"pong\":\"Hello, World!\"}% 部署 Serverless 部署 在项目根路径中添加 serverless.yml 配置 service: spring-boot-serverless provider: name: aws runtime: java8 package: artifact: build/distributions/serverless-spring-boot.zip functions: springBootServerless: handler: io.github.helloworlde.StreamLambdaHandler::handleRequest events: - http: path: /ping method: get timeout: 30 发布 sls deploy 日志：\nsls deploy Serverless: Packaging service... Serverless: Uploading CloudFormation file to S3... Serverless: Uploading artifacts... Serverless: Uploading service serverless-spring-boot.zip file to S3 (12.73 MB)... Serverless: Validating template... Serverless: Updating Stack... Serverless: Checking Stack update progress... .............. Serverless: Stack update finished... Service Information service: spring-boot-serverless stage: dev region: us-east-1 stack: spring-boot-serverless-dev resources: 10 api keys: None endpoints: GET - https://cmu9z3fmd1.execute-api.us-east-1.amazonaws.com/dev/ping functions: springBootServerless: spring-boot-serverless-dev-springBootServerless layers: None 访问 访问 https://cmu9z3fmd1.execute-api.us-east-1.amazonaws.com/dev/ping\n{ \"pong\": \"Hello, World!\" } 使用 AWS CLI 发布 上传到 S3 上传到 S3 时需要有一个 Bucket 存在，可以在 AWS 服务-S3 中创建\n创建 Bucket aws s3 mb s3://spring-boot-serverless --region us-east-1 上传应用 aws cloudformation package --template-file sam.yaml --output-template-file output-sam.yaml --s3-bucket spring-boot-serverless 这个命令执行之后会在项目根目录下生成一个 output-sam.yaml\n输出\nUploading to e793ef8960075db672fce0a8ac65f03b 13353411 / 13353411.0 (100.00%) Successfully packaged artifacts and wrote output template to file output-sam.yaml. Execute the following command to deploy the packaged template aws cloudformation deploy --template-file /Users/HelloWood/Dev/Projects/Serverless/serverless-spring-boot/output-sam.yaml --stack-name spring-boot-serverless 部署 aws cloudformation deploy --template-file /Users/HelloWood/Dev/Projects/Serverless/serverless-spring-boot/output-sam.yaml --stack-name spring-boot-serverless-demo --capabilities CAPABILITY_IAM 需要注意的是 --capabilities CAPABILITY_IAM会创建一个新的角色，会使用 AWSLambdaBasicExecutionRole，该策略仅允许该角色访问 Lambda 相关的资源，也可以使用 CAPABILITY_AUTO_EXPAND或CAPABILITY_NAMED_IAM使用已有的角色；创建后的角色可以在 AWS IAM 的角色下面管理\n测试 获取应用信息 aws cloudformation describe-stacks --stack-name spring-boot-serverless-demo { \"Stacks\": [ { \"StackId\": \"arn:aws:cloudformation:us-east-1:266545579784:stack/spring-boot-serverless-demo/1074b6a0-6f97-11e9-835b-0e348661d726\", \"StackName\": \"spring-boot-serverless-demo\", \"ChangeSetId\": \"arn:aws:cloudformation:us-east-1:266545579784:changeSet/awscli-cloudformation-package-deploy-1557103210/fe06fc3b-a353-4d42-814a-4e4f736a2026\", \"Description\": \"AWS Serverless Spring Boot 2 API - io.github.helloworlde::serverless-spring-boot\", \"CreationTime\": \"2019-05-06T00:37:01.857Z\", \"LastUpdatedTime\": \"2019-05-06T00:40:17.502Z\", \"RollbackConfiguration\": {}, \"StackStatus\": \"CREATE_COMPLETE\", \"DisableRollback\": false, \"NotificationARNs\": [], \"Capabilities\": [ \"CAPABILITY_IAM\" ], \"Outputs\": [ { \"OutputKey\": \"ServerlessSpringBootApi\", \"OutputValue\": \"https://gf2c9fhhql.execute-api.us-east-1.amazonaws.com/Prod/ping\", \"Description\": \"URL for application\", \"ExportName\": \"ServerlessSpringBootApi\" } ], \"Tags\": [], \"EnableTerminationProtection\": false, \"DriftInformation\": { \"StackDriftStatus\": \"NOT_CHECKED\" } } ] } 访问 OutputValue 的 URL curl https://gf2c9fhhql.execute-api.us-east-1.amazonaws.com/Prod/ping {\"pong\":\"Hello, World!\"}% 页面手动部署 创建函数 选择服务 - Lambda - 函数 - 创建函数 - 从头开始创作 权限可以选择现有的角色或者新建角色 添加触发器，选择 API-Gateway 作为触发器，然后保存 点击Layers 的 Spring 应用，上传 zip，在 build/或target/下；运行语言选择 Java8，处理程序为io.github.helloworlde.StreamLambdaHandler::handleRequest，点击保存 测试 选择配置测试事件 - 创建新测试事件 - 选择 AWS API Gateway AWS Proxy，修改相关的path和httpMethod Gateway 的 URL 可以点击 API Gateway查看 项目地址 https://github.com/helloworlde/serverless-spring-boot\n参考文章 A complete guide for running Spring Boot MVC in the cloud using AWS Lambda 使用 Java 构建 Lambda 函数 Installing the AWS SAM CLI on macOS Installing the AWS SAM CLI Key Tasks for the AWS Toolkit for JetBrains 如何看待 AWS Lambda aws-serverless-java-container Quick start Spring Boot ","wordCount":"850","inLanguage":"en","datePublished":"2019-05-06T11:36:14Z","dateModified":"2019-05-06T11:36:14Z","author":{"@type":"Person","name":"HelloWood"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.hellowood.dev/posts/aws-lambda-%E9%83%A8%E7%BD%B2-springboot-%E5%BA%94%E7%94%A8/"},"publisher":{"@type":"Organization","name":"HelloWood","logo":{"@type":"ImageObject","url":"https://blog.hellowood.dev/favicon.ico"}}}</script><link rel=icon href=/images/avatar.png sizes=16x16><link rel=apple-touch-icon href=/images/avatar.png><link rel=manifest href=/images/avatar.png><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.ff1bc260fafbfb440e10194d7d06d57eb5e85eed11d12d06255581262664204e.css integrity="sha256-/xvCYPr7+0QOEBlNfQbVfrXoXu0R0S0GJVWBJiZkIE4=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.872dfd2cd00064018a833a6e8e77a0fbf8fbac159546f2f205d4dad79a5d8e15.js></script>
<script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand data-umami-event=navigation-brand href=/>HOME</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Blog href=/posts>Blog</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Tags href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Archive href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link data-umami-event=Dashboard href=https://umami.hellowood.dev/share/lab/Blog>Dashboard</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link data-umami-event=navigation-social href=https://github.com/helloworlde><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button data-umami-event=toggle-theme aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>AWS Lambda 部署 SpringBoot 应用</h1></header><p><small>May 6, 2019&nbsp;· 850 words&nbsp;· 4 min</small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#配置-aws-cli-和--severless>配置 AWS CLI 和 Severless</a><ul><li><a href=#获取密钥>获取密钥</a></li><li><a href=#安装配置-aws-cli>安装配置 AWS CLI</a></li><li><a href=#安装配置-severless>安装配置 Severless</a></li><li><a href=#安装配置-aws-sam-local>安装配置 AWS SAM Local</a></li></ul></li><li><a href=#创建-spring-boot-应用>创建 Spring Boot 应用</a><ul><li><a href=#通过-maven-插件快速生成>通过 Maven 插件快速生成</a></li><li><a href=#手动创建>手动创建</a></li></ul></li><li><a href=#测试>测试</a><ul><li><a href=#编译生成-zip>编译生成 zip</a></li><li><a href=#测试应用接口>测试应用接口</a></li><li><a href=#使用-sam-测试>使用 SAM 测试</a></li></ul></li><li><a href=#部署>部署</a><ul><li><a href=#serverless-部署>Serverless 部署</a></li><li><a href=#使用-aws-cli-发布>使用 AWS CLI 发布</a></li><li><a href=#页面手动部署>页面手动部署</a></li><li><a href=#项目地址>项目地址</a></li><li><a href=#参考文章>参考文章</a></li></ul></li></ul></nav></div><section class=blog-content><h1 id=aws-lambda-部署-springboot-应用>AWS Lambda 部署 SpringBoot 应用</h1><h2 id=配置-aws-cli-和--severless>配置 AWS CLI 和 Severless</h2><p>AWS CLI 和 Serverless 都可以用于部署 Serverless 应用</p><h3 id=获取密钥>获取密钥</h3><ol><li>登录 AWS， 在服务中搜索并选择 IAM，之后选择用户，添加用户</li></ol><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/blog/serverless/Serverless1.png alt=Serverless1></p><ol start=2><li>输入用户名，选择编程访问</li></ol><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/blog/serverless/Serverless2-add-user.png alt=Serverless2-add-user></p><ol start=3><li>选择权限-直接附加现有策略，搜索<code>AdministratorAccess</code>并选中(有最高权限)</li></ol><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/blog/serverless/Serverless3-add-permission.png alt=Serverless3-add-permission></p><ol start=4><li>选择下一步直到完成，然后保存好密钥(只会出现这一次，否则就只能重新创建)</li></ol><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/blog/serverless/Serverless4-save-secret.png alt=Serverless3-save-secret></p><h3 id=安装配置-aws-cli>安装配置 AWS CLI</h3><h4 id=安装>安装</h4><p>参考 <a href=https://aws.amazon.com/cn/cli/>AWS 命令行界面</a> 安装</p><ul><li>Win 下载 <a href=https://s3.amazonaws.com/aws-cli/AWSCLI64.msi>https://s3.amazonaws.com/aws-cli/AWSCLI64.msi</a> 安装</li><li>Mac/Linux 执行 <code>pip install awscli</code></li></ul><h4 id=配置-aws-cli>配置 AWS CLI</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws configure
</span></span></code></pre></div><p>然后输入刚才的密钥的 Key 和 Secret，Region 可以选择常用的 region，如<code>us-east-1</code></p><h3 id=安装配置-severless>安装配置 Severless</h3><h4 id=安装-1>安装</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install -g serverless
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>或 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>yarn global add serverless
</span></span></code></pre></div><h4 id=配置>配置</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span>serverless config credentials --provider aws --key YOUR_KEY --secret YOUR_SECRET
</span></span></code></pre></div><h3 id=安装配置-aws-sam-local>安装配置 AWS SAM Local</h3><p>aws-sam-local 是用于本地调试 Serverless 应用的工具</p><h4 id=安装-2>安装</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>npm install -g aws-sam-local
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>或
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>yarn global add aws-sam-local
</span></span></code></pre></div><h2 id=创建-spring-boot-应用>创建 Spring Boot 应用</h2><h3 id=通过-maven-插件快速生成>通过 Maven 插件快速生成</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mvn archetype:generate <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        -DgroupId<span style=color:#f92672>=</span>io.github.helloworlde <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        -DartifactId<span style=color:#f92672>=</span>serverless-spring-boot <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        -Dversion<span style=color:#f92672>=</span>1.0-SNAPSHOT <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        -DarchetypeGroupId<span style=color:#f92672>=</span>com.amazonaws.serverless.archetypes <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        -DarchetypeArtifactId<span style=color:#f92672>=</span>aws-serverless-springboot2-archetype <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>        -DarchetypeVersion<span style=color:#f92672>=</span>1.3.1
</span></span></code></pre></div><ul><li>项目文件</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>.
</span></span><span style=display:flex><span>├── README.md
</span></span><span style=display:flex><span>├── build.gradle
</span></span><span style=display:flex><span>├── pom.xml
</span></span><span style=display:flex><span>├── sam.yaml
</span></span><span style=display:flex><span>└── src
</span></span><span style=display:flex><span>    ├── assembly
</span></span><span style=display:flex><span>    │   └── bin.xml
</span></span><span style=display:flex><span>    ├── main
</span></span><span style=display:flex><span>    │   ├── java
</span></span><span style=display:flex><span>    │   │   └── io
</span></span><span style=display:flex><span>    │   │       └── github
</span></span><span style=display:flex><span>    │   │           └── helloworlde
</span></span><span style=display:flex><span>    │   │               ├── Application.java
</span></span><span style=display:flex><span>    │   │               ├── StreamLambdaHandler.java
</span></span><span style=display:flex><span>    │   │               └── controller
</span></span><span style=display:flex><span>    │   │                   └── PingController.java
</span></span><span style=display:flex><span>    │   └── resources
</span></span><span style=display:flex><span>    │       └── application.properties
</span></span><span style=display:flex><span>    └── test
</span></span><span style=display:flex><span>        └── java
</span></span><span style=display:flex><span>            └── io
</span></span><span style=display:flex><span>                └── github
</span></span><span style=display:flex><span>                    └── helloworlde
</span></span><span style=display:flex><span>                        └── StreamLambdaHandlerTest.java
</span></span></code></pre></div><h3 id=手动创建>手动创建</h3><ol><li>创建 SpringBoot 应用</li><li>修改 build.gradle</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-groovy data-lang=groovy><span style=display:flex><span>buildscript <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    ext <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        springBootVersion <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;2.1.1.RELEASE&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    repositories <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        mavenCentral<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    dependencies <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        classpath<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>apply plugin: <span style=color:#e6db74>&#39;java&#39;</span>
</span></span><span style=display:flex><span>apply plugin: <span style=color:#e6db74>&#39;org.springframework.boot&#39;</span>
</span></span><span style=display:flex><span>apply plugin: <span style=color:#e6db74>&#39;io.spring.dependency-management&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>archivesBaseName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;serverless-spring-boot&#39;</span>
</span></span><span style=display:flex><span>group <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;io.github.helloworlde&#39;</span>
</span></span><span style=display:flex><span>version <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;0.0.1-SNAPSHOT&#39;</span>
</span></span><span style=display:flex><span>sourceCompatibility <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>repositories <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    jcenter<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>    mavenLocal<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span>    mavenCentral<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dependencies <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    compile<span style=color:#f92672>(</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;org.springframework.boot:spring-boot-starter-web&#39;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;com.amazonaws.serverless:aws-serverless-java-container-spring:[1.0,)&#39;</span><span style=color:#f92672>,</span>
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;io.symphonia:lambda-logging:1.0.1&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    testCompile<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;junit:junit:4.12&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>task <span style=color:#a6e22e>buildZip</span><span style=color:#f92672>(</span>type: Zip<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    from compileJava
</span></span><span style=display:flex><span>    from processResources
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>into</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;lib&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        from<span style=color:#f92672>(</span>configurations<span style=color:#f92672>.</span><span style=color:#a6e22e>compileClasspath</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            exclude <span style=color:#e6db74>&#39;tomcat-embed-*&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>build<span style=color:#f92672>.</span><span style=color:#a6e22e>dependsOn</span> buildZip
</span></span></code></pre></div><ul><li>添加 PingController.java</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> io.github.helloworlde.controller<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.web.bind.annotation.*<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> org.springframework.web.servlet.config.annotation.EnableWebMvc<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.HashMap<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.util.Map<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@RestController</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@EnableWebMvc</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>PingController</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@RequestMapping</span><span style=color:#f92672>(</span>path <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;/ping&#34;</span><span style=color:#f92672>,</span> method <span style=color:#f92672>=</span> RequestMethod<span style=color:#f92672>.</span><span style=color:#a6e22e>GET</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> String<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>ping</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        Map<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> String<span style=color:#f92672>&gt;</span> pong <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;();</span>
</span></span><span style=display:flex><span>        pong<span style=color:#f92672>.</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;pong&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;Hello, World!&#34;</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> pong<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>添加 StreamLamdbaHandler.java</li></ul><p>StreamLamdbaHandler 相当于一个代理层，将访问 Lambda 的流量转发给 SpringBoot应用；handleRequest方法每次请求都会被调用</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#f92672>package</span> io.github.helloworlde<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.amazonaws.serverless.exceptions.ContainerInitializationException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.amazonaws.serverless.proxy.model.AwsProxyRequest<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.amazonaws.serverless.proxy.model.AwsProxyResponse<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.amazonaws.serverless.proxy.spring.SpringBootLambdaContainerHandler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.amazonaws.services.lambda.runtime.Context<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> com.amazonaws.services.lambda.runtime.RequestStreamHandler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.IOException<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.InputStream<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> java.io.OutputStream<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StreamLambdaHandler</span> <span style=color:#66d9ef>implements</span> RequestStreamHandler <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> SpringBootLambdaContainerHandler<span style=color:#f92672>&lt;</span>AwsProxyRequest<span style=color:#f92672>,</span> AwsProxyResponse<span style=color:#f92672>&gt;</span> handler<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>static</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            handler <span style=color:#f92672>=</span> SpringBootLambdaContainerHandler<span style=color:#f92672>.</span><span style=color:#a6e22e>getAwsProxyHandler</span><span style=color:#f92672>(</span>Application<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>ContainerInitializationException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// if we fail here. We re-throw the exception to force another cold start
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            e<span style=color:#f92672>.</span><span style=color:#a6e22e>printStackTrace</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Could not initialize Spring Boot application&#34;</span><span style=color:#f92672>,</span> e<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>handleRequest</span><span style=color:#f92672>(</span>InputStream inputStream<span style=color:#f92672>,</span> OutputStream outputStream<span style=color:#f92672>,</span> Context context<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throws</span> IOException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        handler<span style=color:#f92672>.</span><span style=color:#a6e22e>proxyStream</span><span style=color:#f92672>(</span>inputStream<span style=color:#f92672>,</span> outputStream<span style=color:#f92672>,</span> context<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><ul><li>添加 sam.yaml</li></ul><p>sam 用于本地测试Serverless 应用，依赖于 Python 和 Docker</p><p>需要注意的是，<code>Resources.ServerlessSpringBootFunction.Properties.CodeUri</code>这个路径需要根据使用 Gradle 或 Maven 进行修改</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>AWSTemplateFormatVersion</span>: <span style=color:#e6db74>&#39;2010-09-09&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Transform</span>: <span style=color:#ae81ff>AWS::Serverless-2016-10-31</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Description</span>: <span style=color:#ae81ff>AWS Serverless Spring Boot 2 API - io.github.helloworlde::serverless-spring-boot</span>
</span></span><span style=display:flex><span><span style=color:#f92672>Globals</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Api</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>EndpointConfiguration</span>: <span style=color:#ae81ff>REGIONAL</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Resources</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ServerlessSpringBootFunction</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::Serverless::Function</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Handler</span>: <span style=color:#ae81ff>io.github.helloworlde.StreamLambdaHandler::handleRequest</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Runtime</span>: <span style=color:#ae81ff>java8</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>CodeUri</span>: <span style=color:#ae81ff>build/distributions/serverless-spring-boot.zip</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>MemorySize</span>: <span style=color:#ae81ff>512</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Policies</span>: <span style=color:#ae81ff>AWSLambdaBasicExecutionRole</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Timeout</span>: <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Events</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>GetResource</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>Api</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>Path</span>: <span style=color:#ae81ff>/{proxy+}</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>Method</span>: <span style=color:#ae81ff>any</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>Outputs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ServerlessSpringBootApi</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Description</span>: <span style=color:#ae81ff>URL for application</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Value</span>: !<span style=color:#ae81ff>Sub &#39;https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/ping&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Export</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Name</span>: <span style=color:#ae81ff>ServerlessSpringBootApi</span>
</span></span></code></pre></div><h2 id=测试>测试</h2><h3 id=编译生成-zip>编译生成 zip</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gradle clean build
</span></span></code></pre></div><h3 id=测试应用接口>测试应用接口</h3><ol><li>启动应用</li><li>访问 <code>http://localhost:8080/ping</code>，应当返回结果：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;pong&#34;</span>: <span style=color:#e6db74>&#34;Hello, World!&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=使用-sam-测试>使用 SAM 测试</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>sam local start<span style=color:#f92672>-</span>api <span style=color:#f92672>--</span>template sam<span style=color:#f92672>.</span><span style=color:#a6e22e>yaml</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -s http://127.0.0.1:3000/ping
</span></span></code></pre></div><p>将会看到输出结果：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{<span style=color:#f92672>&#34;pong&#34;</span>:<span style=color:#e6db74>&#34;Hello, World!&#34;</span>}<span style=color:#960050;background-color:#1e0010>%</span>
</span></span></code></pre></div><h2 id=部署>部署</h2><h3 id=serverless-部署>Serverless 部署</h3><ul><li>在项目根路径中添加 serverless.yml 配置</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>service</span>: <span style=color:#ae81ff>spring-boot-serverless</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>provider</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>aws</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>runtime</span>: <span style=color:#ae81ff>java8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>package</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>artifact</span>: <span style=color:#ae81ff>build/distributions/serverless-spring-boot.zip</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>functions</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>springBootServerless</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>handler</span>: <span style=color:#ae81ff>io.github.helloworlde.StreamLambdaHandler::handleRequest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>events</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>http</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/ping</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>method</span>: <span style=color:#ae81ff>get</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>timeout</span>: <span style=color:#ae81ff>30</span>
</span></span></code></pre></div><ul><li>发布</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sls deploy
</span></span></code></pre></div><p>日志：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sls deploy                             
</span></span><span style=display:flex><span>Serverless: Packaging service...
</span></span><span style=display:flex><span>Serverless: Uploading CloudFormation file to S3...
</span></span><span style=display:flex><span>Serverless: Uploading artifacts...
</span></span><span style=display:flex><span>Serverless: Uploading service serverless-spring-boot.zip file to S3 <span style=color:#f92672>(</span>12.73 MB<span style=color:#f92672>)</span>...
</span></span><span style=display:flex><span>Serverless: Validating template...
</span></span><span style=display:flex><span>Serverless: Updating Stack...
</span></span><span style=display:flex><span>Serverless: Checking Stack update progress...
</span></span><span style=display:flex><span>..............
</span></span><span style=display:flex><span>Serverless: Stack update finished...
</span></span><span style=display:flex><span>Service Information
</span></span><span style=display:flex><span>service: spring-boot-serverless
</span></span><span style=display:flex><span>stage: dev
</span></span><span style=display:flex><span>region: us-east-1
</span></span><span style=display:flex><span>stack: spring-boot-serverless-dev
</span></span><span style=display:flex><span>resources: <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>api keys:
</span></span><span style=display:flex><span>  None
</span></span><span style=display:flex><span>endpoints:
</span></span><span style=display:flex><span>  GET - https://cmu9z3fmd1.execute-api.us-east-1.amazonaws.com/dev/ping
</span></span><span style=display:flex><span>functions:
</span></span><span style=display:flex><span>  springBootServerless: spring-boot-serverless-dev-springBootServerless
</span></span><span style=display:flex><span>layers:
</span></span><span style=display:flex><span>  None
</span></span></code></pre></div><ul><li>访问</li></ul><p>访问 <a href=https://cmu9z3fmd1.execute-api.us-east-1.amazonaws.com/dev/ping>https://cmu9z3fmd1.execute-api.us-east-1.amazonaws.com/dev/ping</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;pong&#34;</span>: <span style=color:#e6db74>&#34;Hello, World!&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=使用-aws-cli-发布>使用 AWS CLI 发布</h3><h4 id=上传到-s3>上传到 S3</h4><p>上传到 S3 时需要有一个 Bucket 存在，可以在 AWS 服务-S3 中创建</p><ul><li>创建 Bucket</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws s3 mb s3://spring-boot-serverless --region us-east-1
</span></span></code></pre></div><ul><li>上传应用</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws cloudformation package --template-file sam.yaml --output-template-file output-sam.yaml --s3-bucket spring-boot-serverless 
</span></span></code></pre></div><p>这个命令执行之后会在项目根目录下生成一个 <code>output-sam.yaml</code></p><p>输出</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Uploading to e793ef8960075db672fce0a8ac65f03b  <span style=color:#ae81ff>13353411</span> / 13353411.0  <span style=color:#f92672>(</span>100.00%<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Successfully packaged artifacts and wrote output template to file output-sam.yaml.
</span></span><span style=display:flex><span>Execute the following command to deploy the packaged template
</span></span><span style=display:flex><span>aws cloudformation deploy --template-file /Users/HelloWood/Dev/Projects/Serverless/serverless-spring-boot/output-sam.yaml --stack-name spring-boot-serverless
</span></span></code></pre></div><h4 id=部署-1>部署</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws cloudformation deploy --template-file /Users/HelloWood/Dev/Projects/Serverless/serverless-spring-boot/output-sam.yaml --stack-name spring-boot-serverless-demo --capabilities CAPABILITY_IAM
</span></span></code></pre></div><p>需要注意的是 <code>--capabilities CAPABILITY_IAM</code>会创建一个新的角色，会使用 <code>AWSLambdaBasicExecutionRole</code>，该策略仅允许该角色访问 Lambda 相关的资源，也可以使用 <code>CAPABILITY_AUTO_EXPAND</code>或<code>CAPABILITY_NAMED_IAM</code>使用已有的角色；创建后的角色可以在 AWS IAM 的角色下面管理</p><h4 id=测试-1>测试</h4><ul><li>获取应用信息</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws cloudformation describe-stacks --stack-name spring-boot-serverless-demo
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Stacks&#34;</span>: [
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;StackId&#34;</span>: <span style=color:#e6db74>&#34;arn:aws:cloudformation:us-east-1:266545579784:stack/spring-boot-serverless-demo/1074b6a0-6f97-11e9-835b-0e348661d726&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;StackName&#34;</span>: <span style=color:#e6db74>&#34;spring-boot-serverless-demo&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;ChangeSetId&#34;</span>: <span style=color:#e6db74>&#34;arn:aws:cloudformation:us-east-1:266545579784:changeSet/awscli-cloudformation-package-deploy-1557103210/fe06fc3b-a353-4d42-814a-4e4f736a2026&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Description&#34;</span>: <span style=color:#e6db74>&#34;AWS Serverless Spring Boot 2 API - io.github.helloworlde::serverless-spring-boot&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;CreationTime&#34;</span>: <span style=color:#e6db74>&#34;2019-05-06T00:37:01.857Z&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;LastUpdatedTime&#34;</span>: <span style=color:#e6db74>&#34;2019-05-06T00:40:17.502Z&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;RollbackConfiguration&#34;</span>: {},
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;StackStatus&#34;</span>: <span style=color:#e6db74>&#34;CREATE_COMPLETE&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;DisableRollback&#34;</span>: <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;NotificationARNs&#34;</span>: [],
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Capabilities&#34;</span>: [
</span></span><span style=display:flex><span>                <span style=color:#e6db74>&#34;CAPABILITY_IAM&#34;</span>
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Outputs&#34;</span>: [
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&#34;OutputKey&#34;</span>: <span style=color:#e6db74>&#34;ServerlessSpringBootApi&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&#34;OutputValue&#34;</span>: <span style=color:#e6db74>&#34;https://gf2c9fhhql.execute-api.us-east-1.amazonaws.com/Prod/ping&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&#34;Description&#34;</span>: <span style=color:#e6db74>&#34;URL for application&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#f92672>&#34;ExportName&#34;</span>: <span style=color:#e6db74>&#34;ServerlessSpringBootApi&#34;</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            ],
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Tags&#34;</span>: [],
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;EnableTerminationProtection&#34;</span>: <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;DriftInformation&#34;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#f92672>&#34;StackDriftStatus&#34;</span>: <span style=color:#e6db74>&#34;NOT_CHECKED&#34;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>访问 OutputValue 的 URL</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl https://gf2c9fhhql.execute-api.us-east-1.amazonaws.com/Prod/ping
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;pong&#34;</span>:<span style=color:#e6db74>&#34;Hello, World!&#34;</span><span style=color:#f92672>}</span>%
</span></span></code></pre></div><h3 id=页面手动部署>页面手动部署</h3><h4 id=创建函数>创建函数</h4><ul><li>选择服务 - Lambda - 函数 - 创建函数 - 从头开始创作</li></ul><p>权限可以选择现有的角色或者新建角色
<img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/blog/serverless/Serverless7-create-on-panel.png alt=Serverless7-create-on-panel></p><ul><li>添加触发器，选择 API-Gateway 作为触发器，然后保存</li></ul><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/blog/serverless/Serverless8-gateway-trigger.png alt=Serverless8-gateway-trigger></p><ul><li>点击Layers 的 Spring 应用，上传 zip，在 <code>build/</code>或<code>target/</code>下；运行语言选择 Java8，处理程序为<code>io.github.helloworlde.StreamLambdaHandler::handleRequest</code>，点击保存</li></ul><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/blog/serverless/Serverless9-upload-app.png alt=Serverless9-upload-app></p><h4 id=测试-2>测试</h4><ul><li>选择配置测试事件 - 创建新测试事件 - 选择 <code>AWS API Gateway AWS Proxy</code>，修改相关的path和httpMethod</li></ul><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/blog/serverless/Serverless10-api-gateway-test.png alt=Serverless10-api-gateway-test></p><p><img src=https://hellowoodes.oss-cn-beijing.aliyuncs.com/blog/serverless/Serverless11-test-result.png alt=Serverless11-test-result></p><ul><li>Gateway 的 URL 可以点击 API Gateway查看</li></ul><hr><h3 id=项目地址>项目地址</h3><p><a href=https://github.com/helloworlde/serverless-spring-boot>https://github.com/helloworlde/serverless-spring-boot</a></p><h3 id=参考文章>参考文章</h3><ul><li><a href=https://skryvets.com/blog/2018/06/02/spring-boot-aws-lambda-guide/>A complete guide for running Spring Boot MVC in the cloud using AWS Lambda</a></li><li><a href=https://docs.aws.amazon.com/zh_cn/lambda/latest/dg/java-programming-model.html>使用 Java 构建 Lambda 函数</a></li><li><a href=https://docs.aws.amazon.com/zh_cn/serverless-application-model/latest/developerguide/serverless-sam-cli-install-mac.html>Installing the AWS SAM CLI on macOS</a></li><li><a href=https://docs.aws.amazon.com/zh_cn/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html>Installing the AWS SAM CLI</a></li><li><a href=https://docs.aws.amazon.com/zh_cn/toolkit-for-jetbrains/latest/userguide/key-tasks.html#key-tasks-install>Key Tasks for the AWS Toolkit for JetBrains</a></li><li><a href=https://www.zhihu.com/question/29490143>如何看待 AWS Lambda</a></li><li><a href=https://github.com/awslabs/aws-serverless-java-container>aws-serverless-java-container</a></li><li><a href=https://github.com/awslabs/aws-serverless-java-container>Quick start Spring Boot</a></li></ul></section><div class=paginator><a class=prev href=https://blog.hellowood.dev/posts/google-cloud-run-%E9%83%A8%E7%BD%B2-knative-serverless-%E5%BA%94%E7%94%A8/><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg><span>Google Cloud Run 部署 Knative Serverless 应用</span></a>
<a class=next href=https://blog.hellowood.dev/posts/mybatis-%E6%9F%A5%E8%AF%A2%E9%94%99%E8%AF%AFjava-lang-illegalargumentexception-invalid-comparison-java-util-date-and-java-lang-string/><span>MyBatis 查询错误：java.lang.IllegalArgumentException: invalid comparison: java.util.Date and java.lang.String</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div></article></div><footer class=footer><p>&copy; 2023 <a href=https://blog.hellowood.dev>HelloWood</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank data-umami-event=to-hugo>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank data-umami-event=to-ladder>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g data-umami-event=top-link><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg></a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>