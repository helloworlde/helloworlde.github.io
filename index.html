<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.111.3"><meta name=viewport content="width=device-width,initial-scale=1"><title>HelloWood</title><meta charset=utf-8><meta name=description content="Ladder@"><meta name=author content="HelloWood"><link rel=canonical href=https://blog.hellowood.dev/><meta name=google-site-verification content="G-3MSGPYTHPZ"><link rel=alternate type=application/rss+xml href=https://blog.hellowood.dev/index.xml title=HelloWood><script async src="https://www.googletagmanager.com/gtag/js?id=G-3MSGPYTHPZ"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3MSGPYTHPZ",{anonymize_ip:!1})}</script><script async defer data-website-id=7a9034de-0ce7-4756-942a-829e6cd22301 src=https://statistics.lab.hellowood.dev/umami.js></script><meta property="og:title" content="HelloWood"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://blog.hellowood.dev/"><meta name=twitter:card content="summary"><meta name=twitter:title content="HelloWood"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"HelloWood","url":"https://blog.hellowood.dev","description":"","thumbnailUrl":"https://blog.hellowood.dev/favicon.ico","sameAs":[]}</script><link rel=icon href=/images/avatar.png sizes=16x16><link rel=apple-touch-icon href=/images/avatar.png><link rel=manifest href=/images/avatar.png><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.f8020eba33d585b82c30b2a1ceb0d4c4e8e41fb6d8843d07d8ad056da8712972.css integrity="sha256-+AIOujPVhbgsMLKhzrDUxOjkH7bYhD0H2K0FbahxKXI=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.c098d85b5396dec4707ea2cead1445b4dc2ff0fc56b8dbbd9049d0d1c50ad237.js></script>
<script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>HOME</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/posts>Blog</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=https://statistics.lab.hellowood.dev/share/r2Llssnu/Blog>Dashboard</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/helloworlde><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><div class=home><div class=info><div class=intro><h1>HelloWood</h1><small>Copy Paste Worker</small><p>Welcome to read my draft notes</p></div><div class=avatar><img src=/images/avatar.png alt=avatar></div></div><div class=featured><h2>Featured Posts</h2><div class=featured-list><article class=featured-single><h4><a href=/posts/proxmox-ve-%E6%B7%BB%E5%8A%A0%E7%9B%91%E6%8E%A7/>Proxmox VE 添加监控</a></h4><p><small>April 9, 2023&nbsp;· 217 words&nbsp;· 2 min</small><p>Proxmox VE 添加监控 PVE 支持添加 Graphite 或者 InfluxDB 作为指标数据的存储；在添加配置后，PVE 会主动将配置信息发送到对应的存储中，用于记录和监控 PVE 的状态
基于 Docker 容器，使用 InfluxDB 和 Grafana 对 PVE 进行监控，效果如图：
配置 InfluxDB 使用的是 InfluxDB 2 版本，使用 Flux 语法进行查询；因此需要启动 InfluxDB 2 的容器，使用 DockerCompose 方便配置
docker-compose.yaml version: '3' services: influxdb: container_name: influxdb image: influxdb:2.6 ports: - "8086:8086" volumes: - ./data/influx/data:/var/lib/influxdb2 - ./data/influx/config:/etc/influxdb2 environment: DOCKER_INFLUXDB_INIT_MODE: setup DOCKER_INFLUXDB_INIT_USERNAME: admin DOCKER_INFLUXDB_INIT_PASSWORD: qwertyuiop DOCKER_INFLUXDB_INIT_ORG: influx DOCKER_INFLUXDB_INIT_BUCKET: influx DOCKER_INFLUXDB_INIT_ADMIN_TOKEN: 123456 DOCKER_INFLUXDB_INIT_MODE它用于指定容器启动时运行的初始化模式。该变量有两个有效值：
setup: 表示在容器首次启动时，将执行InfluxDB初始化脚本并创建管理员用户。 skip：表示跳过初始化脚本的执行，直接启动InfluxDB服务。 DOCKER_INFLUXDB_INIT_PASSWORD 不能设置的太简单，否则 InfluxDB 启动时会报错 DOCKER_INFLUXDB_INIT_ORG 用于指定 InfluxDB 的组织 DOCKER_INFLUXDB_INIT_BUCKET 用于指定初始化使用的 Bucket DOCKER_INFLUXDB_INIT_ADMIN_TOKEN 用于访问时进行鉴权</article><article class=featured-single><h4><a href=/posts/n5105-promox-ve-%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%A2%91%E7%B9%81%E6%AD%BB%E6%9C%BA%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/>N5105 Promox VE 虚拟机频繁死机问题处理</a></h4><p><small>March 25, 2023&nbsp;· 261 words&nbsp;· 2 min</small><p>N5105 Promox VE 虚拟机频繁死机问题处理 使用 N5105 作为 HomeLab 的服务器；之前安装的 ESXi，使用 Ubuntu 22 的时候经常会出现 Ubuntu CPU 占用达到100%，然后死机；但是其他的虚拟机都没有问题，因为对 Linux 并不熟，查看了 ESXi 和 Ubuntu 日志并没有异常；后面安装黑群晖一直失败，因此换到了 Proxmox VE
换到 PVE 后依然存在同样的问题，以为是服务的问题，于是给 Docker 容器添加了资源限制，无效后迁移到了 CentOS 部署，发现还是同样的问题；并且越来越频繁，从一天一次变成了几小时一次，几乎无法使用
猜测会不会是硬件问题，一番搜索发现在 N5105 上居然是个普遍的问题
问题 这个问题于 2022-08-04 在 Proxmox 的问题反馈中提交：Bug 4188 - VMs freeze on Intel N5105 CPU，描述中"到运行Intel N5105 CPU的一些用户注意到在Proxmox上运行的虚拟机会冻结，并记录了各种错误。虚拟机会冻结，控制台无法输入，CPU利用率达到最大值，直到强制重启虚拟机"，现象和我遇到的是一样的，说明该现象是通病；
2022-9-13 在帖子 Opt-in Linux 5.19 Kernel for Proxmox VE 7.x available 中，PVE员工宣布将 PVE 的内核升级到 5.19版本，在 Bug 反馈到讨论中有不少人确认有效
这个问题在 2022-12-06 状态变更为 &lsquo;FIX PACKAGED&rsquo;；在 2022-12-14，PVE员工宣布支持将内核升级到 6.</article><article class=featured-single><h4><a href=/posts/openwrt-%E6%A1%A5%E6%8E%A5%E5%85%85%E5%BD%93%E4%BA%A4%E6%8D%A2%E6%9C%BA/>OpenWrt 桥接充当交换机</a></h4><p><small>March 21, 2023&nbsp;· 329 words&nbsp;· 2 min</small><p>OpenWrt 桥接充当交换机 需求背景 使用的路由器只有 3 个 LAN 口，在购入 NAS 后网口捉襟见肘，并且 NAS 不支持 Wi-Fi，因此需要更多的网口支持设备连接
路由器是小米的 Redmi AX6000， 支持WiFi 6E，协商速度能达到2400Mbps，但却只有千兆的网口；因为家里的两台电脑和 NAS 都是 2.5G 的网口和 WiFi6E 的无线网卡，想要 NAS 高速读写就需要 2.5G 以上的交换机；但是 2.5G 的交换机价格都在 400+，性价比不高
日常将四网口的 N5105 作为 HomeLab 的服务器使用，只有一个网口连接到路由器，其他三个网口空闲；因此想将 N5105 作为交换机，用于连接 NAS 和电脑；有三种方案：
路由器和 N5105 做链路聚合，NAS连接到 N5105，电脑通过 WiFi 访问；速度能达到 2000Mbps，不过这样额外占用了两个网口，但是好处是所有的支持 WiFi6 的设备都能高速访问 NAS 不做链路聚合，这样能够多三个 2.5G 的网口；NAS 和电脑都通过网线连接到 N5105，通过网线连接的设备均能以 2.5G 的速度访问 NAS 为 N5105 添加 WiFi6E 无线网卡，并启用混杂模式，NAS 通过网线连接到 N5105，电脑通过 WiFi 访问 NAS；所有支持 WiFi6 的设备可以 2400Mbps 的速度访问 NAS；但是需要额外购买一张 WiFi6 的无线网卡，并且设备需要连接到 N5150 的 WiFi网络上 基于以上考虑，不做链路聚合成本最低且能扩展网口，添加 WiFi6 网卡效果最好；因为手头没有 WiFi6 的网卡，因此先通过不做链路聚合的方式实现</article><article class=featured-single><h4><a href=/posts/openwrt-%E5%9C%A8-pve-%E4%B8%AD%E4%BB%A5%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85/>OpenWrt 在 PVE 中以虚拟机方式安装</a></h4><p><small>March 20, 2023&nbsp;· 140 words&nbsp;· One minute</small><p>OpenWrt-在 PVE 中以虚拟机方式安装 下载镜像 下载镜像 在 https://openwrt.org/zh/downloads 选择稳定发行版，然后选择需要下载的版本；这里使用当前最新的 22.03.3 版本，使用阿里云 OpenWrt 镜像进行下载
选择下载 generic-ext4-combined-efi.img.gz 这个压缩文件，用于 bios 引导
解压 使用 gunzip 命令解压 gz 压缩文件
gunzip openwrt-22.03.3-x86-64-generic-ext4-combined-efi.img.gz 将下载的镜像解压后得到 img格式的文件
虚拟机配置 创建虚拟机 创建虚拟机，输入名称 操作系统这里选择 &ldquo;不使用任何介质&rdquo; 磁盘这里，选择左侧删除按钮，将磁盘删除；因为会将 img 文件导入作为磁盘，因此这里不需要 按需配置 CPU 和内存；通常 1核和 512M就已经足够了 添加硬盘 上传 img 镜像 选择 local - ISO镜像，将解压后的 img 文件上传到 PVE
等待上传完成，记录上传后的地址，即 target file 后面的路径，需要在导入时使用
将 img 镜像导入为虚拟磁盘 打开 PVE 的 shell，执行导入命令，将 img 作为虚拟磁盘，导入到 106 虚拟机（即刚才创建的虚拟机的 vmid）
qm importdisk 106 /var/lib/vz/template/iso/openwrt-22.</article><article class=featured-single><h4><a href=/posts/%E6%A0%91%E8%8E%93%E6%B4%BE-4b-%E4%BD%BF%E7%94%A8-csi-%E6%91%84%E5%83%8F%E5%A4%B4/>树莓派 4b 使用 CSI 摄像头</a></h4><p><small>March 11, 2023&nbsp;· 175 words&nbsp;· One minute</small><p>树莓派 4b 使用 CSI 摄像头 树莓派 4b 支持通过 USB 或者摄像头 CSI 接口连接摄像头，因此可以使用树莓派 4b 作为监控
基于安装了 Ubuntu Server 22.04 LTS 的树莓派 4b 进行测试
带有红外补光灯的摄像头功率大概5-7w左右，因此使用树莓派 4b 连接时需要有 5V3A 的电源，否则当开启摄像头后树莓派会不断重启
接入摄像头 连接摄像头 如图所示，通过排线连接摄像头和树莓派（图片来自 Getting started with the Camera Module）
开启摄像头 开启摄像头需要先安装 raspi-config 软件
apt-get install -y raspi-config 然后运行 raspi-config，选择用户 pi 进行配置；
接着选择第三个接口配置
然后选择第一个，配置摄像头，选择开启即可；开启完成后，需要关闭树莓派，连接摄像头并重新开机
检查摄像头信息 检查连接状态 重启后检查设备连接状态：
vcgencmd get_camera supported=1 detected=1, libcamera interfaces=0 返回信息提示检查到了一个摄像头并且支持该摄像头
查看摄像头信息 查看摄像头信息需要使用 v4l-utils
apt-get install -y v4l-utils 通过 v4l-utils 列出设备</article><article class=featured-single><h4><a href=/posts/%E6%A0%91%E8%8E%93%E6%B4%BE-4b-%E4%BD%BF%E7%94%A8%E6%91%84%E5%83%8F%E5%A4%B4%E6%8E%A8%E9%80%81%E6%B5%81%E5%88%B0-rtmp-%E6%9C%8D%E5%8A%A1%E5%99%A8/>树莓派 4b 使用摄像头推送流到 RTMP 服务器</a></h4><p><small>March 11, 2023&nbsp;· 267 words&nbsp;· 2 min</small><p>树莓派 4b 使用摄像头推送流到 RTMP 服务器 使用树莓派 4b，基于 Ubuntu 22.04，将摄像头的监控内容推送到 RTMP 服务器，用于其他服务从 RTMP 获取视频，进行视频分析和事件告警ss 树莓派摄像头使用排线进行连接，通过 ffmpeg 将视频流推送到 SRS 服务器（SRS是一个简单高效的实时视频服务器，支持RTMP/WebRTC/HLS/HTTP-FLV/SRT/GB28181）
树莓派连接摄像头可以参考 树莓派 4b 使用摄像头
安装 ffmpeg apt-get update && apt-get install -y ffmpeg 安装 SRS SRS 使用 Docker Compose 进行部署；用于处理 ffmpeg 推送的视频流
docker-compose.yaml version: '3' services: srs: image: "registry.cn-hangzhou.aliyuncs.com/ossrs/srs:4" restart: unless-stopped container_name: "srs" hostname: srs ports: - "1935:1935" - "1985:1985" - "8080:8080" volumes: - "./data:/srs" 使用 ffmpeg 推送流到 SRS 通过 ffmpeg 将视频内容推送到 SRS</article><article class=featured-single><h4><a href=/posts/docker-%E5%BC%80%E5%90%AF%E5%A4%96%E9%83%A8-http-%E8%AE%BF%E9%97%AE/>Docker 开启外部 HTTP 访问</a></h4><p><small>March 5, 2023&nbsp;· 137 words&nbsp;· One minute</small><p>Docker 开启外部 HTTP 访问 在监控容器时，通常需要从 Docker 中获取容器的信息，如果监控服务和其他的服务在同一台宿主机上，通常可以直接通过挂载 socket 的方式进行获取；但是为了监控的准确性，通常会将监控服务和其他服务分开部署，因此需要从外部获取 Docker 容器信息；
Docker 除了支持 socket 方式之外，还支持通过 HTTP 的方式获取容器的信息
开启 HTTP 访问 HTTP 访问是通过在启动 Docker 服务的时候添加参数的方式开启的；需要在 docker service 的启动命令中添加 -H tcp://0.0.0.0:2375 -H unix://var/run/docker.sock，即允许通过 HTTP 方式和 socket 方式访问
配置启动参数 该文件是 docker 服务的定义文件
vi /usr/lib/systemd/system/docker.service 在 Service 的 ExecStart 命令中添加 -H tcp://0.0.0.0:2375 -H unix://var/run/docker.sock
[Service] Type=notify # the default is not to use systemd for cgroups because the delegate issues still # exists and systemd currently does not support the cgroup feature set required # for containers run by docker ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.</article><article class=featured-single><h4><a href=/posts/proxmox-ve-%E5%AE%89%E8%A3%85%E5%88%9D%E5%A7%8B%E5%8C%96/>Proxmox VE 安装初始化</a></h4><p><small>February 27, 2023&nbsp;· 51 words&nbsp;· One minute</small><p>Proxmox VE(PVE) 安装初始化 Proxmox VE，是一个开源的服务器虚拟化环境Linux发行版。Proxmox VE基于Debian，使用基于Ubuntu的定制内核，包含安装程序、网页控制台和命令行工具，并且向第三方工具提供了REST API - 维基百科
PVE 和 Vmware ESXi 类似，都支持虚拟化环境；PVE 基于 Linux，扩展性更强
安装 下载 ISO 镜像 PVE的镜像可在 PVE 官网的下载页面进行下载
制作启动盘 使用 Rufus 或者 balenaEtcher 将下载的 ISO 镜像写入到 U 盘或者移动硬盘中
插入主机并启动 启动后选择安装 Proxmox VE
设置 IP 地址 IP地址用于后续访问，可以通过DHCP获取，也可以设置为固定的 IP
安装完成 安装完成后，会提示重启
登录 重启完成后，在命令行会提示访问的地址，默认端口是 8006，
通过 HTTPS 协议访问；如 https://192.168.17.129:8006</article><article class=featured-single><h4><a href=/posts/traefik-%E4%BD%BF%E7%94%A8-google-github-oauth-%E8%BF%9B%E8%A1%8C%E9%89%B4%E6%9D%83%E7%99%BB%E9%99%86/>Traefik 使用 Google GitHub OAuth 进行鉴权登陆</a></h4><p><small>February 15, 2023&nbsp;· 367 words&nbsp;· 2 min</small><p>Traefik 使用 Google/GitHub OAuth 进行鉴权登陆 在使用 Traefik 作为 Homelab 的网关时，考虑到部分服务涉及隐私，因此需要限制用户登陆后才能使用；
Traefik 支持使用 HTTP 中间件，可以将鉴权信息转发给其他服务进行鉴权，因此，使用 https://github.com/thomseddon/traefik-forward-auth 作为鉴权的服务，该服务默认使用 Google OAuth，因此，可以通过 Google 账号登陆访问内部服务；该服务也支持任何 OAuth 标准的认证服务，如 GitHub，微软等
申请 OAuth 应用 在 Google Cloud 创建新的应用，选择 &ldquo;APIs and Services&rdquo; -> &ldquo;Credentials&rdquo;，选择 &ldquo;CREATE CREDENTIALS&rdquo; -> &ldquo;OAuth Client ID&rdquo;，应用类型选择 &ldquo;Web Application&rdquo;，填写名称，重定向 URL 为要访问的 URL + 认证路径，traefik-forward-auth 的认证路径为 /_oauth
确认后会提示 Client ID 和 Client Secret，需要保存好，作为 traefik-forward-auth 配置
为特定的服务添加认证 认证特定的服务，需要启动 traefik-forward-auth 服务，然后为要认证的服务添加中间件即可；如这里给 whoami 服务添加了名为 traefik-forward-auth 的 HTTP 中间件
这里通过将域名指向本地的方式进行测试，如在 /etc/hosts 中添加 whoami.</article><article class=featured-single><h4><a href=/posts/%E4%BD%BF%E7%94%A8%E5%9F%B9%E6%AD%A3-pzem-004t-%E5%92%8C-homeassistant-%E7%9B%91%E6%B5%8B%E5%AE%B6%E5%BA%AD%E7%94%A8%E7%94%B5%E6%83%85%E5%86%B5/>使用培正 PZEM 004T 和 HomeAssistant 监测家庭用电情况</a></h4><p><small>February 12, 2023&nbsp;· 325 words&nbsp;· 2 min</small><p>使用培正 PZEM-004T 和 HomeAssistant 监测家庭用电情况 培正 PZEM-004T 是一个电能监控模块，能够监测家庭用电的电压，电流，频率，实时功率，耗电量等信息；支持通过 UART 协议进行读取；因此可以使用 ESP8266 或者 ESP32 等模块，将用电信息添加到 HomeAssistant 中
硬件 硬件 价格 数量 备注 peacefair PZEM-004T 100A 主机+开合式CT 42 1 电表，建议使用开合式CT，不需要改动电路 220V 转 5V1A 供电模块 8 1 用于为培正电表和 3v 模块供电 5V 转 3.3V 供电模块 3.5 1 用于为 ESP-01S 模块供电 40P杜邦线母对母 2.6 1 用于连接所有的模块 40P杜邦线母对公 2.6 1 用于连接所有的模块 ##1. ESP-01S 刷入 esphome 固件
运行 esphome 容器 docker run -d \ --name="esphome" \ -p 6052:6052 \ -e TZ=Asia/Shanghai \ --hostname="esphome" \ -v ~/esphome/config:/config \ --privileged \ esphome/esphome 刷入固件 启动后访问 http://localhost:6052/，选择添加设备，完整配置文件如下：</article><article class=featured-single><h4><a href=/posts/%E4%BD%BF%E7%94%A8-powercli-%E7%9A%84-docker-%E5%AE%B9%E5%99%A8%E8%87%AA%E8%A1%8C%E6%9E%84%E5%BB%BA-esxi-%E9%95%9C%E5%83%8F/>使用 PowerCLI 的 Docker 容器自行构建 ESXi 镜像</a></h4><p><small>February 7, 2023&nbsp;· 333 words&nbsp;· 2 min</small><p>使用 PowerCLI 的 Docker 容器自行构建 ESXi 镜像 参考 N5105 构建 ESXi 镜像，在使用 ESXi 7 时，基于 Windows 系统，使用 PowerCLI 为 ESXi 7 的镜像添加了 NVMe 和 Intel I225V 网卡的驱动；
虽然当时已经可以在 Linux 或者 MacOS 上使用 PowerShell，但是因为 PowerCLI 不支持 Core 版本的 PowerShell，会提示 Exception: The VMware.ImageBuilder module is not currently supported on the Core edition of PowerShell；导致只能使用 Windows 构建，对于没有 Windows 系统的用户非常不方便。
PowerCLI 新版本已经支持了 Core 版本的 PowerShell，因此可以通过在 Linux/MacOS/Docker 等平台直接构建 ESXi 镜像；
本次使用 PowerCLI 的 Docker 容器，为 ESXi 8 镜像添加 NVMe 和网卡驱动</article><article class=featured-single><h4><a href=/posts/%E6%8A%80%E5%98%89-b660m-aorus-pro-ax-%E5%AE%89%E8%A3%85%E9%BB%91%E8%8B%B9%E6%9E%9C/>技嘉 B660M AORUS PRO AX 安装黑苹果</a></h4><p><small>December 30, 2022&nbsp;· 376 words&nbsp;· 2 min</small><p>技嘉 B660M AORUS PRO AX 安装黑苹果 系统配置 类型 明细 主板 技嘉 B660M AORUS PRO AX DDR4 CPU 12th Gen Intel(R) Core(TM) i9-12900K 内存 2 x Kingston 16GB 3200MHz DDR4 显卡 憾讯 AMD RX 6600 8GB 硬盘 Lexar 512G Nvme SSD 声卡 Realtek ALC897 无线/蓝牙 Broadcom BCM943602CS, Intel Wi-Fi 6E AX210 有线网口 Intel Ethernet I-225V BIOS 版本 F21 功能支持 功能 状态 备注｜ CPU ✅ CPU型号能够正常识别，架构未识别，使用 Intel Power Gadget 可以跑满功率 内存 ✅ 运行频率正常，卡槽识别正常 核心显卡 ❗ 仅安装核心显卡时可以输出，但是非常卡顿 独立显卡 ✅ 免驱动的显卡安装后即可正常使用 WiFi & 蓝牙 ⚠️ BCM943602CS 下功能均正常，WiFi协商速度为867Mbps，但是实际不到400Mbps；AX210 WiFi可以连接，但是无法切换到其他 WiFi，可能和驱动支持不完善有关，不能同时使用 网口 ✅ 协商速度 2.</article><article class=featured-single><h4><a href=/posts/intel-nuc-9-%E5%AE%89%E8%A3%85%E9%BB%91%E8%8B%B9%E6%9E%9C/>Intel NUC 9 安装黑苹果</a></h4><p><small>December 8, 2022&nbsp;· 517 words&nbsp;· 3 min</small><p>Intel NUC 9 安装 macOS(黑苹果/Hackintosh) 为什么要用黑苹果 手里有两台 MacBook Pro，分别是 18年的 i9 16G版本和20年的 i7 16G版本，升级到 Ventura 版本后响应变慢，同时公司的监控和通讯软件占用了大量内存，出现了严重的卡顿，切换应用等待三四秒之后才能操作；因为 MBP 无法升级内存，并且新款的 Mac 性价比并不高，因此，想通过黑苹果组建一台可以升级内存的电脑；
黑苹果的中文教程有很多，但是不少都是引流到公众号或者QQ群，下载镜像或相关软件都需要收费；这些人利用信息差，将免费和开源的拿去收费，吃相实在难看
NUC 9 NUC 9 是 Intel 在 2020 年第一季度推出的 ITX 主机，代号 Ghost Canyon（幽灵峡谷），因为与同期的 MBP 配置类似，可以安装黑苹果
恰巧 NUC 9 最近降价了，i5版本的价格在 2k 左右，i9版本4k左右；单独购买 i9 的计算卡大概2k，因此购买 i5版本，然后自己更换 i9版本的算力卡性价比更高；兼容的软硬件参考 兼容硬件列表
黑苹果兼容的显卡并不多，主要以 AMD 为主，参考黑苹果免驱显卡大全2022年9月最新版 更新至RX 6900 XT；并且 NUC9 只支持长度不超过 20cm 的显卡，因此，能够选购的显卡非常有限（如憾讯的 6600/6600XT 竞技版，华擎的 6600/6600XT 单风扇版等）
黑苹果安装流程 黑苹果的安装过程大致分为四步，首先刻录 macOS 移动磁盘，然后将机型适用的 EFI 写入到移动磁盘，修改 BIOS 设置，接着启动安装macOS，安装完成后将 EFI 写入到系统即可；这里基于 macOS 进行安装，NUC 9 是 i5版本，没有安装独立显卡</article><article class=featured-single><h4><a href=/posts/windows-%E4%BD%BF%E7%94%A8-yuzu-%E6%A8%A1%E6%8B%9F-nintendo-switch/>Windows 使用 Yuzu 模拟 Nintendo Switch</a></h4><p><small>November 20, 2022&nbsp;· 154 words&nbsp;· One minute</small><p>Windows 使用 yuzu 模拟 Nintendo Switch yuzu 是一款开源的 Ninetendo Swithc 模拟器，支持在 Linux 或者 Windows 平台运行，能够模拟 Switch 平台的大部分游戏
这里使用 Windows 平台进行安装，测试后发现 yuzu 能够较好的体验 Switch 的游戏，对于性能较好的机器，可以流畅运行游戏，并且没有 Switch 切换场景或者读取游戏时长时间的加载等待；对于没有 Switch 的可以作为尝鲜体验的工具，不过实际游戏效果体验不如 Switch 好
安装 yuzu 模拟器 进入 yuzu 的下载页面，发现要求先安装 Microsoft Visual C++，没有下载选项；只有当安装完 Microsoft Visual C++ 后，才会出现下载按钮
下载后安装
配置密钥 安装完成后进入，会发现提示密钥缺失；需要使用 Switch 设备的密钥，这些key 是用来解密 XCI 或者 NCA 格式的游戏文件的；
如果有 Switch ，可以参考 Dumping Decryption Keys from a Switch Console 进行导出；
如果没有 Switch，可以使用 https://github.com/MostlyWhat/prod.keys/blob/main/prod.keys
在 yuzu 模拟器菜单中，选择文件-打开 yuzu 文件夹，将下载到的文件保存到 keys 目录下，然后关闭并重新打开 yuzu 模拟器；再次打开后没有提示缺失密钥，说明密钥已经生效</article><article class=featured-single><h4><a href=/posts/%E4%BD%BF%E7%94%A8-macos-%E5%88%B6%E4%BD%9C-macos-%E7%9A%84-iso-%E9%95%9C%E5%83%8F/>使用 MacOS 制作 MacOS 的 ISO 镜像</a></h4><p><small>November 20, 2022&nbsp;· 184 words&nbsp;· One minute</small><p>使用 macOS 制作 macOS 的 ISO 镜像 需要在虚拟机中使用 macOS，但是没有 ISO 镜像，可以使用 macOS 系统制作 ISO 镜像
在 APP Store 下载安装器 首先需要在 App Store 下载对应版本的系统安装器，在 App Store 只能搜索到当前或更新版本的安装器，如果想使用旧版本，可以通过 Google 或在线的 App Store 搜索对应版本并跳转到 App Store 进行下载；如 macOS Monterey
随后会跳转到软件更新中自动下载，下载完成后在应用里可以看到 &ldquo;安装 macOS Monterey&rdquo;
制作 ISO 镜像 安装完成后，可以通过命令行制作 ISO 镜像
1 创建 dmg 镜像文件 通过 hdiutil 在 /tmp 目录下创建一个临时的 Monterey dmg 文件，文件大小要大于等于安装器的大小，并指定挂载的数据卷名称为 Monterey
hdiutil create -o /tmp/Monterey -size 14500m -volname Monterey -layout SPUD -fs HFS+J 将会提示创建 dmg 文件成功 ：</article><article class=featured-single><h4><a href=/posts/homeassistant-%E5%9F%BA%E4%BA%8E%E5%AE%B9%E5%99%A8%E6%90%AD%E5%BB%BA%E4%B8%8E%E4%BD%BF%E7%94%A8/>HomeAssistant 基于容器搭建与使用</a></h4><p><small>November 13, 2022&nbsp;· 121 words&nbsp;· One minute</small><p>HomeAssistant 基于容器搭建与使用 HomeAssistant 是免费开源的智能家庭自动化控制系统，支持接入多种平台，如 HomeKit，米家，ESPHome 等；国内大部分应用场景是将米家的设备通过 HomeAssistant 接入苹果生态，或者使用第三方组件，监控水电气等
基于容器搭建 HomeAssistant 支持多种运行方式，如以OS方式运行，或者使用二进制或容器等方式运行；容器等方式更方便管理
使用 Docker 直接运行 在 Linux 服务器使用容器启动 HomeAssistant，HomeAssistant 的所有配置和数据都在 /config 目录下，为了持久化数据，将当前路径挂载到 HomeAssistant 的 config 目录下；因为 HomeAssistant 需要访问局域网内的其他设备，因此，建议容器的网络模式使用 host，或者通过 macvlan 驱动为其单独创建网络
docker run -d \ --name="home-assistant" -v ${pwd}:/config \ -v /etc/localtime:/etc/localtime:ro \ --net=host \ homeassistant/home-assistant 使用 Docker Compose 启动 docker-compose.yaml version: '3' services: homeassistant: container_name: homeassistant image: "homeassistant/home-assistant" privileged: true network_mode: host restart: always healthcheck: test: ["CMD", "wget", "-q","--spider", "http://localhost:8123"] interval: 15s timeout: 10s retries: 3 start_period: 90s volumes: - "/etc/localtime:/etc/localtime:ro" - ".</article><article class=featured-single><h4><a href=/posts/openwrt-%E4%BD%BF%E7%94%A8-lets-encrypt-%E8%AF%81%E4%B9%A6%E5%BC%80%E5%90%AF-https-%E8%AE%BF%E9%97%AE/>OpenWrt 使用 Lets Encrypt 证书开启 HTTPS 访问</a></h4><p><small>November 11, 2022&nbsp;· 281 words&nbsp;· 2 min</small><p>OpenWrt 使用 Let&rsquo;s Encrypt 证书开启 HTTPS 访问 OpenWrt 支持开启 HTTPS 访问，但是自签发的证书无法通过 Chrome 等浏览器的认证；因此需要使用 Let&rsquo;s Encrypt 申请证书；通过 uHTTPd 应用配置证书，使用 DNS 验证的方式申请证书
配置 HTTPS 访问需要使用到公网 IP 和域名，需要确认已经可以通过公网访问，并且可以修改域名的解析
安装 uHTTPd uHTTPd 用于 OpenWrt 配置 Web 服务，如端口，证书等
opkg update opkg install luci-app-uhttpd luci-i18n-uhttpd-zh-cn 安装完成后即可在服务-uHTTPd 页面查看端口和证书配置
安装配置 ACME ACME 是 Let&rsquo;s Encrypt 官方支持的客户端；OpenWrt 支持使用 ACME 申请证书，在 ACME 应用中添加证书相关配置即可
安装 ACME opkg update opkg install acme luci-app-acme luci-i18n-acme-zh-cn acme-dnsapi 安装完成后可以在服务-ACME 证书中进行配置
配置 ACME 配置账户信息 首先需要为 ACME 配置邮箱，用于接受证书过期等信息；在 ACME 全局配置-电子邮件帐户添加即可</article></div></div></div></div><footer class=footer><p>&copy; 2023 <a href=https://blog.hellowood.dev>HelloWood</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-up"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg></a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>